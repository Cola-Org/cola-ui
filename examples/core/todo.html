<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<script src="../include-all.js"></script>
	<script type="text/javascript">
		cola(function(model) {
			model.action({
				query: function(arg) {
					console.log(arg.value);
					cola.widget("groupList").refresh();
				},
				showDetail: function(user) {
					console.log(user);
					cola.widget("userDetailLayer").toggle();
				}
			});
			model.describe("users", {
				provider: "../data/users.json"
			});
			model.widgetConfig({
				groupList: {
					$type: "listView",
					bind: "user in users",
					textProperty: "cname",
					group: false,
					indexBar:true,
					groupCollapsible: false,
					getGroupString: function(arg) {
						var label = arg.item.get("pyname");
						if (label) arg.result = label.charAt(0);
					},
					filterItem: function(){
						console.log("==");
						var queryName = model.get("username");
						return item.get("pyname").indexof(queryName)>-1 || item.get("cname").indexOf(queryName)>-1;
					}
				}
			});
		});
		cola(function (model) {
			model.set({
				name:"张三s",
				todos: [
					{ title: "meeting", done: true },
					{ title: "date" },
					{ title: "lunch" , done: true},
					{ title: "play basketball" },
					{ title: "game" }
				],
				sortOptions: ["", "done", "-done", "title", "-title", "done,title"]
			});

			model.action({
				add: function () {
					model.get("todos").insert({
						title: model.get("newItem")
					});
					model.set("newItem", null);
				},
				delete: function (todo) {
					todo.remove();
				},
				stat: function () {
					var done = 0, total = 0;
					model.get("todos").each(function (todo) {
						total++;
						if (todo.get("done")) done++;
					});
					return done + "/" + total;
				}
			});
		});
	</script>
</head>
<body>
<p>
	<input c-bind="newItem">
	<button c-onclick="add()" c-disabled="newItem?false:true">Add</button>
	<button c-class="red:name=='张三'">Add</button>
</p>
<p>
	Filter: <input c-bind="filterParam">
	Sort: <select c-bind="sortParam" c-options="sortOptions"></select>
</p>
<ul>
	<!--<li c-repeat="todo in sort(filter(todos,filterParam),sortParam)">-->
	<li c-repeat="todo in chain(todos).filter(filterParam).sort(sortParam)">
		<input type="checkbox" c-bind="todo.done">
		<span c-bind="todo.title"></span>
		<button c-onclick="delete(todo)">Delete</button>
	</li>
</ul>
<p>
	<span c-bind="stat()"></span>
</p>
</body>
</html>