<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<script src="../include-all.js"></script>
	<script type="text/javascript">
		cola(function (model) {
			model.set("categories",  [
				{
					name: "Fruit",
					products: [
						{
							name: "Apple",
							price: 40
						},
						{
							name: "Orange",
							price: 20
						},
						{
							name: "Banana",
							price: 15
						}
					]
				},
				{
					name: "Drink",
					products: [
						{
							name: "Beer",
							price: 12
						},
						{
							name: "Water",
							price: 5
						},
						{
							name: "Coffee",
							price: 25
						}
					]
				},
				{
					name: "Snacks",
					products: [
						{
							name: "Potato chips",
							price: 15
						},
						{
							name: "Cake",
							price: 30
						}
					]
				}
			]);

			model.get("categories").watch("**", function(path, type, arg) {
				alert("watch: " + path);
			});

			model.action({
				setName: function(entity) {
					entity.set("name", entity.get("name") +  " *** ");
				},
				changePrice: function(product) {
					product.set("price", Math.round(product.get("price") * 1.2));
				},
				delete: function(entity) {
					entity.remove();
				}
			});
		});
	</script>
</head>
<body class="c-view">
	<ul>
		<li c-repeat="category in categories">
			<span c-bind="category.name"></span>
			<button c-onclick="setName(category)">SetName</button>
			<button c-onclick="delete(category)">Delete</button>
			<ul>
				<li c-repeat="product in category.products">
					<span c-bind="category.name"></span>
					<span c-bind="product.name"></span>
					<span c-bind="formatNumber(product.price,'$#,##0.00')"></span>
					<button c-onclick="setName(product)">SetName</button>
					<button c-onclick="changePrice(product)">Change Price</button>
					<button c-onclick="delete(product)">Delete</button>
				</li>
			</ul>
		</li>
	</ul>


</body>
</html>