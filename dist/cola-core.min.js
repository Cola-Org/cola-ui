/*! Cola UI - 0.9.8
 * Copyright (c) 2002-2016 BSTEK Corp. All rights reserved.
 *
 * This file is dual-licensed under the AGPLv3 (http://www.gnu.org/licenses/agpl-3.0.html)
 * and BSDN commercial (http://www.bsdn.org/licenses) licenses.
 *
 * If you are unsure which license is appropriate for your use, please contact the sales department
 * at http://www.bstek.com/contact.
 */
(function(){var ACTIVE_PINCH_REG,ACTIVE_ROTATE_REG,ALIAS_REGEXP,EntityIndex,IGNORE_NODES,LinkedList,ON_NODE_REMOVED_KEY,PAN_VERTICAL_events,Page,SWIPE_VERTICAL_events,TYPE_SEVERITY,USER_DATA_KEY,WIDGET_TAGS_REGISTRY,_$,_DOMNodeInsertedListener,_DOMNodeRemovedListener,_Entity,_EntityList,_ExpressionDataModel,_ExpressionScope,_SYS_PARAMS,_compileResourceUrl,_compileWidgetAttribute,_compileWidgetDom,_cssCache,_destroyDomBinding,_destroyRenderableElement,_doRenderDomTemplate,_evalDataPath,_extendWidget,_filterCollection,_filterEntity,_findRouter,_findWidgetConfig,_getData,_getEntityPath,_getHashPath,_getNodeDataId,_jsCache,_loadCss,_loadHtml,_loadJs,_matchValue,_nodesToBeRemove,_numberWords,_onHashChange,_onStateChange,_setValue,_sortCollection,_switchRouter,_toJSON,_triggerWatcher,_unloadCss,_unwatch,_watch,appendChild,browser,buildContent,cleanStamp,cola,colaEventRegistry,createContentPart,createNodeForAppend,currentRoutePath,currentRouter,defaultActionTimestamp,defaultDataTypes,definedSetting,digestExpression,doMergeDefinitions,doms,exceptionStack,getDefinition,hasDefinition,ignoreRouterSettingChange,key,oldIE,originalAjax,os,resourceStore,routerRegistry,setAttrs,setting,splitExpression,sprintf,tagSplitter,trimPath,typeRegistry,uniqueIdSeed,value,xCreate,slice=[].slice,extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;if(this.cola=cola=function(){var a;return null!=(a=cola._rootFunc)?a.apply(cola,arguments):void 0},cola.util={},cola.constants={VARIABLE_NAME_REGEXP:/^[_a-zA-Z][_a-zA-Z0-9]*$/g,VIEW_CLASS:"c-view",VIEW_PORT_CLASS:"c-viewport",IGNORE_DIRECTIVE:"c-ignore",COLLECTION_CURRENT_CLASS:"current",DEFAULT_PATH:"$root",REPEAT_INDEX:"$index",DOM_USER_DATA_KEY:"_d",DOM_BINDING_KEY:"_binding",DOM_INITIALIZER_KEY:"_initialize",REPEAT_TEMPLATE_KEY:"_template",REPEAT_TAIL_KEY:"_tail",DOM_ELEMENT_KEY:"_element",DOM_SKIP_CHILDREN:"_skipChildren",NOT_WHITE_REG:/\S+/g,CLASS_REG:/[\t\r\n\f]/g,WIDGET_DIMENSION_UNIT:"px",MESSAGE_REFRESH:0,MESSAGE_PROPERTY_CHANGE:1,MESSAGE_CURRENT_CHANGE:10,MESSAGE_EDITING_STATE_CHANGE:11,MESSAGE_VALIDATION_STATE_CHANGE:15,MESSAGE_INSERT:20,MESSAGE_REMOVE:21,MESSAGE_LOADING_START:30,MESSAGE_LOADING_END:31},oldIE=!-[1],$.xCreate=xCreate=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(i=function(a){var b;return null===a||void 0===a?!0:(b=typeof a,"object"!==b&&"function"!==b||a instanceof Date)},a instanceof Array){for(h=[],j=0,k=a.length;k>j;j++)o=a[j],g=xCreate(o,b),null!=g&&h.push(g);return h}if(xCreate.templateProcessors.length)for(q=xCreate.templateProcessors,n=0,l=q.length;l>n;n++)if(s=q[n],g=s(a),null!=g)return g;if("string"==typeof a){if("^"!==a.charAt(0))return document.createTextNode(a);a={tagName:a.substring(1)}}if(r=a.tagName||"DIV",r=r.toUpperCase(),f=oldIE&&"INPUT"===r.toUpperCase()&&a.type?document.createElement("<"+r+' type="'+a.type+'"/>'):document.createElement(r),c=$(f),setAttrs(f,c,a,b),e=a.content,null!=e)if(i(e))"string"==typeof e&&"^"===e.charAt(0)?appendChild(f,document.createElement(e.substring(1))):c.text(e);else if(e instanceof Array)for(p=0,m=e.length;m>p;p++)o=e[p],i(o)?"string"==typeof o&&"^"===o.charAt(0)?appendChild(f,document.createElement(o.substring(1))):appendChild(f,document.createTextNode(o)):(d=xCreate(o,b),null!=d&&appendChild(f,d));else e.nodeType?appendChild(f,e):(d=xCreate(e,b),null!=d&&appendChild(f,d));else a.html&&c.html(a.html);return f},xCreate.templateProcessors=[],xCreate.attributeProcessor={data:function(a,b,c,d){a.data(c)},style:function(a,b,c,d){"string"==typeof c?a.attr("style",c):null!==c&&a.css(c)}},setAttrs=function(a,b,c,d){var e,f,g;for(e in c)if(f=c[e],g=xCreate.attributeProcessor[e])g(b,e,f,d);else switch(e){case"tagName":case"nodeName":case"content":case"html":continue;case"contextKey":d instanceof Object&&f&&"string"==typeof f&&(d[f]=a);break;case"data":d instanceof Object&&f&&"string"==typeof f&&(d[f]=a);break;case"classname":b.attr("class",f);break;default:"function"==typeof f?b.on(e,f):b.attr(e,f)}},appendChild=function(a,b){var c;return"TABLE"===a.nodeName&&"TR"===b.nodeName&&(c=a&&a.tBodies[0]?a.tBodies[0]:a.appendChild(document.createElement("tbody")),a=c),a.appendChild(b)},createNodeForAppend=function(a,b){var c,d,e,f,g;if(g=xCreate(a,b),!g)return null;if(g instanceof Array){for(d=document.createDocumentFragment(),e=0,f=g.length;f>e;e++)c=g[e],d.appendChild(c);g=d}return g},$.fn.xAppend=function(a,b){var c;return c=createNodeForAppend(a,b),c?this.append(c):null},$.fn.xInsertBefore=function(a,b){var c;return c=createNodeForAppend(a,b),c?this.before(c):null},$.fn.xInsertAfter=function(a,b){var c;return c=createNodeForAppend(a,b),c?this.after(c):null},cola.util.KeyedArray=function(){function a(){this.elements=[],this.keys=[],this.keyMap={}}return a.prototype.size=0,a.prototype.add=function(a,b){var c;return this.keyMap.hasOwnProperty(a)&&(c=this.elements.indexOf(b),c>-1&&(this.elements.splice(c,1),this.keys.splice(c,1))),this.keyMap[a]=b,this.size=this.elements.push(b),this.keys.push(a),this},a.prototype.remove=function(a){var b,c;return"number"==typeof a?(c=a,a=this.keys[c],b=this.elements[c],this.elements.splice(c,1),this.keys.splice(c,1),this.size=this.elements.length,delete this.keyMap[a]):(b=this.keyMap[a],delete this.keyMap[a],b&&(c=this.keys.indexOf(a),c>-1&&(this.elements.splice(c,1),this.keys.splice(c,1),this.size=this.elements.length))),b},a.prototype.get=function(a){return"number"==typeof a?this.elements[a]:this.keyMap[a]},a.prototype.getIndex=function(a){return this.keyMap.hasOwnProperty(a)?this.keys.indexOf(a):-1},a.prototype.clear=function(){this.elements=[],this.keys=[],this.keyMap={},this.size=0},a.prototype.elements=function(){return this.elements},a.prototype.each=function(a){var b,c,d,e,f,g;for(d=this.keys,g=this.elements,c=e=0,f=g.length;f>e&&(b=g[c],a.call(this,b,d[c])!==!1);c=++e);},a}(),cola.util.trim=function(a){return null!=a?String.prototype.trim.call(a):""},cola.util.capitalize=function(a){return a?a.charAt(0).toUpperCase()+a.slice(1):a},cola.util.isSimpleValue=function(a){var b;return null===a||void 0===a?!0:(b=typeof a,"object"!==b&&"function"!==b||a instanceof Date||a instanceof Array)},cola.util.each=function(a,b){var c,d,e,f;for(c=e=0,f=a.length;f>e&&(d=a[c],b(d,c)!==!1);c=++e);},cola.util.concatUrl=function(){var a,b,c,d,e,f,g;for(g=1<=arguments.length?slice.call(arguments,0):[],d=g.length-1,b=c=0,e=g.length;e>c;b=++c)f=g[b],a=!1,b>0&&47===f.charCodeAt(0)&&(f=f.substring(1),a=!0),d>b&&47===f.charCodeAt(f.length-1)&&(f=f.substring(0,f.length-1),a=!0),a&&(g[b]=f);return g.join("/")},cola.util.parseStyleLikeString=function(a,b){var c,d,e,f,g,h,i,j,k;if(!a)return!1;for(i={},h=a.split(";"),c=e=0,f=h.length;f>e;c=++e)if(g=h[c],d=g.indexOf(":"),d>0)k=this.trim(g.substring(0,d)),j=this.trim(g.substring(d+1)),k&&j&&(i[k]=j);else{if(g=this.trim(g),!g)continue;0===c&&b?i[b]=g:i[g]=!0}return i},cola.util.parseFunctionArgs=function(a){var b,c,d,e,f,g,h;for(c=a.toString().match(/\([^\(\)]*\)/)[0],h=c.substring(1,c.length-1).split(","),d=[],e=f=0,g=h.length;g>f;e=++f)b=h[e],b=cola.util.trim(b),b&&d.push(b);return d},cola.util.parseListener=function(a){var b,c,d;return d=1,b=a.toString().match(/\([^\(\)]*\)/)[0],c=b.substring(1,b.length-1).split(","),c.length&&"arg"===cola.util.trim(c[0])&&(d=2),a._argsMode=d,d},cola.util.isCompatibleType=function(a,b){if(b===a)return!0;for(;b.__super__;)if(b=b.__super__.constructor,b===a)return!0;return!1},cola.util.delay=function(a,b,c,d){cola.util.cancelDelay(a,b),a["_timer_"+b]=setTimeout(function(){d.call(a)},c)},cola.util.cancelDelay=function(a,b){var c,d;c="_timer_"+b,d=a[c],d&&(delete a[c],clearTimeout(d))},cola.util.waitForAll=function(a,b){var c,d,e,f,g,h,i,j;for(a&&a.length||cola.callback(b,!0),c=0,j=a.length,h={},f=0,g=a.length;g>f;f++)d=a[f],e=cola.uniqueId(),h[e]=!0,i={id:e,complete:function(a){var d;d||(a?h[this.id]&&(delete h[this.id],c++,c===j&&(cola.callback(b,!0),d=!0)):(cola.callback(b,!1),d=!0))}},i.scope=i,d(i)},cola.util.formatDate=function(a,b){return null==a?"":(a instanceof XDate||(a=new XDate(a)),a.toString(b||cola.setting("defaultDateFormat")))},cola.util.formatNumber=function(a,b){return null==a?"":isNaN(a)?a:formatNumber(b||cola.setting("defaultNumberFormat"),a)},cola.util.format=function(a,b){return a instanceof Date?cola.util.formatDate(a,b):isFinite(a)?cola.util.formatNumber(a,b):null===a||void 0===a?"":a},cola.util.isSuperClass=function(a,b){var c;if(!a)return!1;for(;b;){if(b.__super__===a.prototype)return!0;b=null!=(c=b.__super__)?c.constructor:void 0}return!1},cola.version="${version}",uniqueIdSeed=1,uniqueIdSeed=1,cola.uniqueId=function(){return"_id"+uniqueIdSeed++},cola.sequenceNo=function(){return uniqueIdSeed++},cola._EMPTY_FUNC=function(){},"undefined"!=typeof window&&null!==window&&!function(){var a,b,c;cola.browser={},cola.os={},cola.device={},c=window.navigator.userAgent.toLowerCase(),(a=c.match(/webkit\/([\d.]+)/))?(cola.browser.webkit=a[1]||-1,(a=c.match(/chrome\/([\d.]+)/))?cola.browser.chrome=parseFloat(a[1])||-1:(a=c.match(/version\/([\d.]+).*safari/))&&(cola.browser.safari=parseFloat(a[1])||-1),(a=c.match(/qqbrowser\/([\d.]+)/))&&(cola.browser.qqbrowser=parseFloat(a[1])||-1)):(a=c.match(/msie ([\d.]+)/))?cola.browser.ie=parseFloat(a[1])||-1:(a=c.match(/trident/))?cola.browser.ie=11:(a=c.match(/firefox\/([\d.]+)/))?cola.browser.mozilla=parseFloat(a[1])||-1:(a=c.match(/opera.([\d.]+)/))&&(cola.browser.opera=parseFloat(a[1])||-1),(a=c.match(/(iphone|ipad).*os\s([\d_]+)/))?(cola.os.ios=parseFloat(a[2])||-1,cola.device.pad="ipad"===a[1],cola.device.phone=!cola.device.pad):(a=c.match(/(android)\s+([\d.]+)/))?cola.os.android=parseFloat(a[1])||-1:(a=c.match(/(windows)[\D]*([\d]+)/))&&(cola.os.windows=parseFloat(a[1])||-1),(a=c.match(/micromessenger\/([\d.]+)/))&&(cola.browser.weixin=parseFloat(a[1])||-1),cola.device.mobile=!!("ontouchstart"in window&&c.match(/(mobile)/)),cola.device.desktop=!cola.device.mobile,cola.device.mobile&&!cola.os.ios&&(b=768,cola.browser.qqbrowser?cola.device.pad=window.screen.width/2>=b||window.screen.height/2>=b:cola.device.pad=window.screen.width>=b||window.screen.height>=b,cola.device.phone=!cola.device.pad)}(),colaEventRegistry={ready:{},settingChange:{},exception:{},beforeRouterSwitch:{},routerSwitch:{}},cola.on=function(a,b){var c,d,e,f,g;if(e=a.indexOf(":"),e>0&&(c=a.substring(e+1),a=a.substring(0,e)),f=colaEventRegistry[a],!f)throw new cola.Exception('Unrecognized event "'+a+'".');if("function"!=typeof b)throw new cola.Exception("Invalid event listener.");return g=f.listeners,d=f.aliasMap,g?(c&&(null!=d?d[c]:void 0)>-1&&cola.off(a+":"+c),g.push(b),e=g.length-1):(f.listeners=g=[b],e=0),c&&(d||(f.aliasMap=d={}),d[c]=e),this},cola.off=function(a,b){var c,d,e,f,g;if(e=a.indexOf(":"),e>0&&(c=a.substring(e+1),a=a.substring(0,e)),f=colaEventRegistry[a],!f)return this;if(g=f.listeners,!g||0===g.length)return this;if(e=-1,c)d=f.aliasMap,e=null!=d?d[c]:void 0,e>-1&&(null!=d&&delete d[c],g.splice(e,1));else if(b){if(e=g.indexOf(b),e>-1&&(g.splice(e,1),d=f.aliasMap))for(c in d)if(d[c]===b){delete d[c];break}}else delete f.listeners,delete f.aliasMap;return this},cola.getListeners=function(a){var b,c;return b=null!=(c=colaEventRegistry[a])?c.listeners:void 0,(null!=b?b.length:void 0)?b:null},cola.fire=function(a,b,c){var d,e,f,g,h,i,j;if(null==c&&(c={}),h=null!=(i=colaEventRegistry[a])?i.listeners:void 0)for(e=0,f=h.length;f>e;e++)if(g=h[e],d=g._argsMode,g._argsMode||(d=cola.util.parseListener(g)),j=1===d?g.call(this,b,c):g.call(this,c,b),j===!1)return!1;return!0},cola.ready=function(a){return this.on("ready",a)},setting={defaultCharset:"utf-8",defaultNumberFormat:"#,##0.##",defaultDateFormat:"yyyy-MM-dd",defaultSubmitDateFormat:"yyyy-MM-dd'T'HH:mm:ss'T'"},cola.setting=function(a,b){var c,d;if("string"==typeof a){if(void 0===b)return setting[a];setting[a]=b,cola.getListeners("settingChange")&&cola.fire("settingChange",cola,{key:a})}else if("object"==typeof a)for(c in a)d=a[c],setting[c]=d,cola.getListeners("settingChange")&&cola.fire("settingChange",cola,{key:c});return this},definedSetting="undefined"!=typeof colaSetting&&null!==colaSetting||("undefined"!=typeof global&&null!==global?global.colaSetting:void 0))for(key in definedSetting)value=definedSetting[key],cola.setting(key,value);exceptionStack=[],cola.Exception=function(){function Exception(a,b){this.message=a,this.error=b,this.error&&"undefined"!=typeof console&&null!==console&&"function"==typeof console.trace&&console.trace(this.error),exceptionStack.push(this),setTimeout(function(a){return function(){exceptionStack.indexOf(a)>-1&&cola.Exception.processException(a)}}(this),50)}return Exception.processException=function(ex){var ex2,scope;if(!(cola.Exception.ignoreAll||(ex&&cola.Exception.removeException(ex),ex instanceof cola.AbortException||cola.fire("exception",cola,{exception:ex})===!1)))if(ex instanceof cola.RunnableException)eval("var fn = function(){"+ex.script+"}"),scope="undefined"!=typeof window&&null!==window?window:this,fn.call(scope);else{if(cola.Exception.ignoreAll)return;try{("undefined"!=typeof document&&null!==document?document.body:void 0)?ex.showException?ex.showException():cola.Exception.showException(ex):ex.safeShowException?ex.safeShowException():cola.Exception.safeShowException(ex)}catch(_error){ex2=_error,cola.Exception.removeException(ex2),ex2.safeShowException?ex2.safeShowException():cola.Exception.safeShowException(ex2)}}},Exception.removeException=function(a){var b;b=exceptionStack.indexOf(a),b>-1&&exceptionStack.splice(b,1)},Exception.safeShowException=function(a){var b;a instanceof cola.Exception||a instanceof Error?b=a.message:(b=a+"","function"==typeof alert&&alert(b))},Exception.showException=function(a){return this.safeShowException(a)},Exception}(),cola.AbortException=function(a){function b(){}return extend(b,a),b}(cola.Exception),cola.RunnableException=function(a){function b(a){this.script=a,b.__super__.constructor.call(this,"[script]")}return extend(b,a),b}(cola.Exception),resourceStore={},sprintf=function(){var a,b,c,d,e,f;for(f=arguments[0],e=2<=arguments.length?slice.call(arguments,1):[],a=b=0,c=e.length;c>b;a=++b)d=e[a],f=f.replace(new RegExp("\\{"+a+"\\}","g"),d);return f},cola.resource=function(){var a,b,c,d,e;if(b=arguments[0],c=2<=arguments.length?slice.call(arguments,1):[],"string"==typeof b)return e=resourceStore[b],null!=e?c.length?sprintf.apply(this,[e].concat(c)):e:(null!=c?c[0]:void 0)||b;a=b;for(b in a)d=a[b],resourceStore[b]=d},cola.ResourceException=function(a){function b(){var a,c;a=arguments[0],c=2<=arguments.length?slice.call(arguments,1):[],b.__super__.constructor.call(this,cola.resource.apply(cola,[a].concat(slice.call(c))))}return extend(b,a),b}(cola.Exception),cola.callback=function(a,b,c){var d;if(a)if("function"==typeof a){if(b)return a.call(this,c)}else{if(d=a.scope||this,!a.delay)return a.complete.call(d,b,c);setTimeout(function(){a.complete.call(d,b,c)},a.delay)}},cola.resource({"cola.date.monthNames":"January,February,March,April,May,June,July,August,September,October,November,December","cola.date.monthNamesShort":"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sept,Oct,Nov,Dec","cola.date.dayNames":"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday","cola.date.dayNamesShort":"S,M,T,W,T,F,S","cola.date.amDesignator":"AM","cola.date.pmDesignator":"PM","cola.date.time":"Time","cola.validator.error.required":"Cannot be empty.","cola.validator.error.length":"Length is not within the correct range.","cola.validator.error.number":"Value is not within the correct range.","cola.validator.error.email":"Email format is incorrect.","cola.validator.error.url":"URL format is incorrect.","cola.validator.error.regExp":"Format is incorrect.","cola.messageBox.info.title":"Information","cola.messageBox.warning.title":"Warning","cola.messageBox.error.title":"Error","cola.messageBox.question.title":"Confirm","cola.message.approve":"Ok","cola.message.deny":"Cancel","cola.pager.info":"Page:{0}/{1}"}),_toJSON=function(a){var b,c,d;if(a)if("object"==typeof a)if(a instanceof cola.Entity||a instanceof cola.EntityList)a=a.toJSON();else if(a instanceof Date)a=cola.util.formatDate(a,cola.setting("defaultSubmitDateFormat"));else{c=a,a={};for(b in c)d=c[b],a[b]=_toJSON(d)}else"function"==typeof a&&(a=void 0);return a},originalAjax=jQuery.ajax,$.ajax=function(a,b){var c,d,e,f;if("object"!=typeof a||b||(b=a),c=b.data){if("object"==typeof c)if(c instanceof cola.Entity||c instanceof cola.EntityList)c=c.toJSON();else if(c instanceof FormData)c instanceof Date&&(c=_toJSON(c));else{e=c,c={};for(d in e)f=e[d],c[d]=_toJSON(f)}else"function"==typeof c&&(c=void 0);b.data=c}return originalAjax.apply(this,[a,b])},tagSplitter=" ",doMergeDefinitions=function(a,b,c){var d,e,f,g;if(a!==b)for(f in b)if(e=b[f],a.$has(f))if(d=a[f],d&&e)for(g in e)(c||!d.hasOwnProperty(g))&&(d[g]=e[g]);else a[f]=e;else a[f]=e},hasDefinition=function(a){return this.hasOwnProperty(a.toLowerCase())},getDefinition=function(a){return this[a.toLowerCase()]},cola.preprocessClass=function(a){var b,c,d,e,f,g,h;if((!a.attributes._inited||!a.events._inited)&&(h=null!=(g=a.__super__)?g.constructor:void 0)){if(!h||h.attributes._inited&&h.events._inited||cola.preprocessClass(h),b=a.attributes,!b._inited){b._inited=!0;for(e in b)c=b[e],f=e.toLowerCase(),e!==f&&(null==c&&(c={}),c.name=e,b[f]=c,delete b[e]);b.$has=hasDefinition,b.$get=getDefinition,doMergeDefinitions(b,h.attributes,!1)}if(d=a.events,!d._inited){d._inited=!0;for(e in d)c=d[e],f=e.toLowerCase(),e!==f&&(d[f]=c,delete d[e]);d.$has=hasDefinition,d.$get=getDefinition,doMergeDefinitions(d,h.events,!1)}}},cola.Element=function(){function Element(a){var b,c,d,e,f,g,h,i;e=this.constructor,e.attributes._inited&&e.events._inited||cola.preprocessClass(e),this._constructing=!0,this._scope=(null!=a?a.scope:void 0)||cola.currentScope,d=e.attributes;for(b in d)c=d[b],void 0!==(null!=c?c.defaultValue:void 0)&&(c.setter?c.setter.call(this,c.defaultValue,b):this["_"+((null!=c?c.name:void 0)||b)]=c.defaultValue);if(e._constructors)for(i=e._constructors,g=0,h=i.length;h>g;g++)f=i[g],f.call(this);a&&this.set(a,!0),delete this._constructing,this.fire("create",this)}return Element.mixin=function(a,b){var c,d,e,f,g,h;for(h in b)e=b[h],"attributes"===h?(g=e,g&&(c=null!=a.attributes?a.attributes:a.attributes={},doMergeDefinitions(c,g,!0))):"events"===h?(f=e,f&&(d=null!=a.events?a.events:a.events={},doMergeDefinitions(d,f,!0))):"constructor"===h?a._constructors?a._constructors.push(e):a._constructors=[e]:"destroy"===h?a._destructors?a._destructors.push(e):a._destructors=[e]:a.prototype[h]=e},Element.attributes={model:{readOnly:!0,getter:function(){return this._scope}},tag:{getter:function(){return this._tag?this._tag.join(tagSplitter):null},setter:function(a){var b,c,d,e,f,g,h;if(this._tag)for(f=this._tag,b=0,c=f.length;c>b;b++)g=f[b],cola.tagManager.unreg(g,this);if(a)for(this._tag=h=a.split(tagSplitter),e=0,d=h.length;d>e;e++)g=h[e],cola.tagManager.reg(g,this);else this._tag=null}},userData:null},Element.events={create:null,attributeChange:null,destroy:null},Element.prototype.destroy=function(){var a,b,c,d,e,f,g,h;if(a=this.constructor,a._destructors)for(g=a._destructors,d=0,e=g.length;e>d;d++)b=g[d],b.call(this);if(this._elementAttrBindings){h=this._elementAttrBindings;for(f in h)c=h[f],c.destroy()}this.fire("destroy",this),this._tag&&this._set("tag",null)},Element.prototype.get=function(a,b){var c,d,e,f,g;if(a.indexOf(".")>-1){for(g=a.split("."),e=this,c=0,d=g.length;d>c&&(f=g[c],e=e instanceof cola.Element?e._get(f,b):"function"==typeof e.get?e.get(f):e[f],null!=e);c++);return e}return this._get(a,b)},Element.prototype._get=function(a,b){var c;if(!this.constructor.attributes.$has(a)){if(b)return;throw new cola.Exception('Unrecognized Attribute "'+a+'".')}return c=this.constructor.attributes[a.toLowerCase()],(null!=c?c.getter:void 0)?c.getter.call(this,a):this["_"+a]},Element.prototype.set=function(a,b,c){var d,e,f,g,h,i,j;if("string"==typeof a)if(a.indexOf(".")>-1){for(j=a.split("."),h=this,e=f=0,g=j.length;g>f&&(i=j[e],h=h instanceof cola.Element?h._get(i,c):h[i],null!=h)&&!(e>=j.length-2);e=++f);if(null==h&&!c)throw new cola.Exception('Cannot set attribute "'+i.slice(0,e).join(".")+'" of undefined.');h instanceof cola.Element?h._set(j[j.length-1],b,c):"function"==typeof h.set?h.set(j[j.length-1],b):h[j[j.length-1]]=b}else this._set(a,b,c);else{d=a,c=b;for(a in d)this.set(a,d[a],c)}return this},Element.prototype._set=function(a,b,c){var d,e,f,g,h,i,j,k;if("string"==typeof b&&this._scope&&123===b.charCodeAt(0)&&(i=cola._compileText(b),(null!=i?i.length:void 0)>0&&(b=i[0])),this.constructor.attributes.$has(a)){if(e=this.constructor.attributes[a.toLowerCase()]){if(e.readOnly){if(c)return;throw new cola.Exception('Attribute "'+a+'" is readonly.')}if(!this._constructing&&e.readOnlyAfterCreate){if(c)return;throw new cola.Exception('Attribute "'+a+'" cannot be changed after create.')}}}else if(b){if(f=a,h=f.indexOf(":"),h>0&&(f=f.substring(0,h)),this.constructor.events.$has(f)){if(b instanceof cola.Expression)return g=b,k=this._scope,void this.on(a,function(a,b){g.evaluate(k,"never",{vars:{$self:a,$arg:b}})},c);if("function"==typeof b)return void this.on(a,b);if("string"==typeof b&&(d=null!=(j=this._scope)?j.action(b):void 0))return void this.on(a,d)}if(c)return;throw new cola.Exception('Unrecognized Attribute "'+a+'".')}this._doSet(a,e,b),this._eventRegistry&&this.getListeners("attributeChange")&&this.fire("attributeChange",this,{attribute:a})},Element.prototype._doSet=function(a,b,c){var d,e,f,g;if(!this._duringBindingRefresh&&this._elementAttrBindings&&(d=this._elementAttrBindings[a],d&&(d.destroy(),delete this._elementAttrBindings[a])),c instanceof cola.Expression&&cola.currentScope&&(f=c,g=cola.currentScope,f.isStatic?c=f.evaluate(g,"never"):(d=new cola.ElementAttrBinding(this,a,f,g),null==this._elementAttrBindings&&(this._elementAttrBindings={}),e=this._elementAttrBindings,e&&(e[a]=d),c=d.evaluate())),b){if("boolean"===b.type?null!=c&&"boolean"!=typeof c&&(c="true"===c):"number"===b.type&&null!=c&&"number"!=typeof c&&(c=parseFloat(c)||0),b["enum"]&&b["enum"].indexOf(c)<0)throw new cola.Exception('The value "'+c+'" of attribute "'+a+'" is out of range.');if(b.setter)return void b.setter.call(this,c,a)}this["_"+((null!=b?b.name:void 0)||a)]=c},Element.prototype._on=function(a,b,c,d){var e,f,g,h,i;if(a=a.toLowerCase(),f=this.constructor.events[a],this._eventRegistry?h=this._eventRegistry[a]:this._eventRegistry={},h||(this._eventRegistry[a]=h={}),d&&(null==h.onceListeners&&(h.onceListeners=[]),h.onceListeners.push(b)),i=h.listeners,e=h.aliasMap,i){if((null!=f?f.singleListener:void 0)&&i.length)throw new cola.Exception('Multi listeners is not allowed for event "'+a+'".');c&&(null!=e?e[c]:void 0)>-1&&cola.off(a+":"+c),i.push(b),g=i.length-1}else h.listeners=i=[b],g=0;c&&(e||(h.aliasMap=e={}),e[c]=g)},Element.prototype.on=function(a,b,c){var d,e;if(e=a.indexOf(":"),e>0&&(d=a.substring(e+1),a=a.substring(0,e)),!this.constructor.events.$has(a))throw new cola.Exception('Unrecognized event "'+a+'".');if("function"!=typeof b)throw new cola.Exception("Invalid event listener.");return this._on(a,b,d,c),this},Element.prototype.one=function(a,b){return this.on(a,b,!0)},Element.prototype._off=function(a,b,c){var d,e,f,g,h;if(a=a.toLowerCase(),f=this._eventRegistry[a],!f)return this;if(g=f.listeners,!g||!g.length)return this;if(e=-1,c||b){if(c)d=f.aliasMap,e=null!=d?d[c]:void 0,e>-1&&(null!=d&&delete d[c],b=g[e],g.splice(e,1));else if(b&&(e=g.indexOf(b),e>-1&&(g.splice(e,1),d=f.aliasMap)))for(c in d)if(d[c]===b){delete d[c];break}f.onceListeners&&b&&(h=f.onceListeners,e=h.indexOf(b),e>-1&&(h.splice(e,1),h.length||delete f.onceListeners))}else delete f.listeners,delete f.aliasMap},Element.prototype.off=function(a,b){var c,d;return this._eventRegistry?(d=a.indexOf(":"),d>0&&(c=a.substring(d+1),a=a.substring(0,d)),this._off(a,b,c),this):this},Element.prototype.getListeners=function(a){var b,c;return null!=(b=this._eventRegistry)&&null!=(c=b[a.toLowerCase()])?c.listeners:void 0},Element.prototype.fire=function(eventName,self,arg){var argsMode,l,len1,len2,listener,listenerRegistry,listeners,o,oldScope,onceListeners,result,retValue;if(this._eventRegistry){if(eventName=eventName.toLowerCase(),result=void 0,listenerRegistry=this._eventRegistry[eventName],listenerRegistry&&(listeners=listenerRegistry.listeners)){arg?arg.model=this._scope:arg={model:this._scope},oldScope=cola.currentScope,cola.currentScope=this._scope;try{for(l=0,len1=listeners.length;len1>l&&(listener=listeners[l],"function"==typeof listener?(argsMode=listener._argsMode,listener._argsMode||(argsMode=cola.util.parseListener(listener)),retValue=1===argsMode?listener.call(self,self,arg):listener.call(self,arg,self)):"string"==typeof listener&&(retValue=function(_this){return function(){return eval(listener)}}(this)()),void 0!==retValue&&(result=retValue),retValue!==!1);l++);}finally{cola.currentScope=oldScope}if(listenerRegistry.onceListeners)for(onceListeners=listenerRegistry.onceListeners.slice(),delete listenerRegistry.onceListeners,o=0,len2=onceListeners.length;len2>o;o++)listener=onceListeners[o],this.off(eventName,listener)}return result}},Element}(),cola.Definition=function(a){function b(a){var c;(null!=a?a.name:void 0)&&(this._name=a.name,delete a.name,c=(null!=a?a.scope:void 0)||cola.currentScope,c&&c.data.regDefinition(this)),b.__super__.constructor.call(this,a)}return extend(b,a),b.attributes={name:{readOnlyAfterCreate:!0}},b}(cola.Element),cola.Element.createGroup=function(a,b){var c,d,e,f;if(b)for(a=[],d=0,e=a.length;e>d;d++){if(c=a[d],c._scope&&!c._model)for(f=c._scope;f;){if(f instanceof cola.Scope){c._model=f;break}f=f.parent}c._model===b&&a.push(c)}else a=a?a.slice(0):[];return a.set=function(b,c){var d,e,f;for(f=0,e=a.length;e>f;f++)d=a[f],d.set(b,c);return this},a.on=function(b,c,d){var e,f,g;for(g=0,f=a.length;f>g;g++)e=a[g],e.on(b,c,d);return this},a.off=function(b){var c,d,e;for(e=0,d=a.length;d>e;e++)c=a[e],c.off(b);return this},a},cola.tagManager={registry:{},reg:function(a,b){var c;c=this.registry[a],c?c.push(b):this.registry[a]=[b]},unreg:function(a,b){var c,d;b?(c=this.registry[a],c&&(d=c.indexOf(b),d>-1&&(0===d&&1===c.length?delete this.registry[a]:c.splice(d,1)))):delete this.registry[a]},find:function(a){return this.registry[a]}},cola.tag=function(a){var b;return b=cola.tagManager.find(a),cola.Element.createGroup(b)},typeRegistry={},cola.registerType=function(a,b,c){var d;d=typeRegistry[a]||(typeRegistry[a]={}),d[b]=c},cola.registerTypeResolver=function(a,b){var c;c=typeRegistry[a]||(typeRegistry[a]={}),null==c._resolvers&&(c._resolvers=[]),c._resolvers.push(b)},cola.resolveType=function(a,b,c){var d,e,f,g,h,i;if(d=null,e=typeRegistry[a]){if(d=e[(null!=b?b.$type:void 0)||"_default"],!d&&e._resolvers)for(h=e._resolvers,f=0,g=h.length;g>f;f++)if(i=h[f],d=i(b)){if(c&&!cola.util.isCompatibleType(c,d))throw new cola.Exception("Incompatiable class type.");break}return d}},cola.create=function(a,b,c){var d;return"string"==typeof b&&(b={$type:b}),new(d=cola.resolveType(a,b,c))(b)},XDate&&("function"==typeof $&&$(function(){var a;XDate.locales[""]=a={},cola.resource("cola.date.monthNames")&&(a.monthNames=cola.resource("cola.date.monthNames",6).split(",")),cola.resource("cola.date.monthNamesShort")&&(a.monthNamesShort=cola.resource("cola.date.monthNamesShort").split(",")),cola.resource("cola.date.dayNames")&&(a.dayNames=cola.resource("cola.date.dayNames").split(",")),cola.resource("cola.date.dayNamesShort")&&(a.dayNamesShort=cola.resource("cola.date.dayNamesShort").split(",")),cola.resource("cola.date.amDesignator")&&(a.amDesignator=cola.resource("cola.date.amDesignator")),cola.resource("cola.date.pmDesignator")&&(a.pmDesignator=cola.resource("cola.date.pmDesignator"))}),XDate.parsers.push(function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(!(a.indexOf("||")<0)){for(o=a.split("||"),f=o[0],c=o[1],o={y:{len:0,value:1900},M:{len:0,value:1},d:{len:0,value:1},h:{len:0,value:0},m:{len:0,value:0},s:{len:0,value:0}},q=[],g=!1,i=!1,h=0;h<f.length;)b=f.charAt(h),'"'===b?(g=!0,i===b?i=!1:i||(i=b)):!i&&o[b]?(0===o[b].len&&q.push(b),o[b].len++):g=!0,h++;if(r=!1,g){if(e=c.split(/\D+/),""===e[e.length-1]&&e.splice(e.length-1,1),""===e[0]&&e.splice(0,1),q.length===e.length)for(r=!0,h=m=0,l=q.length;l>m;h=++m)p=q[h],o[p].value=parseInt(e[h],10)}else if(c.match(/^\d{2,14}$/))for(r=!0,s=0,j=0,k=q.length;k>j;j++)p=q[j],n=o[p],n.len&&(d=c.substring(s,s+n.len),n.value=parseInt(d,10),s+=n.len);return r?new XDate(o.y.value,o.M.value-1,o.d.value,o.h.value,o.m.value,o.s.value):void 0}})),cola._compileText=function(a){var b,c,d,e,f;for(d=0,f=0;(f=a.indexOf("{{",d))>-1&&(c=digestExpression(a,f+2));)f>d&&(e||(e=[]),e.push(a.substring(d,f))),b=cola._compileExpression(c,c.indexOf(" in ")>0?"repeat":void 0),e?e.push(b):e=[b],d=f+c.length+4;return e?(d<a.length-1&&e.push(a.substring(d)),e):null},digestExpression=function(a,b){var c,d,e,f,g;for(g=b,e=a.length,d=0;e>b;){if(c=a.charCodeAt(b),125!==c||f)d=0,(39===c||34===c)&&(f?f===c&&(f=!1):f=c);else{if(1===d)return a.substring(g,b-1);d++}b++}},cola._compileExpression=function(a,b){var c,d,e;if(!a)return null;if("repeat"===b)if(e=a.indexOf(" in "),e>0){if(c=a.substring(0,e),c.match(cola.constants.VARIABLE_NAME_REGEXP)){if(a=a.substring(e+4),!a)return null;d=new cola.Expression(a,!0),d.raw=c+" in "+d.raw,d.repeat=!0,d.alias=c}if(!d)throw new cola.Exception('"'+a+'" is not a valid expression.')}else d=new cola.Expression(a,!0),d.repeat=!0,d.alias="item";else if("alias"===b){if(e=a.indexOf(" as "),e>0&&(c=a.substring(e+4),c&&c.match(cola.constants.VARIABLE_NAME_REGEXP))){if(a=a.substring(0,e),!a)return null;d=new cola.Expression(a,!0),d.raw=d.raw+" as "+c,d.setAlias=!0,d.alias=c}if(!d)throw new cola.Exception('"'+a+'" should be a alias expression.')}else d=new cola.Expression(a,!0);return d},splitExpression=function(a,b){var c,d,e,f,g,h,i,j;for(j=b.charCodeAt(0),h=null,f=0,d=0,e=a.length;e>d;)c=a.charCodeAt(d),c!==j||i?(39===c||34===c)&&(i?i===c&&(i=!1):i=c):(g=a.substring(f,d),null==h&&(h=[]),h.push(cola.util.trim(g)),f=d+1),d++;return e>f&&(g=a.substring(f),null==h&&(h=[]),h.push(cola.util.trim(g))),h},cola.Expression=function(){function Expression(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(this.raw=a,c=a.indexOf(" on "),c>0&&c<a.length-1)for(this.hasDefinedPath=!0,o=a.substring(c+4),a=a.substring(0,c),p=[],n=o.split(/[,;]/),e=0,g=n.length;g>e;e++)if(m=n[e],m=cola.util.trim(m)){if(m.indexOf(".")>0){for(l=[],j=m.split("."),f=j.length-1,d=i=0,h=j.length;h>i;d=++i)k=j[d],f>d&&33!==k.charCodeAt(0)&&(k="!"+k),l.push(k);m=l.join(".")}p.push(m)}b=a.charCodeAt(0),61===b?(a=a.substring(1),this.isStatic=!0):63===b&&(a=a.substring(1),this.isDyna=!0),this.compile(a),p&&(this.paths=p),this.writeable=("MemberExpression"===this.type||"Identifier"===this.type)&&!this.hasCallStatement}return Expression.prototype.compile=function(a){var b,c,d,e;d=function(b,c,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t;switch(t=b.type){case"MemberExpression":case"Identifier":case"ThisExpression":"MemberExpression"===t?(d(b.object,c,e,!1,g),e.length?e.push(b.property.name):(c.push("."),c.push(b.property.name))):e.push(b.name);break;case"CallExpression":if(g.hasCallStatement=!0,i=b.callee,"Identifier"===i.type)c.push('scope.action("'),c.push(b.callee.name),c.push('")(');else{if("MemberExpression"!==i.type)throw new cola.Exception('"'+a+'" invalid callee.');d(i.object,c,e,!0,g),c.push("."),c.push(i.property.name),c.push("(")}if(null!=(q=b.arguments)?q.length:void 0)for(r=b.arguments,k=l=0,m=r.length;m>l;k=++l)h=r[k],k>0&&c.push(","),d(h,c,e,!0,g);c.push(")");break;case"Literal":c.push(b.raw);break;case"BinaryExpression":case"LogicalExpression":c.push("("),d(b.left,c,e,!0,g),c.push(b.operator),d(b.right,c,e,!0,g),c.push(")");break;case"UnaryExpression":c.push(b.operator),d(b.argument,c,e,!0,g);break;case"ConditionalExpression":
c.push("("),d(b.test,c,e,!0,g),c.push("?"),d(b.consequent,c,e,!0,g),c.push(":"),d(b.alternate,c,e,!0,g),c.push(")");break;case"ArrayExpression":for(c.push("["),s=b.elements,k=o=0,n=s.length;n>o;k=++o)j=s[k],k>0&&c.push(","),d(j,c,e,!0,g);c.push("]")}f&&e.length&&(p=e.join("."),g.paths?g.paths.push(p):g.paths=[p],c.push("_getData(scope,'"),c.push(p),c.push("',loadMode,dataCtx)"),e.splice(0,e.length))},e=jsep(a),this.type=e.type,b=[],c=[],d(e,b,c,!0,this),this.script=b.join("")},Expression.prototype.evaluate=function(scope,loadMode,dataCtx){var expression,parent,pathInfo,retValue;return this.isDyna&&!(null!=dataCtx?dataCtx.ignoreDynaExpression:void 0)?(retValue=eval(this.script),"string"==typeof retValue&&(expression=cola._compileExpression(retValue),null!=dataCtx&&(dataCtx.dynaExpression=expression))):expression=this,expression.writeable?(pathInfo=expression.getParentPathInfo(),pathInfo.parentPath?(parent=scope.get(pathInfo.parentPath,loadMode,dataCtx),parent instanceof cola.EntityList&&(parent=parent.current),parent&&"object"==typeof parent&&(retValue=cola.Entity._evalDataPath(parent,pathInfo.property,!1,loadMode,null,dataCtx)),retValue instanceof cola.Entity||retValue instanceof cola.EntityList?null!=dataCtx&&(dataCtx.closetEntity=retValue):parent instanceof cola.Entity&&null!=dataCtx&&(dataCtx.closetEntity=parent)):(retValue=eval(expression.script),(retValue instanceof cola.Entity||retValue instanceof cola.EntityList)&&null!=dataCtx&&(dataCtx.closetEntity=retValue))):(retValue=eval(expression.script),retValue instanceof cola.Chain&&(retValue=retValue._data)),retValue},Expression.prototype.getParentPathInfo=function(){var a,b,c;return void 0!==this.parentPath?this.parentPath:(this.writeable&&(c=this.paths[0],"Identifier"===this.type?b={parentPath:null,property:c}:(a=c.lastIndexOf("."),b={parentPath:c.substring(0,a),property:c.substring(a+1)})),b)},Expression.prototype.toString=function(){return this.raw},Expression}(),_getData=function(a,b,c,d){var e;return e=a.get(b,c,d),void 0===e&&(null!=d?d.vars:void 0)&&(e=d.vars[b]),e},cola.registerTypeResolver("validator",function(a){return a&&a.$type?cola[cola.util.capitalize(a.$type)+"Validator"]:void 0}),cola.registerTypeResolver("validator",function(a){return"function"==typeof a?cola.CustomValidator:void 0}),cola.Validator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={message:null,messageType:{defaultValue:"error","enum":["error","warning","info"]},disabled:null,validateEmptyValue:null},b.prototype._getDefaultMessage=function(a){return'"'+a+'" is not a valid value.'},b.prototype._parseValidResult=function(a,b){var c;return"boolean"==typeof a?a?a=null:(c=this._message,null==c&&(c=this._getDefaultMessage(b)),a={type:this._messageType,text:c}):a&&"string"==typeof a&&(a={type:this._messageType,text:a}),a},b.prototype.validate=function(a){var b;if(this._validateEmptyValue||null!=a&&""!==a)return b=this._validate(a),this._parseValidResult(b,a)},b}(cola.Definition),cola.RequiredValidator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={validateEmptyValue:{defaultValue:!0},trim:{defaultValue:!0}},b.prototype._getDefaultMessage=function(a){return cola.resource("cola.validator.error.required",a)},b.prototype._validate=function(a){return"string"!=typeof a?null!=a:(this._trim&&(a=cola.util.trim(a)),!!a)},b}(cola.Validator),cola.NumberValidator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={min:null,minInclude:{defaultValue:!0},max:null,maxInclude:{defaultValue:!0}},b.prototype._getDefaultMessage=function(a){return cola.resource("cola.validator.error.number",a)},b.prototype._validate=function(a){var b;return b=!0,null!=this._min&&(b=this._minInclude?a>=this._min:a>this._min),b&&null!=this._max&&(b=this._maxInclude?a<=this._max:a<this._max),b},b}(cola.Validator),cola.LengthValidator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={min:null,max:null},b.prototype._getDefaultMessage=function(a){return cola.resource("cola.validator.error.length",a)},b.prototype._validate=function(a){var b,c;return"string"==typeof a||"number"==typeof a?(c=!0,b=(a+"").length,null!=this._min&&(c=b>=this._min),c&&null!=this._max&&(c=b<=this._max),c):!0},b}(cola.Validator),cola.RegExpValidator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={regExp:null,mode:{defaultValue:"white","enum":["white","black"]}},b.prototype._getDefaultMessage=function(a){return cola.resource("cola.validator.error.regExp",a)},b.prototype._validate=function(a){var b,c;return b=this._regExp,b&&"string"==typeof a?(!b instanceof RegExp&&(b=new RegExp(b)),c=!0,c=!!a.match(b),"black"===this._mode&&(c=!c),c):!0},b}(cola.Validator),cola.EmailValidator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype._getDefaultMessage=function(a){return cola.resource("cola.validator.error.email",a)},b.prototype._validate=function(a){return"string"==typeof a?!!a.match(/^([a-z0-9]*[-_\.]?[a-z0-9]+)*@([a-z0-9]*[-_]?[a-z0-9]+)+[\.][a-z]{2,3}([\.][a-z]{2})?$/i):!0},b}(cola.Validator),cola.UrlValidator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype._getDefaultMessage=function(a){return cola.resource("cola.validator.error.email",a)},b.prototype._validate=function(a){return"string"==typeof a?!!a.match(/^(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/i):!0},b}(cola.Validator),cola.AsyncValidator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={async:{defaultValue:!0}},b.prototype.validate=function(a,b){var c;if(this._validateEmptyValue||null!=a&&""!==a)return this._async?c=this._validate(a,{complete:function(a){return function(c,d){c&&(d=a._parseValidResult(d)),cola.callback(b,c,d)}}(this)}):(c=this._validate(a),c=this._parseValidResult(c),cola.callback(b,!0,c)),c},b}(cola.Validator),cola.AjaxValidator=function(a){function b(a){b.__super__.constructor.call(this,a),this._ajaxService=new cola.AjaxService}return extend(b,a),b.attributes={url:null,method:null,ajaxOptions:null,data:null},b.prototype._validate=function(a,b){var c,d,e,f,g,h;if(g=this._data,null==g||":data"===g)g=a;else if("object"==typeof g){f={};for(e in g)h=g[e],":data"===h&&(h=a),f[e]=h;g=f}return d={async:!!b,url:this._url,data:g,method:this._method,ajaxOptions:this._ajaxOptions},c=new cola.AjaxServiceInvoker(this._ajaxService,d),b?c.invokeAsync(b):c.invokeSync()},b}(cola.AsyncValidator),cola.CustomValidator=function(a){function b(a){"function"==typeof a?(b.__super__.constructor.call(this),this.set({func:a,async:cola.util.parseFunctionArgs(a).length>1})):b.__super__.constructor.call(this,a)}return extend(b,a),b.attributes={async:{defaultValue:!1},validateEmptyValue:{defaultValue:!0},func:null},b.prototype._validate=function(a,b){return this._async&&b?void(this._func?this._func(a,b):cola.callback(b,!0)):"function"==typeof this._func?this._func(a):void 0},b}(cola.AsyncValidator),cola.DataType=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b}(cola.Definition),cola.BaseDataType=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b}(cola.DataType),cola.StringDataType=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.toText=function(a){return null!=a?a+"":""},b.prototype.parse=function(a){return a},b}(cola.BaseDataType),cola.NumberDataType=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={isInteger:null},b.prototype.parse=function(a){var b;return a?"number"==typeof a?this._isInteger?Math.round(a):a:(b=this._isInteger?Math.round(parseInt(a,10)):parseFloat(a,10),isNaN(b)?0:b):0},b}(cola.BaseDataType),cola.BooleanDataType=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.parse=function(a){return a?"boolean"==typeof a?a:["true","on","yes","y","1"].indexOf((a+"").toLowerCase())>-1?!0:!1:!1},b}(cola.BaseDataType),cola.DateDataType=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.parse=function(a){var b;return a?(b=new XDate(a),b.toDate()):new Date(NaN)},b}(cola.BaseDataType),cola.JSONDataType=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.toText=function(a){return JSON.stringify(a)},b.prototype.parse=function(a){return"string"==typeof a?JSON.parse(a):a},b}(cola.DataType),cola.EntityDataType=function(a){function b(a){this._properties=new cola.util.KeyedArray,b.__super__.constructor.call(this,a)}return extend(b,a),b.attributes={properties:{setter:function(a){var b,c,d,e,f,g;if(this._properties.clear(),a instanceof Array){for(f=[],c=0,d=a.length;d>c;c++)e=a[c],f.push(this.addProperty(e));return f}g=[];for(e in a)b=a[e],b?(b instanceof cola.Property||(b.property=e),g.push(this.addProperty(b))):g.push(void 0);return g}}},b.events={beforeCurrentChange:null,currentChange:null,beforeDataChange:null,dataChange:null,beforeEntityInsert:null,entityInsert:null,beforeEntityDelete:null,entityDelete:null},b.prototype.addProperty=function(a){if(a instanceof cola.Property){if(a._owner&&a._owner!==this)throw new cola.Exception("Property("+a._property+") is already belongs to anthor DataType.")}else a="string"==typeof a?new cola.Property({property:a}):new cola.Property(a);return this._properties.get(a._property)&&this.removeProperty(a._property),this._properties.add(a._property,a),a._owner=this,a},b.prototype.removeProperty=function(a){return a instanceof cola.Property?this._properties.remove(a._property):a=this._properties.remove(a),delete a._owner,a},b.prototype.getProperty=function(a){var b,c,d,e;return b=a.indexOf("."),b>0?(c=a.substring(0,b),d=a.substring(b+1),e=this._getProperty(c),(null!=e?e._dataType:void 0)&&null!=e?e._dataType.getProperty(d):void 0):this._getProperty(a)},b.prototype._getProperty=function(a){return this._properties.get(a)},b.prototype.getProperties=function(){return this._properties},b}(cola.DataType),cola.DataType.dataTypeSetter=function(a){var b,c;if("string"==typeof a){if(b=a,c=this._scope,a=c?c.dataType(b):cola.DataType.defaultDataTypes[b],!a)throw new cola.Exception('Unrecognized DataType "'+b+'".')}else null==a||a instanceof cola.DataType||(a=new cola.EntityDataType(a));this._dataType=a||null},cola.Property=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={property:{readOnlyAfterCreate:!0},name:{setter:function(a){this._name=a,null==this._property&&(this._property=a)}},owner:{readOnly:!0},caption:null,dataType:{setter:cola.DataType.dataTypeSetter},description:null,provider:{setter:function(a){null==a||a instanceof cola.Provider||(a=new cola.Provider(a)),this._provider=a}},defaultValue:null,aggregated:{readOnlyAfterCreate:!0},validators:{setter:function(a){var b,c,d,e;if(b=function(a){return function(b){b instanceof cola.Validator||(b=cola.create("validator",b,cola.Validator)),a._validators.push(b)}}(this),delete this._validators,a)if(this._validators=[],"string"==typeof a)e=cola.create("validator",a,cola.Validator),b(e);else if(a instanceof Array)for(c=0,d=a.length;d>c;c++)e=a[c],b(e);else b(a)}},rejectInvalidValue:null},b.events={beforeWrite:null,write:null,beforeLoad:null,loaded:null},b}(cola.Definition),cola.DataType.jsonToEntity=function(a,b,c,d){var e;if(void 0===c&&(c=a instanceof Array?!0:"object"==typeof a&&a.hasOwnProperty("$data")?a.$data instanceof Array:!1),c)return e=new cola.EntityList(null,b),d&&(e.pageSize=d),e.fillData(a),e;if(a instanceof Array)throw new cola.Exception('Unmatched DataType. expect "Object" but "Array".');return new cola.Entity(a,b)},cola.DataType.jsonToData=function(a,b,c,d){var e;return e=b instanceof cola.StringDataType&&"string"!=typeof a||b instanceof cola.BooleanDataType&&"boolean"!=typeof a||b instanceof cola.NumberDataType&&"number"!=typeof a||b instanceof cola.DateDataType&&!(a instanceof Date)?b.parse(a):b instanceof cola.EntityDataType?cola.DataType.jsonToEntity(a,b,c,d):b&&"object"==typeof a?b.parse(a):a},cola.DataType.defaultDataTypes=defaultDataTypes={string:new cola.StringDataType({name:"string"}),"int":new cola.NumberDataType({name:"int",isInteger:!0}),"float":new cola.NumberDataType({name:"float"}),"boolean":new cola.BooleanDataType({name:"boolean"}),date:new cola.DateDataType({name:"date"}),json:new cola.JSONDataType({name:"json"}),entity:new cola.EntityDataType({name:"entity"})},defaultDataTypes.number=defaultDataTypes["float"],_getEntityPath=function(){var a,b,c,d,e;if(this._pathCache)return this._pathCache;if(b=this.parent,null!=b){for(d=[],e=this;null!=b;)b instanceof _EntityList&&(a=e),c=e._parentProperty,c&&d.push(c),e=b,b=b.parent;return this._pathCache=d=d.reverse(),d}},_watch=function(a,b){var c;a instanceof Function&&(b=a,a="*"),null==this._watchers&&(this._watchers={}),c=this._watchers[a],c?c.watchers.push(b):this._watchers[a]={path:a.split("."),watchers:[b]}},_unwatch=function(a,b){var c,d,e,f,g,h,i;if(this._watchers)if(a instanceof Function&&(b=a,a="*"),i=this._watchers,b){if(c=i[a]){for(g=c.watchers,d=e=0,f=g.length;f>e;d=++e)if(h=g[d],h===b){c.watchers.splice(d,1);break}c.watchers.length||delete i[a]}}else delete i[a]},_triggerWatcher=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;if(this._watchers){l=this._watchers;for(j in l){if(d=l[j],o=!1,"**"===j)o=!0;else if("*"===j)o=a.length===d.path.length;else if(k=d.path,k.length>=a.length)for(o=!0,e=f=0,g=k.length;g>f;e=++f){if(n=k[e],e===k.length-1){if("**"===n)break;if("*"===n){o=e===a.length-1;break}}if(n!==a[e]){o=!1;break}}if(o)for(m=d.watchers,i=0,h=m.length;h>i;i++)p=m[i],p.call(this,a,b,c)}}this.parent&&(this._parentProperty&&a.unshift(this._parentProperty),this.parent._triggerWatcher(a,b,c))},_matchValue=function(a,b){return b.strict?b.caseSensitive||"string"!=typeof b.value?a===b.value:(a+"").toLowerCase()===b.value:b.caseSensitive?(a+"").indexOf(b.value)>-1:(a+"").toLowerCase().indexOf(b.value)>-1},cola._trimCriteria=function(a,b){var c,d;if(null==b&&(b={}),null==a)return a;if(cola.util.isSimpleValue(a))b.caseSensitive||(a=(a+"").toLowerCase()),a={$:{value:a,caseSensitive:b.caseSensitive,strict:b.strict}};else if("object"==typeof a)for(c in a)d=a[c],"string"==typeof d?a[c]={value:d.toLowerCase(),caseSensitive:b.caseSensitive,strict:b.strict}:(null==d.caseSensitive&&(d.caseSensitive=b.caseSensitive),d.caseSensitive||"string"!=typeof d.value||(d.value=d.value.toLowerCase()),null==d.strict&&(d.strict=b.strict),d.strict||(d.value=d.value?d.value+"":""));return a},_filterCollection=function(a,b,c){var d;return null==c&&(c={}),a?(d=[],d.$origin=a.$origin||a,c.mode||(c.mode=a instanceof cola.EntityList?"entity":"json"),cola.each(a,function(a){var e;return e=c.deep?[]:null,(null==b||_filterEntity(a,b,c,e))&&(d.push(a),c.one)?!1:void(e&&Array.prototype.push.apply(d,e))}),d):null},_filterEntity=function(a,b,c,d){var e,f,g,h,i,j,k;if(null==c&&(c={}),e=function(a){var e;"entity"===c.mode?a instanceof cola.EntityList?(e=_filterCollection(a,b,c),Array.prototype.push.apply(d,e)):a instanceof cola.Entity&&(e=[],_filterEntity(a,b,c,e),Array.prototype.push.apply(d,e)):"array"==typeof a?(e=_filterCollection(a,b,c),Array.prototype.push.apply(d,e)):"object"!=typeof a||a instanceof Date||(e=[],_filterEntity(a,b,c,e),Array.prototype.push.apply(d,e))},!a)return!1;if(c.mode||(c.mode=a instanceof cola.Entity?"entity":"json"),g=!1,null==b)g=!0;else if("object"==typeof b){if(cola.util.isSimpleValue(a))b.$&&(g=_matchValue(k,b.$));else for(i in b)if(j=b[i],f=null,"$"===i){f="entity"===c.mode?a._data:a;for(h in f)if(k=f[h],_matchValue(k,j)&&(g=!0,!d))break;if(g&&!d)break}else if("entity"===c.mode){if(_matchValue(a.get(i),j)&&(g=!0,!d))break}else if(_matchValue(a[i],j)&&(g=!0,!d))break}else"function"==typeof b&&(g=b(a,c));if(d&&(!c.one||!g)){null==f&&(f="entity"===c.mode?a._data:a);for(h in f)k=f[h],e(k)}return g},_sortCollection=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;if(!a)return null;if(null==b||"$none"===b)return a;if(a instanceof cola.EntityList&&(i=a,a=a.toArray(),a.$origin=i),b){if("$reverse"===b)return a.reverse();if("string"==typeof b){for(f=[],m=b.split(","),g=0,h=m.length;h>g;g++)j=m[g],d=j.charCodeAt(0),l=!1,43===d?k=j.substring(1):45===d?(k=j.substring(1),l=!0):k=j,f.push({prop:k,desc:l});b=function(a,b){var d,e,g,h,i,j;for(g=0,e=f.length;e>g;g++)if(d=f[g],i=null,j=null,k=d.prop){if("$random"===k)return 2*Math.random()-1;if(i=a instanceof cola.Entity?a.get(k):cola.util.isSimpleValue(a)?a:a[k],c||"string"!=typeof i||(i=i.toLowerCase()),j=b instanceof cola.Entity?b.get(k):cola.util.isSimpleValue(b)?b:b[k],c||"string"!=typeof j||(j=j.toLowerCase()),h=0,null==i?h=-1:null==j?h=1:i>j?h=1:j>i&&(h=-1),0!==h)return d.desc?0-h:h}else if(h=0,null==a?h=-1:null==b?h=1:a>b?h=1:b>a&&(h=-1),0!==h)return d.desc?0-h:h;return 0}}}else b=function(a,b){var d;return d=0,c||("string"==typeof a&&(a=a.toLowerCase()),"string"==typeof b&&(b=b.toLowerCase())),null==a?d=-1:null==b?d=1:a>b?d=1:b>a&&(d=-1),d};return e=function(a,c){return b(a,c)},a.sort(e)},cola.Entity=function(){function a(a,b){this.id=cola.uniqueId(),this.timestamp=cola.sequenceNo(),this.dataType=b,this._data={},null!=a&&(this._disableWriteObservers++,this.set(a),this._disableWriteObservers--)}return a.STATE_NONE="none",a.STATE_NEW="new",a.STATE_MODIFIED="modified",a.STATE_DELETED="deleted",a.prototype.state=a.STATE_NONE,a.prototype._disableObserverCount=0,a.prototype._disableWriteObservers=0,a.prototype.hasValue=function(a){var b;return this._data.hasOwnProperty(a)||null!=(null!=(b=this.dataType)?b.getProperty(a):void 0)},a.prototype.get=function(a,b,c){var d;return null==b&&(b="async"),!b||"function"!=typeof b&&"object"!=typeof b||(d=b,b="async"),a.indexOf(".")>0?_evalDataPath(this,a,!1,b,d,c):this._get(a,b,d,c)},a.prototype._get=function(a,b,c,d){var e,f,g,h,i,j;return f=function(e){var f,g,h;return h=void 0,g=e.getInvoker({data:this}),"sync"===b?(h=g.invokeSync(),h=this._set(a,h),h&&(h instanceof cola.EntityList||h instanceof cola.Entity)&&(h._providerInvoker=g)):"async"===b?(d&&(d.unloaded=!0,null==d.providerInvokers&&(d.providerInvokers=[]),d.providerInvokers.push(g)),this._data[a]=g,f={data:this,property:a},this._notify(cola.constants.MESSAGE_LOADING_START,f),g.invokeAsync({complete:function(b){return function(d,e){b._notify(cola.constants.MESSAGE_LOADING_END,f),b._data[a]!==g&&(d=!1),d?(e=b._set(a,e),h=e,e&&(e instanceof cola.EntityList||e instanceof cola.Entity)&&(e._providerInvoker=g)):b._set(a,null),c&&cola.callback(c,d,e)}}(this)})):cola.callback(c,!0,void 0),h},g=null!=(j=this.dataType)?j.getProperty(a):void 0,value=this._data[a],void 0===value?g&&(h=g.get("provider"),null!=d&&(d.unloaded=!0),h&&"lazy"===h._loadMode&&(value=f.call(this,h),e=!0)):value instanceof cola.Provider?(value=f.call(this,value),e=!0):value instanceof cola.AjaxServiceInvoker&&(i=value,"sync"===b?(value=i.invokeSync(),value=this._set(a,value)):"async"===b?(c&&i.callbacks.push(c),e=!0,value=void 0):value=void 0,d&&(d.unloaded=!0,null==d.providerInvokers&&(d.providerInvokers=[]),d.providerInvokers.push(i))),c&&!e&&cola.callback(c,!0,value),value},a.prototype.set=function(a,b,c){var d;if("string"==typeof a)_setValue(this,a,b,c);else if(a&&"object"==typeof a){d=a;for(a in d)"$"!==a.charAt(0)&&this.set(a,d[a])}return this},a.prototype._jsonToEntity=function(a,b,c,d){var e;return e=cola.DataType.jsonToEntity(a,b,c,null!=d?d._pageSize:void 0),e&&d&&(e._providerInvoker=d.getInvoker({data:this})),e},a.prototype._set=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;if(q=this._data[a],r=null!=(u=this.dataType)?u.getProperty(a):void 0,null!=b)if(b instanceof cola.Provider)d=void 0!==q;else{if(r&&(f=r._dataType,s=r._provider),f){if(null!=b)if(f instanceof cola.StringDataType&&"string"!=typeof b||f instanceof cola.BooleanDataType&&"boolean"!=typeof b||f instanceof cola.NumberDataType&&"number"!=typeof b||f instanceof cola.DateDataType&&!(b instanceof Date))b=f.parse(b);else if(f instanceof cola.EntityDataType){if(m=!0,b instanceof _Entity?m=b.dataType===f&&!r._aggregated:b instanceof _EntityList?m=b.dataType===f&&r._aggregated:b=this._jsonToEntity(b,f,r._aggregated,s),!m)throw g=f.get("name"),c=(null!=(v=b.dataType)?v.get("name"):void 0)||"undefined",r._aggregated&&(g="["+g+"]"),b instanceof cola.EntityList&&(c="["+c+"]"),new cola.Exception('Unmatched DataType. expect "'+g+'" but "'+c+'".')}else b=f.parse(b)}else"object"==typeof b&&null!=b&&(b instanceof Array?(e=!0,b.length>0&&(h=b[0],cola.util.isSimpleValue(h)&&(e=!1)),e&&(b=this._jsonToEntity(b,null,!0,s))):b.hasOwnProperty("$data")?b=this._jsonToEntity(b,null,!0,s):b instanceof Date||b instanceof _Entity||b instanceof _EntityList||(b=this._jsonToEntity(b,null,!1,s)));d=q!==b}else d=q!==b;if(d){if(r&&r._validators&&r._rejectInvalidValue){for(o=null,w=r._validators,i=0,j=w.length;j>i;i++)z=w[i],(null!=b||z instanceof cola.RequiredValidator)&&(z._disabled&&z instanceof cola.AsyncValidator&&z.get("async")||(n=z.validate(b),n&&(null==o&&(o=[]),n instanceof Array?Array.prototype.push.apply(o,n):o.push(n))));if(o)for(p=0,k=o.length;k>p;p++)if(n=o[p],"error"===n)throw new cola.Exception(n.text)}if(0===this._disableWriteObservers&&(null!=q&&(q instanceof _Entity||q instanceof _EntityList)&&(q._setDataModel(null),delete q.parent,delete q._parentProperty),this.state===_Entity.STATE_NONE&&this.setState(_Entity.STATE_MODIFIED)),this._data[a]=b,null!=b&&(b instanceof _Entity||b instanceof _EntityList)){if(b.parent&&b.parent!==this)throw new cola.Exception('Entity/EntityList is already belongs to another owner. "'+a+'"');b.parent=this,b._parentProperty=a,b._setDataModel(this._dataModel),b._onPathChange(),this._mayHasSubEntity=!0}if(this.timestamp=cola.sequenceNo(),0===this._disableWriteObservers&&this._notify(cola.constants.MESSAGE_PROPERTY_CHANGE,{entity:this,property:a,value:b,oldValue:q}),void 0!==o){if(null!=(x=this._messageHolder)&&x.clear(a),this.addMessage(a,o),null!=b)for(y=r._validators,t=0,l=y.length;l>t;t++)z=y[t],!z._disabled&&z instanceof cola.AsyncValidator&&z.get("async")&&z.validate(b,function(b){return function(c){c&&b.addMessage(a,c)}}(this))}else this.validate(a)}return b},a.prototype.remove=function(a){return this.parent?this.parent instanceof _EntityList?this.parent.remove(this,a):(this.setState(_Entity.STATE_DELETED),this.parent.set(this._parentProperty,null)):this.setState(_Entity.STATE_DELETED),this},a.prototype.createChild=function(a,b){var c,d,e,f,g;if(b&&b instanceof Array)throw new cola.Exception('Unmatched DataType. expect "Object" but "Array".');if(d=null!=(g=this.dataType)?g.getProperty(a):void 0,e=null!=d?d._dataType:void 0,e&&!(e instanceof cola.EntityDataType))throw new cola.Exception('Unmatched DataType. expect "cola.EntityDataType" but "'+e._name+'".');return(null!=d?d._aggregated:void 0)?(c=this._get(a,"never"),null==c&&(c=new cola.EntityList(null,e),f=d._provider,f&&(c.pageSize=f._pageSize,c._providerInvoker=f.getInvoker({data:this})),this._disableWriteObservers++,this._set(a,c),this._disableWriteObservers--),c.insert(b)):this._set(a,b)},a.prototype.createBrother=function(a){var b,c;if(a&&a instanceof Array)throw new cola.Exception('Unmatched DataType. expect "Object" but "Array".');return b=new _Entity(a,this.dataType),b.setState(_Entity.STATE_NEW),c=this.parent,c&&c instanceof _EntityList&&c.insert(b),b},a.prototype.setState=function(a){var b;return this.state===a?this:(this.state===_Entity.STATE_NONE&&a===_Entity.STATE_MODIFIED&&this._storeOldData(),b=this.state,this.state=a,this._notify(cola.constants.MESSAGE_EDITING_STATE_CHANGE,{entity:this,oldState:b,state:a}),this)},a.prototype._storeOldData=function(){var a,b,c;if(!this._oldData){a=this._data,b=this._oldData={};for(c in a)value=a[c],value&&(value instanceof _Entity||value instanceof _EntityList)||(b[c]=value)}},a.prototype.getOldValue=function(a){var b;return null!=(b=this._oldData)?b[a]:void 0},a.prototype.reset=function(a){var b;if(a)this._set(a,void 0),this.clearMessages(a);else{this.disableObservers(),b=this._data;for(a in b)value=b[a],void 0!==value&&delete b[a];this.resetState(),this.enableObservers(),this._notify(cola.constants.MESSAGE_REFRESH,{data:this})}return this},a.prototype.resetState=function(){return delete this._oldData,this.clearMessages(),this.setState(_Entity.STATE_NONE),this},a.prototype.getDataType=function(a){var b,c,d,e,f,g,h;if(a){if(c=this.dataType)for(g=a.split("."),d=0,e=g.length;e>d&&(f=g[d],h="function"==typeof c.getProperty?c.getProperty(f):void 0,null!=h)&&(c=h.get("dataType"),null!=c);d++);}else c=this.dataType;return null==c&&(b=this.get(a),c=null!=b?b.dataType:void 0),c},a.prototype.getPath=_getEntityPath,a.prototype.flush=function(a,b){var c,d,e,f;if(null==b&&(b="async"),e=this.dataType.getProperty(a),f=null!=e?e._provider:void 0,!f)throw new cola.Exception("Provider undefined.");this._set(a,void 0),!b||"function"!=typeof b&&"object"!=typeof b||(c=b,b="async"),d=f._loadMode,f._loadMode="lazy";try{return this._get(a,b,{complete:function(a){return function(a,b){cola.callback(c,a,b)}}(this)})}finally{f._loadMode=d}},a.prototype._setDataModel=function(a){var b,c;if(this._dataModel!==a&&(this._dataModel&&this._dataModel.onEntityDetach(this),this._dataModel=a,a&&a.onEntityAttach(this),this._mayHasSubEntity)){b=this._data;for(c in b)value=b[c],value&&(value instanceof _Entity||value instanceof _EntityList)&&value._setDataModel(a)}},a.prototype.watch=_watch,a.prototype.unwatch=_unwatch,a.prototype._triggerWatcher=_triggerWatcher,a.prototype._onPathChange=function(){var a,b;if(delete this._pathCache,this._mayHasSubEntity){a=this._data;for(b in a)value=a[b],value&&(value instanceof _Entity||value instanceof _EntityList)&&value._onPathChange()}},a.prototype.disableObservers=function(){return this._disableObserverCount<0?this._disableObserverCount=1:this._disableObserverCount++,this},a.prototype.enableObservers=function(){return this._disableObserverCount<1?this._disableObserverCount=0:this._disableObserverCount--,this._disableObserverCount<1?this._disableObserverCount=0:this._disableObserverCount--,this},a.prototype.notifyObservers=function(){return this._notify(cola.constants.MESSAGE_REFRESH,{data:this}),this},a.prototype._notify=function(a,b){var c;0===this._disableObserverCount&&(delete b.timestamp,c=this.getPath(),a!==cola.constants.MESSAGE_PROPERTY_CHANGE&&a!==cola.constants.MESSAGE_VALIDATION_STATE_CHANGE&&a!==cola.constants.MESSAGE_LOADING_START&&a!==cola.constants.MESSAGE_LOADING_END||!b.property||(c=c?c.concat(b.property):[b.property]),this._doNotify(c,a,b),(a===cola.constants.MESSAGE_PROPERTY_CHANGE||a===cola.constants.MESSAGE_REFRESH)&&this._triggerWatcher([b.property||"*"],a,b))},a.prototype._doNotify=function(a,b,c){var d;null!=(d=this._dataModel)&&d.onDataMessage(a,b,c)},a.prototype._validate=function(a){var b,c,d,e,f,g,h,i;if(g=this.dataType.getProperty(a),g&&g._validators){if(b=this._data[a],b&&(b instanceof cola.Provider||b instanceof cola.AjaxServiceInvoker))return;for(h=g._validators,c=0,d=h.length;d>c;c++)i=h[c],i._disabled||(i instanceof cola.AsyncValidator&&i.get("async")?i.validate(b,function(b){return function(c){c&&b.addMessage(a,c)}}(this)):(e=i.validate(b),e&&(this._addMessage(a,e),f=!0)))}return f},a.prototype.validate=function(a){var b,c,d,e,f,g,h;if(this._messageHolder&&(e=this._messageHolder.getKeyMessage(),this._messageHolder.clear(a)),this.dataType)if(a)this._validate(a),this._notify(cola.constants.MESSAGE_VALIDATION_STATE_CHANGE,{entity:this,property:a});else for(g=this.dataType.getProperties().elements,c=0,d=g.length;d>c;c++)f=g[c],this._validate(f._property),this._notify(cola.constants.MESSAGE_VALIDATION_STATE_CHANGE,{entity:this,property:f._property});return b=null!=(h=this._messageHolder)?h.getKeyMessage():void 0,(e||b)&&e!==b&&this._notify(cola.constants.MESSAGE_VALIDATION_STATE_CHANGE,{entity:this}),!("error"===(null!=b?b.type:void 0))},a.prototype._addMessage=function(a,b){var c,d,e,f,g;if(f=this._messageHolder,f||(this._messageHolder=f=new _Entity.MessageHolder),b instanceof Array)for(c=0,d=b.length;d>c;c++)e=b[c],f.add(a,e)&&(g=!0);else f.add(a,b)&&(g=!0);return g},a.prototype.addMessage=function(a,b){var c;return 1===arguments.length&&(b=a,a="$"),"$"===a?this._notify(cola.constants.MESSAGE_VALIDATION_STATE_CHANGE,{entity:this}):(c=this._addMessage(a,b),this._notify(cola.constants.MESSAGE_VALIDATION_STATE_CHANGE,{entity:this,property:a}),c&&this._notify(cola.constants.MESSAGE_VALIDATION_STATE_CHANGE,{entity:this})),this},a.prototype.getKeyMessage=function(a){var b;return null!=(b=this._messageHolder)?b.getKeyMessage(a):void 0},a.prototype.getMessages=function(a){var b;return null!=(b=this._messageHolder)?b.getMessages(a):void 0},a.prototype.clearMessages=function(a){var b,c;return this._messageHolder?(a&&(b=this._messageHolder.getKeyMessage(a)),c=this._messageHolder.clear(a),b&&this._notify(cola.constants.MESSAGE_VALIDATION_STATE_CHANGE,{entity:this,property:a}),c&&this._notify(cola.constants.MESSAGE_VALIDATION_STATE_CHANGE,{entity:this}),this):this},a.prototype.findMessages=function(a,b){var c;return null!=(c=this._messageHolder)?c.findMessages(a,b):void 0},a.prototype.toJSON=function(a){var b,c,d,e,f,g;g=(null!=a?a.state:void 0)||!1,d=(null!=a?a.oldData:void 0)||!1,f=(null!=a?a.simpleValue:void 0)||!1,b=this._data,c={};for(e in b)if(value=b[e],36!==e.charCodeAt(0)){if(value){if(value instanceof cola.AjaxServiceInvoker)continue;if(value instanceof _Entity||value instanceof _EntityList){if(f)continue;value=value.toJSON(a)}}c[e]=value}return g&&(c.$state=this.state),d&&this._oldData&&(c.$oldData=this._oldData),c},a}(),LinkedList=function(){function a(){}return a.prototype._size=0,a.prototype._insertElement=function(a,b,c){var d,e;this._first?b&&"end"!==b?"before"===b?(e=c._previous,null!=e&&(e._next=a),c._previous=a,a._previous=e,a._next=c,this._first===c&&(this._first=a)):"after"===b?(d=c._next,null!=d&&(d._previous=a),c._next=a,a._previous=c,a._next=d,this._last===c&&(this._last=a)):"begin"===b&&(delete a._previous,a._next=this._first,this._first._previous=a,this._first=a):(a._previous=this._last,delete a._next,this._last._next=a,this._last=a):this._first=this._last=a,a._page=this,this._size++},a.prototype._removeElement=function(a){var b,c;c=a._previous,b=a._next,null!=c&&(c._next=b),null!=b&&(b._previous=c),this._first===a&&(this._first=b),this._last===a&&(this._last=c),this._size++},a.prototype._clearElements=function(){this._first=this._last=null,this._size=0},a}(),Page=function(a){function b(a,b){this.entityList=a,this.pageNo=b}return extend(b,a),b.prototype.loaded=!1,b.prototype.entityCount=0,b.prototype.initData=function(a){var b,c,d,e,f,g,h;if(h=a,e=this.entityList,a.hasOwnProperty("$data")&&(a=h.$data),!(a instanceof Array))throw new cola.Exception('Unmatched DataType. expect "Array" but "Object".');for(c=e.dataType,f=0,g=a.length;g>f;f++)b=a[f],d=new _Entity(b,c),this._insertElement(d);null!=h.$entityCount&&(e.totalEntityCount=h.$entityCount),null!=e.totalEntityCount&&(e.pageSize&&(e.pageCount=parseInt((e.totalEntityCount+e.pageSize-1)/e.pageSize)),e.pageCountDetermined=!0),e.entityCount+=a.length,e.timestamp=cola.sequenceNo(),e._notify(cola.constants.MESSAGE_REFRESH,{data:e})},b.prototype._insertElement=function(a,c,d){var e;b.__super__._insertElement.call(this,a,c,d),e=this.entityList,a._page=this,a.parent=e,delete a._parentProperty,this.dontAutoSetCurrent||null!=e.current||a.state!==_Entity.STATE_DELETED&&(e.current=a,e._setCurrentPage(a._page)),a._setDataModel(e._dataModel),a._onPathChange(),a.state!==_Entity.STATE_DELETED&&this.entityCount++},b.prototype._removeElement=function(a){
b.__super__._removeElement.call(this,a),delete a._page,delete a.parent,a._setDataModel(null),a._onPathChange(),a.state!==_Entity.STATE_DELETED&&this.entityCount--},b.prototype._clearElements=function(){var a;for(a=this._first;a;)delete a._page,delete a.parent,a._setDataModel(null),a._onPathChange(),a=a._next;this.entityCount=0,b.__super__._clearElements.call(this)},b.prototype.loadData=function(a){var b,c;b=this.entityList._providerInvoker,b&&(b.pageSize=this.entityList.pageSize,b.pageNo=this.pageNo,a?b.invokeAsync({complete:function(b){return function(c,d){return c&&b.initData(d),cola.callback(a,c,d)}}(this)}):(c=b.invokeSync(),this.initData(c)))},b}(LinkedList),cola.EntityList=function(a){function b(a,b){this.id=cola.uniqueId(),this.timestamp=cola.sequenceNo(),this.dataType=b,a&&this.fillData(a)}return extend(b,a),b.prototype.current=null,b.prototype.entityCount=0,b.prototype.pageMode="append",b.prototype.pageSize=0,b.prototype.pageNo=1,b.prototype.pageCount=1,b.prototype._disableObserverCount=0,b.prototype.fillData=function(a){var b;b=this._findPage(this.pageNo),null==b&&(b=new Page(this,this.pageNo)),this._insertElement(b,"begin"),b.initData(a)},b.prototype._setDataModel=function(a){var b,c;if(this._dataModel!==a&&(this._dataModel=a,c=this._first))for(b=c._first;c;)b?(b._setDataModel(a),b=b._next):(c=c._next,b=null!=c?c._first:void 0)},b.prototype.watch=_watch,b.prototype.unwatch=_unwatch,b.prototype._triggerWatcher=_triggerWatcher,b.prototype._setCurrentPage=function(a){this._currentPage=a,this.pageNo=(null!=a?a.pageNo:void 0)||1,this.timestamp=cola.sequenceNo()},b.prototype._onPathChange=function(){var a,b;if(delete this._pathCache,b=this._first)for(a=b._first;b;)a?(a._onPathChange(),a=a._next):(b=b._next,a=null!=b?b._first:void 0)},b.prototype._findPrevious=function(a){var b,c;if(!a||a.parent===this)for(a?(b=a._page,c=a._previous):(b=this._last,c=b._last);b;)if(c){if(c.state!==_Entity.STATE_DELETED)return c;c=c._previous}else b=b._previous,c=null!=b?b._last:void 0},b.prototype._findNext=function(a){var b,c;if(!a||a.parent===this)for(a?(c=a._page,b=a._next):(c=this._first,b=c._first);c;)if(b){if(b.state!==_Entity.STATE_DELETED)return b;b=b._next}else c=c._next,b=null!=c?c._first:void 0},b.prototype._findPage=function(a){var b;if(1>a)return null;if(a>this.pageCount&&(this.pageCountDetermined||a>this.pageCount+1))return null;if(b=this._currentPage||this._first,!b)return null;if(b.pageNo===a)return b;if(b.pageNo<a)for(b=b._next;null!=b;){if(b.pageNo===a)return b;if(b.pageNo>a)break;b=b._next}else for(b=b._previous;null!=b;){if(b.pageNo===a)return b;if(b.pageNo<a)break;b=b._previous}return null},b.prototype._createPage=function(a){var b,c,d;if(1>a)return null;if(a>this.pageCount&&(this.pageCountDetermined||a>this.pageCount+1))return null;if(b="end",d=this._currentPage||this._first)if(d.page===a-1)b="after";else if(d.page===a+1)b="before";else for(c=this._last;c;){if(c.pageNo<a){d=c,b="after";break}c=c._previous}return c=new Page(this,a),this._insertElement(c,b,d),c},b.prototype.hasNextPage=function(){var a;return a=this.pageNo+1,!this.pageCountDetermined||a<=this.pageCount},b.prototype._loadPage=function(a,b,c){var d,e,f;if(null==c&&(c="async"),!c||"function"!=typeof c&&"object"!=typeof c||(d=c,c="async"),f=this._findPage(a),f!==this._currentPage)if(f){if(this._setCurrentPage(f),b)for(e=f._first;e;){if(e.state!==_Entity.STATE_DELETED){this.setCurrent(e);break}e=e._next}cola.callback(d,!0)}else"never"!==c&&(b&&this.setCurrent(null),f=this._createPage(a),f&&("async"===c?f.loadData({complete:function(b){return function(c,e){c&&(b._setCurrentPage(f),f.entityCount&&b.pageCount<a&&(b.pageCount=a)),cola.callback(d,c,e)}}(this)}):(f.loadData(),this._setCurrentPage(f),cola.callback(d,!0))));return this},b.prototype.loadPage=function(a,b){return this._loadPage(a,!1,b)},b.prototype.gotoPage=function(a,b){return 1>a?a=1:this.pageCountDetermined&&a>this.pageCount&&(a=this.pageCount),this._loadPage(a,!0,b)},b.prototype.firstPage=function(a){return this.gotoPage(1,a),this},b.prototype.previousPage=function(a){var b;return b=this.pageNo-1,1>b&&(b=1),this.gotoPage(b,a),this},b.prototype.nextPage=function(a){var b;return b=this.pageNo+1,this.pageCountDetermined&&b>this.pageCount&&(b=this.pageCount),this.gotoPage(b,a),this},b.prototype.lastPage=function(a){return this.gotoPage(this.pageCount,a),this},b.prototype.insert=function(a,b,c){var d;if("before"===b||"after"===b?(c&&c.parent!==this&&(c=null),null==c&&(c=this.current),c&&(d=c._page)):"append"===this.pageMode&&("end"===b?d=this._last:"begin"===b&&(d=this._first)),d||(d=this._currentPage,d||(this.gotoPage(1),d=this._currentPage)),a instanceof _Entity){if(a.parent&&a.parent!==this)throw new cola.Exception('Entity is already belongs to another owner. "'+(this._parentProperty||"Unknown")+'".');a.state===_Entity.STATE_DELETED&&a.setState(_Entity.STATE_NONE)}else a=new _Entity(a,this.dataType),a.setState(_Entity.STATE_NEW);return d.dontAutoSetCurrent=!0,d._insertElement(a,b,c),d.dontAutoSetCurrent=!1,a.state!==_Entity.STATE_DELETED&&this.entityCount++,this.timestamp=cola.sequenceNo(),this._notify(cola.constants.MESSAGE_INSERT,{entityList:this,entity:a,insertMode:b,refEntity:c}),this.current||this.setCurrent(a),a},b.prototype.remove=function(a,b){var c,d,e;if((null!=a||(a=this.current,null!=a))&&a.parent===this)return a===this.current&&(c=!0,d=this._findNext(a),d||(d=this._findPrevious(a))),e=a._page,b?(e._removeElement(a),this.entityCount--):a.state===_Entity.STATE_NEW?(a.setState(_Entity.STATE_DELETED),e._removeElement(a),this.entityCount--):a.state!==_Entity.STATE_DELETED&&(a.setState(_Entity.STATE_DELETED),this.entityCount--),this.timestamp=cola.sequenceNo(),this._notify(cola.constants.MESSAGE_REMOVE,{entityList:this,entity:a}),c&&this.setCurrent(d),a},b.prototype.setCurrent=function(a){var b;if(this.current===a||(null!=a?a.state:void 0)===cola.Entity.STATE_DELETED)return this;if(a&&a.parent!==this)throw new cola.Exception("The entity is not belongs to this EntityList.");return b=this.current,b&&b._onPathChange(),this.current=a,a&&(this._setCurrentPage(a._page),a._onPathChange()),this._notify(cola.constants.MESSAGE_CURRENT_CHANGE,{entityList:this,current:a,oldCurrent:b}),this},b.prototype.first=function(){var a;return a=this._findNext(),a?(this.setCurrent(a),a):this.current},b.prototype.previous=function(){var a;return a=this._findPrevious(this.current),a?(this.setCurrent(a),a):this.current},b.prototype.next=function(){var a;return a=this._findNext(this.current),a?(this.setCurrent(a),a):this.current},b.prototype.last=function(){var a;return a=this._findPrevious(),a?(this.setCurrent(a),a):this.current},b.prototype._reset=function(){var a;for(this.current=null,this.entityCount=0,this.pageNo=1,this.pageCount=1,a=this._first;a;)a._clearElements(),a=a._next;return delete this._currentPage,delete this._first,delete this._last,this.timestamp=cola.sequenceNo(),this},b.prototype.disableObservers=function(){return this._disableObserverCount<0?this._disableObserverCount=1:this._disableObserverCount++,this},b.prototype.enableObservers=function(){return this._disableObserverCount<1?this._disableObserverCount=0:this._disableObserverCount--,this},b.prototype.notifyObservers=function(){return this._notify(cola.constants.MESSAGE_REFRESH,{data:this}),this},b.prototype._notify=function(a,b){var c;0===this._disableObserverCount&&(null!=(c=this._dataModel)&&c.onDataMessage(this.getPath(),a,b),(a===cola.constants.MESSAGE_CURRENT_CHANGE||a===cola.constants.MESSAGE_INSERT||a===cola.constants.MESSAGE_REMOVE)&&this._triggerWatcher(["*"],a,b))},b.prototype.each=function(a,b){var c,d,e,f,g;if(f=this._first,!f)return this;if(null!=b&&("boolean"==typeof b?c=b:(c=b.deleted,g=b.pageNo,!g&&b.currentPage&&(g=this.pageNo))),g>1&&(f=this._findPage(g),!f))return this;for(e=f._first,d=0;f;)if(e){if((c||e.state!==_Entity.STATE_DELETED)&&a.call(this,e,d++)===!1)break;e=e._next}else{if(!f||g)break;f=f._next,e=null!=f?f._first:void 0}return this},b.prototype.getPath=_getEntityPath,b.prototype.toJSON=function(a){var b,c,d,e;if(c=null!=a?a.deleted:void 0,b=[],e=this._first)for(d=e._first;e;)d?((c||d.state!==_Entity.STATE_DELETED)&&b.push(d.toJSON(a)),d=d._next):(e=e._next,d=null!=e?e._first:void 0);return b},b.prototype.toArray=function(){var a,b,c;if(a=[],c=this._first)for(b=c._first;c;)b?(b.state!==_Entity.STATE_DELETED&&a.push(b),b=b._next):(c=c._next,b=null!=c?c._first:void 0);return a},b.prototype.filter=function(a,b){return a=cola._trimCriteria(a,b),_filterCollection(this,a,b)},b.prototype.where=function(a,b){return null==b&&(b={}),void 0===b.caseSensitive&&(b.caseSensitive=!0),void 0===b.strict&&(b.strict=!0),a=cola._trimCriteria(a,b),_filterCollection(this,a,b)},b.prototype.find=function(a,b){var c;return b.one=!0,c=cola.util.where(this,a,b),null!=c?c[0]:void 0},b}(LinkedList),_Entity=cola.Entity,_EntityList=cola.EntityList,_Entity._evalDataPath=_evalDataPath=function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n;if(b)for(m=b.split("."),j=m.length-1,g=i=0,k=m.length;k>i&&(l=m[g],n=!1,0===g&&a instanceof _EntityList?a="#"===l?a.current:a[l]:(h=g===j,c||(h||(n=!0),35===l.charCodeAt(l.length-1)&&(n=!0,l=l.substring(0,l.length-1))),a instanceof _Entity?("function"==typeof a._get&&(a=a._get(l,d,e,f)),a&&a instanceof _EntityList&&(c||n)&&(a=a.current)):a=a[l]),null!=a);g=++i);return a},_Entity._setValue=_setValue=function(a,b,c,d){var e,f,g;if(e=b.lastIndexOf("."),e>0){if(f=b.substring(0,e),g=b.substring(e+1),a=_evalDataPath(a,f,!0,"never",d),null==a||a instanceof _EntityList)throw new cola.Exception('Cannot set value to EntityList "'+b+'".');a instanceof cola.AjaxServiceInvoker?a=void 0:"function"==typeof a._set?a._set(g,c):a[g]=c}else"function"==typeof a._set?a._set(b,c):a[b]=c},_Entity._getEntityId=function(a){return a?a instanceof cola.Entity?a.id:"object"==typeof a?(null==a._id&&(a._id=cola.uniqueId()),a._id):void 0:null},TYPE_SEVERITY={VALIDATION_INFO:1,VALIDATION_WARN:2,VALIDATION_ERROR:4},cola.Entity.MessageHolder=function(){function a(){this.keyMessage={},this.propertyMessages={}}return a.prototype.compare=function(a,b){return(TYPE_SEVERITY[a.type]||0)-(TYPE_SEVERITY[b.type]||0)},a.prototype.add=function(a,b){var c,d,e,f;return e=this.propertyMessages[a],e?e.push(b):this.propertyMessages[a]=[b],c="$"===a,d?this.compare(b,d)>0&&(this.keyMessage[a]=b,f=c):(this.keyMessage[a]=b,f=c),f||c||(d=this.keyMessage.$,d?this.compare(b,d)>0&&(this.keyMessage.$=b,f=!0):(this.keyMessage.$=b,f=!0)),f},a.prototype.clear=function(a){var b,c,d,e,f,g,h,i;if(a){delete this.propertyMessages[a],delete this.keyMessage[a],h=this.propertyMessages;for(g in h)for(f=h[g],c=0,d=f.length;d>c;c++){if(e=f[c],b){if(!(this.compare(e,b)>0))continue;b=e}else b=e;if("error"===b.type)break}i=this.keyMessage.$!==b,i&&(this.keyMessage.$=b)}else i=!0,this.keyMessage={},this.propertyMessages={};return i},a.prototype.getMessages=function(a){return null==a&&(a="$"),this.propertyMessages[a]},a.prototype.getKeyMessage=function(a){return null==a&&(a="$"),this.keyMessage[a]},a.prototype.findMessages=function(a,b){var c,d,e,f,g,h,i,j,k;if(a)if(h=this.propertyMessages[a],b)for(g=[],c=0,d=h.length;d>c;c++)f=h[c],f.type===b&&g.push(f);else g=h;else{g=[],k=this.propertyMessages;for(j in k)for(h=k[j],i=0,e=h.length;e>i;i++)f=h[i],b&&f.type!==b||g.push(f)}return g},a}(),cola.each=function(a,b,c){a instanceof cola.EntityList?a.each(b,c):a instanceof Array&&("function"==typeof a.each?a.each(b):cola.util.each(a,b))},cola.util.filter=function(a,b,c){return b=cola._trimCriteria(b,c),_filterCollection(a,b,c)},cola.util.where=function(a,b,c){return null==c&&(c={}),void 0===c.caseSensitive&&(c.caseSensitive=!0),void 0===c.strict&&(c.strict=!0),b=cola._trimCriteria(b,c),_filterCollection(a,b,c)},cola.util.find=function(a,b,c){var d;return c.one=!0,d=cola.util.where(a,b,c),null!=d?d[0]:void 0},cola.util.sort=function(a,b,c){return _sortCollection(a,b,c)},cola.util.flush=function(a,b){(a instanceof cola.Entity||a instanceof cola.EntityList)&&a.parent instanceof cola.Entity&&a._parentProperty&&a.parent.flush(a._parentProperty,b)},EntityIndex=function(){function a(a,b,c){var d,e;if(this.data=a,this.property=b,this.option=null!=c?c:{},this.model=d=null!=(e=this.data._dataModel)?e.model:void 0,!d)throw new cola.Exception("The Entity or EntityList is not belongs to any Model.");if(this.deep=this.option.deep,this.isCollection=this.data instanceof cola.EntityList,!this.deep&&!this.isCollection)throw new cola.Exception("Can not build index for single Entity.");this.index={},this.idMap={},this.buildIndex(),d.data.addEntityListener(this)}return a.prototype.buildIndex=function(){var a;a=this.data,a instanceof cola.Entity?this._buildIndexForEntity(a):a instanceof cola.EntityList&&this._buildIndexForEntityList(a)},a.prototype._buildIndexForEntityList=function(a){a.each(function(a){return function(b){a._buildIndexForEntity(b)}}(this))},a.prototype._buildIndexForEntity=function(a){var b,c,d;if(value=a.get(this.property),this.index[value+""]=a,this.idMap[a.id]=!0,this.deep){b=a._data;for(c in b)d=b[c],d&&(d instanceof cola.Entity?this._buildIndexForEntity(d):d instanceof cola.EntityList&&this._buildIndexForEntityList(d))}},a.prototype.onEntityAttach=function(a){var b,c;if(this.deep)for(b=a;b;){if(b===this.data){c=!0;break}b=b.parent}else c=this.isCollection?a.parent===this.data:a===this.data;c&&(value=a.get(this.property),this.idMap[a.id]=!0,this.index[value+""]=a)},a.prototype.onEntityDetach=function(a){this.idMap[a.id]&&(value=a.get(this.property),delete this.idMap[a.id],delete this.index[value+""])},a.prototype.find=function(a){return this.index[a+""]},a.prototype.destroy=function(){this.model.data.removeEntityListener(this)},a}(),cola.util.buildIndex=function(a,b,c){return new EntityIndex(a,b,c)},"undefined"!=typeof exports&&null!==exports?(cola=require("./entity"),"undefined"!=typeof module&&null!==module&&(module.exports=cola)):cola=this.cola,cola.model=function(a,b){if(2===arguments.length){if(b){if(cola.model.models[a])throw new cola.Exception('Duplicated model name "'+a+'".');cola.model.models[a]=b}else b=cola.removeModel(a);return b}return cola.model.models[a]},cola.model.models={},cola.removeModel=function(a){var b;return b=cola.model.models[a],delete cola.model.models[a],b},cola.Scope=function(){function a(){}return a.prototype.get=function(a,b,c){return this.data.get(a,b,c)},a.prototype.set=function(a,b,c){return this.data.set(a,b,c),this},a.prototype.describe=function(a,b){return this.data.describe(a,b)},a.prototype.dataType=function(a){var b,c,d;if("string"==typeof a)return b=this.data.definition(a),b instanceof cola.DataType?b:null;if(a)if(a instanceof Array)for(c=0,d=a.length;d>c;c++)b=a[c],b instanceof cola.DataType||b.lazy!==!1&&(b=new cola.EntityDataType(b),b.name&&this.data.regDefinition(b.name,b));else if(b=a,!(b instanceof cola.DataType)&&b.lazy!==!1)return b=new cola.EntityDataType(b),b.name&&this.data.regDefinition(b.name,b),b},a.prototype.definition=function(a){return this.data.definition(a)},a.prototype.flush=function(a,b){return this.data.flush(a,b),this},a.prototype.disableObservers=function(){return this.data.disableObservers(),this},a.prototype.enableObservers=function(){return this.data.enableObservers(),this},a.prototype.notifyObservers=function(){return this.data.notifyObservers(),this},a.prototype.watch=function(a,b){var c,d,e,f;if(f={processMessage:function(a,c,d,e){b(c,d,e)}},a instanceof Array)for(c=0,d=a.length;d>c;c++)e=a[c],this.data.bind(e,f);else this.data.bind(a,f);return this},a.prototype.hasExBinding=function(){return this._hasExBinding},a.prototype.setHasExBinding=function(a){var b;this._hasExBinding!==a&&(this._hasExBinding=a,a&&null!=(b=this.parent)&&b.setHasExBinding(!0))},a}(),cola.Model=function(a){function b(a,b){var c;null==cola.currentScope&&(cola.currentScope=this),a instanceof cola.Scope&&(b=a,a=void 0),a&&(this.name=a,cola.model(a,this)),b&&"string"==typeof b&&(c=b,b=cola.model(c)),this.parent=b,this.setHasExBinding(!0),this.data=new cola.DataModel(this),b&&b.data.bind("**",this),this.action=function(a,b){var c,d,e,f,g,h;if(h=this.action,1===arguments.length){if("string"==typeof a){for(g=this;h;){if(e=h[a])return e.action||e;if(g=g.parent,!g)break;h=g.action}return cola.defaultAction[a]}if(a&&"object"==typeof a){d=a;for(f in d)c=d[f],this.action(f,c)}return null}return b?h[a]=b:delete h[a],this}}return extend(b,a),b.prototype.destroy=function(){var a;this.name&&cola.removeModel(this.name),"function"==typeof(a=this.data).destroy&&a.destroy()},b.prototype.processMessage=function(a,b,c,d){return this.data.onDataMessage(b,c,d)},b.prototype.$=function(a){return null==this._$dom&&(this._$dom=$(this._dom)),this._$dom.find(a)},b}(cola.Scope),cola.SubScope=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.watchPath=function(a){var b,c,d,e,f;if(!this._watchAllMessages&&this._watchPath!==a)if(this._unwatchPath(),a)if(this._watchPath=f=[],e=this.parent,a instanceof Array)for(b=0,c=a.length;c>b;b++)d=a[b],d+=".**",f.push(d),null!=e&&e.data.bind(d,this);else a+=".**",f.push(a),null!=e&&e.data.bind(a,this);else delete this._watchPath},b.prototype._unwatchPath=function(){var a,b,c,d,e;if(this._watchPath&&(e=this._watchPath,delete this._watchPath,d=this.parent,d&&e))if(e instanceof Array)for(a=0,b=e.length;b>a;a++)c=e[a],d.data.unbind(c,this);else d.data.unbind(e,this)},b.prototype.watchAllMessages=function(){var a;this._watchAllMessages||(this._watchAllMessages=!0,this._unwatchPath(),a=this.parent,a&&(this._watchPath=["**"],a.data.bind("**",this),"function"==typeof a.watchAllMessages&&a.watchAllMessages()))},b.prototype.destroy=function(){this.parent&&this._unwatchPath()},b}(cola.Scope),cola.ExpressionScope=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.repeatNotification=!0,b.prototype._unwatchPath=function(){var a,c,d,e;if(b.__super__._unwatchPath.call(this),this.parent&&this.expressionDynaPaths)for(e=this.expressionDynaPaths,a=0,c=e.length;c>a;a++)d=e[a],this.parent.data.unbind(d,this)},b.prototype.setExpression=function(a){var b,c,d,e;if(this.expression=a,null==this.expressionPaths&&(this.expressionPaths=[]),a){if(a.paths)for(e=this.expression.paths,b=0,c=e.length;c>b;b++)d=e[b],this.expressionPaths.push(d.split("."));a.paths||!a.hasCallStatement||a.hasDefinedPath?this.watchPath(a.paths):this.watchAllMessages()}else this._unwatchPath()},b.prototype.evaluate=function(a,b,c,d){var e,f,g,h,i,j,k,l,m;if(null==c&&(c="async"),null==d&&(d={}),this.expression){if(b&&this.dynaExpression)m=this.dynaExpression.evaluate(a,c,d);else if(m=this.expression.evaluate(a,c,d),this.expression.isDyna&&d.dynaExpression&&(this.dynaExpression=d.dynaExpression,this.dynaExpression.raw!==this.dynaExpressionStr&&(this.dynaExpressionStr=this.dynaExpression.raw),this.parent&&!this.ignoreBind)){if(this.expressionDynaPaths){for(l=this.expressionDynaPaths,f=0,g=l.length;g>f;f++)j=l[f],this.parent.data.unbind(j,this);delete this.expressionDynaPaths}if(k=this.expression.paths,e=this.dynaExpression.paths)for(i=0,h=e.length;h>i;i++)j=e[i],(!k||k.indexOf(j)<0)&&(this.expressionDynaPaths?this.expressionDynaPaths.push(j):this.expressionDynaPaths=[j],this.parent.data.bind(j,this))}return m}},b.prototype.isParentOfTarget=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(c=this.expressionPaths,b=this.expressionDynaPaths,!c.length&&!b)return!1;if(!a)return!0;if(c.length)for(f=0,g=c.length;g>f;f++){for(o=c[f],e=!0,d=k=0,h=a.length;h>k;d=++k)if(l=a[d],n=o[d],l!==n){if("**"===n)continue;if("*"===n&&d===a.length-1)continue;e=!1;break}if(e)return 2}if(b)for(m=0,i=b.length;i>m;m++){for(o=b[m],e=!0,d=p=0,j=a.length;j>p;d=++p)if(l=a[d],n=o[d].split("."),l!==n){if("**"===n)continue;if("*"===n&&d===a.length-1)continue;e=!1;break}if(e)return 1}return 0},b}(cola.SubScope),cola.AliasScope=function(a){function b(a,b){this.parent=a,this.setExpression(b),this.data=new cola.AliasDataModel(this,b.alias,this.dataType),this.action=this.parent.action}return extend(b,a),b.prototype.destroy=function(){b.__super__.destroy.call(this),this.data.destroy()},b.prototype.setExpression=function(a){b.__super__.setExpression.call(this,a),a&&1===typeof a.paths.length&&!a.hasCallStatement&&(this.dataType=this.parent.data.getDataType(a.paths[0]))},b.prototype.setTargetData=function(a){this.data.setTargetData(a)},b.prototype.retrieveData=function(a){var b;cola.util.cancelDelay(this,"retrieve"),b=this.evaluate(this,a),this.setTargetData(b)},b.prototype.refreshTargetData=function(){this.data.onDataMessage([this.expression.alias],cola.constants.MESSAGE_REFRESH,{data:data})},b.prototype.processMessage=function(a,b,c,d){var e;this.messageTimestamp>=d.timestamp||(e=this._processMessage(a,b,c,d),e||this.data.onDataMessage(b,c,d))},b.prototype._processMessage=function(a,b,c,d){var e,f;return(c===cola.constants.MESSAGE_REFRESH||c===cola.constants.MESSAGE_CURRENT_CHANGE||c===cola.constants.MESSAGE_PROPERTY_CHANGE||c===cola.constants.MESSAGE_REMOVE)&&(f=this.isParentOfTarget(b),f?(this.retrieveData(2>f),this.refreshTargetData(),e=!0):this.expression&&(this.expressionPaths||!this.expression.hasCallStatement||this.expression.hasDefinedPath||(cola.util.delay(this,"retrieve",100,function(a){return function(){a.retrieveData(),a.refreshTargetData()}}(this)),e=!0))),e},b}(cola.ExpressionScope),cola.ItemScope=function(a){function b(a,b){var c;this.parent=a,this.data=new cola.ItemDataModel(this,b,null!=(c=this.parent)?c.dataType:void 0),this.action=this.parent.action}return extend(b,a),b.prototype.watchPath=function(){},b.prototype.watchAllMessages=function(){var a;null!=(a=this.parent)&&"function"==typeof a.watchAllMessages&&a.watchAllMessages()},b.prototype.processMessage=function(a,b,c,d){return this.data.onDataMessage(b,c,d)},b}(cola.SubScope),cola.ItemsScope=function(a){function b(a,b){this.setParent(a),this.setExpression(b)}return extend(b,a),b.prototype.setParent=function(a){this.parent&&this._unwatchPath(),this.parent=a,this.data=a.data,this.action=a.action,this._watchAllMessages?this.watchAllMessages():this._watchPath&&this.watchPath(this._watchPath)},b.prototype.setExpression=function(a){b.__super__.setExpression.call(this,a),this.alias=a?a.alias:"item"},b.prototype.setItems=function(a){this._setItems(a)},b.prototype.retrieveData=function(a){var b;cola.util.cancelDelay(this,"retrieve"),this._retrieveItems?this._retrieveItems(a):this.expression&&(b=this.evaluate(this.parent,a),this.setItems(b))},b.prototype._setItems=function(a){this.items=a,this.originItems=a instanceof Array?a.$origin:null},b.prototype.refreshItems=function(){"function"==typeof this.onItemsRefresh&&this.onItemsRefresh()},b.prototype.refreshItem=function(a){a.itemsScope=this,"function"==typeof this.onItemRefresh&&this.onItemRefresh(a)},b.prototype.insertItem=function(a){a.itemsScope=this,"function"==typeof this.onItemInsert&&this.onItemInsert(a)},b.prototype.removeItem=function(a){a.itemsScope=this,"function"==typeof this.onItemRemove&&this.onItemRemove(a)},b.prototype.itemsLoadingStart=function(a){return a.itemsScope=this,"function"==typeof this.onItemsLoadingStart?this.onItemsLoadingStart(a):void 0},b.prototype.itemsLoadingEnd=function(a){return a.itemsScope=this,"function"==typeof this.onItemsLoadingEnd?this.onItemsLoadingEnd(a):void 0},b.prototype.changeCurrentItem=function(a){a.itemsScope=this,"function"==typeof this.onCurrentItemChange&&this.onCurrentItemChange(a)},b.prototype.resetItemScopeMap=function(){this.itemScopeMap={}},b.prototype.getItemScope=function(a){var b;return b=cola.Entity._getEntityId(a),this.itemScopeMap[b]},b.prototype.regItemScope=function(a,b){this.itemScopeMap[a]=b},b.prototype.unregItemScope=function(a){delete this.itemScopeMap[a]},b.prototype.findItemDomBinding=function(a){var b,c,d,e,f,g,h,i,j;if(c=this.itemScopeMap,d=this.items,j=this.originItems,h=null!=j?j._multiItems:void 0,d||j)for(;a;){if(a instanceof cola.Entity){if(g=a.parent===d,!g&&j)if(h){for(e=0,f=j.length;f>e;e++)if(i=j[e],a.parent===i){g=!0;break}}else g=a.parent===j;if(g)return b=cola.Entity._getEntityId(a),b?c[b]:null}a=a.parent}return null},b.prototype.processMessage=function(a,b,c,d){var e,f,g,h;if(!(this.messageTimestamp>=d.timestamp))if(e=this._processMessage(a,b,c,d))this.messageTimestamp=d.timestamp;else if(this.itemScopeMap)if(g=this.findItemDomBinding(d.data||d.entity))g.processMessage(a,b,c,d);else if(this.hasExBinding()){h=this.itemScopeMap;for(f in h)g=h[f],g.hasExBinding()&&g.processMessage(a,b,c,d)}},b.prototype.isOriginItems=function(a){var b,c,d,e;if(!this.originItems)return!1;if(this.originItems===a)return!0;if(this.originItems instanceof Array&&this.originItems._multiItems)for(e=this.originItems,b=0,c=e.length;c>b;b++)if(d=e[b],d===a)return!0;return!1},b.prototype._processMessage=function(a,b,c,d){var e,f,g,h,i,j;return c===cola.constants.MESSAGE_REFRESH?this.isParentOfTarget(b,this.expressionPaths)?(this.retrieveData(),this.refreshItems(),e=!0):i=!0:c===cola.constants.MESSAGE_PROPERTY_CHANGE?this.isParentOfTarget(b,this.expressionPaths)?(this.retrieveData(),this.refreshItems(),e=!0):(h=null!=(j=d.entity)?j.parent:void 0,h===this.items||this.isOriginItems(d.parent)?this.refreshItem(d):i=!0):c===cola.constants.MESSAGE_CURRENT_CHANGE?d.entityList===this.items||this.isOriginItems(d.entityList)?"function"==typeof this.onCurrentItemChange&&this.onCurrentItemChange(d):this.isParentOfTarget(b,this.expressionPaths)?(this.retrieveData(),this.refreshItems(),e=!0):i=!0:c===cola.constants.MESSAGE_INSERT?d.entityList===this.items?(this.insertItem(d),e=!0):this.isOriginItems(d.entityList)?(this.insertItem(d),e=!0):i=!0:c===cola.constants.MESSAGE_REMOVE?d.entityList===this.items?(this.removeItem(d),e=!0):this.isOriginItems(d.entityList)?(g=this.items,g instanceof Array&&(f=g.indexOf(d.entity),f>-1&&g.splice(f,1)),this.removeItem(d),e=!0):i=!0:c===cola.constants.MESSAGE_LOADING_START?this.isParentOfTarget(b,this.expressionPaths)&&this.itemsLoadingStart(d):c===cola.constants.MESSAGE_LOADING_END&&this.isParentOfTarget(b,this.expressionPaths)&&this.itemsLoadingEnd(d),i&&this.expression&&(this.expressionPaths||!this.expression.hasCallStatement||this.expression.hasDefinedPath||cola.util.delay(this,"retrieve",100,function(a){return function(){a.retrieveData(),a.refreshItems()}}(this))),e},b}(cola.ExpressionScope),cola.AbstractDataModel=function(){function a(a){this.model=a}return a.prototype.disableObserverCount=0,a.prototype.get=function(a,b,c){var d,e,f,g,h,i,j,k,l;return a?this._aliasMap&&(h=a.indexOf("."),g=h>0?a.substring(0,h):a,e=this._aliasMap[g])?(d=e.data,h>0?(!b||"function"!=typeof b&&"object"!=typeof b||(b="async",f=b),cola.Entity._evalDataPath(d,a.substring(h+1),!1,b,f,c)):d):(l=this._rootData,null!=l?this.model.parent?(h=a.indexOf("."),i=h>0?a.substring(0,h):a,l.hasValue(i)?l.get(a,b,c):this.model.parent.data.get(a,b,c)):l.get(a,b,c):null!=(k=this.model.parent)?k.data.get(a,b,c):void 0):this._getRootData()||(null!=(j=this.model.parent)?j.get():void 0)},a.prototype.set=function(a,b,c){var d,e,f,g,h;if(a)if(h=this._getRootData(),"string"==typeof a)if(f=a.indexOf("."),f>0){if(e=a.substring(0,f),this._aliasMap&&(d=this._aliasMap[e])){if(!d.data)throw new cola.Exception('Cannot set value to "'+a+'"');return cola.Entity._setValue(d.data,a.substring(f+1),b,c),this}this.model.parent?h.hasValue(e)?h.set(a,b,c):this.model.parent.data.set(a,b,c):h.set(a,b,c)}else this._set(a,b,c);else{b=a;for(g in b)this.set(g,b[g],c)}return this},a.prototype._set=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;m=this._rootData,f=m.hasValue(a),(null!=(l=this._aliasMap)?l[a]:void 0)&&(h=this._aliasMap[a],h.data!==b&&(g=h.data,delete this._aliasMap[a],this.unbind(h.bindingPath,h))),null!=b&&(b.$provider||b.$dataType)&&(b.$provider&&(k=new cola.Provider(b.$provider)),n=m.dataType,j=n.getProperty(a),null==j&&(j=n.addProperty({property:a})),k&&j.set("provider",k),b.$dataType&&j.set("dataType",b.$dataType)),(!k||f)&&(b&&(b instanceof cola.Entity||b instanceof cola.EntityList)&&b.parent&&b!==m._data[a]?(null==this._aliasMap&&(this._aliasMap={}),i=b.getPath("always"),e=this,this._aliasMap[a]=d={data:b,path:i,bindingPath:i.slice(0).concat("**"),processMessage:function(b,c,d,f){var g;g=c.slice(this.path.length),e.onDataMessage([a].concat(g),d,f)}},this.bind(d.bindingPath,d),this.onDataMessage([a],cola.constants.MESSAGE_PROPERTY_CHANGE,{entity:m,property:a,oldValue:g,value:b})):m.set(a,b,c))},a.prototype.reset=function(a){var b;return null!=(b=this._rootData)&&b.reset(a),this},a.prototype.flush=function(a,b){var c;return null!=(c=this._rootData)&&c.flush(a,b),this},a.prototype.bind=function(a,b){return this.bindingRegistry||(this.bindingRegistry={__path:"",__processorMap:{}}),"string"==typeof a&&(a=a.split(".")),a&&this._bind(a,b),this},a.prototype._bind=function(a,b){var c,d,e,f,g,h;if(e=this.bindingRegistry,a){for(c=0,d=a.length;d>c;c++)g=a[c],h=e[g],null==h&&(f=e.__path?e.__path+"."+g:g,e[g]=h={__path:f,__processorMap:{}}),e=h;null==b.id&&(b.id=cola.uniqueId()),e.__processorMap[b.id]=b}},a.prototype.unbind=function(a,b){return this.bindingRegistry?("string"==typeof a&&(a=a.split(".")),a&&this._unbind(a,b),this):void 0},a.prototype._unbind=function(a,b){var c,d,e,f;for(e=this.bindingRegistry,c=0,d=a.length;d>c&&(f=a[c],e=e[f],null!=e);c++);return null!=e?delete e.__processorMap[b.id]:void 0},a.prototype.disableObservers=function(){return this.disableObserverCount<0?this.disableObserverCount=1:this.disableObserverCount++,this},a.prototype.enableObservers=function(){return this.disableObserverCount<1?this.disableObserverCount=0:this.disableObserverCount--,this},a.prototype.notifyObservers=function(){var a;return null!=(a=this._rootData)&&a.notifyObservers(),this},a.prototype.onDataMessage=function(a,b,c){var d,e,f,g,h,i,j,k,l;if(null==c&&(c={}),this.bindingRegistry&&!(this.disableObserverCount>0)){k=cola.currentScope,cola.currentScope=this;try{if(null==c.timestamp&&(c.timestamp=cola.sequenceNo()),a)for(j=this.bindingRegistry,h=a.length-1,f=g=0,i=a.length;i>g&&(l=a[f],f===h&&(e=j["*"]),e&&this.processDataMessage(e,a,b,c),d=j["**"],d&&this.processDataMessage(d,a,b,c),j=j[l],j);f=++g);else j=this.bindingRegistry,e=j["*"],e&&this.processDataMessage(e,null,b,c),d=j["**"],d&&this.processDataMessage(d,null,b,c);j&&this.processDataMessage(j,a,b,c,!0)}finally{cola.currentScope=k}}},a.prototype.processDataMessage=function(a,b,c,d,e){var f,g,h,i,j,k;j=a.__processorMap;for(f in j)i=j[f],i.disabled||i.timestamp>=d.timestamp&&!i.repeatNotification||(i.timestamp=d.timestamp,i.processMessage(a.__path,b,c,d));if(e){g=!(cola.constants.MESSAGE_EDITING_STATE_CHANGE<=c&&c<=cola.constants.MESSAGE_VALIDATION_STATE_CHANGE||cola.constants.MESSAGE_LOADING_START<=c&&c<=cola.constants.MESSAGE_LOADING_END),c===cola.constants.MESSAGE_CURRENT_CHANGE&&(c=cola.constants.MESSAGE_REFRESH);for(h in a)k=a[h],k&&("**"===h||g)&&"__processorMap"!==h&&"__path"!==h&&this.processDataMessage(k,b,c,d,!0)}},a}(),cola.DataModel=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype._createRootData=function(a){return new cola.Entity(null,a)},b.prototype._getRootData=function(){var a,b;return null==this._rootData&&(null==this._rootDataType&&(this._rootDataType=new cola.EntityDataType),this._rootData=b=this._createRootData(this._rootDataType),b.state=cola.Entity.STATE_NEW,a=this,b._setDataModel(a)),this._rootData},b.prototype.describe=function(a,b){var c,d,e,f,g;if(this._getRootData(),"string"==typeof a){if(e=null!=(g=this._rootDataType)?g.getProperty(a):void 0,b)if(e||(e=this._rootDataType.addProperty({property:a})),"string"==typeof b){if(c=this.definition(b),!c)throw new cola.Exception('Unrecognized DataType "'+b+'".');e.set("dataType",c)}else b instanceof cola.DataType?e.set("dataType",b):e.set(b)}else if(a){b=a;for(f in b)d=b[f],this.describe(f,d)}},b.prototype.getProperty=function(a){var b,c,d,e,f,g,h,i;for(d=a.indexOf("."),d>0?(e=a.substring(0,d),f=a.substring(d+1)):(e=null,
f=a),b=this;b&&(i=b._rootDataType,!i||!(c=e?null!=(g=i.getProperty(e))?g.get("dataType"):void 0:i));)b=null!=(h=b.model.parent)?h.data:void 0;return null!=c?c.getProperty(f):void 0},b.prototype.getDataType=function(a){var b,c;return c=this.getProperty(a),b=null!=c?c.get("dataType"):void 0},b.prototype.definition=function(a){var b,c;return b=null!=(c=this._definitionStore)?c[a]:void 0,b?b instanceof cola.Definition||(b=new cola.EntityDataType(b),this._definitionStore[a]=b):b=cola.DataType.defaultDataTypes[a],b},b.prototype.regDefinition=function(a,b){var c;if(a instanceof cola.Definition&&(b=a,a=a._name),!a)throw new cola.Exception('Attribute "name" cannot be emtpy.');if(b._scope&&b._scope!==this.model)throw new cola.Exception("DataType("+b._name+") is already belongs to anthor Model.");if(c=this._definitionStore,null==c)this._definitionStore=c={};else if(c[a])throw new cola.Exception('Duplicated Definition name "'+a+'".');return c[a]=b,this},b.prototype.unregDefinition=function(a){var b;return this._definitionStore&&(b=this._definitionStore[a],delete this._definitionStore[a]),b},b.prototype.addEntityListener=function(a){null==this._entityListeners&&(this._entityListeners=[]),this._entityListeners.push(a)},b.prototype.removeEntityListener=function(a){var b;this._entityListeners&&a&&(b=this._entityListeners.indexOf(a),b>-1&&this._entityListeners.splice(b,1))},b.prototype.onEntityAttach=function(a){var b,c,d,e;if(this._entityListeners)for(e=this._entityListeners,b=0,c=e.length;c>b;b++)d=e[b],d.onEntityAttach(a)},b.prototype.onEntityDetach=function(a){var b,c,d,e;if(this._entityListeners)for(e=this._entityListeners,b=0,c=e.length;c>b;b++)d=e[b],d.onEntityDetach(a)},b}(cola.AbstractDataModel),cola.AliasDataModel=function(a){function b(a,b,c){var d;for(this.model=a,this.alias=b,this.dataType=c,this.defaultDataType=this.dataType,d=this.model.parent;d;){if(d.data){this.parent=d.data;break}d=d.parent}}return extend(b,a),b.prototype.getTargetData=function(){return this._targetData},b.prototype.setTargetData=function(a,b){var c;c=this._targetData,this._targetData=a,(a instanceof cola.Entity||a instanceof cola.EntityList)&&(this.dataType=a.dataType||this.defaultDataType),b||this.onDataMessage([this.alias],cola.constants.MESSAGE_PROPERTY_CHANGE,{entity:null,property:this.alias,value:a,oldValue:c})},b.prototype.describe=function(a,c){return a===this.alias?b.__super__.describe.call(this,a,c):this.parent.describe(a,c)},b.prototype.getProperty=function(a){var b,c,d;return c=a.indexOf("."),c>0?a.substring(0,c)===this.alias?(b=this._targetData instanceof cola.Entity||this._targetData instanceof cola.EntityList?this._targetData.dataType:null,b&&(d=b.getProperty(a.substring(c+1)),b=null!=d?d.get("dataType"):void 0),b):this.parent.getDataType(a):a===this.alias?this._targetData instanceof cola.Entity||this._targetData instanceof cola.EntityList?this._targetData.dataType:null:this.parent.getProperty(a)},b.prototype.getDataType=function(a){var b,c,d,e;return c=a.indexOf("."),c>0?a.substring(0,c)===this.alias?(this._rootDataType&&(d=null!=(e=this._rootDataType)?e.getProperty(a.substring(c+1)):void 0,b=null!=d?d.get("dataType"):void 0),b):this.parent.getDataType(a):a===this.alias?this.dataType:this.parent.getDataType(a)},b.prototype.definition=function(a){return this.parent.definition(a)},b.prototype.regDefinition=function(a){return this.parent.regDefinition(a)},b.prototype.unregDefinition=function(a){return this.parent.unregDefinition(a)},b.prototype._bind=function(a,c){b.__super__._bind.call(this,a,c),this._exBindingProcessed||a[0]===this.alias||(this._exBindingProcessed=!0,this.model.setHasExBinding(!0),this.model.watchAllMessages())},b.prototype.get=function(a,b,c){var d,e,f,g;if(d=this.alias,e=d.length,a.substring(0,e)===d)if(f=a.charCodeAt(e),46===f){if(a.indexOf(".")>0){if(g=this._targetData,g instanceof cola.Entity)return g.get(a.substring(e+1),b,c);if(g&&"object"==typeof g)return g[a.substring(e+1)]}}else if(isNaN(f))return this._targetData;return this.parent.get(a,b,c)},b.prototype.set=function(a,b,c){var d,e,f,g;if(d=this.alias,e=d.length,a.substring(0,e)===d)if(f=a.charCodeAt(e),46===f){if(a.indexOf(".")>0)return null!=(g=this._targetData)&&g.set(a.substring(e+1),b,c),this}else if(isNaN(f))return this.setTargetData(b),this;return this.parent.set(a,b,c),this},b.prototype.dataType=function(a){return this.parent.dataType(a)},b.prototype.regDefinition=function(a,b){return this.parent.regDefinition(a,b),this},b.prototype.unregDefinition=function(a){return this.parent.unregDefinition(a)},b.prototype.flush=function(a,b){var c,d,e,f;if(c=this.alias,a.substring(0,c.length)===c){if(d=a.charCodeAt(1),46===d)return null!=(e=this._targetData)&&e.flush(a.substring(c.length+1),b),this;if(isNaN(d))return null!=(f=this._targetData)&&f.flush(b),this}return this.parent.flush(a,b),this},b.prototype.disableObservers=function(){return this.parent.disableObservers(),this},b.prototype.enableObservers=function(){return this.parent.enableObservers(),this},b.prototype.notifyObservers=function(){return this.parent.notifyObservers(),this},b.prototype.onDataMessage=function(a,c,d){var e,f,g,h;if(b.__super__.onDataMessage.call(this,a,c,d),this._targetData){for(h=this._targetData,e=d.data||d.entityList||d.entity;e;){if(e===h){f=!0;break}e=e.parent}f&&(g=a.slice(h.getPath().length),b.__super__.onDataMessage.call(this,[this.alias].concat(g),c,d))}},b}(cola.AbstractDataModel),cola.ItemDataModel=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.getIndex=function(){return this._index},b.prototype.setIndex=function(a,b){this._index=a,b||this.onDataMessage([cola.constants.REPEAT_INDEX],cola.constants.MESSAGE_PROPERTY_CHANGE,{entity:null,property:cola.constants.REPEAT_INDEX,value:a})},b.prototype.get=function(a,c,d){return a===cola.constants.REPEAT_INDEX?this.getIndex():b.__super__.get.call(this,a,c,d)},b.prototype.set=function(a,c,d){a===cola.constants.REPEAT_INDEX?this.setIndex(c):b.__super__.set.call(this,a,c,d)},b}(cola.AliasDataModel),new cola.Model(cola.constants.DEFAULT_PATH),cola.data=function(a){var b,c,d,e,f;if(!a)return a;if(a.provider)e=a.provider;else{e={};for(c in a)f=a[c],"dataType"!==c&&(e[c]=f)}if(b=a.dataType)if("string"==typeof b){if(d=b,b=cola.currentScope.dataType(d),!b)throw new cola.Exception('Unrecognized DataType "'+d+'".')}else b instanceof cola.DataType||(b=new cola.EntityDataType(b));return{$dataType:b,$provider:e}},cola.ElementAttrBinding=function(){function a(a,b,c,d){var e,f,g,h;for(this.element=a,this.attr=b,this.expression=c,this.scope=d,this.paths=this.expression.paths||[],this.watchingMoreMessage=!this.paths.length&&this.expression.hasCallStatement&&!this.expression.hasDefinedPath,h=this.paths,e=0,f=h.length;f>e;e++)g=h[e],d.data.bind(g,this)}return a.prototype.destroy=function(){var a,b,c,d;if(d=this.paths)for(a=0,b=d.length;b>a;a++)c=d[a],this.scope.data.unbind(c,this)},a.prototype.processMessage=function(a,b,c){var d;(cola.constants.MESSAGE_REFRESH<=c&&c<=cola.constants.MESSAGE_CURRENT_CHANGE||this.watchingMoreMessage)&&this.refresh((null!=(d=this.dynaPaths)?d.indexOf(a):void 0)>=0)},a.prototype.evaluate=function(a,b){var c,d,e,f,g,h,i,j,k,l;if(g="async",a&&this.dynaExpression)l=this.dynaExpression.evaluate(this.scope,g,b);else if(l=this.expression.evaluate(this.scope,g,b),this.expression.isDyna&&(null!=b?b.dynaExpression:void 0)&&(c=b.dynaExpression,c.raw!==this.dynaExpressionStr&&(this.dynaExpressionStr=c.raw),!this.ignoreBind)){if(this.dynaPaths)for(k=this.dynaPaths,d=0,e=k.length;e>d;d++)i=k[d],this.scope.data.unbind(i,this);if(j=this.dynaExpression.paths)for(h=0,f=j.length;f>h;h++)i=j[h],this.paths.indexOf(i)<0&&(this.dynaPaths?this.dynaPaths.push(i):this.dynaPaths=[i],this.scope.data.bind(i,this))}return l},a.prototype._refresh=function(a){var b;value=this.evaluate(a),b=this.element,b._duringBindingRefresh=!0;try{b.set(this.attr,value)}finally{b._duringBindingRefresh=!1}},a.prototype.refresh=function(a){this._refresh&&(this.delay?cola.util.delay(this,"refresh",100,function(){this._refresh(a)}):this._refresh(a))},a}(),cola.submit=function(a,b){var c,d,e,f,g;e=a,a={};for(f in e)g=e[f],a[f]=g;if(c=a.data){if(!(c instanceof cola.Entity||c instanceof cola.EntityList))throw new cola.Exception("Invalid submit data.");this.dataFilter&&(d=cola.submit.filter[this.dataFilter],c=d?d(c):c)}return c||a.alwaysSubmit?(a.parameter?a.data={data:c,parameter:a.parameter}:a.data=c,jQuery.post(a.url,a.data).done(function(a){cola.callback(b,!0,a)}).fail(function(a){cola.callback(b,!0,a)}),!0):!1},cola.submit.filter={dirty:function(a){var b;return a instanceof cola.EntityList?(b=[],a.each(function(a){a.state!==cola.Entity.STATE_NONE&&b.push(a)})):a.state!==cola.Entity.STATE_NONE&&(b=a),b},"child-dirty":function(a){return a},"dirty-tree":function(a){return a}},defaultActionTimestamp=0,cola.defaultAction=function(a,b){var c;if(a){if("string"==typeof a&&"function"==typeof b)cola.defaultAction[a]=b;else if("object"==typeof a)for(c in a)a.hasOwnProperty(c)&&(cola.defaultAction[c]=a[c]);defaultActionTimestamp=cola.uniqueId()}},cola.Chain=function(){function a(a){var b;if(this._data=a,cola.Chain.prototype.timestamp!==defaultActionTimestamp){cola.Chain.prototype.timestamp=defaultActionTimestamp;for(b in cola.defaultAction)!cola.Chain.prototype[b]&&cola.defaultAction.hasOwnProperty(b)&&"chain"!==b&&!function(a){return cola.Chain.prototype[a]=function(){var b,c;return b=1<=arguments.length?slice.call(arguments,0):[],this._data=(c=cola.defaultAction)[a].apply(c,[this._data].concat(slice.call(b))),this}}(b)}}return a}(),cola.defaultAction.chain=function(a){return new cola.Chain(a)},cola.defaultAction["default"]=function(a,b){return null==b&&(b=""),a||b},cola.defaultAction["int"]=function(a){return parseInt(a,10)||0},cola.defaultAction["float"]=function(a){return parseFloat(a)||0},cola.defaultAction.is=function(a){return!!a},cola.defaultAction.bool=cola.defaultAction.is,cola.defaultAction.not=function(a){return!a},cola.defaultAction.isEmpty=function(a){return a instanceof Array?0===a.length:a instanceof cola.EntityList?0===a.entityCount:"string"==typeof a?""===a:!a},cola.defaultAction.isNotEmpty=function(a){return!cola.defaultAction.isEmpty(a)},cola.defaultAction.len=function(a){return a?a instanceof Array?a.length:a instanceof cola.EntityList?a.entityCount:0:0},cola.defaultAction.upperCase=function(a){return null!=a?a.toUpperCase():void 0},cola.defaultAction.lowerCase=function(a){return null!=a?a.toLowerCase():void 0},cola.defaultAction.capitalize=function(a){return cola.util.capitalize(a)},cola.defaultAction.resource=function(){var a,b;return a=arguments[0],b=2<=arguments.length?slice.call(arguments,1):[],cola.resource.apply(cola,[a].concat(slice.call(b)))},_matchValue=function(a,b){return b.strict?b.caseSensitive||"string"!=typeof b.value?a===b.value:(a+"").toLowerCase()===b.value:b.caseSensitive?(a+"").indexOf(b.value)>-1:(a+"").toLowerCase().indexOf(b.value)>-1},cola.defaultAction.filter=function(a,b,c){return b=cola._trimCriteria(b,c),cola.util.filter(a,b,c)},cola.defaultAction.sort=cola.util.sort,cola.defaultAction.top=function(a,b){var c,d;return null==b&&(b=1),a?0>b?a:(d=[],d.$origin=a.$origin||a,c=0,cola.each(a,function(a){return c++,d.push(a),b>c}),d):null},cola.defaultAction.formatDate=cola.util.formatDate,cola.defaultAction.formatNumber=cola.util.formatNumber,cola.defaultAction.format=cola.util.format,_numberWords=["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen"],cola.defaultAction.number2Word=function(a){return _numberWords[a]},cola.defaultAction.backgroundImage=function(a){return a?"url("+a+")":"none"},cola.AjaxServiceInvoker=function(){function a(a,b){this.ajaxService=a,this.invokerOptions=b,this.callbacks=[]}return a.prototype.invokeCallback=function(a,b){var c,d,e,f;for(this.invoking=!1,d=this.callbacks,this.callbacks=[],e=0,f=d.length;f>e;e++)c=d[e],cola.callback(c,a,b)},a.prototype._internalInvoke=function(a){var b,c,d,e,f,g;null==a&&(a=!0),b=this.ajaxService,c=this.invokerOptions,f=void 0,d={};for(e in c)g=c[e],d[e]=g;return d.async=a,d.sendJson&&(d.data=JSON.stringify(d.data)),b.getListeners("beforeSend")&&b.fire("beforeSend",b,{options:d})===!1?void 0:(this._beforeSend&&this._beforeSend(d),jQuery.ajax(d).done(function(a){return function(c){c=b.translateResult(c,d),a.invokeCallback(!0,c),b.getListeners("success")&&b.fire("success",b,{options:d,result:c}),b.getListeners("complete")&&b.fire("complete",b,{success:!0,options:d,result:c}),f=c}}(this)).fail(function(a){return function(c,e,g){var h,i;return h={xhr:c,status:e,message:g,data:c.responseJSON},i=a.invokeCallback(!1,h),void 0!==i&&(f=i),f===!1?f:(i=b.fire("error",b,{options:d,xhr:c,error:h}),void 0!==i&&(f=i),f===!1?f:(i=b.fire("complete",b,{success:!1,xhr:c,options:d,error:h}),void 0!==i&&(f=i),f))}}(this)),f)},a.prototype.invokeAsync=function(a){return this.callbacks.push(a),this.invoking?!1:(this.invoking=!0,this._internalInvoke(),!0)},a.prototype.invokeSync=function(a){if(this.invoking)throw new cola.Exception("Cannot perform synchronized request during an asynchronized request executing. ["+this.url+"]");return this.callbacks.push(a),this._internalInvoke(!1)},a}(),cola.AjaxService=function(a){function b(a){"string"==typeof a&&(a={url:a}),b.__super__.constructor.call(this,a)}return extend(b,a),b.attributes={url:null,method:null,parameter:null,timeout:null,ajaxOptions:null},b.events={beforeSend:null,complete:null,success:null,error:null},b.prototype.getUrl=function(){return this._url},b.prototype.getInvokerOptions=function(a){var b,c,d,e;if(c={},b=this._ajaxOptions)for(d in b)e=b[d],c[d]=e;return c.url=this.getUrl(a),this._method&&(c.method=this._method),this._timeout&&(c.timeout=this._timeout),c.data=this._parameter,c},b.prototype.getInvoker=function(a){return new cola.AjaxServiceInvoker(this,this.getInvokerOptions(a))},b.prototype.translateResult=function(a,b){return a},b}(cola.Definition),cola.ProviderInvoker=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype._replaceSysParams=function(a){var b,c,d,e,f,g,h,i,j,k;if(j=a.originUrl||a.url,g=j.match(/{{\$[\w-]+}}/g))for(null==a.originUrl&&(a.originUrl=j),d=0,e=g.length;e>d;d++)f=g[d],h=f.substring(2,f.length-1),h&&(j=j.replace(f,this[h]||""),a.url=j,b=!0);if(c=a.originData||a.data)for(i in c)k=c[i],"string"==typeof k&&123===k.charCodeAt(0)&&k.match(/^{{\$[\w-]+}}$/)&&(null==a.originData&&(a.originData=$.extend(c,null)),c[i]=this[k.substring(2,k.length-1)],b=!0);return b},b.prototype.applyPagingParameters=function(a){this._replaceSysParams(a)||(null==a.data&&(a.data={}),"from"===cola.setting("pagingParamStyle")?(a.data.from=this.from,a.data.limit=this.limit+(this.detectEnd?1:0)):(a.data.pageSize=this.pageSize,a.data.pageNo=this.pageNo))},b.prototype._beforeSend=function(a){!this.pageNo>=1&&(this.pageNo=1),this.from=this.pageSize*(this.pageNo-1),this.limit=this.pageSize,this.pageSize&&this.applyPagingParameters(a)},b}(cola.AjaxServiceInvoker),_SYS_PARAMS=["$pageNo","$pageSize","$from","$limit"],_ExpressionDataModel=function(a){function b(a,c){this.entity=c,b.__super__.constructor.call(this,a)}return extend(b,a),b.prototype.get=function(a,b,c){var d;return 64===a.charCodeAt(0)?this.entity.get(a.substring(1)):null!=(d=this.model.parent)?d.data.get(a,b,c):void 0},b.prototype.set=cola._EMPTY_FUNC,b.prototype.processMessage=cola._EMPTY_FUNC,b.prototype.getDataType=cola._EMPTY_FUNC,b.prototype.getProperty=cola._EMPTY_FUNC,b.prototype.flush=cola._EMPTY_FUNC,b}(cola.AbstractDataModel),_ExpressionScope=function(a){function b(a,b){this.parent=a,this.entity=b,this.data=new _ExpressionDataModel(this,this.entity),this.action=this.parent.action}return extend(b,a),b}(cola.SubScope),cola.Provider=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={loadMode:{defaultValue:"lazy"},pageSize:null,detectEnd:null},b.prototype.getUrl=function(a){var b,c,d,e,f;if(f=this._url,e=f.match(/{{.+}}/g))for(null==a.expressionScope&&(a.expressionScope=new _ExpressionScope(this._scope,a.data)),b=0,c=e.length;c>b;b++)d=e[b],f=f.replace(d,this._evalParamValue(d,a));return f},b.prototype.getInvoker=function(a){var b;return b=new cola.ProviderInvoker(this,this.getInvokerOptions(a)),b.pageSize=this._pageSize,b.detectEnd=this._detectEnd,b},b.prototype._evalParamValue=function(a,b){var c;return 123===a.charCodeAt(0)&&a.match(/^{{.+}}$/)&&(c=a.substring(2,a.length-2),_SYS_PARAMS.indexOf(c)<0&&(c=cola._compileExpression(c)))?c.evaluate(b.expressionScope,"never"):a},b.prototype.getInvokerOptions=function(a){var c,d,e,f,g;if(d=b.__super__.getInvokerOptions.call(this,a),f=d.data,null!=f)if(null==a.expressionScope&&(a.expressionScope=new _ExpressionScope(this._scope,a.data)),"string"==typeof f)f=this._evalParamValue(f,a);else if("function"==typeof f&&(f=f(this,a)),"object"==typeof f){c=f,f={};for(e in c)g=c[e],"string"==typeof g&&(g=this._evalParamValue(g,a)),f[e]=g}return null==f?f={}:f instanceof Object||(f={parameter:f}),d.data=f,null==d.dataType&&(d.dataType="json"),d},b.prototype.translateResult=function(a,b){return this._detectEnd&&a instanceof Array&&(a=a.length>=this._pageSize?a.slice(0,this._pageSize):{$entityCount:(b.data.from||0)+a.length,$data:a}),a},b}(cola.AjaxService),_$=$(),_$.length=1,this.$fly=function(a){return _$[0]=a,_$},cola.util.setText=function(a,b){null==b&&(b=""),cola.browser.mozilla?("string"==typeof b&&(b=b.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\n/g,"<br>")),a.innerHTML=b):a.innerText=b},doms={},cola.util.cacheDom=function(a){cola._ignoreNodeRemoved=!0,doms.hiddenDiv||(doms.hiddenDiv=$.xCreate({tagName:"div",id:"_hidden_div",style:{display:"none"}}),doms.hiddenDiv.setAttribute(cola.constants.IGNORE_DIRECTIVE,""),document.body.appendChild(doms.hiddenDiv)),doms.hiddenDiv.appendChild(a),cola._ignoreNodeRemoved=!1},USER_DATA_KEY=cola.constants.DOM_USER_DATA_KEY,cola.util.userDataStore={size:0},cola.util.userData=function(a,b,c){var d,e,f,g,h,i,j;if(3!==a.nodeType)if(i=cola.util.userDataStore,8===a.nodeType?(h=a.nodeValue,d=h.indexOf("|"),d>-1&&(e=h.substring(d+1))):e=a.getAttribute(USER_DATA_KEY),3===arguments.length)e?(g=i[e],g||(i[e]=g={__cleanStamp:cleanStamp})):(e=cola.uniqueId(),8===a.nodeType?d>-1?a.nodeValue=h.substring(0,d+1)+e:a.nodeValue=h?h+"|"+e:"|"+e:a.setAttribute(USER_DATA_KEY,e),i[e]=g={__cleanStamp:cleanStamp},i.size++),g[b]=c;else if(2===arguments.length){if("string"==typeof b){if(e)return g=i[e],null!=g?g[b]:void 0}else if(b&&"object"==typeof b){e?(g=i[e],g||(i[e]=g={__cleanStamp:cleanStamp})):(e=cola.uniqueId(),8===a.nodeType?d>-1?a.nodeValue=h.substring(0,d+1)+e:a.nodeValue=h?h+"|"+e:"|"+e:a.setAttribute(USER_DATA_KEY,e),i[e]=g={__cleanStamp:cleanStamp},i.size++);for(f in b)j=b[f],g[f]=j}}else if(1===arguments.length&&e)return i[e]},cola.util.removeUserData=function(a,b){var c,d,e,f;return 8===a.nodeType?(f=a.nodeValue,c=f.indexOf("|"),c>-1&&(d=f.substring(c+1))):d=a.getAttribute(USER_DATA_KEY),d&&(e=cola.util.userDataStore[d],e&&(b?(value=e[b],delete e[b]):(delete cola.util.userDataStore[d],userData.size--))),value},ON_NODE_REMOVED_KEY="__onNodeRemoved",cola.detachNode=function(a){a.parentNode&&(cola._ignoreNodeRemoved=!0,a.parentNode.removeChild(a),cola._ignoreNodeRemoved=!1)},cola.util.onNodeDispose=function(a,b){var c;c=cola.util.userData(a,ON_NODE_REMOVED_KEY),c?c instanceof Array?c.push(b):cola.util.userData(a,ON_NODE_REMOVED_KEY,[c,b]):cola.util.userData(a,ON_NODE_REMOVED_KEY,b)},_nodesToBeRemove={},_getNodeDataId=function(a){var b,c,d;if(3!==a.nodeType)return 8===a.nodeType?(d=a.nodeValue,b=d.indexOf("|"),b>-1&&(c=d.substring(b+1))):c=a.getAttribute(USER_DATA_KEY),c},_DOMNodeInsertedListener=function(a){var b,c,d;if(d=a.target){for(b=d.firstChild;b;)c=_getNodeDataId(b),c&&delete _nodesToBeRemove[c],b=b.nextSibling;c=_getNodeDataId(d),c&&delete _nodesToBeRemove[c]}},_DOMNodeRemovedListener=function(a){var b,c,d;if(!cola._ignoreNodeRemoved&&!window.closed&&(d=a.target)){for(b=d.firstChild;b;)c=_getNodeDataId(b),c&&(_nodesToBeRemove[c]=b),b=b.nextSibling;c=_getNodeDataId(d),c&&(_nodesToBeRemove[c]=d)}},cleanStamp=1,document.all?setTimeout(function(){var a;a=0,setInterval(function(){var b,c,d,e,f,g,h;if(!(cola.util.userDataStore.size<256)){for(h=cola.util.userDataStore,b=0,d=document.all.length;d>a;)if(e=document.all[a],c=null,8===e.nodeType?(g=e.nodeValue,a=g.indexOf("|"),a>-1&&(c=g.substring(a+1))):c=e.getAttribute(USER_DATA_KEY),c&&(f=h[c],f&&(f.__cleanStamp=cleanStamp)),a++,b++,b>=64)return;for(c in h)f=h[c],f!==cleanStamp&&delete h[c];cleanStamp++}},1e3)},1e4):(document.addEventListener("DOMNodeInserted",_DOMNodeInsertedListener),document.addEventListener("DOMNodeRemoved",_DOMNodeRemovedListener),$fly(window).on("unload",function(){document.removeEventListener("DOMNodeInserted",_DOMNodeInsertedListener),document.removeEventListener("DOMNodeRemoved",_DOMNodeRemovedListener)}),setInterval(function(){var a,b,c,d,e,f,g,h;for(b in _nodesToBeRemove)if(f=_nodesToBeRemove[b],h=cola.util.userDataStore[b]){if(a=!0,g=h[ON_NODE_REMOVED_KEY])if(g instanceof Array)for(c=0,d=g.length;d>c;c++)(e=g[c])(f,h);else g(f,h);delete cola.util.userDataStore[b]}a&&(_nodesToBeRemove={})},1e4)),cola.device.mobile&&$fly(window).on("load",function(){FastClick.attach(document.body)}),cola.browser.webkit?(browser="webkit",cola.browser.chrome?browser+=" chrome":cola.browser.safari&&(browser+=" safari")):browser=cola.browser.ie?"ie":cola.browser.mozilla?"mozilla":"",os=cola.os.android?" android":cola.os.ios?" ios":cola.os.windows?" windows":"",cola.device.mobile?os+=" mobile":cola.device.desktop&&(os+=" desktop"),(browser||os)&&$fly(document.documentElement).addClass(browser+os),cola.os.mobile&&$(function(){"undefined"!=typeof FastClick&&null!==FastClick&&FastClick.attach(document.body)}),cola.loadSubView=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(n=[],e=!1,s=function(c,d,f){var g,h,i,j,k,l,m,o;if(c){if(!e&&(j=n.indexOf(f),j>-1&&n.splice(j,1),0===n.length)){if($fly(a).removeClass("loading"),a.hasAttribute(cola.constants.IGNORE_DIRECTIVE)&&(i=!0,a.removeAttribute(cola.constants.IGNORE_DIRECTIVE)),b.suspendedInitFuncs.length)for(o=b.suspendedInitFuncs,l=0,m=o.length;m>l;l++)(k=o[l])(a,b.model,b.param);else cola(a,b.model);i&&a.setAttribute(cola.constants.IGNORE_DIRECTIVE,!0),cola.getListeners("ready")&&(cola.fire("ready",cola),cola.off("ready")),cola.callback(b.callback,!0)}}else if(!e&&(e=!0,g=d,cola.callback(b.callback,!1,g)!==!1))throw h=g.xhr?g.status+" "+g.message:g.message,new cola.Exception("Failed to load resource from ["+f+"]. "+h)},$fly(a).addClass("loading"),f=b.htmlUrl,f&&n.push(f),b.jsUrl)if(h=[],b.jsUrl instanceof Array)for(q=b.jsUrl,i=0,j=q.length;j>i;i++)g=q[i],g=_compileResourceUrl(g,f,".js"),g&&(n.push(g),h.push(g));else g=_compileResourceUrl(b.jsUrl,f,".js"),g&&(n.push(g),h.push(g));if(b.cssUrl)if(d=[],b.cssUrl instanceof Array)for(r=b.cssUrl,o=0,k=r.length;k>o;o++)c=r[o],c=_compileResourceUrl(c,f,".css"),c&&(n.push(c),d.push(c));else c=_compileResourceUrl(b.cssUrl,f,".css"),c&&(n.push(c),d.push(c));if(b.suspendedInitFuncs=[],f&&_loadHtml(a,f,b,{complete:function(a,b){return s(a,b,f)}}),h)for(p=0,l=h.length;l>p;p++)g=h[p],_loadJs(b,g,{complete:function(a,b){return s(a,b,g)}});if(d)for(t=0,m=d.length;m>t;t++)c=d[t],_loadCss(b,c,{complete:function(a,b){return s(a,b,c)}})},cola.unloadSubView=function(a,b){var c,d,e,f,g;if($fly(a).empty(),d=b.htmlUrl,b.cssUrl)if(b.cssUrl instanceof Array)for(g=b.cssUrl,e=0,f=g.length;f>e;e++)c=g[e],c=_compileResourceUrl(c,d,".css"),c&&_unloadCss(c);else c=_compileResourceUrl(b.cssUrl,d,".css"),c&&_unloadCss(c)},_compileResourceUrl=function(a,b,c){var d,e;return"$"===a?d=!0:0===a.indexOf("$.")&&(d=!0,c=a.substring(2)),d&&(a=null,b&&(e=b.indexOf("?"),e>0&&(b=b.substring(0,e)),e=b.lastIndexOf("."),a=(e>0?b.substring(0,e):b)+c)),a},_loadHtml=function(a,b,c,d){$.ajax(b,{timeout:c.timeout}).done(function(b){$(a).html(b),cola.callback(d,!0)}).fail(function(a,b,c){cola.callback(d,!1,{xhr:a,status:b,message:c})})},_jsCache={},_loadJs=function(a,b,c){var d;d=_jsCache[b],d?(Array.prototype.push.apply(a.suspendedInitFuncs,d),cola.callback(c,!0)):$.ajax(b,{dataType:"text",cache:!0,timeout:a.timeout}).done(function(d){var e,f,g;g=$.xCreate({tagName:"script",language:"javascript",type:"text/javascript",charset:cola.setting("defaultCharset")}),g.text=d,cola._suspendedInitFuncs=a.suspendedInitFuncs;try{try{f=document.querySelector("head")||document.documentElement,f.appendChild(g)}finally{delete cola._suspendedInitFuncs,_jsCache[b]=a.suspendedInitFuncs}cola.callback(c,!0)}catch(h){e=h,cola.callback(c,!1,e)}}).fail(function(a,b,d){cola.callback(c,!1,{xhr:a,status:b,message:d})})},_cssCache={},_loadCss=function(a,b,c){var d,e,f,g;return e=_cssCache[b],e?(f=parseInt(e.getAttribute("_refNum"))||1,e.setAttribute("_refNum",f+1+""),cola.callback(c,!0),!1):(e=$.xCreate({tagName:"link",rel:"stylesheet",type:"text/css",charset:cola.setting("defaultCharset"),href:b}),a.timeout&&(g=setTimeout(function(){$fly(e).remove(),cola.callback(c,!1,{status:"timeout"})},a.timeout)),cola.os.android&&cola.os.version<4.4||$(e).one("load",function(){g&&clearTimeout(g),cola.callback(c,!0)}).on("readystatechange",function(a){var b;"complete"===(null!=(b=a.target)?b.readyState:void 0)&&(g&&clearTimeout(g),$fly(this).off("readystatechange"),cola.callback(c,!0))}).one("error",function(a){g&&clearTimeout(g),cola.callback(c,!1,a)}),d=document.querySelector("head")||document.documentElement,e.setAttribute("_refNum","1"),d.appendChild(e),_cssCache[b]=e,cola.os.android&&cola.os.version<4.4&&(g&&clearTimeout(g),cola.callback(c,!0)),!0)},_unloadCss=function(a){var b,c;b=_cssCache[a],b&&(c=parseInt(b.getAttribute("_refNum"))||1,c>1?b.setAttribute("_refNum",c-1+""):(delete _cssCache[a],$fly(b).remove()))},routerRegistry=null,currentRoutePath=null,currentRouter=null,trimPath=function(a){return a&&(47!==a.charCodeAt(0)&&(a="/"+a),47===a.charCodeAt(a.length-1)&&(a=a.substring(0,a.length-1))),a||""},ignoreRouterSettingChange=!1,cola.on("settingChange",function(a,b){var c,d;ignoreRouterSettingChange||("routerContextPath"===b.key||"defaultRouterPath"===b.key)&&(c=cola.setting(b.key),d=trimPath(c),d!==c&&(ignoreRouterSettingChange=!0,cola.setting(b.key,d),ignoreRouterSettingChange=!1))}),cola.route=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(null==routerRegistry&&(routerRegistry=new cola.util.KeyedArray),"function"==typeof b&&(b={enter:b}),b.path=a=trimPath(a),a=a.slice(1),!b.name){for(h=a||cola.constants.DEFAULT_PATH,m=h.split(/[\/\-]/),i=[],d=e=0,f=m.length;f>e;d=++e)l=m[d],l&&58!==l.charCodeAt(0)&&i.push(i.length>0?cola.util.capitalize(l):l);b.name=i.join("")}if(b.pathParts=n=[],a){for(c=!1,o=a.split("/"),j=0,g=o.length;g>j;j++)l=o[j],58===l.charCodeAt(0)?(k=63===l.charCodeAt(l.length-1),p=k?l.substring(1,l.length-1):l.substring(1),c=!0,n.push({variable:p,optional:k})):n.push(l);b.hasVariable=c}return routerRegistry.add(b.path,b),b},cola.getCurrentRoutePath=function(){return currentRoutePath},cola.getCurrentRouter=function(){return currentRouter},cola.setRoutePath=function(a,b,c){var d,e,f,g,h;a&&35===a.charCodeAt(0)?(h="hash",a=a.substring(1)):h=cola.setting("routerMode")||"hash","hash"===h?(47!==a.charCodeAt(0)&&(a="/"+a),window.location.hash!==a&&(window.location.hash=a),c&&_onHashChange()):(e=cola.setting("routerContextPath"),g=e&&47===a.charCodeAt(0)?cola.util.concatUrl(e,a):a,f=g,d=f.indexOf("?"),d>=0&&(f=f.substring(0,d)),d=f.indexOf("#"),d>=0&&(f=f.substring(0,d)),location.pathname!==f?(b?window.history.replaceState({path:g},null,g):window.history.pushState({path:g},null,g),location.pathname!==f&&(g=location.pathname+location.search+location.hash,e&&0===g.indexOf(e)&&(a=g.substring(e.length)),window.history.replaceState({path:g,originPath:a},null,g)),_onStateChange(a)):c&&_onStateChange(f))},_findRouter=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(!routerRegistry)return null;for(null==a&&(a=cola.setting("defaultRouterPath")),a=trimPath(a).slice(1),l=a?a.split(/[\/\?\#]/):[],m=routerRegistry.elements,f=0,g=m.length;g>f;f++)if(n=m[f],c=n.pathParts,d=c.length-l.length,0===d||1===d&&c.length>0&&c[c.length-1].optional){for(i=!0,k={},e=j=0,h=c.length;h>j;e=++j)if(b=c[e],"string"==typeof b){if(b!==l[e]){i=!1;break}}else{if(e>=l.length&&!b.optional){i=!1;break}k[b.variable]=l[e]}if(i)break}return i?(n.param=k,n):null},cola.createRouterModel=function(a){var b,c;if(a.parentModel instanceof cola.Scope?b=a.parentModel:(c=a.parentModel||cola.constants.DEFAULT_PATH,b=cola.model(c)),!b)throw new cola.Exception('Parent Model "'+c+'" is undefined.');return new cola.Model(a.name,b)},_switchRouter=function(a,b){var c,d,e,f;return a.redirectTo?void cola.setRoutePath(a.redirectTo):(c={path:b,prev:currentRouter,next:a},void(cola.fire("beforeRouterSwitch",cola,c)!==!1&&(currentRouter&&("function"==typeof currentRouter.leave&&currentRouter.leave(currentRouter),currentRouter.targetDom&&(cola.unloadSubView(currentRouter.targetDom,{cssUrl:currentRouter.cssUrl}),e=cola.util.removeUserData(currentRouter.targetDom,"_model"),null!=e&&e.destroy())),a.templateUrl&&(a.target&&(f=a.target.nodeType?a.target:$(a.target)[0]),f||(f=document.getElementsByClassName(cola.constants.VIEW_PORT_CLASS)[0],f||(f=document.getElementsByClassName(cola.constants.VIEW_CLASS)[0],f||(f=document.body))),a.targetDom=f,$fly(f).empty()),currentRouter=a,a.templateUrl?(d=cola.createRouterModel(a),c.nextModel=d,cola.util.userData(a.targetDom,"_model",d),cola.loadSubView(a.targetDom,{model:d,htmlUrl:a.templateUrl,jsUrl:a.jsUrl,cssUrl:a.cssUrl,data:a.data,param:a.param,callback:function(){"function"==typeof a.enter&&a.enter(a,d),a.title&&(document.title=a.title)}})):("function"==typeof a.enter&&a.enter(a,null),a.title&&(document.title=a.title)),cola.fire("routerSwitch",cola,c))))},_getHashPath=function(){var a;return a=location.hash,a&&(a=a.substring(1)),33===(null!=a?a.charCodeAt(0):void 0)&&(a=a.substring(1)),trimPath(a)},_onHashChange=function(){var a,b;"hash"===(cola.setting("routerMode")||"hash")&&(a=_getHashPath(),a!==currentRoutePath&&(currentRoutePath=a,b=_findRouter(a),b&&_switchRouter(b,a)))},_onStateChange=function(a){var b,c,d;"state"===cola.setting("routerMode")&&(a=trimPath(a),b=a.indexOf("#"),b>-1&&(a=a.substring(b+1)),47===a.charCodeAt(0)&&(d=cola.setting("routerContextPath"),d&&0===a.indexOf(d)&&(a=a.slice(d.length))),a!==currentRoutePath&&(currentRoutePath=a,b=a.indexOf("?"),b>-1&&(a=a.substring(0,b)),c=_findRouter(a),c&&_switchRouter(c,a)))},$(function(){setTimeout(function(){var a,b;$fly(window).on("hashchange",_onHashChange).on("popstate",function(){var a;location.hash||(a=window.history.state,_onStateChange((null!=a?a.path:void 0)||location.pathname+location.search+location.hash))}),$(document.body).delegate("a.state","click",function(){var a,b;return a=this.getAttribute("href"),a&&(b=this.getAttribute("target"),!b||"_self"===b)?(cola.setRoutePath(a),!1):void 0}),a=_getHashPath(),a?(b=_findRouter(a),b&&_switchRouter(b,a)):(a=cola.setting("defaultRouterPath"),b=_findRouter(a),b&&cola.setRoutePath(a+location.search,!0,!0))},0)}),cola._BindingFeature=function(){function a(){}return a.prototype.init=function(){},a}(),cola._ExpressionFeature=function(a){function b(a){this.expression=a,this.expression&&(this.isStatic=this.expression.isStatic,this.isDyna=this.expression.isDyna,this.paths=this.expression.paths||[],!this.paths.length&&this.expression.hasCallStatement&&(this.paths=["**"],this.isStatic||(this.delay=!0),this.watchingMoreMessage=!this.expression.hasDefinedPath))}return extend(b,a),b.prototype.evaluate=function(a,b,c,d){var e,f,g,h,i,j,k,l,m;if(null==c&&(c={}),null==d&&(d="async"),m=a.scope,null==c.vars&&(c.vars={}),c.vars.$dom=a.dom,b&&this.dynaExpression)l=this.dynaExpression.evaluate(m,d,c);else if(l=this.expression.evaluate(m,d,c),this.isDyna&&c.dynaExpression&&(this.dynaExpression=c.dynaExpression,
this.dynaExpression.raw!==this.dynaExpressionStr&&(this.dynaExpressionStr=this.dynaExpression.raw),!this.ignoreBind)){if(this.dynaPaths)for(k=this.dynaPaths,e=0,f=k.length;f>e;e++)i=k[e],a.unbind(i,this);if(j=this.dynaExpression.paths)for(h=0,g=j.length;g>h;h++)i=j[h],this.paths.indexOf(i)<0&&(this.dynaPaths?this.dynaPaths.push(i):this.dynaPaths=[i],a.bind(i,this))}return l},b.prototype.refresh=function(a,b,c,d){null==d&&(d={}),this._refresh&&(this.delay&&!b?cola.util.delay(a,"refresh",100,function(b){return function(){b._refresh(a,c,d),b.isStatic&&!d.unloaded&&(b.disabled=!0)}}(this)):(this._refresh(a,c,d),this.isStatic&&!d.unloaded&&(this.disabled=!0)))},b}(cola._BindingFeature),cola._AliasFeature=function(a){function b(a){b.__super__.constructor.call(this,a),this.alias=a.alias}return extend(b,a),b.prototype.ignoreBind=!0,b.prototype.init=function(a){a.scope=new cola.AliasScope(a.scope,this.expression),a.subScopeCreated=!0},b.prototype.evaluate=function(a,b,c,d){var e;return null==c&&(c={}),null==c.vars&&(c.vars={}),c.vars.$dom=a.dom,e=a.scope,e.evaluate(e,b,d,c)},b.prototype._refresh=function(a,b,c){var d;d=this.evaluate(a,b,c),a.scope.data.setTargetData(d)},b}(cola._ExpressionFeature),cola._RepeatFeature=function(a){function b(a){b.__super__.constructor.call(this,a),this.alias=a.alias}return extend(b,a),b.prototype.ignoreBind=!0,b.prototype.init=function(a){var b;a.scope=b=new cola.ItemsScope(a.scope,this.isDyna?null:this.expression),b.onItemsRefresh=function(b){return function(){b.onItemsRefresh(a)}}(this),b.onCurrentItemChange=function(b){var c,d,e;if(a.currentItemDom&&$fly(a.currentItemDom).removeClass(cola.constants.COLLECTION_CURRENT_CLASS),b.current&&a.itemDomBindingMap&&(e=cola.Entity._getEntityId(b.current))){if(d=a.itemDomBindingMap[e],!d)return void this.onItemsRefresh(a);c=d.dom,$fly(c).addClass(cola.constants.COLLECTION_CURRENT_CLASS)}a.currentItemDom=c},b.onItemInsert=function(b){return function(c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(e=a.dom,r=cola.util.userData(e,cola.constants.REPEAT_TAIL_KEY),s=cola.util.userData(e,cola.constants.REPEAT_TEMPLATE_KEY),d=c.entity,l=c.itemsScope,j=c.insertMode,j&&"end"!==j?"begin"===j?i=1:"before"===j?(q=l.getItemScope(c.refEntity),i=null!=q?q.data.getIndex():void 0):"after"===j&&(q=l.getItemScope(c.refEntity),i=(null!=q?q.data.getIndex():void 0)+1):i=c.entityList.entityCount,k=b.createNewItem(a,s,a.scope,d,i),j&&"end"!==j){"begin"===j?$fly(e).after(k):a.itemDomBindingMap&&(p=cola.Entity._getEntityId(c.refEntity),p&&(o=null!=(m=a.itemDomBindingMap[p])?m.dom:void 0,o&&("before"===j?$fly(o).before(k):$fly(o).after(k)))),n=l.itemScopeMap;for(h in n)g=n[h],f=g.data.getIndex(),f>=i&&g.data.getTargetData()!==d&&g.data.setIndex(f+1)}else $fly(r).before(k)}}(this),b.onItemRemove=function(b){var c,d,e,f,g,h,i,j,k,l;if(c=b.entity,k=b.itemsScope,i=cola.Entity._getEntityId(c),i&&(j=k.getItemScope(c),h=a.itemDomBindingMap[i],h&&(k.unregItemScope(i),h.remove(),h.dom===a.currentItemDom&&delete a.currentItemDom),j&&(g=j.data.getIndex(),g<b.entityList.entityCount))){l=k.itemScopeMap;for(f in l)e=l[f],d=e.data.getIndex(),d>g&&e.data.setIndex(d-1)}},a.subScopeCreated=!0},b.prototype.evaluate=function(a,b,c,d){var e;return null==c&&(c={}),null==c.vars&&(c.vars={}),c.vars.$dom=a.dom,e=a.scope,e.evaluate(e,b,d,c)},b.prototype._refresh=function(a,b,c){this.isDyna&&!b&&(this.evaluate(a,b,c),a.scope.setExpression(this.dynaExpression)),a.scope.retrieveData(),a.scope.refreshItems()},b.prototype.onItemsRefresh=function(a){var b,c,d,e,f,g,h,i,j;if(h=a.scope,f=h.items,g=h.originItems,f&&!(f instanceof cola.EntityList)&&!(f instanceof Array))throw new cola.Exception('Expression "'+this.expression+'" must bind to EntityList or Array.');if(f!==a.items||f&&f.timestamp!==a.timestamp)if(a.items=f,a.timestamp=(null!=f?f.timestamp:void 0)||0,d=a.dom,i=cola.util.userData(d,cola.constants.REPEAT_TAIL_KEY),j=cola.util.userData(d,cola.constants.REPEAT_TEMPLATE_KEY),i||(i=document.createComment("Repeat Tail "),$fly(d).after(i),cola.util.userData(d,cola.constants.REPEAT_TAIL_KEY,i)),b=d,c=null,f&&(a.itemDomBindingMap={},h.resetItemScopeMap(),a.currentItemDom&&$fly(a.currentItemDom).removeClass(cola.constants.COLLECTION_CURRENT_CLASS),cola.each(f,function(d){return function(e,k){var l,m,n,o;null!=e&&(l=b.nextSibling,l===i&&(l=null),l?(m=cola.util.userData(l,cola.constants.DOM_BINDING_KEY),o=m.scope,n="object"==typeof e?cola.Entity._getEntityId(e):cola.uniqueId(),h.regItemScope(n,o),m.itemId=n,a.itemDomBindingMap[n]=m,o.data.setTargetData(e),o.data.setIndex(k+1)):(l=d.createNewItem(a,j,h,e,k+1),null==c&&(c=document.createDocumentFragment()),c.appendChild(l),$fly(i).before(l)),e===(f.current||(null!=g?g.current:void 0))&&($fly(l).addClass(cola.constants.COLLECTION_CURRENT_CLASS),a.currentItemDom=l),b=l)}}(this))),c)$fly(i).before(c);else for(e=b.nextSibling;e&&e!==i;)b=e,e=b.nextSibling,$fly(b).remove()},b.prototype.createNewItem=function(a,b,c,d,e){var f,g,h,i,j;return i=new cola.ItemScope(c,this.alias),i.data.setTargetData(d,!0),i.data.setIndex(e,!0),g=b.cloneNode(!0),this.deepCloneNodeData(g,i,!1),j=cola.util.userData(b,cola.constants.DOM_BINDING_KEY),f=j.clone(g,i),this.refreshItemDomBinding(g,i),h="object"==typeof d?cola.Entity._getEntityId(d):cola.uniqueId(),c.regItemScope(h,i),f.itemId=h,a.itemDomBindingMap[h]=f,g},b.prototype.deepCloneNodeData=function(a,b,c){var d,e,f,g,h;if(g=cola.util.userData(a)){e={};for(f in g){if(h=g[f],f===cola.constants.DOM_BINDING_KEY)c&&(h=h.clone(a,b));else if("__"===f.substring(0,2))continue;e[f]=h}cola.util.userData(a,e)}for(d=a.firstChild;d;)3===d.nodeType||("function"==typeof d.hasAttribute?d.hasAttribute(cola.constants.IGNORE_DIRECTIVE):void 0)||this.deepCloneNodeData(d,b,!0),d=d.nextSibling},b.prototype.refreshItemDomBinding=function(a,b){var c,d,e,f,g,h,i;for(e=cola.util.userData(a,cola.constants.DOM_BINDING_KEY),e&&(e.refresh(),b=e.subScope||e.scope,e instanceof cola._RepeatDomBinding&&(d=cola.util.userData(e.dom,cola.constants.REPEAT_TAIL_KEY))),c=a.firstChild;c;)3===c.nodeType||("function"==typeof c.hasAttribute?c.hasAttribute(cola.constants.IGNORE_DIRECTIVE):void 0)||(c=this.refreshItemDomBinding(c,b)),c=c.nextSibling;if(g=cola.util.userData(a,cola.constants.DOM_INITIALIZER_KEY)){for(h=0,i=g.length;i>h;h++)(f=g[h])(b,a);cola.util.removeUserData(a,cola.constants.DOM_INITIALIZER_KEY)}return d||a},b}(cola._ExpressionFeature),cola._WatchFeature=function(a){function b(a,b){this.action=a,this.paths=b,this.watchingMoreMessage=!0}return extend(b,a),b.prototype.processMessage=function(a,b){var c;(!this.isDyna||(null!=(c=this.dynaPaths)?c.indexOf(b):void 0)>=0)&&this.refresh(a)},b.prototype.refresh=function(a){var b;if(b=a.scope.action(this.action),!b)throw new cola.Exception('No action named "'+this.action+'" found.');b(a.dom,a.scope)},b}(cola._BindingFeature),cola._EventFeature=function(a){function b(a,b){this.expression=a,this.event=b}return extend(b,a),b.prototype.ignoreBind=!0,b.prototype.init=function(a){a.$dom.on(this.event,function(b){return function(c){var d;d=cola.currentScope,cola.currentScope=a.scope;try{return b.evaluate(a,!1,{vars:{$event:c}},"never")}finally{cola.currentScope=d}}}(this))},b}(cola._ExpressionFeature),cola._DomFeature=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.writeBack=function(a,b){var c,d;(null!=(d=this.expression)?d.writeable:void 0)&&(c=this.isDyna?this.dynaPaths:this.paths,c&&1===c.length&&(this.ignoreMessage=!0,a.scope.set(c[0],b),this.ignoreMessage=!1))},b.prototype.processMessage=function(a,b,c,d,e){var f;(cola.constants.MESSAGE_REFRESH<=d&&d<=cola.constants.MESSAGE_CURRENT_CHANGE||this.watchingMoreMessage)&&this.refresh(a,!1,(null!=(f=this.dynaPaths)?f.indexOf(b):void 0)>=0)},b.prototype._refresh=function(a,b,c){this.ignoreMessage||(value=this.evaluate(a,b,c),this._doRender(a,value))},b}(cola._ExpressionFeature),cola._DomAttrFeature=function(a){function b(a,c){this.attr=c,b.__super__.constructor.call(this,a)}return extend(b,a),b.prototype._doRender=function(a,b){var c,d;b instanceof Date&&(d=cola.setting("defaultDateFormat"),d&&(b=cola.defaultAction.formatDate(b,d))),c=this.attr,"text"===c?cola.util.setText(a.dom,null!=b?b:""):"html"===c?a.$dom.html(null!=b?b:""):a.$dom.attr(c,null!=b?b:"")},b}(cola._DomFeature),cola._DomStylePropFeature=function(a){function b(a,c){this.prop=c,b.__super__.constructor.call(this,a)}return extend(b,a),b.prototype._doRender=function(a,b){a.$dom.css(this.prop,b)},b}(cola._DomFeature),cola._DomClassFeature=function(a){function b(a){b.__super__.constructor.call(this,a)}return extend(b,a),b.prototype._doRender=function(a,b){this._lastClassName&&a.$dom.removeClass(this._lastClassName),b&&(a.$dom.addClass(b),this._lastClassName=b)},b}(cola._DomFeature),cola._DomToggleClassFeature=function(a){function b(a,c){this.className=c,b.__super__.constructor.call(this,a)}return extend(b,a),b.prototype._doRender=function(a,b){a.$dom[b?"addClass":"removeClass"](this.className)},b}(cola._DomFeature),cola._TextBoxFeature=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.init=function(a){var c;c=this,a.$dom.on("input",function(){c.writeBack(a,this.value)}),b.__super__.init.call(this)},b.prototype._doRender=function(a,b){a.dom.value=b||""},b}(cola._DomFeature),cola._CheckboxFeature=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.init=function(a){var c;c=this,a.$dom.on("click",function(){c.writeBack(a,this.checked)}),b.__super__.init.call(this)},b.prototype._doRender=function(a,b){var c;c=cola.DataType.defaultDataTypes["boolean"].parse(b),a.dom.checked=c},b}(cola._DomFeature),cola._RadioFeature=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.init=function(a){a.$dom.on("click",function(){var b;b=this.checked,b&&this.writeBack(a,b)}),b.__super__.init.call(this)},b.prototype._doRender=function(a,b){a.dom.checked=b===a.dom.value},b}(cola._DomFeature),cola._SelectFeature=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.init=function(a){var c;c=this,a.$dom.on("change",function(){value=this.options[this.selectedIndex],c.writeBack(a,null!=value?value.value:void 0)}),b.__super__.init.call(this)},b.prototype._doRender=function(a,b){a.dom.value=b},b}(cola._DomFeature),cola._DisplayFeature=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype._doRender=function(a,b){a.dom.style.display=b?"":"none"},b}(cola._DomFeature),cola._SelectOptionsFeature=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype._doRender=function(a,b){var c;(b instanceof Array||b instanceof cola.EntityList)&&(c=a.dom.options,b instanceof cola.EntityList?c.length=b.entityCount:c.length=b.length,cola.each(b,function(a,b){var d;d=c[b],cola.util.isSimpleValue(a)?$fly(d).removeAttr("value").text(a):a instanceof cola.Entity?$fly(d).attr("value",a.get("value")||a.get("key")).text(a.get("text")||a.get("name")):$fly(d).attr("value",a.value||a.key).text(a.text||a.name)}))},b}(cola._DomFeature),_destroyDomBinding=function(a,b){var c;c=b[cola.constants.DOM_BINDING_KEY],null!=c&&c.destroy()},cola._DomBinding=function(){function a(a,b,c){var d,e,f;if(this.scope=b,this.dom=a,this.$dom=$(a),c)for(e=0,f=c.length;f>e;e++)d=c[e],this.addFeature(d);cola.util.userData(a,cola.constants.DOM_BINDING_KEY,this),cola.util.onNodeDispose(a,_destroyDomBinding)}return a.prototype.destroy=function(){var a,b;if(a=this.features)for(b=a.length-1;b>=0;)this.unbindFeature(a[b]),b--;delete this.dom,delete this.$dom},a.prototype.addFeature=function(a){null==a.id&&(a.id=cola.uniqueId()),"function"==typeof a.init&&a.init(this),this.features?this.features.push(a):this.features=[a],a.ignoreBind||this.bindFeature(a)},a.prototype.removeFeature=function(a){var b,c;b=this.features,b&&(c=b.indexOf(a),c>-1&&b.splice(c,1),a.ignoreBind||this.unbindFeature(a))},a.prototype.bindFeature=function(a){var b,c,d,e;if(a.processMessage&&(e=a.paths))for(b=0,c=e.length;c>b;b++)d=e[b],this.bind(d,a)},a.prototype.unbindFeature=function(a){var b,c,d,e;if(a.processMessage&&(e=a.paths))for(b=0,c=e.length;c>b;b++)d=e[b],this.unbind(d,a)},a.prototype.bind=function(a,b){var c,d;d={path:a,processMessage:function(a){return function(c,e,f,g){b.disabled?d.disabled=!0:(b.processMessage(a,c,e,f,g),b.disabled&&(d.disabled=!0))}}(this)},this.scope.data.bind(a,d),c=this[b.id],c?c.push(d):this[b.id]=[d]},a.prototype.unbind=function(a,b){var c,d,e,f,g;if(c=this[b.id]){for(d=e=0,f=c.length;f>e;d=++e)if(g=c[d],g.path===a){this.scope.data.unbind(a,c[d]),c.splice(d,1);break}c.length||delete this[b.id]}},a.prototype.refresh=function(a){var b,c,d,e;if(this.features)for(e=this.features,c=0,d=e.length;d>c;c++)b=e[c],b.refresh(this,a)},a.prototype.clone=function(a,b){return new this.constructor(a,b,this.features,!0)},a}(),cola._AliasDomBinding=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.destroy=function(){b.__super__.destroy.call(this),this.subScopeCreated&&this.scope.destroy()},b}(cola._DomBinding),cola._RepeatDomBinding=function(a){function b(a,c,d,e){var f,g,h,i,j;if(e)b.__super__.constructor.call(this,a,c,d);else if(this.scope=c,g=document.createComment("Repeat Head "),cola._ignoreNodeRemoved=!0,a.parentNode.replaceChild(g,a),cola.util.cacheDom(a),cola._ignoreNodeRemoved=!1,this.dom=g,cola.util.userData(g,cola.constants.DOM_BINDING_KEY,this),cola.util.userData(g,cola.constants.REPEAT_TEMPLATE_KEY,a),cola.util.onNodeDispose(g,_destroyDomBinding),j=new cola._RepeatItemDomBinding(a,null),j.repeatDomBinding=this,j.isTemplate=!0,d)if(d instanceof Array)for(h=0,i=d.length;i>h;h++)f=d[h],f instanceof cola._RepeatFeature?this.addFeature(f):j.addFeature(f);else d instanceof cola._RepeatFeature?this.addFeature(d):j.addFeature(d)}return extend(b,a),b.prototype.destroy=function(){b.__super__.destroy.call(this),this.subScopeCreated&&this.scope.destroy(),delete this.currentItemDom},b}(cola._DomBinding),cola._RepeatItemDomBinding=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.destroy=function(){var a;b.__super__.destroy.call(this),this.isTemplate||null!=(a=this.repeatDomBinding.itemDomBindingMap)&&delete a[this.itemId]},b.prototype.clone=function(a,c){var d;return d=b.__super__.clone.call(this,a,c),d.repeatDomBinding=this.repeatDomBinding,d},b.prototype.bind=function(a,c){return this.isTemplate?void 0:b.__super__.bind.call(this,a,c)},b.prototype.bindFeature=function(a){return this.isTemplate?void 0:b.__super__.bindFeature.call(this,a)},b.prototype.processDataMessage=function(a,b,c){this.isTemplate||this.scope.data.processMessage("**",a,b,c)},b.prototype.refresh=function(){return this.isTemplate?void 0:b.__super__.refresh.call(this)},b.prototype.remove=function(){this.isTemplate||this.$dom.remove()},b}(cola._AliasDomBinding),IGNORE_NODES=["SCRIPT","STYLE","META","TEMPLATE"],ALIAS_REGEXP=new RegExp("\\$default","g"),cola._mainInitFuncs=[],cola._rootFunc=function(){var a,b,c,d,e,f,g,h;for(b=null,h=null,g=null,d=0,e=arguments.length;e>d;d++)a=arguments[d],"function"==typeof a?b=a:"string"==typeof a?g=a:a instanceof cola.Scope?f=a:((null!=a?a.nodeType:void 0)||"object"==typeof a&&a.length>0)&&(h=a);return c=function(a,c,d){var e,f,g,h;g=cola.currentScope,cola.currentScope=c;try{if(c._dom?c._dom=c._dom.concat(a):c._dom=a,delete c._$dom,"function"==typeof b&&b(c,d),a||(h=document.getElementsByClassName(cola.constants.VIEW_CLASS),(null!=h?h.length:void 0)&&(a=h)),null==a&&(a=document.body),a.length)for(doms=a,f=0,e=doms.length;e>f;f++)a=doms[f],cola._renderDomTemplate(a,c);else cola._renderDomTemplate(a,c)}finally{cola.currentScope=g}},cola._suspendedInitFuncs?cola._suspendedInitFuncs.push(c):(f||(null==g&&(g=cola.constants.DEFAULT_PATH),f=cola.model(g),null==f&&(f=new cola.Model(g))),cola._mainInitFuncs?cola._mainInitFuncs.push({targetDom:h,model:f,init:c}):c(h,f)),cola},$(function(){var a,b,c,d;for(b=cola._mainInitFuncs,delete cola._mainInitFuncs,c=0,d=b.length;d>c;c++)a=b[c],a.init(a.targetDom,a.model);cola.getListeners("ready")&&(cola.fire("ready",cola),cola.off("ready"))}),cola._userDomCompiler={$:[]},cola.xRender=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(a){if(o=cola.currentScope,b=b||o,a.nodeType)g=a;else if("string"==typeof a){if(a.match(/^\#[\w\-\$]*$/)&&(t=document.getElementById(a.substring(1)),t?"TEMPLATE"===a.nodeName&&(a=t.innerHTML,$fly(t).remove()):(a=null,g=t)),a)for(f=document.createDocumentFragment(),e=document.createElement("div"),e.innerHTML=a,d=e.firstChild;d;)l=d.nextSibling,f.appendChild(d),d=l}else{cola.currentScope=b;try{if(null==c&&(c={}),a instanceof Array)for(f=document.createDocumentFragment(),h=0,i=a.length;i>h;h++){for(m=a[h],d=null,r=cola.xRender.nodeProcessors,n=0,j=r.length;j>n&&(p=r[n],!(d=p(m,c)));n++);null==d&&(d=$.xCreate(m,c)),d&&f.appendChild(d)}else{for(s=cola.xRender.nodeProcessors,q=0,k=s.length;k>q&&(p=s[q],!(g=p(a,c)));q++);g||(g=$.xCreate(a,c))}}finally{cola.currentScope=o}}return g?cola._renderDomTemplate(g,b,c):f&&(cola._renderDomTemplate(f,b,c),g=f.firstChild===f.lastChild?f.firstChild:f),g}},cola.xRender.nodeProcessors=[],cola._renderDomTemplate=function(a,b,c){null==c&&(c={}),_doRenderDomTemplate(a,b,c)},_doRenderDomTemplate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;if(8===a.nodeType)return a;if(1===a.nodeType&&(a.hasAttribute(cola.constants.IGNORE_DIRECTIVE)||a.className.indexOf(cola.constants.IGNORE_DIRECTIVE)>=0))return a;if(IGNORE_NODES.indexOf(a.nodeName)>-1)return a;if(3===a.nodeType)return g=a.nodeValue,C=cola._compileText(g),(null!=C?C.length:void 0)&&buildContent(C,a,b),a;if(11===a.nodeType){for(j=a.firstChild;j;)j=_doRenderDomTemplate(j,b,c),j=j.nextSibling;return a}for(s=null,q=null,H=null,g=a.getAttribute("c-repeat"),g?(g=g.replace(ALIAS_REGEXP,c.defaultPath),h="repeat",p=cola._domFeatureBuilder[h](g,h,a),null==q&&(q=[]),q.push(p),a.removeAttribute("c-repeat")):(g=a.getAttribute("c-alias"),g&&(g=g.replace(ALIAS_REGEXP,c.defaultPath),h="alias",p=cola._domFeatureBuilder[h](g,h,a),null==q&&(q=[]),q.push(p),a.removeAttribute("c-alias"))),E=cola._userDomCompiler.$,u=0,v=E.length;v>u;u++)l=E[u],I=l(b,a,null,c),I&&(I instanceof cola._BindingFeature&&q.push(I),"function"==typeof I&&(null==s&&(s=[]),s.push(I)));for(F=a.attributes,B=0,w=F.length;w>B;B++)if(d=F[B],e=d.name,"c-"===e.substring(0,2)&&(null==H&&(H=[]),H.push(e),f=d.value,f&&c.defaultPath&&(f=f.replace(ALIAS_REGEXP,c.defaultPath)),f))if(e=e.substring(2),l=cola._userDomCompiler.hasOwnProperty(e)&&cola._userDomCompiler[e]){if(I=l(b,a,d,c))if(I instanceof cola._BindingFeature)q.push(I);else if(I instanceof Array)for(D=0,x=I.length;x>D;D++)o=I[D],q.push(o);else"function"==typeof I&&(null==s&&(s=[]),s.push(I))}else if(0===e.indexOf("on")?p=cola._domFeatureBuilder.event(f,e,a):(i=cola._domFeatureBuilder.hasOwnProperty(e)&&cola._domFeatureBuilder[e],p=(i||cola._domFeatureBuilder.$).call(cola._domFeatureBuilder,f,e,a)),p)if(null==q&&(q=[]),p instanceof cola._BindingFeature)q.push(p);else if(p instanceof Array)for(K=0,y=p.length;y>K;K++)o=p[K],q.push(o);if(H)for(M=0,z=H.length;z>M;M++)G=H[M],a.removeAttribute(G);if((null!=q?q.length:void 0)&&(n=cola._domBindingBuilder[h||"$"](a,b,q),b.data.alias&&(m=b.data.alias)),cola.util.userData(a,cola.constants.DOM_SKIP_CHILDREN))cola.util.removeUserData(a,cola.constants.DOM_SKIP_CHILDREN);else{k={};for(t in c)L=c[t],k[t]=L;for(k.inRepeatTemplate=c.inRepeatTemplate||"repeat"===h,m&&(k.defaultPath=m),j=a.firstChild;j;)j=_doRenderDomTemplate(j,b,k),j=j.nextSibling}if(s)if(c.inRepeatTemplate||"repeat"===h)cola.util.userData(a,cola.constants.DOM_INITIALIZER_KEY,s);else for(N=0,A=s.length;A>N;N++)(r=s[N])(b,a);return(null!=q?q.length:void 0)&&(c.inRepeatTemplate||n.refresh(!0),n instanceof cola._RepeatDomBinding&&(J=cola.util.userData(n.dom,cola.constants.REPEAT_TAIL_KEY),a=J||n.dom)),a},createContentPart=function(a,b){var c,d,e,f;return a instanceof cola.Expression?(d=a,f=document.createElement("span"),e=new cola._DomAttrFeature(d,"text"),c=new cola._DomBinding(f,b,e),c.refresh()):f=document.createTextNode(a),f},buildContent=function(a,b,c){var d,e,f,g,h;if(1===a.length)d=createContentPart(a[0],c);else for(d=document.createDocumentFragment(),e=0,f=a.length;f>e;e++)g=a[e],h=createContentPart(g,c),d.appendChild(h);b.parentNode.replaceChild(d,b)},cola._domBindingBuilder={$:function(a,b,c){return new cola._DomBinding(a,b,c)},repeat:function(a,b,c){var d;return d=new cola._RepeatDomBinding(a,b,c),b=d.scope,d},alias:function(a,b,c){var d;return d=new cola._AliasDomBinding(a,b,c),b=d.scope,d}},cola._domFeatureBuilder={$:function(a,b,c){var d,e;return d=cola._compileExpression(a),d&&(e="display"===b?new cola._DisplayFeature(d):"options"===b&&"SELECT"===c.nodeName?new cola._SelectOptionsFeature(d):new cola._DomAttrFeature(d,b)),e},repeat:function(a){var b;return b=cola._compileExpression(a,"repeat"),b?new cola._RepeatFeature(b):void 0},alias:function(a){var b;return b=cola._compileExpression(a,"alias"),b?new cola._AliasFeature(b):void 0},bind:function(a,b,c){var d,e,f,g;return d=cola._compileExpression(a),f=c.nodeName,"INPUT"===f?(g=c.type,e="checkbox"===g?new cola._CheckboxFeature(d):"radio"===g?new cola._RadioFeature(d):new cola._TextBoxFeature(d)):e="SELECT"===f?new cola._SelectFeature(d):"TEXTAREA"===f?new cola._TextBoxFeature(d):new cola._DomAttrFeature(d,"text"),e},style:function(a){var b,c,d,e,f,g;if(!a)return!1;e=cola.util.parseStyleLikeString(a),d=[];for(g in e)f=e[g],b=cola._compileExpression(f),b&&(c=new cola._DomStylePropFeature(b,g),d.push(c));return d},classname:function(a){var b,c,d,e,f,g;if(!a)return!1;g=[];try{e=cola._compileExpression(a),e&&(f=new cola._DomClassFeature(e),g.push(f))}catch(h){b=cola.util.parseStyleLikeString(a);for(d in b)c=b[d],e=cola._compileExpression(c),e&&(f=new cola._DomToggleClassFeature(e,d),g.push(f))}return g},"class":function(){return this.classname.apply(this,arguments)},resource:function(a,b,c){a=cola.util.trim(a),a&&$fly(c).text(cola.resource(a))},watch:function(a){var b,c,d,e,f,g,h,i,j;if(d=a.indexOf(" on "),d>0&&(b=a.substring(0,d),h=a.substring(d+4))){for(i=[],j=h.split(","),e=0,f=j.length;f>e;e++)g=j[e],g=cola.util.trim(g),g&&i.push(g);i.length&&(c=new cola._WatchFeature(b,i))}if(!c)throw new cola.Exception('"'+expr+'" is not a valid watch expression.');return c},event:function(a,b){var c,d;return c=cola._compileExpression(a),c&&(d=new cola._EventFeature(c,b.substring(2))),d}},function(){var a,b;return a=function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},b=!!CSSStyleDeclaration.prototype.getPropertyValue,b?void 0:(CSSStyleDeclaration.prototype.getPropertyValue=function(a){return this.getAttribute(a)},CSSStyleDeclaration.prototype.setProperty=function(b,c,d){var e;return this.setAttribute(b,c),d="undefined"!=typeof d?d:"",""!==d?(e=new RegExp(a(b)+"\\s*:\\s*"+a(c)(NaN,"gmi")),this.cssText=this.cssText.replace(e,b+": "+c+" !"+d+";")):void 0},CSSStyleDeclaration.prototype.removeProperty=function(a){return this.removeAttribute(a)},CSSStyleDeclaration.prototype.getPropertyPriority=function(b){var c;return c=new RegExp(a(b)+"\\s*:\\s*[^\\s]*\\s*!important(\\s*;)?","gmi"),c.test(this.cssText)?"important":""})}(),cola.util.addClass=function(a,b,c){var d;return c?(1===a.nodeType&&(d=a.className?(" "+a.className+" ").replace(cola.constants.CLASS_REG," "):" ",d.indexOf(" "+b+" ")<0&&(d+=b+" ",a.className=$.trim(d))),cola.util):($(a).addClass(b),cola.util)},cola.util.removeClass=function(a,b,c){var d;return c?(1===a.nodeType&&(d=a.className?(" "+a.className+" ").replace(cola.constants.CLASS_REG," "):" ",d.indexOf(" "+b+" ")>=0&&(d=d.replace(" "+b+" "," "),a.className=$.trim(d))),cola.util):($(a).removeClass(b),cola.util)},cola.util.toggleClass=function(a,b,c,d){return d?(1===a.nodeType&&(c?this._addClass(a,b,!0):this._removeClass(a,b,!0)),cola.util):void $(a).toggleClass(b,!!c)},cola.util.hasClass=function(a,b){var c,d,e,f,g;for(g=b.split(/\s+/g),c=a.className?(" "+a.className+" ").replace(cola.constants.CLASS_REG," "):" ",d=0,e=g.length;e>d;d++)if(f=g[d],c.indexOf(" "+f+" ")<0)return!1;return!0},cola.util.style=function(a,b,c,d){var e;return e=a.style,"undefined"!=typeof b?"undefined"!=typeof c?(d="undefined"!=typeof d?d:"",e.setProperty(b,c,d)):e.getPropertyValue(b):e},cola.util.getTextChildData=function(a){var b;for(b=a.firstChild;b;){if(3===b.nodeType)return b.textContent;b=b.nextSibling}return null},cola.util.eachNodeChild=function(a,b){var c;if(!a||!b)return cola.util;for(c=a.firstChild;c&&b(c)!==!1;)c=c.nextSibling;return cola.util},cola.util.hasContent=function(a){var b;for(b=a.firstChild;b;){if(3===b.nodeType||1===b.nodeType)return!0;b=b.nextSibling}return!1},cola.util.getScrollerRender=function(a){var b,c,d;return b=document.createElement("div"),c=cola.Fx.perspectiveProperty,d=cola.Fx.transformProperty,void 0!==b.style[c]?function(b,c,e){a.style[d]="translate3d("+-b+"px,"+-c+"px,0) scale("+e+")"}:void 0!==b.style[d]?function(b,c,e){a.style[d]="translate("+-b+"px,"+-c+"px) scale("+e+")"}:function(b,c,d){a.style.marginLeft=b?-b/d+"px":"",a.style.marginTop=c?-c/d+"px":"",a.style.zoom=d||""}},cola.util.getType=function(){var a,b,c,d,e;for(a={},e="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),b=0,c=e.length;c>b;b++)d=e[b],a["[object "+d+"]"]=d.toLowerCase();return function(b){var c;return c=Object.prototype.toString.call(b),a[c]||"object"}}(),cola.util.typeOf=function(a,b){return cola.util.getType(a)===b},cola.util.getDomRect=function(a){var b;return b=a.getBoundingClientRect(),isNaN(b.height)&&(b.height=b.bottom-b.top),isNaN(b.width)&&(b.width=b.right-b.left),b},$.xCreate.templateProcessors.push(function(a){var b;return a instanceof cola.Widget?(b=a.getDom(),b.setAttribute(cola.constants.IGNORE_DIRECTIVE,""),b):void 0}),$.xCreate.attributeProcessor["c-widget"]=function(a,b,c,d){var e,f;c&&("string"==typeof c?a.attr(b,c):d&&(e=cola.uniqueId(),a.attr("c-widget-config",e),f=d.widgetConfigs,f||(d.widgetConfigs=f={}),f[e]=c))},cola.xRender.nodeProcessors.push(function(a,b){var c,d;return a instanceof cola.Widget?d=a:a.$type&&(d=cola.widget(a,b.namespace)),d&&(c=d.getDom(),c.setAttribute(cola.constants.IGNORE_DIRECTIVE,"")),c}),cola.Model.prototype.widgetConfig=function(a,b){var c,d,e;if(1===arguments.length){if("string"==typeof a)return null!=(d=this._widgetConfig)?d[a]:void 0;b=a;for(c in b)e=b[c],this.widgetConfig(c,e)}else null==this._widgetConfig&&(this._widgetConfig={}),this._widgetConfig[a]=b},ALIAS_REGEXP=new RegExp("\\$default","g"),_findWidgetConfig=function(a,b){for(var c,d;a&&!(d=null!=(c=a._widgetConfig)?c[b]:void 0);)a=a.parent;return d},_compileWidgetDom=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;for(null==c&&(c={}),b.attributes._inited&&b.events._inited||cola.preprocessClass(b),c.$constr=b,m=null,l=a.attributes,g=0,h=l.length;h>g;g++)d=l[g],e=d.name,0===e.indexOf("c-")?(k=e.slice(2),b.attributes.$has(k)&&"class"!==k?("bind"===k?c[k]=d.value:c[k]=cola._compileExpression(d.value),null==m&&(m=[]),m.push(e)):(f=b.events.$has(k),f||0!==k.indexOf("on")||b.events.$has(k.slice(2))&&(f=!0,k=k.slice(2)),f&&(c[k]=cola._compileExpression(d.value),null==m&&(m=[]),m.push(e)))):(k=e,b.attributes.$has(k)?c[k]=d.value:(f=b.events.$has(k),f||0!==k.indexOf("on")||b.events.$has(k.slice(2))&&(f=!0,k=k.slice(2),null==m&&(m=[]),m.push(e)),f&&(c[k]=d.value)));if(m)for(j=0,i=m.length;i>j;j++)d=m[j],a.removeAttribute(d);return c},_compileWidgetAttribute=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;if(n=b.getAttribute("c-widget"),n&&(b.removeAttribute("c-widget"),c.defaultPath&&(n=n.replace(ALIAS_REGEXP,c.defaultPath)),d=cola.util.parseStyleLikeString(n,"$type"))){g=null;for(l in d)m=d[l],f=null,35===l.charCodeAt(0)?f=l.substring(1):"$type"===l&&"string"==typeof m&&35===m.charCodeAt(0)&&(f=m.substring(1)),f&&(delete d[l],null==g&&(g=[]),g.push(f));if(g)for(j=0,k=g.length;k>j;j++)if(f=g[j],e=_findWidgetConfig(a,f))for(h in e)i=e[h],d[h]=i}return d},cola._userDomCompiler.$.push(function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o;if(cola.util.userData(b,cola.constants.DOM_ELEMENT_KEY))return null;if(1!==b.nodeType)return null;if(b.id&&(h=_findWidgetConfig(a,b.id)),j=d.parentWidget,m=b.tagName,f=b.getAttribute("c-widget-config"),f?(b.removeAttribute("c-widget-config"),e=null!=(k=d.widgetConfigs)?k[f]:void 0):(e=_compileWidgetAttribute(a,b,d),e&&(e.$type||e.$constr)||(o=null!=j&&null!=(l=j.childTagNames)?l[m]:void 0,null==o&&(o=WIDGET_TAGS_REGISTRY[m]),o&&(e=_compileWidgetDom(b,o,e)))),!e&&!h)return null;if(null==e&&(e={}),h)for(i in h)n=h[i],e.hasOwnProperty(i)||(e[i]=n);return"string"==typeof e&&(e={$type:e}),g=e.$constr instanceof Function?e.$constr:cola.resolveType((null!=j?j.CHILDREN_TYPE_NAMESPACE:void 0)||"widget",e,cola.Widget),e.$constr=d.parentWidget=g,cola.util.isCompatibleType(cola.AbstractLayer,g)&&e.lazyRender&&cola.util.userData(b,cola.constants.DOM_SKIP_CHILDREN,!0),function(a,b){var c,f;d.parentWidget=j,e.dom=b,c=cola.currentScope,cola.currentScope=a;try{return f=cola.widget(e)}finally{cola.currentScope=c}}}),cola.registerTypeResolver("widget",function(a){return a?a.$constructor&&cola.util.isSuperClass(cola.Widget,a.$constructor)?a.$constructor:a.$type?cola[cola.util.capitalize(a.$type)]:void 0:void 0}),cola.registerType("widget","_default",cola.Widget),cola.widget=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;if(!a)return null;if("string"==typeof a){if(g=window[a],!g)return null;if(g.nodeType)return m=cola.util.userData(g,cola.constants.DOM_ELEMENT_KEY),c&&m._scope!==c&&(m=null),m instanceof cola.Widget?m:null;for(h=[],i=0,j=g.length;j>i;i++)f=g[i],m=cola.util.userData(f,cola.constants.DOM_ELEMENT_KEY),m instanceof cola.Widget&&(!c||m._scope===c)&&h.push(m);return h.length?1===h.length?h[0]:cola.Element.createGroup(h):null}if(a instanceof Array){for(h=[],l=0,k=a.length;k>l;l++)d=a[l],h.push(cola.widget(d,b,c));return cola.Element.createGroup(h)}return 1===a.nodeType?(m=cola.util.userData(a,cola.constants.DOM_ELEMENT_KEY),c&&m._scope!==c&&(m=null),m instanceof cola.Widget?m:null):(e=a.$constr||cola.resolveType(b||"widget",a,cola.Widget),c&&!a.scope&&(a.scope=c),new e(a))},cola.findWidget=function(a,b){var c,d;return b&&"string"==typeof b&&(d=b,b=WIDGET_TAGS_REGISTRY[d],b||(b=cola.resolveType("widget",{$type:d})),!b)?null:(a instanceof cola.Widget&&(a=a.getDom()),(c=function(a,b,d){var e,f,g,h;for(f=b.parentNode;f;){if(b=f,h=cola.util.userData(b,cola.constants.DOM_ELEMENT_KEY),h&&(!d||h instanceof d))return h;f=b.parentNode}if(a.parent){try{g=a.parent.jQuery("iframe,frame")}catch(i){}g&&(e=null,g.each(function(){return this.contentWindow===a?(e=this,!1):void 0}),e&&(h=c(a.parent,e,d)))}return h})(window,a,b))},cola.Model.prototype.widget=function(a){return cola.widget(a,null,this)},WIDGET_TAGS_REGISTRY={},_extendWidget=function(a,b){var c,d,e,f,g;c=function(a){c.attributes._inited&&c.events._inited||cola.preprocessClass(c),b.create&&this.on("create",b.create),b.destroy&&this.on("destroy",b.destroy),b.initDom&&this.on("initDom",function(a){return function(b,c){return a.initDom(c.dom)}}(this)),b.refreshDom&&this.on("refreshDom",function(a){return function(b,c){return a.refreshDom(c.dom)}}(this)),this.on("attributeChange",function(a){return function(b,c){var d;d=c.attribute,a._widgetModel.data.onDataMessage(["@"+d],cola.constants.MESSAGE_PROPERTY_CHANGE,{}),value=a._get(d),value&&(value instanceof cola.Entity||value instanceof cola.EntityList)?a._entityProps[d]=value:delete a._entityProps[d]}}(this)),this._entityProps={},this._widgetModel=new cola.WidgetModel(this,(null!=a?a.scope:void 0)||cola.currentScope),c.__super__.constructor.call(this,a)},extend(c,a),c.tagName=(null!=(f=b.tagName)?f.toUpperCase():void 0)||"",b.parentWidget&&(c.parentWidget=b.parentWidget),
c.attributes=b.attributes||{},c.attributes.widgetModel={readOnly:!0,getter:function(){return this._widgetModel}},c.attributes.template={readOnlyAfterCreate:!0},b.events&&(c.events=b.events),b.template&&(g=b.template,"string"==typeof g&&g.match(/^\#[\w\-\$]*$/)&&(g=document.getElementById(g.substring(1)),g&&(b.template=g.innerHTML,$fly(g).remove())),c.attributes.template={defaultValue:b.template}),c.prototype._createDom=function(){var b;return this._template?(b=cola.xRender(this._template||{},this._widgetModel),this._domCreated=!0,b):a.prototype._createDom.apply(this)},c.prototype._initDom=function(b){var c,d,e,f,h,i,j;if(a.prototype._initDom.call(this,b),g=this._template,g&&!this._domCreated&&(j=this.xRender(g),11===(null!=j?j.nodeType:void 0)&&(j=j.firstElementChild),j)){if(j.attributes)for(i=j.attributes,f=0,h=i.length;h>f;f++)c=i[f],d=c.name,"class"===d?$fly(b).addClass(c.value):"style"!==d&&(b.hasAttribute(d)||b.setAttribute(d,c.value));for(e in j.style)""===b.style[e]&&(b.style[e]=j.style[e]);for(;j.firstChild;)b.appendChild(j.firstChild)}},c.prototype.xRender=function(a,b){return cola.xRender(a,this._widgetModel,b)};for(e in b)d=b[e],b.hasOwnProperty(e)&&"function"==typeof d&&(c.prototype[e]=d);return c},cola.defineWidget=function(a,b){var c,d,e;if(cola.util.isSuperClass(cola.Widget,a)||(b=a,a=cola.TemplateWidget),b&&(a=_extendWidget(a,b)),e=null!=(d=a.tagName)?d.toUpperCase():void 0,e&&a.parentWidget){if(c=a.parentWidget.childTagNames,c||(a.parentWidget.childTagNames=c={}),c[e])throw new cola.Exception('Tag name "'+e+'" is already registered in "'+a.parentWidget.tagName+'".');c[e]=a}else if(e){if(WIDGET_TAGS_REGISTRY[e])throw new cola.Exception('Tag name "'+e+'" is already registered.');WIDGET_TAGS_REGISTRY[e]=a}return a},cola.registerWidget=cola.defineWidget,ACTIVE_PINCH_REG=/^pinch/i,ACTIVE_ROTATE_REG=/^rotate/i,PAN_VERTICAL_events=["panUp","panDown"],SWIPE_VERTICAL_events=["swipeUp","swipeDown"],"string"!=typeof document.documentElement.style.flex&&$(document.documentElement).addClass("flex-unsupported"),cola.ClassNamePool=function(){function a(a,b){null==b&&(b=[]),this.elements=[],a=a?(" "+a+" ").replace(cola.constants.CLASS_REG," "):" ",b.forEach(function(b){return function(c){var d;d=" "+c+" ",a.indexOf(d)>-1&&(a=a.replace(d," "),b.add(c))}}(this)),$.trim(a).split(" ").forEach(function(a){return function(b){a.add(b)}}(this))}return a.prototype.add=function(a){var b;if(a&&(b=this.elements.indexOf(a),!(b>-1)))return this.elements.push(a)},a.prototype.remove=function(a){var b;return b=this.elements.indexOf(a),b>-1&&this.elements.splice(b,1),this},a.prototype.destroy=function(){return delete this.elements},a.prototype.join=function(){return this.elements.join(" ")},a.prototype.toggle=function(a,b){b?this.add(a):this.remove(a)},a}(),_destroyRenderableElement=function(a,b){var c;c=b[cola.constants.DOM_ELEMENT_KEY],("function"==typeof c?c(_destroyed):void 0)||(c._domRemoved=!0,c.destroy())},cola.RenderableElement=function(a){function b(a){var c;a&&(c=a.dom,c&&delete a.dom),null==this._doms&&(this._doms={}),b.__super__.constructor.call(this,a),c&&this._setDom(c,!0)}return extend(b,a),b.events={initDom:null,refreshDom:null},b.prototype._initDom=function(a){},b.prototype._parseDom=function(a){},b.prototype._setDom=function(a,b){var c;a&&(this._dom=a,cola.util.userData(a,cola.constants.DOM_ELEMENT_KEY,this),cola.util.onNodeDispose(a,_destroyRenderableElement),b&&this._parseDom(a),this._initDom(a),c={dom:a},this.fire("initDom",this,c),this._refreshDom(),this._rendered=!0)},b.prototype._createDom=function(){var a,b;return b=document.createElement(this.constructor.tagName||"div"),a=this.constructor.CLASS_NAME||"",a&&$fly(b).addClass("ui "+a),b},b.prototype._doSet=function(a,c,d){return(null!=c?c.refreshDom:void 0)&&this._dom&&cola.util.delay(this,"refreshDom",50,this._refreshDom),b.__super__._doSet.call(this,a,c,d)},b.prototype._doRefreshDom=function(){var a,b,c,d,e;if(cola.util.cancelDelay(this,"_refreshDom"),this._dom){if(a=this.constructor.CLASS_NAME)for(this._classNamePool.add("ui"),e=$.trim(a).split(" "),b=0,c=e.length;c>b;b++)d=e[b],this._classNamePool.add(d);this._resetDimension()}},b.prototype._refreshDom=function(){var a;(this._dom||!this._destroyed)&&(this._classNamePool=new cola.ClassNamePool(this._dom.className,this.constructor.SEMANTIC_CLASS),this._doRefreshDom(),a=$.trim(this._classNamePool.join()),this._dom.className=a,this._classNamePool.destroy(),delete this._classNamePool)},b.prototype._resetDimension=function(){},b.prototype.getDom=function(){var a;return this._destroyed?null:(this._dom||(a=this._createDom(),this._setDom(a)),this._dom)},b.prototype.get$Dom=function(){return this._destroyed?null:(null==this._$dom&&(this._$dom=$(this.getDom())),this._$dom)},b.prototype.refresh=function(){var a;return this._dom?(this._refreshDom(),a={dom:this._dom},this.fire("refreshDom",this,a),this):this},b.prototype.appendTo=function(a){return a&&this.getDom()&&$(a).append(this._dom),this},b.prototype.remove=function(){return this.get$Dom().remove(),this},b.prototype.destroy=function(){this._destroyed||(cola.util.cancelDelay(this,"refreshDom"),this._dom&&(this._domRemoved||this.remove(),delete this._dom,delete this._$dom),b.__super__.destroy.call(this),this._destroyed=!0)},b.prototype.addClass=function(a,b){return b?cola.util.addClass(this._dom,a,!0):this.get$Dom().addClass(a),this},b.prototype.removeClass=function(a,b){return b?cola.util.removeClass(this._dom,a,!0):this.get$Dom().removeClass(a),this},b.prototype.toggleClass=function(a,b,c){return c?cola.util.toggleClass(this._dom,a,b,!0):this.get$Dom().toggleClass(a,b),this},b.prototype.hasClass=function(a,b){return b?cola.util.hasClass(this._dom,a,!0):this.get$Dom().hasClass(a)},b}(cola.Element),cola.Widget=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.SEMANTIC_CLASS=["left floated","right floated"],b.attributes={display:{defaultValue:!0,refreshDom:!0,type:"boolean"},"float":{refreshDom:!0,"enum":["left","right",""],defaultValue:"",setter:function(a){var b;b=this._float,this._dom&&b&&b!==a&&cola.util.removeClass(this._dom,b+" floated",!0),this._float=a}},"class":{refreshDom:!0,setter:function(a){var b;b=this._class,b&&this._dom&&b!==a&&this.get$Dom().removeClass(b),this._class=a}},popup:null,dimmer:{setter:function(a){var b,c;null==this._dimmer&&(this._dimmer={});for(b in a)c=a[b],this._dimmer[b]=c}},height:{refreshDom:!0},width:{refreshDom:!0}},b.events={click:{$event:"click"},dblClick:{$event:"dblclick"},mouseDown:{$event:"mousedown"},mouseUp:{$event:"mouseup"},tap:{hammerEvent:"tap"},press:{hammerEvent:"press"},panStart:{hammerEvent:"panstart"},panMove:{hammerEvent:"panmove"},panEnd:{hammerEvent:"panend"},panCancel:{hammerEvent:"pancancel"},panLeft:{hammerEvent:"panleft"},panRight:{hammerEvent:"panright"},panUp:{hammerEvent:"panup"},panDown:{hammerEvent:"pandown"},pinchStart:{hammerEvent:"pinchstart"},pinchMove:{hammerEvent:"pinchmove"},pinchEnd:{hammerEvent:"pinchend"},pinchCancel:{hammerEvent:"pinchcancel"},pinchIn:{hammerEvent:"pinchin"},pinchOut:{hammerEvent:"pinchout"},rotateStart:{hammerEvent:"rotatestart"},rotateMove:{hammerEvent:"rotatemove"},rotateEnd:{hammerEvent:"rotateend"},rotateCancel:{hammerEvent:"rotatecancel"},swipeLeft:{hammerEvent:"swipeleft"},swipeRight:{hammerEvent:"swiperight"},swipeUp:{hammerEvent:"swipeup"},swipeDown:{hammerEvent:"swipedown"}},b.prototype._initDom=function(a){var c,d;return b.__super__._initDom.call(this,a),c=this._popup,c?(d={},"string"==typeof c||c.constructor===Object.prototype.constructor&&c.tagName||1===c.nodeType?d.html=cola.xRender(c):c.constructor===Object.prototype.constructor&&(d=c,d.content?d.html=cola.xRender(d.content):d.html&&(d.html=cola.xRender(d.html))),$(a).popup(d)):void 0},b.prototype._setDom=function(a,c){var d;if(a){b.__super__._setDom.call(this,a,c);for(d in this.constructor.events)this.getListeners(d)&&this._bindEvent(d)}},b.prototype._on=function(a,c,d){return b.__super__._on.call(this,a,c,d),this._dom&&this._bindEvent(a),this},b.prototype.fire=function(a,c,d){var e;if(this._eventRegistry&&(e=this.constructor.events.$get(a),!(this.constructor.attributes.hasOwnProperty("disabled")&&this.get("disabled")&&e&&(e.$event||e.hammerEvent)||(this._hasFireTapEvent||(this._hasFireTapEvent="tap"===a),"click"===a&&this._hasFireTapEvent))))return b.__super__.fire.call(this,a,c,d)},b.prototype._doRefreshDom=function(){var a,c,d,e;if(this._dom&&(b.__super__._doRefreshDom.call(this),this._float&&this._classNamePool.add(this._float+" floated"),this._classNamePool.toggle("display-none",!this._display),!this._rendered&&this._class))for(e=this._class.split(" "),a=0,c=e.length;c>a;a++)d=e[a],this._classNamePool.add(d)},b.prototype._bindEvent=function(a){var b,c;if(this._dom&&(null==this._bindedEvents&&(this._bindedEvents={}),!this._bindedEvents[a]))return b=this.get$Dom(),c=this.constructor.events.$get(a),(null!=c?c.$event:void 0)?(b.on(c.$event,function(b){return function(c){var d;return d={dom:b._dom,event:c},b.fire(a,b,d)}}(this)),void(this._bindedEvents[a]=!0)):(null!=c?c.hammerEvent:void 0)?(null==this._hammer&&(this._hammer=new Hammer(this._dom,{})),ACTIVE_PINCH_REG.test(a)&&this._hammer.get("pinch").set({enable:!0}),ACTIVE_ROTATE_REG.test(a)&&this._hammer.get("rotate").set({enable:!0}),PAN_VERTICAL_events.indexOf(a)>=0&&this._hammer.get("pan").set({direction:Hammer.DIRECTION_ALL}),SWIPE_VERTICAL_events.indexOf(a)>=0&&this._hammer.get("swipe").set({direction:Hammer.DIRECTION_ALL}),this._hammer.on(c.hammerEvent,function(b){return function(c){var d;return d={dom:b._dom,event:c,eventName:a},b.fire(a,b,d)}}(this)),void(this._bindedEvents[a]=!0)):void 0},b.prototype._resetDimension=function(){var a,b,c,d;a=this.get$Dom(),c=cola.constants.WIDGET_DIMENSION_UNIT,b=this.get("height"),isFinite(b)&&(b=""+parseInt(b)+c),b&&a.css("height",b),d=this.get("width"),isFinite(d)&&(d=""+parseInt(d)+c),d&&a.css("width",d)},b.prototype.showDimmer=function(a){var b,c,d,e,f,g;if(null==a&&(a={}),!this._dom)return this;c=a.content,!c&&this._dimmer&&(c=this._dimmer.content),c&&("string"==typeof c?e=$.xCreate({tagName:"div",content:c}):c.constructor===Object.prototype.constructor&&c.tagName?e=$.xCreate(c):1===c.nodeType&&(e=c)),null==this._dimmer&&(this._dimmer={});for(f in a)g=a[f],"content"!==f&&(this._dimmer[f]=g);return b=this.get$Dom(),d=b.dimmer("get dimmer"),e&&(d?$(d).empty():b.dimmer("create"),b.dimmer("add content",e)),b.dimmer(this._dimmer),b.dimmer("show"),this},b.prototype.hideDimmer=function(){return this._dom?(this.get$Dom().dimmer("hide"),this):this},b.prototype.destroy=function(){this._destroyed||(this._dom&&(delete this._hammer,delete this._bindedEvents,delete this._parent,delete this._doms),b.__super__.destroy.call(this),this._destroyed=!0)},b}(cola.RenderableElement),cola.floatWidget={_zIndex:1100,zIndex:function(){return++cola.floatWidget._zIndex}},cola.Exception.showException=function(a){var b;return b=a instanceof cola.Exception||a instanceof Error?a.message:a+"",cola.alert(b)},cola.WidgetDataModel=function(a){function b(a,c){this.widget=c,b.__super__.constructor.call(this,a)}return extend(b,a),b.prototype.get=function(a,b,c){var d;return 64===a.charCodeAt(0)?this.widget.get(a.substring(1)):null!=(d=this.model.parent)?d.data.get(a,b,c):void 0},b.prototype.set=function(a,b){var c;64===a.charCodeAt(0)?(this.widget.set(a.substring(1),b),this.onDataMessage(a.split("."),cola.constants.MESSAGE_PROPERTY_CHANGE,{})):null!=(c=this.model.parent)&&c.data.set(a,b)},b.prototype.processMessage=function(a,b,c,d){var e,f,g,h,i,j,k;if(this.onDataMessage(b,c,d),g=d.entity||d.entityList){i=this.widget._entityProps;for(e in i){for(value=i[e],h=!1,f=g;f;){if(f===value){h=!0;break}f=f.parent}h&&(k=value.getPath(),(null!=k?k.length:void 0)&&(j=b.slice(k.length),this.onDataMessage(["@"+e].concat(j),c,d)))}}},b.prototype.getDataType=function(a){var b;return 64===a.charCodeAt(0)?null:null!=(b=this.model.parent)?b.data.getDataType(a):void 0},b.prototype.getProperty=function(a){var b;return 64===a.charCodeAt(0)?null:null!=(b=this.model.parent)?b.data.getDataType(a):void 0},b.prototype.flush=function(a,b){var c;return 64!==path.charCodeAt(0)&&null!=(c=this.model.parent)&&c.data.getDataType(a,b),this},b}(cola.AbstractDataModel),cola.WidgetModel=function(a){function b(a,b){var c,d;this.widget=a,this.parent=b,d=this.widget,this.data=new cola.WidgetDataModel(this,d),null!=(c=this.parent)&&c.data.bind("**",this),this.action=function(a){var b;return b=d[a],b instanceof Function?function(){return b.apply(d,arguments)}:d._scope.action(a)}}return extend(b,a),b.prototype.repeatNotification=!0,b.prototype.processMessage=function(a,b,c,d){return this.messageTimestamp>=d.timestamp?void 0:this.data.processMessage(a,b,c,d)},b}(cola.SubScope),cola.TemplateWidget=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b}(cola.Widget)}).call(this);