/*! Cola UI - 1.0.8
 * Copyright (c) 2002-2016 BSTEK Corp. All rights reserved.
 *
 * This file is dual-licensed under the AGPLv3 (http://www.gnu.org/licenses/agpl-3.0.html)
 * and BSDN commercial (http://www.bsdn.org/licenses) licenses.
 *
 * If you are unsure which license is appropriate for your use, please contact the sales department
 * at http://www.bstek.com/contact.
 */
(function(){var ACTIVE_PINCH_REG,ACTIVE_ROTATE_REG,ALIAS_REGEXP,EntityIndex,IGNORE_NODES,LinkedList,ON_NODE_REMOVED_KEY,PAN_VERTICAL_events,Page,SWIPE_VERTICAL_events,TYPE_SEVERITY,USER_DATA_KEY,WIDGET_TAGS_REGISTRY,_$,_DOMNodeInsertedListener,_DOMNodeRemovedListener,_Entity,_EntityList,_ExpressionDataModel,_ExpressionScope,_SYS_PARAMS,_compileResourceUrl,_compileWidgetAttribute,_compileWidgetDom,_cssCache,_destroyDomBinding,_destroyRenderableElement,_doRenderDomTemplate,_evalDataPath,_extendWidget,_extractDirtyTree,_filterCollection,_filterEntity,_findRouter,_findWidgetConfig,_getData,_getEntityPath,_getHashPath,_getNodeDataId,_jsCache,_loadCss,_loadHtml,_loadJs,_matchValue,_nodesToBeRemove,_numberWords,_onHashChange,_onStateChange,_processEntity,_processEntityList,_setValue,_sortCollection,_switchRouter,_toJSON,_triggerWatcher,_unloadCss,_unwatch,_watch,appendChild,browser,buildContent,cleanStamp,cola,colaEventRegistry,createContentPart,createNodeForAppend,currentRoutePath,currentRouter,defaultActionTimestamp,defaultDataTypes,definedSetting,dictionaryMap,digestExpression,doMergeDefinitions,doms,exceptionStack,getDefinition,hasDefinition,ignoreRouterSettingChange,key,keyValuesMap,oldIE,originalAjax,os,resourceStore,routerRegistry,setAttrs,setting,sprintf,tagSplitter,trimPath,typeRegistry,uniqueIdSeed,value,xCreate,slice=[].slice,extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;if(this.cola=cola=function(){var a;return null!=(a=cola._rootFunc)?a.apply(cola,arguments):void 0},cola.util={},cola.constants={VARIABLE_NAME_REGEXP:/^[_a-zA-Z][_a-zA-Z0-9]*$/g,VIEW_CLASS:"c-view",VIEW_PORT_CLASS:"c-viewport",IGNORE_DIRECTIVE:"c-ignore",SHOW_ON_READY_CLASS:"show-on-ready",COLLECTION_CURRENT_CLASS:"current",DEFAULT_PATH:"$root",REPEAT_INDEX:"$index",DOM_USER_DATA_KEY:"_d",DOM_BINDING_KEY:"_binding",DOM_INITIALIZER_KEY:"_initialize",REPEAT_TEMPLATE_KEY:"_template",REPEAT_TAIL_KEY:"_tail",DOM_ELEMENT_KEY:"_element",DOM_SKIP_CHILDREN:"_skipChildren",NOT_WHITE_REG:/\S+/g,CLASS_REG:/[\t\r\n\f]/g,WIDGET_DIMENSION_UNIT:"px",MESSAGE_REFRESH:0,MESSAGE_PROPERTY_CHANGE:1,MESSAGE_CURRENT_CHANGE:10,MESSAGE_EDITING_STATE_CHANGE:11,MESSAGE_VALIDATION_STATE_CHANGE:15,MESSAGE_INSERT:20,MESSAGE_REMOVE:21,MESSAGE_LOADING_START:30,MESSAGE_LOADING_END:31},oldIE=!-[1],$.xCreate=xCreate=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(i=function(a){var b;return null===a||void 0===a?!0:(b=typeof a,"object"!==b&&"function"!==b||a instanceof Date)},a instanceof Array){for(h=[],j=0,k=a.length;k>j;j++)o=a[j],g=xCreate(o,b),null!=g&&h.push(g);return h}if(xCreate.templateProcessors.length)for(q=xCreate.templateProcessors,n=0,l=q.length;l>n;n++)if(s=q[n],g=s(a),null!=g)return g;if("string"==typeof a){if("^"!==a.charAt(0))return document.createTextNode(a);a={tagName:a.substring(1)}}if(r=a.tagName||"DIV",r=r.toUpperCase(),f=oldIE&&"INPUT"===r.toUpperCase()&&a.type?document.createElement("<"+r+' type="'+a.type+'"/>'):document.createElement(r),c=$(f),setAttrs(f,c,a,b),e=a.content,null!=e)if(i(e))"string"==typeof e&&"^"===e.charAt(0)?appendChild(f,document.createElement(e.substring(1))):c.text(e);else if(e instanceof Array)for(p=0,m=e.length;m>p;p++)o=e[p],i(o)?"string"==typeof o&&"^"===o.charAt(0)?appendChild(f,document.createElement(o.substring(1))):appendChild(f,document.createTextNode(o)):(d=xCreate(o,b),null!=d&&appendChild(f,d));else e.nodeType?appendChild(f,e):(d=xCreate(e,b),null!=d&&appendChild(f,d));else a.html&&c.html(a.html);return f},xCreate.templateProcessors=[],xCreate.attributeProcessor={data:function(a,b,c,d){a.data(c)},style:function(a,b,c,d){"string"==typeof c?a.attr("style",c):null!==c&&a.css(c)}},setAttrs=function(a,b,c,d){var e,f,g;for(e in c)if(f=c[e],g=xCreate.attributeProcessor[e])g(b,e,f,d);else switch(e){case"tagName":case"nodeName":case"content":case"html":continue;case"contextKey":d instanceof Object&&f&&"string"==typeof f&&(d[f]=a);break;case"data":d instanceof Object&&f&&"string"==typeof f&&(d[f]=a);break;case"classname":b.attr("class",f);break;default:"function"==typeof f?b.on(e,f):("boolean"==typeof f&&(f+=""),a.setAttribute(e,f))}},appendChild=function(a,b){var c;return"TABLE"===a.nodeName&&"TR"===b.nodeName&&(c=a&&a.tBodies[0]?a.tBodies[0]:a.appendChild(document.createElement("tbody")),a=c),a.appendChild(b)},createNodeForAppend=function(a,b){var c,d,e,f,g;if(g=xCreate(a,b),!g)return null;if(g instanceof Array){for(d=document.createDocumentFragment(),e=0,f=g.length;f>e;e++)c=g[e],d.appendChild(c);g=d}return g},$.fn.xAppend=function(a,b){var c;return c=createNodeForAppend(a,b),c?this.append(c):null},$.fn.xInsertBefore=function(a,b){var c;return c=createNodeForAppend(a,b),c?this.before(c):null},$.fn.xInsertAfter=function(a,b){var c;return c=createNodeForAppend(a,b),c?this.after(c):null},cola.util.KeyedArray=function(){function a(){this.elements=[],this.keys=[],this.keyMap={}}return a.prototype.size=0,a.prototype.add=function(a,b){var c;return this.keyMap.hasOwnProperty(a)&&(c=this.elements.indexOf(b),c>-1&&(this.elements.splice(c,1),this.keys.splice(c,1))),this.keyMap[a]=b,this.size=this.elements.push(b),this.keys.push(a),this},a.prototype.remove=function(a){var b,c;return"number"==typeof a?(c=a,a=this.keys[c],b=this.elements[c],this.elements.splice(c,1),this.keys.splice(c,1),this.size=this.elements.length,delete this.keyMap[a]):(b=this.keyMap[a],delete this.keyMap[a],b&&(c=this.keys.indexOf(a),c>-1&&(this.elements.splice(c,1),this.keys.splice(c,1),this.size=this.elements.length))),b},a.prototype.get=function(a){return"number"==typeof a?this.elements[a]:this.keyMap[a]},a.prototype.getIndex=function(a){return this.keyMap.hasOwnProperty(a)?this.keys.indexOf(a):-1},a.prototype.clear=function(){this.elements=[],this.keys=[],this.keyMap={},this.size=0},a.prototype.elements=function(){return this.elements},a.prototype.each=function(a){var b,c,d,e,f,g;for(d=this.keys,g=this.elements,c=e=0,f=g.length;f>e&&(b=g[c],a.call(this,b,d[c])!==!1);c=++e);},a}(),cola.util.trim=function(a){return null!=a?String.prototype.trim.call(a):""},cola.util.capitalize=function(a){return a?a.charAt(0).toUpperCase()+a.slice(1):a},cola.util.isSimpleValue=function(a){var b;return null===a||void 0===a?!0:(b=typeof a,"object"!==b&&"function"!==b||a instanceof Date||a instanceof Array)},cola.util.each=function(a,b){var c,d,e,f;for(c=e=0,f=a.length;f>e&&(d=a[c],b(d,c)!==!1);c=++e);},cola.util.path=function(){var a,b,c,d,e,f,g;for(g=1<=arguments.length?slice.call(arguments,0):[],d=g.length-1,b=c=0,e=g.length;e>c;b=++c)f=g[b],a=!1,b>0&&47===f.charCodeAt(0)&&(f=f.substring(1),a=!0),d>b&&47===f.charCodeAt(f.length-1)&&(f=f.substring(0,f.length-1),a=!0),a&&(g[b]=f);return g.join("/")},cola.util.parseStyleLikeString=function(a,b){var c,d,e,f,g,h,i,j,k;if(!a)return!1;for(i={},h=a.split(";"),c=e=0,f=h.length;f>e;c=++e)if(g=h[c],d=g.indexOf(":"),d>0)k=this.trim(g.substring(0,d)),j=this.trim(g.substring(d+1)),k&&j&&(i[k]=j);else{if(g=this.trim(g),!g)continue;0===c&&b?i[b]=g:i[g]=!0}return i},cola.util.parseFunctionArgs=function(a){var b,c,d,e,f,g,h;for(c=a.toString().match(/\([^\(\)]*\)/)[0],h=c.substring(1,c.length-1).split(","),d=[],e=f=0,g=h.length;g>f;e=++f)b=h[e],b=cola.util.trim(b),b&&d.push(b);return d},cola.util.parseListener=function(a){var b,c,d;return d=1,b=a.toString().match(/\([^\(\)]*\)/)[0],c=b.substring(1,b.length-1).split(","),c.length&&"arg"===cola.util.trim(c[0])&&(d=2),a._argsMode=d,d},cola.util.isCompatibleType=function(a,b){if(b===a)return!0;for(;b.__super__;)if(b=b.__super__.constructor,b===a)return!0;return!1},cola.util.delay=function(a,b,c,d){cola.util.cancelDelay(a,b),a["_timer_"+b]=setTimeout(function(){d.call(a)},c)},cola.util.cancelDelay=function(a,b){var c,d;c="_timer_"+b,d=a[c],d&&(delete a[c],clearTimeout(d))},cola.util.waitForAll=function(a,b){var c,d,e,f,g,h,i,j;for(a&&a.length||cola.callback(b,!0),c=0,j=a.length,h={},f=0,g=a.length;g>f;f++)d=a[f],e=cola.uniqueId(),h[e]=!0,i={id:e,complete:function(a){var d;d||(a?h[this.id]&&(delete h[this.id],c++,c===j&&(cola.callback(b,!0),d=!0)):(cola.callback(b,!1),d=!0))}},i.scope=i,d(i)},cola.util.formatDate=function(a,b){return null==a?"":(a instanceof XDate||(a=new XDate(a)),a.toString(b||cola.setting("defaultDateFormat")))},cola.util.formatNumber=function(a,b){return null==a?"":isNaN(a)?a:formatNumber(b||cola.setting("defaultNumberFormat"),a)},cola.util.format=function(a,b){return a instanceof Date?cola.util.formatDate(a,b):isFinite(a)?cola.util.formatNumber(a,b):null===a||void 0===a?"":a},cola.util.queryParams=function(){var a,b,c,d,e,f,g,h,i,j,k,l;if(a=function(a){return decodeURIComponent((a||"").replace(/\+/g," "))},j=(window.location.search||"").substring(1),i={},j.length>0)for(k=j.split("&"),b=d=0,e=k.length;e>d;b=++d)h=k[b],g=h.split("="),c=a(g.shift()),l=a(g.length?g.join("="):null),i.hasOwnProperty(c)?(f=i[c],f instanceof Array?f.push(l):i[c]=[f,l]):i[c]=l;return i},cola.util.pathParams=function(a,b){var c,d,e;return null==b&&(b=0),e=(window.location.pathname||"").replace(/^\//,""),d=e.split("/"),c=d.indexOf(a),c>=0?d[c+1+b]:void 0},keyValuesMap={},dictionaryMap={},cola.util.dictionary=function(a,b){var c,d,e,f;if(null!==b){if(void 0===b)return keyValuesMap[a];for(keyValuesMap[a]=b,dictionaryMap[a]=c={},d=0,e=b.length;e>d;d++)f=b[d],c[f.key||""]=f.value;return c}delete keyValuesMap[a],delete dictionaryMap[a]},cola.util.translate=function(a,b){var c;return null!=(c=dictionaryMap[a])?c[b||""]:void 0},cola.util.isSuperClass=function(a,b){var c;if(!a)return!1;for(;b;){if(b.__super__===a.prototype)return!0;b=null!=(c=b.__super__)?c.constructor:void 0}return!1},cola.version="${version}",uniqueIdSeed=1,cola.uniqueId=function(){return"_id"+uniqueIdSeed++},cola.sequenceNo=function(){return uniqueIdSeed++},cola._EMPTY_FUNC=function(){},"undefined"!=typeof window&&null!==window&&!function(){var a,b,c;cola.browser={},cola.os={},cola.device={},c=window.navigator.userAgent.toLowerCase(),(a=c.match(/webkit\/([\d.]+)/))?(cola.browser.webkit=a[1]||-1,(a=c.match(/chrome\/([\d.]+)/))?cola.browser.chrome=parseFloat(a[1])||-1:(a=c.match(/version\/([\d.]+).*safari/))&&(cola.browser.safari=parseFloat(a[1])||-1),(a=c.match(/qqbrowser\/([\d.]+)/))&&(cola.browser.qqbrowser=parseFloat(a[1])||-1)):(a=c.match(/msie ([\d.]+)/))?cola.browser.ie=parseFloat(a[1])||-1:(a=c.match(/trident/))?cola.browser.ie=11:(a=c.match(/firefox\/([\d.]+)/))?cola.browser.mozilla=parseFloat(a[1])||-1:(a=c.match(/opera.([\d.]+)/))&&(cola.browser.opera=parseFloat(a[1])||-1),(a=c.match(/(iphone|ipad).*os\s([\d_]+)/))?(cola.os.ios=parseFloat(a[2])||-1,cola.device.pad="ipad"===a[1],cola.device.phone=!cola.device.pad):(a=c.match(/(android)\s+([\d.]+)/))?cola.os.android=parseFloat(a[1])||-1:(a=c.match(/(windows)[\D]*([\d]+)/))&&(cola.os.windows=parseFloat(a[1])||-1),(a=c.match(/micromessenger\/([\d.]+)/))&&(cola.browser.weixin=parseFloat(a[1])||-1),cola.device.mobile=!!("ontouchstart"in window&&c.match(/(mobile)/)),cola.device.desktop=!cola.device.mobile,cola.device.mobile&&!cola.os.ios&&(b=768,cola.browser.qqbrowser?cola.device.pad=window.screen.width/2>=b||window.screen.height/2>=b:cola.device.pad=window.screen.width>=b||window.screen.height>=b,cola.device.phone=!cola.device.pad)}(),colaEventRegistry={beforeInit:{},ready:{},settingChange:{},exception:{},beforeRouterSwitch:{},routerSwitch:{}},cola.on=function(a,b){var c,d,e,f,g;if(e=a.indexOf(":"),e>0&&(c=a.substring(e+1),a=a.substring(0,e)),f=colaEventRegistry[a],!f)throw new cola.Exception('Unrecognized event "'+a+'".');if("function"!=typeof b)throw new cola.Exception("Invalid event listener.");return g=f.listeners,d=f.aliasMap,g?(c&&(null!=d?d[c]:void 0)>-1&&cola.off(a+":"+c),g.push(b),e=g.length-1):(f.listeners=g=[b],e=0),c&&(d||(f.aliasMap=d={}),d[c]=e),this},cola.off=function(a,b){var c,d,e,f,g;if(e=a.indexOf(":"),e>0&&(c=a.substring(e+1),a=a.substring(0,e)),f=colaEventRegistry[a],!f)return this;if(g=f.listeners,!g||0===g.length)return this;if(e=-1,c)d=f.aliasMap,e=null!=d?d[c]:void 0,e>-1&&(null!=d&&delete d[c],g.splice(e,1));else if(b){if(e=g.indexOf(b),e>-1&&(g.splice(e,1),d=f.aliasMap))for(c in d)if(d[c]===b){delete d[c];break}}else delete f.listeners,delete f.aliasMap;return this},cola.getListeners=function(a){var b,c;return b=null!=(c=colaEventRegistry[a])?c.listeners:void 0,(null!=b?b.length:void 0)?b:null},cola.fire=function(a,b,c){var d,e,f,g,h,i,j;if(null==c&&(c={}),h=null!=(i=colaEventRegistry[a])?i.listeners:void 0)for(e=0,f=h.length;f>e;e++)if(g=h[e],d=g._argsMode,g._argsMode||(d=cola.util.parseListener(g)),j=1===d?g.call(this,b,c):g.call(this,c,b),j===!1)return!1;return!0},cola.ready=function(a){return this.on("ready",a)},setting={defaultCharset:"utf-8",defaultNumberFormat:"#,##0.##",defaultDateFormat:"yyyy-MM-dd",defaultSubmitDateFormat:"yyyy-MM-dd'T'HH:mm:ss'T'"},cola.setting=function(a,b){var c,d;if("string"==typeof a){if(void 0===b)return setting[a];setting[a]=b,cola.getListeners("settingChange")&&cola.fire("settingChange",cola,{key:a})}else if("object"==typeof a)for(c in a)d=a[c],setting[c]=d,cola.getListeners("settingChange")&&cola.fire("settingChange",cola,{key:c});return this},definedSetting="undefined"!=typeof colaSetting&&null!==colaSetting||("undefined"!=typeof global&&null!==global?global.colaSetting:void 0))for(key in definedSetting)value=definedSetting[key],cola.setting(key,value);exceptionStack=[],cola.Exception=function(){function Exception(a,b){this.message=a,this.error=b,this.error&&"undefined"!=typeof console&&null!==console&&"function"==typeof console.trace&&console.trace(this.error),exceptionStack.push(this),setTimeout(function(a){return function(){exceptionStack.indexOf(a)>-1&&cola.Exception.processException(a)}}(this),50)}return Exception.processException=function(ex){var ex2,scope;if(!(cola.Exception.ignoreAll||(ex&&cola.Exception.removeException(ex),ex instanceof cola.AbortException||cola.fire("exception",cola,{exception:ex})===!1)))if(ex instanceof cola.RunnableException)eval("var fn = function(){"+ex.script+"}"),scope="undefined"!=typeof window&&null!==window?window:this,fn.call(scope);else{if(cola.Exception.ignoreAll)return;try{("undefined"!=typeof document&&null!==document?document.body:void 0)?ex.showException?ex.showException():cola.Exception.showException(ex):ex.safeShowException?ex.safeShowException():cola.Exception.safeShowException(ex)}catch(_error){ex2=_error,cola.Exception.removeException(ex2),ex2.safeShowException?ex2.safeShowException():cola.Exception.safeShowException(ex2)}}},Exception.removeException=function(a){var b;b=exceptionStack.indexOf(a),b>-1&&exceptionStack.splice(b,1)},Exception.safeShowException=function(a){var b;a instanceof cola.Exception||a instanceof Error?b=a.message:(b=a+"","function"==typeof alert&&alert(b))},Exception.showException=function(a){return this.safeShowException(a)},Exception}(),cola.AbortException=function(a){function b(){}return extend(b,a),b}(cola.Exception),cola.RunnableException=function(a){function b(a){this.script=a,b.__super__.constructor.call(this,"[script]")}return extend(b,a),b}(cola.Exception),resourceStore={},sprintf=function(){var a,b,c,d,e,f;for(f=arguments[0],e=2<=arguments.length?slice.call(arguments,1):[],a=b=0,c=e.length;c>b;a=++b)d=e[a],f=f.replace(new RegExp("\\{"+a+"\\}","g"),d);return f},cola.resource=function(){var a,b,c,d,e;if(b=arguments[0],c=2<=arguments.length?slice.call(arguments,1):[],"string"==typeof b)return e=resourceStore[b],null!=e?c.length?sprintf.apply(this,[e].concat(c)):e:(null!=c?c[0]:void 0)||b;a=b;for(b in a)d=a[b],resourceStore[b]=d},cola.ResourceException=function(a){function b(){var a,c;a=arguments[0],c=2<=arguments.length?slice.call(arguments,1):[],b.__super__.constructor.call(this,cola.resource.apply(cola,[a].concat(slice.call(c))))}return extend(b,a),b}(cola.Exception),cola.callback=function(a,b,c){var d;if(a)if("function"==typeof a){if(b)return a.call(this,c)}else{if(d=a.scope||this,!a.delay)return a.complete.call(d,b,c);setTimeout(function(){a.complete.call(d,b,c)},a.delay)}},cola.resource({"cola.date.monthNames":"January,February,March,April,May,June,July,August,September,October,November,December","cola.date.monthNamesShort":"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sept,Oct,Nov,Dec","cola.date.dayNames":"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday","cola.date.dayNamesShort":"S,M,T,W,T,F,S","cola.date.amDesignator":"AM","cola.date.pmDesignator":"PM","cola.date.time":"Time","cola.validator.error.required":"Cannot be empty.","cola.validator.error.length":"Length is not within the correct range.","cola.validator.error.number":"Value is not within the correct range.","cola.validator.error.email":"Email format is incorrect.","cola.validator.error.url":"URL format is incorrect.","cola.validator.error.regExp":"Format is incorrect.","cola.messageBox.info.title":"Information","cola.messageBox.warning.title":"Warning","cola.messageBox.error.title":"Error","cola.messageBox.question.title":"Confirm","cola.message.approve":"Ok","cola.message.deny":"Cancel","cola.pager.info":"Page:{0}/{1}({2})","cola.pager.pageSize":"Page Size:"}),_toJSON=function(a){var b,c,d;if(a)if("object"==typeof a)if(a instanceof cola.Entity||a instanceof cola.EntityList)a=a.toJSON();else if(a instanceof Date)a=cola.util.formatDate(a,cola.setting("defaultSubmitDateFormat"));else{c=a,a={};for(b in c)d=c[b],a[b]=_toJSON(d)}else"function"==typeof a&&(a=void 0);return a},originalAjax=$.ajax,$.ajax=function(a,b){var c,d,e,f;if("object"!=typeof a||b||(b=a),c=b.data){if("object"==typeof c)if(c instanceof cola.Entity||c instanceof cola.EntityList)c=c.toJSON();else if(c instanceof FormData)c instanceof Date&&(c=_toJSON(c));else{e=c,c={};for(d in e)f=e[d],c[d]=_toJSON(f)}else"function"==typeof c&&(c=void 0);b.data=c}return originalAjax.apply(this,[a,b])},tagSplitter=" ",doMergeDefinitions=function(a,b,c){var d,e,f,g;if(a!==b)for(f in b)if(e=b[f],a.$has(f))if(d=a[f],d&&e)for(g in e)!c&&d.hasOwnProperty(g)||(d[g]=e[g]);else a[f]=e;else a[f]=e},hasDefinition=function(a){return this.hasOwnProperty(a.toLowerCase())},getDefinition=function(a){return this[a.toLowerCase()]},cola.preprocessClass=function(a){var b,c,d,e,f,g,h;if((!a.attributes._inited||!a.events._inited)&&(h=null!=(g=a.__super__)?g.constructor:void 0)){if(!h||h.attributes._inited&&h.events._inited||cola.preprocessClass(h),b=a.attributes,!b._inited){b._inited=!0;for(e in b)c=b[e],f=e.toLowerCase(),e!==f&&(null==c&&(c={}),c.name=e,b[f]=c,delete b[e]);b.$has=hasDefinition,b.$get=getDefinition,doMergeDefinitions(b,h.attributes,!1)}if(d=a.events,!d._inited){d._inited=!0;for(e in d)c=d[e],f=e.toLowerCase(),e!==f&&(d[f]=c,delete d[e]);d.$has=hasDefinition,d.$get=getDefinition,doMergeDefinitions(d,h.events,!1)}}},cola.Element=function(){function Element(a){var b,c,d,e,f,g,h,i;e=this.constructor,e.attributes._inited&&e.events._inited||cola.preprocessClass(e),this._constructing=!0,this._scope=(null!=a?a.scope:void 0)||cola.currentScope,d=e.attributes;for(b in d)c=d[b],void 0!==(null!=c?c.defaultValue:void 0)&&(c.setter?c.setter.call(this,c.defaultValue,b):this["_"+((null!=c?c.name:void 0)||b)]=c.defaultValue);if(e._constructors)for(i=e._constructors,g=0,h=i.length;h>g;g++)f=i[g],f.call(this);a&&this.set(a,!0),delete this._constructing,this.fire("create",this)}return Element.mixin=function(a,b){var c,d,e,f,g,h;for(h in b)e=b[h],"attributes"===h?(g=e,g&&(c=null!=a.attributes?a.attributes:a.attributes={},doMergeDefinitions(c,g,!0))):"events"===h?(f=e,f&&(d=null!=a.events?a.events:a.events={},doMergeDefinitions(d,f,!0))):"constructor"===h?a._constructors?a._constructors.push(e):a._constructors=[e]:"destroy"===h?a._destructors?a._destructors.push(e):a._destructors=[e]:a.prototype[h]=e},Element.attributes={model:{readOnly:!0,getter:function(){return this._scope}},tag:{getter:function(){return this._tag?this._tag.join(tagSplitter):null},setter:function(a){var b,c,d,e,f,g,h;if(this._tag)for(f=this._tag,b=0,c=f.length;c>b;b++)g=f[b],cola.tagManager.unreg(g,this);if(a)for(this._tag=h=a.split(tagSplitter),e=0,d=h.length;d>e;e++)g=h[e],cola.tagManager.reg(g,this);else this._tag=null}},userData:null},Element.events={create:null,attributeChange:null,destroy:null},Element.prototype.destroy=function(){var a,b,c,d,e,f,g,h;if(a=this.constructor,a._destructors)for(g=a._destructors,d=0,e=g.length;e>d;d++)b=g[d],b.call(this);if(this._elementAttrBindings){h=this._elementAttrBindings;for(f in h)c=h[f],c.destroy()}this.fire("destroy",this),this._tag&&this._set("tag",null)},Element.prototype.get=function(a,b){var c,d,e,f,g;if(a.indexOf(".")>-1){for(g=a.split("."),e=this,c=0,d=g.length;d>c&&(f=g[c],e=e instanceof cola.Element?e._get(f,b):"function"==typeof e.get?e.get(f):e[f],null!=e);c++);return e}return this._get(a,b)},Element.prototype._get=function(a,b){var c;if(!this.constructor.attributes.$has(a)){if(b)return;throw new cola.Exception('Unrecognized Attribute "'+a+'".')}return c=this.constructor.attributes[a.toLowerCase()],(null!=c?c.getter:void 0)?c.getter.call(this,a):this["_"+a]},Element.prototype.set=function(a,b,c){var d,e,f,g,h,i,j;if("string"==typeof a)if(a.indexOf(".")>-1){for(j=a.split("."),h=this,e=f=0,g=j.length;g>f&&(i=j[e],h=h instanceof cola.Element?h._get(i,c):h[i],null!=h)&&!(e>=j.length-2);e=++f);if(null==h&&!c)throw new cola.Exception('Cannot set attribute "'+i.slice(0,e).join(".")+'" of undefined.');h instanceof cola.Element?h._set(j[j.length-1],b,c):"function"==typeof h.set?h.set(j[j.length-1],b):h[j[j.length-1]]=b}else this._set(a,b,c);else{d=a,c=b;for(a in d)this.set(a,d[a],c)}return this},Element.prototype._set=function(a,b,c){var d,e,f,g,h,i,j,k;if("string"==typeof b&&this._scope&&123===b.charCodeAt(0)&&(i=cola._compileText(b),(null!=i?i.length:void 0)>0&&(b=i[0])),this.constructor.attributes.$has(a)){if(e=this.constructor.attributes[a.toLowerCase()]){if(e.readOnly){if(c)return;throw new cola.Exception('Attribute "'+a+'" is readonly.')}if(!this._constructing&&e.readOnlyAfterCreate){if(c)return;throw new cola.Exception('Attribute "'+a+'" cannot be changed after create.')}}}else if(b){if(f=a,h=f.indexOf(":"),h>0&&(f=f.substring(0,h)),this.constructor.events.$has(f)){if(b instanceof cola.Expression)return g=b,k=this._scope,void this.on(a,function(a,b){g.evaluate(k,"never",{vars:{$self:a,$arg:b,$dom:b.dom,$event:b.event}})},c);if("function"==typeof b)return void this.on(a,b);if("string"==typeof b&&(d=null!=(j=this._scope)?j.action(b):void 0))return void this.on(a,d)}if(c)return;throw new cola.Exception('Unrecognized Attribute "'+a+'".')}this._doSet(a,e,b),this._eventRegistry&&this.getListeners("attributeChange")&&this.fire("attributeChange",this,{attribute:a})},Element.prototype._doSet=function(a,b,c){var d,e,f,g;if(!this._duringBindingRefresh&&this._elementAttrBindings&&(d=this._elementAttrBindings[a],d&&(d.destroy(),delete this._elementAttrBindings[a])),c instanceof cola.Expression&&cola.currentScope&&(f=c,g=cola.currentScope,f.isStatic?c=f.evaluate(g,"never"):(d=new cola.ElementAttrBinding(this,a,f,g),null==this._elementAttrBindings&&(this._elementAttrBindings={}),e=this._elementAttrBindings,e&&(e[a]=d),c=d.evaluate())),b){if("boolean"===b.type?null!=c&&"boolean"!=typeof c&&(c="true"===c):"number"===b.type&&null!=c&&"number"!=typeof c&&(c=parseFloat(c)||0),b["enum"]&&b["enum"].indexOf(c)<0)throw new cola.Exception('The value "'+c+'" of attribute "'+a+'" is out of range.');if(b.setter)return void b.setter.call(this,c,a)}this["_"+((null!=b?b.name:void 0)||a)]=c},Element.prototype._on=function(a,b,c,d){var e,f,g,h,i;if(a=a.toLowerCase(),f=this.constructor.events[a],this._eventRegistry?h=this._eventRegistry[a]:this._eventRegistry={},h||(this._eventRegistry[a]=h={}),d&&(null==h.onceListeners&&(h.onceListeners=[]),h.onceListeners.push(b)),i=h.listeners,e=h.aliasMap,i){if((null!=f?f.singleListener:void 0)&&i.length)throw new cola.Exception('Multi listeners is not allowed for event "'+a+'".');c&&(null!=e?e[c]:void 0)>-1&&cola.off(a+":"+c),i.push(b),g=i.length-1}else h.listeners=i=[b],g=0;c&&(e||(h.aliasMap=e={}),e[c]=g)},Element.prototype.on=function(a,b,c){var d,e;if(e=a.indexOf(":"),e>0&&(d=a.substring(e+1),a=a.substring(0,e)),!this.constructor.events.$has(a))throw new cola.Exception('Unrecognized event "'+a+'".');if("function"!=typeof b)throw new cola.Exception("Invalid event listener.");return this._on(a,b,d,c),this},Element.prototype.one=function(a,b){return this.on(a,b,!0)},Element.prototype._off=function(a,b,c){var d,e,f,g,h;if(a=a.toLowerCase(),f=this._eventRegistry[a],!f)return this;if(g=f.listeners,!g||!g.length)return this;if(e=-1,c||b){if(c)d=f.aliasMap,e=null!=d?d[c]:void 0,e>-1&&(null!=d&&delete d[c],b=g[e],g.splice(e,1));else if(b&&(e=g.indexOf(b),e>-1&&(g.splice(e,1),d=f.aliasMap)))for(c in d)if(d[c]===b){delete d[c];break}f.onceListeners&&b&&(h=f.onceListeners,e=h.indexOf(b),e>-1&&(h.splice(e,1),h.length||delete f.onceListeners))}else delete f.listeners,delete f.aliasMap},Element.prototype.off=function(a,b){var c,d;return this._eventRegistry?(d=a.indexOf(":"),d>0&&(c=a.substring(d+1),a=a.substring(0,d)),this._off(a,b,c),this):this},Element.prototype.getListeners=function(a){var b,c;return null!=(b=this._eventRegistry)&&null!=(c=b[a.toLowerCase()])?c.listeners:void 0},Element.prototype.fire=function(eventName,self,arg){var argsMode,l,len1,len2,listener,listenerRegistry,listeners,o,oldScope,onceListeners,result,retValue;if(this._eventRegistry){if(eventName=eventName.toLowerCase(),result=void 0,listenerRegistry=this._eventRegistry[eventName],listenerRegistry&&(listeners=listenerRegistry.listeners)){arg?arg.model=this._scope:arg={model:this._scope},oldScope=cola.currentScope,cola.currentScope=this._scope;try{for(l=0,len1=listeners.length;len1>l&&(listener=listeners[l],"function"==typeof listener?(argsMode=listener._argsMode,listener._argsMode||(argsMode=cola.util.parseListener(listener)),retValue=1===argsMode?listener.call(self,self,arg):listener.call(self,arg,self)):"string"==typeof listener&&(retValue=function(_this){return function(){return eval(listener)}}(this)()),void 0!==retValue&&(result=retValue),retValue!==!1);l++);}finally{cola.currentScope=oldScope}if(listenerRegistry.onceListeners)for(onceListeners=listenerRegistry.onceListeners.slice(),delete listenerRegistry.onceListeners,o=0,len2=onceListeners.length;len2>o;o++)listener=onceListeners[o],this.off(eventName,listener)}return result}},Element}(),cola.Definition=function(a){function b(a){var c;(null!=a?a.name:void 0)&&(this._name=a.name,delete a.name,c=(null!=a?a.scope:void 0)||cola.currentScope,c&&c.data.regDefinition(this)),b.__super__.constructor.call(this,a)}return extend(b,a),b.attributes={name:{readOnlyAfterCreate:!0}},b}(cola.Element),cola.Element.createGroup=function(a,b){var c,d,e,f;if(b)for(a=[],d=0,e=a.length;e>d;d++){if(c=a[d],c._scope&&!c._model)for(f=c._scope;f;){if(f instanceof cola.Scope){c._model=f;break}f=f.parent}c._model===b&&a.push(c)}else a=a?a.slice(0):[];return a.set=function(b,c){var d,e,f;for(f=0,e=a.length;e>f;f++)d=a[f],d.set(b,c);return this},a.on=function(b,c,d){var e,f,g;for(g=0,f=a.length;f>g;g++)e=a[g],e.on(b,c,d);return this},a.off=function(b){var c,d,e;for(e=0,d=a.length;d>e;e++)c=a[e],c.off(b);return this},a},cola.tagManager={registry:{},reg:function(a,b){var c;c=this.registry[a],c?c.push(b):this.registry[a]=[b]},unreg:function(a,b){var c,d;b?(c=this.registry[a],c&&(d=c.indexOf(b),d>-1&&(0===d&&1===c.length?delete this.registry[a]:c.splice(d,1)))):delete this.registry[a]},find:function(a){return this.registry[a]}},cola.tag=function(a){var b;return b=cola.tagManager.find(a),cola.Element.createGroup(b)},typeRegistry={},cola.registerType=function(a,b,c){var d;d=typeRegistry[a]||(typeRegistry[a]={}),d[b]=c},cola.registerTypeResolver=function(a,b){var c;c=typeRegistry[a]||(typeRegistry[a]={}),null==c._resolvers&&(c._resolvers=[]),c._resolvers.push(b)},cola.resolveType=function(a,b,c){var d,e,f,g,h,i;if(d=null,e=typeRegistry[a]){if(d=e[(null!=b?b.$type:void 0)||"_default"],!d&&e._resolvers)for(h=e._resolvers,f=0,g=h.length;g>f;f++)if(i=h[f],d=i(b)){if(c&&!cola.util.isCompatibleType(c,d))throw new cola.Exception("Incompatiable class type.");break}return d}},cola.create=function(a,b,c){var d;return"string"==typeof b&&(b={$type:b}),new(d=cola.resolveType(a,b,c))(b)},XDate&&("function"==typeof $&&$(function(){var a;XDate.locales[""]=a={},cola.resource("cola.date.monthNames")&&(a.monthNames=cola.resource("cola.date.monthNames",6).split(",")),cola.resource("cola.date.monthNamesShort")&&(a.monthNamesShort=cola.resource("cola.date.monthNamesShort").split(",")),cola.resource("cola.date.dayNames")&&(a.dayNames=cola.resource("cola.date.dayNames").split(",")),cola.resource("cola.date.dayNamesShort")&&(a.dayNamesShort=cola.resource("cola.date.dayNamesShort").split(",")),cola.resource("cola.date.amDesignator")&&(a.amDesignator=cola.resource("cola.date.amDesignator")),cola.resource("cola.date.pmDesignator")&&(a.pmDesignator=cola.resource("cola.date.pmDesignator"))}),XDate.parsers.push(function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(!(a.indexOf("||")<0)){for(o=a.split("||"),f=o[0],c=o[1],o={y:{len:0,value:1900},M:{len:0,value:1},d:{len:0,value:1},h:{len:0,value:0},m:{len:0,value:0},s:{len:0,value:0}},q=[],g=!1,i=!1,h=0;h<f.length;)b=f.charAt(h),'"'===b?(g=!0,i===b?i=!1:i||(i=b)):!i&&o[b]?(0===o[b].len&&q.push(b),o[b].len++):g=!0,h++;if(r=!1,g){if(e=c.split(/\D+/),""===e[e.length-1]&&e.splice(e.length-1,1),""===e[0]&&e.splice(0,1),q.length===e.length)for(r=!0,h=m=0,l=q.length;l>m;h=++m)p=q[h],o[p].value=parseInt(e[h],10)}else if(c.match(/^\d{2,14}$/))for(r=!0,s=0,j=0,k=q.length;k>j;j++)p=q[j],n=o[p],n.len&&(d=c.substring(s,s+n.len),n.value=parseInt(d,10),s+=n.len);return r?new XDate(o.y.value,o.M.value-1,o.d.value,o.h.value,o.m.value,o.s.value):void 0}})),cola._compileText=function(a){var b,c,d,e,f;for(d=0,f=0;(f=a.indexOf("{{",d))>-1&&(c=digestExpression(a,f+2));)f>d&&(e||(e=[]),e.push(a.substring(d,f))),b=cola._compileExpression(c,c.indexOf(" in ")>0?"repeat":void 0),e?e.push(b):e=[b],d=f+c.length+4;return e?(d<a.length-1&&e.push(a.substring(d)),e):null},digestExpression=function(a,b){var c,d,e,f,g;for(g=b,e=a.length,d=0;e>b;){if(c=a.charCodeAt(b),125!==c||f)d=0,39!==c&&34!==c||(f?f===c&&(f=!1):f=c);else{if(1===d)return a.substring(g,b-1);d++}b++}},cola._compileExpression=function(a,b){var c,d,e;if(!a)return null;if("repeat"===b)if(e=a.indexOf(" in "),e>0){if(c=a.substring(0,e),c.match(cola.constants.VARIABLE_NAME_REGEXP)){if(a=a.substring(e+4),!a)return null;d=new cola.Expression(a,!0),d.raw=c+" in "+d.raw,d.repeat=!0,d.alias=c}if(!d)throw new cola.Exception('"'+a+'" is not a valid expression.')}else d=new cola.Expression(a,!0),d.repeat=!0,d.alias="item";else if("alias"===b){if(e=a.indexOf(" as "),e>0&&(c=a.substring(e+4),c&&c.match(cola.constants.VARIABLE_NAME_REGEXP))){if(a=a.substring(0,e),!a)return null;d=new cola.Expression(a,!0),d.raw=d.raw+" as "+c,d.setAlias=!0,d.alias=c}if(!d)throw new cola.Exception('"'+a+'" should be a alias expression.')}else d=new cola.Expression(a,!0);return d},cola.Expression=function(){function Expression(a){var b,c,d,e,f,g,h,i;if(this.raw=a,c=a.indexOf(" on "),c>0&&c<a.length-1)for(this.hasDefinedPath=!0,h=a.substring(c+4),a=a.substring(0,c),i=[],g=h.split(/[,;]/),d=0,e=g.length;e>d;d++)f=g[d],f=cola.util.trim(f),f&&i.push(f);b=a.charCodeAt(0),61===b&&(a=a.substring(1),this.isStatic=!0),this.compile(a),i&&(this.paths=i),this.writeable=("MemberExpression"===this.type||"Identifier"===this.type)&&!this.hasCallStatement}return Expression.prototype.compile=function(a){var b,c,d,e;d=function(b,c,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t;switch(t=b.type){case"MemberExpression":case"Identifier":case"ThisExpression":"MemberExpression"===t?(d(b.object,c,e,!1,g),e.length?e.push(b.property.name):(c.push("."),c.push(b.property.name))):e.push(b.name);break;case"CallExpression":if(g.hasCallStatement=!0,i=b.callee,"Identifier"===i.type)c.push('scope.action("'),c.push(b.callee.name),
c.push('").call(scope');else{if("MemberExpression"!==i.type)throw new cola.Exception('"'+a+'" invalid callee.');d(i.object,c,e,!0,g),c.push("."),c.push(i.property.name),c.push("(")}if(null!=(q=b.arguments)?q.length:void 0)for(r=b.arguments,k=l=0,m=r.length;m>l;k=++l)h=r[k],c.push(","),d(h,c,e,!0,g);c.push(")");break;case"Literal":c.push(b.raw);break;case"BinaryExpression":case"LogicalExpression":c.push("("),d(b.left,c,e,!0,g),c.push(b.operator),d(b.right,c,e,!0,g),c.push(")");break;case"UnaryExpression":c.push(b.operator),d(b.argument,c,e,!0,g);break;case"ConditionalExpression":c.push("("),d(b.test,c,e,!0,g),c.push("?"),d(b.consequent,c,e,!0,g),c.push(":"),d(b.alternate,c,e,!0,g),c.push(")");break;case"ArrayExpression":for(c.push("["),s=b.elements,k=o=0,n=s.length;n>o;k=++o)j=s[k],k>0&&c.push(","),d(j,c,e,!0,g);c.push("]")}f&&e.length&&(64===e[0].charCodeAt(0)&&(g.isDyna=!0,null==g.dynaPathMap&&(g.dynaPathMap={}),g.dynaPathMap[e[0].substring(1)]=e.slice(0)),p=e.join("."),g.paths?g.paths.push(p):g.paths=[p],c.push("_getData(scope,'"),c.push(p),c.push("',loadMode,dataCtx)"),e.splice(0,e.length))},e=jsep(a),this.type=e.type,b=[],c=[],d(e,b,c,!0,this),this.script=b.join("")},Expression.prototype.evaluate=function(scope,loadMode,dataCtx){var dynaPath,originPath,path,ref,retValue;if(this.dynaPathMap){this.pathReplacement={},ref=this.dynaPathMap;for(dynaPath in ref)path=ref[dynaPath],originPath=path.join("."),path[0]="@"+_getData(scope,dynaPath,"never",dataCtx),this.pathReplacement[originPath]=path.join(".")}return retValue=eval(this.script),retValue instanceof cola.Chain&&(retValue=retValue._data),retValue},Expression.prototype.getParentPathInfo=function(){var a,b,c;return void 0!==this.parentPath?this.parentPath:(this.writeable&&(c=this.paths[0],"Identifier"===this.type?b={parentPath:null,property:c}:(a=c.lastIndexOf("."),b={parentPath:c.substring(0,a),property:c.substring(a+1)})),b)},Expression.prototype.toString=function(){return this.raw},Expression}(),_getData=function(a,b,c,d){var e;return this.pathReplacement&&(b=this.pathReplacement[b]||b),e=a.get(b,c,d),void 0===e&&(null!=d?d.vars:void 0)&&(e=d.vars[b]),e},cola.registerTypeResolver("validator",function(a){return a&&a.$type?cola[cola.util.capitalize(a.$type)+"Validator"]:void 0}),cola.registerTypeResolver("validator",function(a){return"function"==typeof a?cola.CustomValidator:void 0}),cola.Validator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={message:null,messageType:{defaultValue:"error","enum":["error","warning","info"]},disabled:null,validateEmptyValue:null},b.prototype._getDefaultMessage=function(a){return'"'+a+'" is not a valid value.'},b.prototype._parseValidResult=function(a,b){var c;return"boolean"==typeof a?a?a=null:(c=this._message,null==c&&(c=this._getDefaultMessage(b)),a={type:this._messageType,text:c}):a&&"string"==typeof a&&(a={type:this._messageType,text:a}),a},b.prototype.validate=function(a){var b;if(this._validateEmptyValue||null!=a&&""!==a)return b=this._validate(a),this._parseValidResult(b,a)},b}(cola.Definition),cola.RequiredValidator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={validateEmptyValue:{defaultValue:!0},trim:{defaultValue:!0}},b.prototype._getDefaultMessage=function(a){return cola.resource("cola.validator.error.required",a)},b.prototype._validate=function(a){return"string"!=typeof a?null!=a:(this._trim&&(a=cola.util.trim(a)),!!a)},b}(cola.Validator),cola.NumberValidator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={min:null,minInclude:{defaultValue:!0},max:null,maxInclude:{defaultValue:!0}},b.prototype._getDefaultMessage=function(a){return cola.resource("cola.validator.error.number",a)},b.prototype._validate=function(a){var b;return b=!0,null!=this._min&&(b=this._minInclude?a>=this._min:a>this._min),b&&null!=this._max&&(b=this._maxInclude?a<=this._max:a<this._max),b},b}(cola.Validator),cola.LengthValidator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={min:null,max:null},b.prototype._getDefaultMessage=function(a){return cola.resource("cola.validator.error.length",a)},b.prototype._validate=function(a){var b,c;return"string"==typeof a||"number"==typeof a?(c=!0,b=(a+"").length,null!=this._min&&(c=b>=this._min),c&&null!=this._max&&(c=b<=this._max),c):!0},b}(cola.Validator),cola.RegExpValidator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={regExp:null,mode:{defaultValue:"white","enum":["white","black"]}},b.prototype._getDefaultMessage=function(a){return cola.resource("cola.validator.error.regExp",a)},b.prototype._validate=function(a){var b,c;return b=this._regExp,b&&"string"==typeof a?(!b instanceof RegExp&&(b=new RegExp(b)),c=!0,c=!!a.match(b),"black"===this._mode&&(c=!c),c):!0},b}(cola.Validator),cola.EmailValidator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype._getDefaultMessage=function(a){return cola.resource("cola.validator.error.email",a)},b.prototype._validate=function(a){return"string"==typeof a?!!a.match(/^([a-z0-9]*[-_\.]?[a-z0-9]+)*@([a-z0-9]*[-_]?[a-z0-9]+)+[\.][a-z]{2,3}([\.][a-z]{2})?$/i):!0},b}(cola.Validator),cola.UrlValidator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype._getDefaultMessage=function(a){return cola.resource("cola.validator.error.email",a)},b.prototype._validate=function(a){return"string"==typeof a?!!a.match(/^(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/i):!0},b}(cola.Validator),cola.AsyncValidator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={async:{defaultValue:!0}},b.prototype.validate=function(a,b){var c;if(this._validateEmptyValue||null!=a&&""!==a)return this._async?c=this._validate(a,{complete:function(a){return function(c,d){c&&(d=a._parseValidResult(d)),cola.callback(b,c,d)}}(this)}):(c=this._validate(a),c=this._parseValidResult(c),cola.callback(b,!0,c)),c},b}(cola.Validator),cola.AjaxValidator=function(a){function b(a){b.__super__.constructor.call(this,a),this._ajaxService=new cola.AjaxService}return extend(b,a),b.attributes={url:null,method:null,ajaxOptions:null,data:null},b.prototype._validate=function(a,b){var c,d,e,f,g,h;if(g=this._data,null==g||":data"===g)g=a;else if("object"==typeof g){f={};for(e in g)h=g[e],":data"===h&&(h=a),f[e]=h;g=f}return d={async:!!b,url:this._url,data:g,method:this._method,ajaxOptions:this._ajaxOptions},c=new cola.AjaxServiceInvoker(this._ajaxService,d),b?c.invokeAsync(b):c.invokeSync()},b}(cola.AsyncValidator),cola.CustomValidator=function(a){function b(a){"function"==typeof a?(b.__super__.constructor.call(this),this.set({func:a,async:cola.util.parseFunctionArgs(a).length>1})):b.__super__.constructor.call(this,a)}return extend(b,a),b.attributes={async:{defaultValue:!1},validateEmptyValue:{defaultValue:!0},func:null},b.prototype._validate=function(a,b){return this._async&&b?void(this._func?this._func(a,b):cola.callback(b,!0)):"function"==typeof this._func?this._func(a):void 0},b}(cola.AsyncValidator),cola.DataType=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b}(cola.Definition),cola.BaseDataType=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b}(cola.DataType),cola.StringDataType=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.toText=function(a){return null!=a?a+"":""},b.prototype.parse=function(a){return a},b}(cola.BaseDataType),cola.NumberDataType=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={isInteger:null},b.prototype.parse=function(a){var b;return a?"number"==typeof a?this._isInteger?Math.round(a):a:(b=this._isInteger?Math.round(parseInt(a,10)):parseFloat(a,10),isNaN(b)?0:b):0},b}(cola.BaseDataType),cola.BooleanDataType=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.parse=function(a){return a?"boolean"==typeof a?a:["true","on","yes","y","1"].indexOf((a+"").toLowerCase())>-1:!1},b}(cola.BaseDataType),cola.DateDataType=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.parse=function(a){var b;return a?(b=new XDate(a),b.toDate()):new Date(NaN)},b}(cola.BaseDataType),cola.JSONDataType=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.toText=function(a){return JSON.stringify(a)},b.prototype.parse=function(a){return"string"==typeof a?JSON.parse(a):a},b}(cola.DataType),cola.EntityDataType=function(a){function b(a){this._properties=new cola.util.KeyedArray,b.__super__.constructor.call(this,a)}return extend(b,a),b.attributes={properties:{setter:function(a){var b,c,d,e,f,g;if(this._properties.clear(),a instanceof Array){for(f=[],c=0,d=a.length;d>c;c++)e=a[c],f.push(this.addProperty(e));return f}g=[];for(e in a)b=a[e],b?(b instanceof cola.Property||(b.property=e),g.push(this.addProperty(b))):g.push(void 0);return g}}},b.events={beforeCurrentChange:null,currentChange:null,beforeDataChange:null,dataChange:null,entityCreate:null,beforeEntityRemove:null,entityRemove:null,beforeEntityInsert:null,entityInsert:null,beforeEntityDelete:null,entityDelete:null},b.prototype.addProperty=function(a){if(a instanceof cola.Property){if(a._owner&&a._owner!==this)throw new cola.Exception("Property("+a._property+") is already belongs to anthor DataType.")}else a="string"==typeof a?new cola.Property({property:a}):new cola.Property(a);return this._properties.get(a._property)&&this.removeProperty(a._property),this._properties.add(a._property,a),this._properties.add(a._property,a),a._owner=this,a},b.prototype.removeProperty=function(a){return a instanceof cola.Property?this._properties.remove(a._property):a=this._properties.remove(a),delete a._owner,a},b.prototype.getProperty=function(a){var b,c,d,e;return b=a.indexOf("."),b>0?(c=a.substring(0,b),d=a.substring(b+1),e=this._getProperty(c),(null!=e?e._dataType:void 0)&&null!=e?e._dataType.getProperty(d):void 0):this._getProperty(a)},b.prototype._getProperty=function(a){return this._properties.get(a)},b.prototype.getProperties=function(){return this._properties},b}(cola.DataType),cola.DataType.dataTypeSetter=function(a){var b,c;if("string"==typeof a){if(b=a,c=this._scope,a=c?c.dataType(b):cola.DataType.defaultDataTypes[b],!a)throw new cola.Exception('Unrecognized DataType "'+b+'".')}else null==a||a instanceof cola.DataType||(a=new cola.EntityDataType(a));this._dataType=a||null},cola.Property=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={property:{readOnlyAfterCreate:!0},name:{setter:function(a){this._name=a,null==this._property&&(this._property=a)}},owner:{readOnly:!0},caption:null,dataType:{setter:cola.DataType.dataTypeSetter},description:null,provider:{setter:function(a){null==a||a instanceof cola.Provider||(a=new cola.Provider(a)),this._provider=a}},defaultValue:null,aggregated:{readOnlyAfterCreate:!0},validators:{setter:function(a){var b,c,d,e;if(b=function(a){return function(b){b instanceof cola.Validator||(b=cola.create("validator",b,cola.Validator)),a._validators.push(b)}}(this),delete this._validators,a)if(this._validators=[],"string"==typeof a)e=cola.create("validator",a,cola.Validator),b(e);else if(a instanceof Array)for(c=0,d=a.length;d>c;c++)e=a[c],b(e);else b(a)}},rejectInvalidValue:null},b.events={beforeWrite:null,write:null,beforeLoad:null,loaded:null},b}(cola.Definition),cola.DataType.jsonToEntity=function(a,b,c,d){var e;if(void 0===c&&(c=a instanceof Array?!0:"object"==typeof a&&a.hasOwnProperty("$data")?a.$data instanceof Array:"object"==typeof a&&a.hasOwnProperty("data$")?a.data$ instanceof Array:!1),c)return e=new cola.EntityList(null,b),d&&(e.pageSize=d),e.fillData(a),e;if(a instanceof Array)throw new cola.Exception('Unmatched DataType. expect "Object" but "Array".');return new cola.Entity(a,b)},cola.DataType.jsonToData=function(a,b,c,d){var e;return e=b instanceof cola.StringDataType&&"string"!=typeof a||b instanceof cola.BooleanDataType&&"boolean"!=typeof a||b instanceof cola.NumberDataType&&"number"!=typeof a||b instanceof cola.DateDataType&&!(a instanceof Date)?b.parse(a):b instanceof cola.EntityDataType?cola.DataType.jsonToEntity(a,b,c,d):b&&"object"==typeof a?b.parse(a):a},cola.DataType.defaultDataTypes=defaultDataTypes={string:new cola.StringDataType({name:"string"}),"int":new cola.NumberDataType({name:"int",isInteger:!0}),"float":new cola.NumberDataType({name:"float"}),"boolean":new cola.BooleanDataType({name:"boolean"}),date:new cola.DateDataType({name:"date"}),json:new cola.JSONDataType({name:"json"}),entity:new cola.EntityDataType({name:"entity"})},defaultDataTypes.number=defaultDataTypes["float"],_getEntityPath=function(){var a,b,c,d;if(this._pathCache)return this._pathCache;if(a=this.parent,null!=a){for(c=[],d=this;null!=a;)b=d._parentProperty,b&&c.push(b),d=a,a=a.parent;return this._pathCache=c=c.reverse(),c}},_watch=function(a,b){var c;a instanceof Function&&(b=a,a="*"),null==this._watchers&&(this._watchers={}),c=this._watchers[a],c?c.watchers.push(b):this._watchers[a]={path:a.split("."),watchers:[b]}},_unwatch=function(a,b){var c,d,e,f,g,h,i;if(this._watchers)if(a instanceof Function&&(b=a,a="*"),i=this._watchers,b){if(c=i[a]){for(g=c.watchers,d=e=0,f=g.length;f>e;d=++e)if(h=g[d],h===b){c.watchers.splice(d,1);break}c.watchers.length||delete i[a]}}else delete i[a]},_triggerWatcher=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;if(this._watchers){l=this._watchers;for(j in l){if(d=l[j],o=!1,"**"===j)o=!0;else if("*"===j)o=a.length===d.path.length;else if(k=d.path,k.length>=a.length)for(o=!0,e=f=0,g=k.length;g>f;e=++f){if(n=k[e],e===k.length-1){if("**"===n)break;if("*"===n){o=e===a.length-1;break}}if(n!==a[e]){o=!1;break}}if(o)for(m=d.watchers,i=0,h=m.length;h>i;i++)p=m[i],p.call(this,a,b,c)}}this.parent&&(this._parentProperty&&a.unshift(this._parentProperty),this.parent._triggerWatcher(a,b,c))},_matchValue=function(a,b){return b.strict?b.caseSensitive||"string"!=typeof b.value?a===b.value:(a+"").toLowerCase()===b.value:b.caseSensitive?(a+"").indexOf(b.value)>-1:(a+"").toLowerCase().indexOf(b.value)>-1},cola._trimCriteria=function(a,b){var c,d;if(null==b&&(b={}),null==a)return a;if(cola.util.isSimpleValue(a))b.caseSensitive||(a=(a+"").toLowerCase()),a={$:{value:a,caseSensitive:b.caseSensitive,strict:b.strict}};else if("object"==typeof a)for(c in a)d=a[c],"string"==typeof d?a[c]={value:d.toLowerCase(),caseSensitive:b.caseSensitive,strict:b.strict}:(null==d.caseSensitive&&(d.caseSensitive=b.caseSensitive),d.caseSensitive||"string"!=typeof d.value||(d.value=d.value.toLowerCase()),null==d.strict&&(d.strict=b.strict),d.strict||(d.value=d.value?d.value+"":""));return a},_filterCollection=function(a,b,c){var d;return null==c&&(c={}),a?(d=[],d.$origin=a.$origin||a,c.mode||(a instanceof cola.EntityList||a[0]instanceof cola.Entity?c.mode="entity":c.mode="json"),cola.each(a,function(a){var e;return e=c.deep?[]:null,(null==b||_filterEntity(a,b,c,e))&&(d.push(a),c.one)?!1:void(e&&Array.prototype.push.apply(d,e))}),d):null},_filterEntity=function(a,b,c,d){var e,f,g,h,i,j,k;if(null==c&&(c={}),e=function(a){var e;"entity"===c.mode?a instanceof cola.EntityList?(e=_filterCollection(a,b,c),Array.prototype.push.apply(d,e)):a instanceof cola.Entity&&(e=[],_filterEntity(a,b,c,e),Array.prototype.push.apply(d,e)):"array"==typeof a?(e=_filterCollection(a,b,c),Array.prototype.push.apply(d,e)):"object"!=typeof a||a instanceof Date||(e=[],_filterEntity(a,b,c,e),Array.prototype.push.apply(d,e))},!a)return!1;if(c.mode||(c.mode=a instanceof cola.Entity?"entity":"json"),g=!1,null==b)g=!0;else if("object"==typeof b){if(cola.util.isSimpleValue(a))b.$&&(g=_matchValue(k,b.$));else for(i in b)if(j=b[i],f=null,"$"===i){f="entity"===c.mode?a._data:a;for(h in f)if(k=f[h],_matchValue(k,j)&&(g=!0,!d))break;if(g&&!d)break}else if("entity"===c.mode){if(_matchValue(a.get(i),j)&&(g=!0,!d))break}else if(_matchValue(a[i],j)&&(g=!0,!d))break}else"function"==typeof b&&(g=b(a,c));if(d&&(!c.one||!g)){null==f&&(f="entity"===c.mode?a._data:a);for(h in f)k=f[h],e(k)}return g},_sortCollection=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;if(!a)return null;if(null==b||"$none"===b)return a;if(a instanceof cola.EntityList&&(i=a,a=a.toArray(),a.$origin=i),b){if("$reverse"===b)return a.reverse();if("string"==typeof b){for(f=[],m=b.split(","),g=0,h=m.length;h>g;g++)j=m[g],d=j.charCodeAt(0),l=!1,43===d?k=j.substring(1):45===d?(k=j.substring(1),l=!0):k=j,f.push({prop:k,desc:l});b=function(a,b){var d,e,g,h,i,j;for(g=0,e=f.length;e>g;g++)if(d=f[g],i=null,j=null,k=d.prop){if("$random"===k)return 2*Math.random()-1;if(i=a instanceof cola.Entity?a.get(k):cola.util.isSimpleValue(a)?a:a[k],c||"string"!=typeof i||(i=i.toLowerCase()),j=b instanceof cola.Entity?b.get(k):cola.util.isSimpleValue(b)?b:b[k],c||"string"!=typeof j||(j=j.toLowerCase()),h=0,null==i?h=-1:null==j?h=1:i>j?h=1:j>i&&(h=-1),0!==h)return d.desc?0-h:h}else if(h=0,null==a?h=-1:null==b?h=1:a>b?h=1:b>a&&(h=-1),0!==h)return d.desc?0-h:h;return 0}}}else b=function(a,b){var d;return d=0,c||("string"==typeof a&&(a=a.toLowerCase()),"string"==typeof b&&(b=b.toLowerCase())),null==a?d=-1:null==b?d=1:a>b?d=1:b>a&&(d=-1),d};return e=function(a,c){return b(a,c)},a.sort(e)},cola.Entity=function(){function a(a,b){var c,d,e,f,g;if(this.id=cola.uniqueId(),this.timestamp=cola.sequenceNo(),this.dataType=b,c={},b)for(g=b.getProperties().elements,d=0,e=g.length;e>d;d++)f=g[d],null!=f._defaultValue&&(c[f._property]=f._defaultValue);this._data=c,null!=a&&(this._disableWriteObservers++,this.set(a),a.state$&&(this.state=a.state$),this._disableWriteObservers--),b&&b.fire("entityCreate",b,{entity:this})}return a.STATE_NONE="NONE",a.STATE_NEW="NEW",a.STATE_MODIFIED="MODIFIED",a.STATE_DELETED="DELETED",a.prototype.state=a.STATE_NONE,a.prototype._disableObserverCount=0,a.prototype._disableWriteObservers=0,a.prototype.hasValue=function(a){var b;return this._data.hasOwnProperty(a)||null!=(null!=(b=this.dataType)?b.getProperty(a):void 0)},a.prototype.get=function(a,b,c){var d;return null==b&&(b="async"),"function"!=typeof b&&"object"!=typeof b||(d=b,b="async"),a.indexOf(".")>0||a.indexOf("#")>=0?_evalDataPath(this,a,!1,b,d,c):this._get(a,b,d,c)},a.prototype.getAsync=function(a,b,c){return $.Deferred(function(b){return function(d){return b.get(a,{complete:function(a,b){a?d.resolve(b):d.reject(b)}},c)}}(this))},a.prototype._get=function(a,b,c,d){var e,f,g,h,i,j;return f=function(e){var f,g,h;return h=void 0,g=e.getInvoker({data:this}),"sync"===b?(h=g.invokeSync(),this._set(a,h),h=this._data[a],h&&(h instanceof cola.EntityList||h instanceof cola.Entity)&&(h._providerInvoker=g)):"async"===b?(d&&(d.unloaded=!0,null==d.providerInvokers&&(d.providerInvokers=[]),d.providerInvokers.push(g)),this._data[a]=g,f={data:this,property:a},this._notify(cola.constants.MESSAGE_LOADING_START,f),g.invokeAsync({complete:function(b){return function(d,e){b._notify(cola.constants.MESSAGE_LOADING_END,f),b._data[a]!==g&&(d=!1),d?(e=b._set(a,e,!0),e&&(e instanceof cola.EntityList||e instanceof cola.Entity)&&(e._providerInvoker=g)):b._set(a,null,!0),c&&cola.callback(c,d,e)}}(this)})):cola.callback(c,!0,void 0),h},g=null!=(j=this.dataType)?j.getProperty(a):void 0,value=this._data[a],void 0===value?g&&(h=g.get("provider"),null!=d&&(d.unloaded=!!h),"never"!==b&&h&&"lazy"===h._loadMode&&(value=f.call(this,h),e=!0)):value instanceof cola.Provider?(value=f.call(this,value),e=!0):value instanceof cola.AjaxServiceInvoker?(i=value,"sync"===b?(value=i.invokeSync(),value=this._set(a,value)):"async"===b?(c&&i.callbacks.push(c),e=!0,value=void 0,d&&(d.unloaded=!0,null==d.providerInvokers&&(d.providerInvokers=[]),d.providerInvokers.push(i))):(value=void 0,null!=d&&(d.unloaded=!0))):"function"==typeof value?(i={_$providerInvoker:!0,entity:this,func:value,callbacks:[c],invokeAsync:function(){this.func.call(this.entity,function(a){return function(b){var d,e,f;for(f=a.callbacks,d=0,e=f.length;e>d;d++)c=f[d],cola.callback(c,!0,b)}}(this))}},this._data[a]=i,i.invokeAsync(),value=void 0,e=!0,d&&(d.unloaded=!0,null==d.providerInvokers&&(d.providerInvokers=[]),d.providerInvokers.push(i))):"object"==typeof value&&(null!=value?value._$providerInvoker:void 0)&&(value.callbacks.push(c),value=void 0,e=!0,d&&(d.unloaded=!0,null==d.providerInvokers&&(d.providerInvokers=[]),d.providerInvokers.push(i))),c&&!e&&cola.callback(c,!0,value),value},a.prototype.set=function(a,b,c){var d;if("string"==typeof a)_setValue(this,a,b,c);else if(a&&"object"==typeof a){d=a;for(a in d)this.set(a,d[a])}return this},a.prototype._jsonToEntity=function(a,b,c,d){var e;return e=cola.DataType.jsonToEntity(a,b,c,null!=d?d._pageSize:void 0),e&&d&&(e._providerInvoker=d.getInvoker({data:this})),e},a.prototype._set=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;if(r=this._data[a],s=null!=(v=this.dataType)?v.getProperty(a):void 0,null!=b)if(b instanceof cola.Provider)e=void 0!==r;else{if(s&&(g=s._dataType,t=s._provider),g){if(null!=b)if(g instanceof cola.StringDataType&&"string"!=typeof b||g instanceof cola.BooleanDataType&&"boolean"!=typeof b||g instanceof cola.NumberDataType&&"number"!=typeof b||g instanceof cola.DateDataType&&!(b instanceof Date))b=g.parse(b);else if(g instanceof cola.EntityDataType){if(n=!0,b instanceof _Entity?n=b.dataType===g&&!s._aggregated:b instanceof _EntityList?n=b.dataType===g&&s._aggregated:b=s._aggregated||b instanceof Array||b.hasOwnProperty("$data")||b.hasOwnProperty("data$")?this._jsonToEntity(b,g,!0,t):new _Entity(b,g),!n)throw h=g.get("name"),d=(null!=(w=b.dataType)?w.get("name"):void 0)||"undefined",s._aggregated&&(h="["+h+"]"),b instanceof cola.EntityList&&(d="["+d+"]"),new cola.Exception('Unmatched DataType. expect "'+h+'" but "'+d+'".')}else b=g.parse(b)}else"object"==typeof b&&null!=b&&36!==a.charCodeAt(0)&&(b instanceof Array?(f=!0,b.length>0&&(i=b[0],cola.util.isSimpleValue(i)&&(f=!1)),f&&(b=this._jsonToEntity(b,null,!0,t))):b.hasOwnProperty("$data")||b.hasOwnProperty("data$")?b=this._jsonToEntity(b,null,!0,t):b instanceof Date||b instanceof _Entity||b instanceof _EntityList||(b=this._jsonToEntity(b,null,!1,t)));e=r!==b}else e=r!==b;if(e){if(this.dataType&&this.dataType.getListeners("beforeDataChange")&&this.dataType.fire("beforeDataChange",this.dataType,{entity:this,property:a,oldValue:r,value:b})===!1)return;if(s&&s._validators&&s._rejectInvalidValue){for(p=null,x=s._validators,j=0,k=x.length;k>j;j++)A=x[j],(null!=b||A instanceof cola.RequiredValidator)&&(A._disabled&&A instanceof cola.AsyncValidator&&A.get("async")||(o=A.validate(b),o&&(null==p&&(p=[]),o instanceof Array?Array.prototype.push.apply(p,o):p.push(o))));if(p)for(q=0,l=p.length;l>q;q++)if(o=p[q],"error"===o)throw new cola.Exception(o.text)}if(0===this._disableWriteObservers&&(null!=r&&(r instanceof _Entity||r instanceof _EntityList)&&(r._setDataModel(null),delete r.parent,delete r._parentProperty),c||this.state!==_Entity.STATE_NONE||this.setState(_Entity.STATE_MODIFIED)),this._data[a]=b,null!=b&&(b instanceof _Entity||b instanceof _EntityList)){if(b.parent&&b.parent!==this)throw new cola.Exception('Entity/EntityList is already belongs to another owner. "'+a+'"');b.parent=this,b._parentProperty=a,b._setDataModel(this._dataModel),b._onPathChange(),this._mayHasSubEntity=!0}if(this.timestamp=cola.sequenceNo(),0===this._disableWriteObservers&&this._notify(cola.constants.MESSAGE_PROPERTY_CHANGE,{entity:this,property:a,value:b,oldValue:r}),void 0!==p){if(null!=(y=this._messageHolder)&&y.clear(a),this.addMessage(a,p),null!=b)for(z=s._validators,u=0,m=z.length;m>u;u++)A=z[u],!A._disabled&&A instanceof cola.AsyncValidator&&A.get("async")&&A.validate(b,function(b){return function(c){c&&b.addMessage(a,c)}}(this))}else this.validate(a);this.dataType&&this.dataType.getListeners("dataChange")&&this.dataType.fire("dataChange",this.dataType,{entity:this,property:a,oldValue:r,value:b})}return b},a.prototype.remove=function(a){if(this.parent)if(this.parent instanceof _EntityList){if(this.dataType&&this.dataType.fire("beforeEntityRemove",this.dataType,{entity:this})===!1)return this;this.parent.remove(this,a),this.dataType&&this.dataType.fire("entityRemove",this.dataType,{entity:this})}else this.setState(_Entity.STATE_DELETED),this.parent.set(this._parentProperty,null);else this.setState(_Entity.STATE_DELETED);return this},a.prototype.createChild=function(a,b){var c,d,e,f,g;if(b&&b instanceof Array)throw new cola.Exception('Unmatched DataType. expect "Object" but "Array".');if(d=null!=(g=this.dataType)?g.getProperty(a):void 0,e=null!=d?d._dataType:void 0,e&&!(e instanceof cola.EntityDataType))throw new cola.Exception('Unmatched DataType. expect "cola.EntityDataType" but "'+e._name+'".');return(null!=d?d._aggregated:void 0)?(c=this._get(a,"never"),null==c&&(c=new cola.EntityList(null,e),f=d._provider,f&&(c.pageSize=f._pageSize,c._providerInvoker=f.getInvoker({data:this})),this._disableWriteObservers++,this._set(a,c),this._disableWriteObservers--),c.insert(b)):this._set(a,b)},a.prototype.createBrother=function(a){var b,c;if(a&&a instanceof Array)throw new cola.Exception('Unmatched DataType. expect "Object" but "Array".');return b=new _Entity(a,this.dataType),b.setState(_Entity.STATE_NEW),c=this.parent,c&&c instanceof _EntityList&&c.insert(b),b},a.prototype.setState=function(a){var b;return this.state===a?this:a===_Entity.STATE_DELETED&&this.dataType&&this.dataType.fire("beforeEntityRemove",this.dataType,{entity:this})===!1?this:(this.state===_Entity.STATE_NONE&&a===_Entity.STATE_MODIFIED&&this._storeOldData(),b=this.state,this.state=a,this._notify(cola.constants.MESSAGE_EDITING_STATE_CHANGE,{entity:this,oldState:b,state:a}),a===_Entity.STATE_DELETED&&this.dataType&&this.dataType.fire("beforeEntityRemove",this.dataType,{entity:this}),this)},a.prototype._storeOldData=function(){var a,b,c;if(!this._oldData){a=this._data,b=this._oldData={};for(c in a)value=a[c],value&&(value instanceof _Entity||value instanceof _EntityList)||(b[c]=value)}},a.prototype.getOldValue=function(a){var b;return null!=(b=this._oldData)?b[a]:void 0},a.prototype.reset=function(a){var b;if(a)this._set(a,void 0),this.clearMessages(a);else{this.disableObservers(),b=this._data;for(a in b)value=b[a],void 0!==value&&delete b[a];this.resetState(),this.enableObservers(),this._notify(cola.constants.MESSAGE_REFRESH,{data:this})}return this},a.prototype.resetState=function(){return delete this._oldData,this.clearMessages(),this.setState(_Entity.STATE_NONE),this},a.prototype.getDataType=function(a){var b,c,d,e,f,g,h;if(a){if(c=this.dataType)for(g=a.split("."),d=0,e=g.length;e>d&&(f=g[d],h="function"==typeof c.getProperty?c.getProperty(f):void 0,null!=h)&&(c=h.get("dataType"),null!=c);d++);}else c=this.dataType;return null==c&&(b=this.get(a),c=null!=b?b.dataType:void 0),c},a.prototype.getPath=_getEntityPath,a.prototype.flush=function(a,b){var c,d,e,f;if(null==b&&(b="async"),e=this.dataType.getProperty(a),f=null!=e?e._provider:void 0,!f)throw new cola.Exception("Provider undefined.");this._set(a,void 0),!b||"function"!=typeof b&&"object"!=typeof b||(c=b,b="async"),d=f._loadMode,f._loadMode="lazy";try{return this._get(a,b,{complete:function(a){return function(a,b){cola.callback(c,a,b)}}(this)})}finally{f._loadMode=d}},a.prototype._setDataModel=function(a){var b,c;if(this._dataModel!==a&&(this._dataModel&&this._dataModel.onEntityDetach(this),this._dataModel=a,a&&a.onEntityAttach(this),this._mayHasSubEntity)){b=this._data;for(c in b)value=b[c],value&&(value instanceof _Entity||value instanceof _EntityList)&&value._setDataModel(a)}},a.prototype.watch=_watch,a.prototype.unwatch=_unwatch,a.prototype._triggerWatcher=_triggerWatcher,a.prototype._onPathChange=function(){var a,b;if(delete this._pathCache,this._mayHasSubEntity){a=this._data;for(b in a)value=a[b],value&&(value instanceof _Entity||value instanceof _EntityList)&&value._onPathChange()}},a.prototype.disableObservers=function(){return this._disableObserverCount<0?this._disableObserverCount=1:this._disableObserverCount++,this},a.prototype.enableObservers=function(){return this._disableObserverCount<1?this._disableObserverCount=0:this._disableObserverCount--,this._disableObserverCount<1?this._disableObserverCount=0:this._disableObserverCount--,this},a.prototype.notifyObservers=function(){return this._notify(cola.constants.MESSAGE_REFRESH,{data:this}),this},a.prototype._notify=function(a,b){var c;0===this._disableObserverCount&&(delete b.timestamp,c=this.getPath(),a!==cola.constants.MESSAGE_PROPERTY_CHANGE&&a!==cola.constants.MESSAGE_VALIDATION_STATE_CHANGE&&a!==cola.constants.MESSAGE_LOADING_START&&a!==cola.constants.MESSAGE_LOADING_END||!b.property||(c=c?c.concat(b.property):[b.property]),this._doNotify(c,a,b),a!==cola.constants.MESSAGE_PROPERTY_CHANGE&&a!==cola.constants.MESSAGE_REFRESH||this._triggerWatcher([b.property||"*"],a,b))},a.prototype._doNotify=function(a,b,c){var d;null!=(d=this._dataModel)&&d.onDataMessage(a,b,c)},a.prototype._validate=function(a){var b,c,d,e,f,g,h,i;if(g=this.dataType.getProperty(a),g&&g._validators){if(b=this._data[a],b&&(b instanceof cola.Provider||b instanceof cola.AjaxServiceInvoker))return;for(h=g._validators,c=0,d=h.length;d>c;c++)i=h[c],i._disabled||(i instanceof cola.AsyncValidator&&i.get("async")?i.validate(b,function(b){return function(c){c&&b.addMessage(a,c)}}(this)):(e=i.validate(b),e&&(this._addMessage(a,e),f=!0)))}return f},a.prototype.validate=function(a){var b,c,d,e,f,g,h;if(this._messageHolder&&(e=this._messageHolder.getKeyMessage(),this._messageHolder.clear(a)),this.dataType)if(a)this._validate(a),this._notify(cola.constants.MESSAGE_VALIDATION_STATE_CHANGE,{entity:this,property:a});else for(g=this.dataType.getProperties().elements,c=0,d=g.length;d>c;c++)f=g[c],this._validate(f._property),this._notify(cola.constants.MESSAGE_VALIDATION_STATE_CHANGE,{entity:this,property:f._property});return b=null!=(h=this._messageHolder)?h.getKeyMessage():void 0,(e||b)&&e!==b&&this._notify(cola.constants.MESSAGE_VALIDATION_STATE_CHANGE,{entity:this}),!("error"===(null!=b?b.type:void 0))},a.prototype._addMessage=function(a,b){var c,d,e,f,g;if(f=this._messageHolder,f||(this._messageHolder=f=new _Entity.MessageHolder),b instanceof Array)for(c=0,d=b.length;d>c;c++)e=b[c],f.add(a,e)&&(g=!0);else f.add(a,b)&&(g=!0);return g},a.prototype.addMessage=function(a,b){var c;return 1===arguments.length&&(b=a,a="$"),"$"===a?this._notify(cola.constants.MESSAGE_VALIDATION_STATE_CHANGE,{entity:this}):(c=this._addMessage(a,b),this._notify(cola.constants.MESSAGE_VALIDATION_STATE_CHANGE,{entity:this,property:a}),c&&this._notify(cola.constants.MESSAGE_VALIDATION_STATE_CHANGE,{entity:this})),this},a.prototype.getKeyMessage=function(a){var b;return null!=(b=this._messageHolder)?b.getKeyMessage(a):void 0},a.prototype.getMessages=function(a){var b;return null!=(b=this._messageHolder)?b.getMessages(a):void 0},a.prototype.clearMessages=function(a){var b,c;return this._messageHolder?(a&&(b=this._messageHolder.getKeyMessage(a)),c=this._messageHolder.clear(a),b&&this._notify(cola.constants.MESSAGE_VALIDATION_STATE_CHANGE,{entity:this,property:a}),c&&this._notify(cola.constants.MESSAGE_VALIDATION_STATE_CHANGE,{entity:this}),this):this},a.prototype.findMessages=function(a,b){var c;return null!=(c=this._messageHolder)?c.findMessages(a,b):void 0},a.prototype.toJSON=function(a){var b,c,d,e,f,g,h;c=(null!=a?a.entityId:void 0)||!1,h=(null!=a?a.state:void 0)||!1,e=(null!=a?a.oldData:void 0)||!1,g=(null!=a?a.simpleValue:void 0)||!1,b=this._data,d={};for(f in b)if(value=b[f],36!==f.charCodeAt(0)){if(value){if(value instanceof cola.AjaxServiceInvoker)continue;
if(value instanceof _Entity||value instanceof _EntityList){if(g)continue;value=value.toJSON(a)}}d[f]=value}return c&&(d.entityId$=this.id),h&&(d.state$=this.state),e&&this._oldData&&(d.$oldData=this._oldData),d},a}(),LinkedList=function(){function a(){}return a.prototype._size=0,a.prototype._insertElement=function(a,b,c){var d,e;this._first?b&&"end"!==b?"before"===b?(e=c._previous,null!=e&&(e._next=a),c._previous=a,a._previous=e,a._next=c,this._first===c&&(this._first=a)):"after"===b?(d=c._next,null!=d&&(d._previous=a),c._next=a,a._previous=c,a._next=d,this._last===c&&(this._last=a)):"begin"===b&&(delete a._previous,a._next=this._first,this._first._previous=a,this._first=a):(a._previous=this._last,delete a._next,this._last._next=a,this._last=a):this._first=this._last=a,a._page=this,this._size++},a.prototype._removeElement=function(a){var b,c;c=a._previous,b=a._next,null!=c&&(c._next=b),null!=b&&(b._previous=c),this._first===a&&(this._first=b),this._last===a&&(this._last=c),this._size++},a.prototype._clearElements=function(){this._first=this._last=null,this._size=0},a}(),Page=function(a){function b(a,b){this.entityList=a,this.pageNo=b}return extend(b,a),b.prototype.loaded=!1,b.prototype.entityCount=0,b.prototype.initData=function(a){var b,c,d,e,f,g,h;if(h=a,e=this.entityList,a.hasOwnProperty("$data")?a=h.$data:a.hasOwnProperty("data$")&&(a=h.data$),!(a instanceof Array))throw new cola.Exception('Unmatched DataType. expect "Array" but "Object".');if(a.length){for(c=e.dataType,f=0,g=a.length;g>f;f++)b=a[f],d=new _Entity(b,c),this._insertElement(d);null!=h.$entityCount?e.totalEntityCount=h.$entityCount:null!=h.entityCount$&&(e.totalEntityCount=h.entityCount$),null!=e.totalEntityCount&&(e.pageSize&&(e.pageCount=parseInt((e.totalEntityCount+e.pageSize-1)/e.pageSize)),e.pageCountDetermined=!0),e.entityCount+=a.length,e.timestamp=cola.sequenceNo(),e._notify(cola.constants.MESSAGE_REFRESH,{data:e})}else e.totalEntityCount=e.entityCount,e.pageCountDetermined=!0},b.prototype._insertElement=function(a,c,d){var e;b.__super__._insertElement.call(this,a,c,d),e=this.entityList,a._page=this,a.parent=e,delete a._parentProperty,this.dontAutoSetCurrent||null!=e.current||a.state!==_Entity.STATE_DELETED&&(e.current=a,e._setCurrentPage(a._page)),a._setDataModel(e._dataModel),a._onPathChange(),a.state!==_Entity.STATE_DELETED&&this.entityCount++},b.prototype._removeElement=function(a){b.__super__._removeElement.call(this,a),delete a._page,delete a.parent,a._setDataModel(null),a._onPathChange(),a.state!==_Entity.STATE_DELETED&&this.entityCount--},b.prototype._clearElements=function(){var a;for(a=this._first;a;)delete a._page,delete a.parent,a._setDataModel(null),a._onPathChange(),a=a._next;this.entityCount=0,b.__super__._clearElements.call(this)},b.prototype.loadData=function(a){var b,c;b=this.entityList._providerInvoker,b&&(b.pageSize=this.entityList.pageSize,b.pageNo=this.pageNo,a?b.invokeAsync({complete:function(b){return function(c,d){return c&&b.initData(d),cola.callback(a,c,d)}}(this)}):(c=b.invokeSync(),this.initData(c)))},b}(LinkedList),cola.EntityList=function(a){function b(a,b){this.id=cola.uniqueId(),this.timestamp=cola.sequenceNo(),this.dataType=b,a&&this.fillData(a)}return extend(b,a),b.prototype.current=null,b.prototype.entityCount=0,b.prototype.pageMode="append",b.prototype.pageSize=0,b.prototype.pageNo=1,b.prototype.pageCount=1,b.prototype._disableObserverCount=0,b.prototype.fillData=function(a){var b;b=this._findPage(this.pageNo),null==b&&(b=new Page(this,this.pageNo)),this._insertElement(b,"begin"),b.initData(a)},b.prototype._setDataModel=function(a){var b,c;if(this._dataModel!==a&&(this._dataModel=a,c=this._first))for(b=c._first;c;)b?(b._setDataModel(a),b=b._next):(c=c._next,b=null!=c?c._first:void 0)},b.prototype.watch=_watch,b.prototype.unwatch=_unwatch,b.prototype._triggerWatcher=_triggerWatcher,b.prototype._setCurrentPage=function(a){this._currentPage=a,this.pageNo=(null!=a?a.pageNo:void 0)||1,this.timestamp=cola.sequenceNo()},b.prototype._onPathChange=function(){var a,b;if(delete this._pathCache,b=this._first)for(a=b._first;b;)a?(a._onPathChange(),a=a._next):(b=b._next,a=null!=b?b._first:void 0)},b.prototype._findPrevious=function(a){var b,c;if(!a||a.parent===this)for(a?(b=a._page,c=a._previous):(b=this._last,c=b._last);b;)if(c){if(c.state!==_Entity.STATE_DELETED)return c;c=c._previous}else b=b._previous,c=null!=b?b._last:void 0},b.prototype._findNext=function(a){var b,c;if(!a||a.parent===this)for(a?(c=a._page,b=a._next):(c=this._first,b=c._first);c;)if(b){if(b.state!==_Entity.STATE_DELETED)return b;b=b._next}else c=c._next,b=null!=c?c._first:void 0},b.prototype._findPage=function(a){var b;if(1>a)return null;if(a>this.pageCount&&(this.pageCountDetermined||a>this.pageCount+1))return null;if(b=this._currentPage||this._first,!b)return null;if(b.pageNo===a)return b;if(b.pageNo<a)for(b=b._next;null!=b;){if(b.pageNo===a)return b;if(b.pageNo>a)break;b=b._next}else for(b=b._previous;null!=b;){if(b.pageNo===a)return b;if(b.pageNo<a)break;b=b._previous}return null},b.prototype._createPage=function(a){var b,c,d;if(1>a)return null;if(a>this.pageCount&&(this.pageCountDetermined||a>this.pageCount+1))return null;if(b="end",d=this._currentPage||this._first)if(d.page===a-1)b="after";else if(d.page===a+1)b="before";else for(c=this._last;c;){if(c.pageNo<a){d=c,b="after";break}c=c._previous}return c=new Page(this,a),this._insertElement(c,b,d),c},b.prototype.hasNextPage=function(){var a;return a=this.pageNo+1,!this.pageCountDetermined||a<=this.pageCount},b.prototype._loadPage=function(a,b,c){var d,e,f;if(null==c&&(c="async"),!c||"function"!=typeof c&&"object"!=typeof c||(d=c,c="async"),f=this._findPage(a),f!==this._currentPage)if(f){if(this._setCurrentPage(f),b)for(e=f._first;e;){if(e.state!==_Entity.STATE_DELETED){this.setCurrent(e);break}e=e._next}cola.callback(d,!0)}else"never"!==c&&(b&&this.setCurrent(null),f=this._createPage(a),f&&("async"===c?(this._currentPage||this._setCurrentPage(f),f.loadData({complete:function(b){return function(c,e){c&&(b._currentPage!==f&&b._setCurrentPage(f),f.entityCount&&b.pageCount<a&&(b.pageCount=a)),cola.callback(d,c,e)}}(this)})):(f.loadData(),this._setCurrentPage(f),cola.callback(d,!0))));return this},b.prototype.loadPage=function(a,b){return this._loadPage(a,!1,b)},b.prototype.gotoPage=function(a,b){return 1>a?a=1:this.pageCountDetermined&&a>this.pageCount&&(a=this.pageCount),this._loadPage(a,!0,b)},b.prototype.firstPage=function(a){return this.gotoPage(1,a),this},b.prototype.previousPage=function(a){var b;return b=this.pageNo-1,1>b&&(b=1),this.gotoPage(b,a),this},b.prototype.nextPage=function(a){var b;return b=this.pageNo+1,this.pageCountDetermined&&b>this.pageCount&&(b=this.pageCount),this.gotoPage(b,a),this},b.prototype.lastPage=function(a){return this.gotoPage(this.pageCount,a),this},b.prototype.insert=function(a,b,c){var d;if("before"===b||"after"===b?(c&&c.parent!==this&&(c=null),null==c&&(c=this.current),c&&(d=c._page)):"append"===this.pageMode&&("end"===b?d=this._last:"begin"===b&&(d=this._first)),d||(d=this._currentPage,d||(this.gotoPage(1),d=this._currentPage)),a instanceof _Entity){if(a.parent&&a.parent!==this)throw new cola.Exception('Entity is already belongs to another owner. "'+(this._parentProperty||"Unknown")+'".');a.state===_Entity.STATE_DELETED&&a.setState(_Entity.STATE_NONE)}else a=new _Entity(a,this.dataType),a.setState(_Entity.STATE_NEW);return this.dataType&&this.dataType.getListeners("beforeEntityInsert")&&this.dataType.fire("beforeEntityInsert",this.dataType,{entityList:this,entity:a})===!1?null:(d.dontAutoSetCurrent=!0,d._insertElement(a,b,c),d.dontAutoSetCurrent=!1,a.state!==_Entity.STATE_DELETED&&this.entityCount++,this.timestamp=cola.sequenceNo(),this._notify(cola.constants.MESSAGE_INSERT,{entityList:this,entity:a,insertMode:b,refEntity:c}),this.dataType&&this.dataType.getListeners("entityInsert")&&this.dataType.fire("entityInsert",this.dataType,{entityList:this,entity:a}),this.current||this.setCurrent(a),a)},b.prototype.remove=function(a,b){var c,d,e;if((null!=a||(a=this.current,null!=a))&&a.parent===this)return this.dataType&&this.dataType.getListeners("beforeEntityRemove")&&this.dataType.fire("beforeEntityRemove",this.dataType,{entityList:this,entity:a})===!1?null:(a===this.current&&(c=!0,d=this._findNext(a),d||(d=this._findPrevious(a))),e=a._page,b?(e._removeElement(a),this.entityCount--):a.state===_Entity.STATE_NEW?(a.setState(_Entity.STATE_DELETED),e._removeElement(a),this.entityCount--):a.state!==_Entity.STATE_DELETED&&(a.setState(_Entity.STATE_DELETED),this.entityCount--),this.timestamp=cola.sequenceNo(),this._notify(cola.constants.MESSAGE_REMOVE,{entityList:this,entity:a}),this.dataType&&this.dataType.getListeners("entityRemove")&&this.dataType.fire("entityRemove",this.dataType,{entityList:this,entity:a}),c&&this.setCurrent(d),a)},b.prototype.empty=function(){this._reset(),this._notify(cola.constants.MESSAGE_REFRESH,{data:this})},b.prototype.setCurrent=function(a){var b;if(this.current===a||(null!=a?a.state:void 0)===cola.Entity.STATE_DELETED)return this;if(a&&a.parent!==this)throw new cola.Exception("The entity is not belongs to this EntityList.");return b=this.current,b&&b._onPathChange(),this.dataType&&this.dataType.getListeners("beforeCurrentChange")&&this.dataType.fire("beforeCurrentChange",this.dataType,{entityList:this,oldCurrent:b,current:a})===!1?this:(this.current=a,a&&(this._setCurrentPage(a._page),a._onPathChange()),this._notify(cola.constants.MESSAGE_CURRENT_CHANGE,{entityList:this,current:a,oldCurrent:b}),this.dataType&&this.dataType.getListeners("currentChange")&&this.dataType.fire("currentChange",this.dataType,{entityList:this,oldCurrent:b,current:a}),this)},b.prototype.first=function(){var a;return a=this._findNext(),a?(this.setCurrent(a),a):this.current},b.prototype.previous=function(){var a;return a=this._findPrevious(this.current),a?(this.setCurrent(a),a):this.current},b.prototype.next=function(){var a;return a=this._findNext(this.current),a?(this.setCurrent(a),a):this.current},b.prototype.last=function(){var a;return a=this._findPrevious(),a?(this.setCurrent(a),a):this.current},b.prototype._reset=function(){var a;for(this.current=null,this.entityCount=0,this.pageNo=1,this.pageCount=1,a=this._first;a;)a._clearElements(),a=a._next;return delete this._currentPage,delete this._first,delete this._last,this.timestamp=cola.sequenceNo(),this},b.prototype.disableObservers=function(){return this._disableObserverCount<0?this._disableObserverCount=1:this._disableObserverCount++,this},b.prototype.enableObservers=function(){return this._disableObserverCount<1?this._disableObserverCount=0:this._disableObserverCount--,this},b.prototype.notifyObservers=function(){return this._notify(cola.constants.MESSAGE_REFRESH,{data:this}),this},b.prototype._notify=function(a,b){var c;0===this._disableObserverCount&&(null!=(c=this._dataModel)&&c.onDataMessage(this.getPath(),a,b),a!==cola.constants.MESSAGE_CURRENT_CHANGE&&a!==cola.constants.MESSAGE_INSERT&&a!==cola.constants.MESSAGE_REMOVE||this._triggerWatcher(["*"],a,b))},b.prototype.each=function(a,b){var c,d,e,f,g;if(f=this._first,!f)return this;if(null!=b&&("boolean"==typeof b?c=b:(c=b.deleted,g=b.pageNo,!g&&b.currentPage&&(g=this.pageNo))),g>1&&(f=this._findPage(g),!f))return this;for(e=f._first,d=0;f;)if(e){if((c||e.state!==_Entity.STATE_DELETED)&&a.call(this,e,d++)===!1)break;e=e._next}else{if(!f||g)break;f=f._next,e=null!=f?f._first:void 0}return this},b.prototype.getPath=_getEntityPath,b.prototype.toJSON=function(a){var b,c,d,e;if(c=null!=a?a.deleted:void 0,b=[],e=this._first)for(d=e._first;e;)d?((c||d.state!==_Entity.STATE_DELETED)&&b.push(d.toJSON(a)),d=d._next):(e=e._next,d=null!=e?e._first:void 0);return b},b.prototype.toArray=function(){var a,b,c;if(a=[],c=this._first)for(b=c._first;c;)b?(b.state!==_Entity.STATE_DELETED&&a.push(b),b=b._next):(c=c._next,b=null!=c?c._first:void 0);return a},b.prototype.filter=function(a,b){return a=cola._trimCriteria(a,b),_filterCollection(this,a,b)},b.prototype.where=function(a,b){return null==b&&(b={}),void 0===b.caseSensitive&&(b.caseSensitive=!0),void 0===b.strict&&(b.strict=!0),a=cola._trimCriteria(a,b),_filterCollection(this,a,b)},b.prototype.find=function(a,b){var c;return b.one=!0,c=cola.util.where(this,a,b),null!=c?c[0]:void 0},b}(LinkedList),_Entity=cola.Entity,_EntityList=cola.EntityList,_Entity._evalDataPath=_evalDataPath=function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p;if(null==f&&(f={}),n=b.split("."),k=n.length-1,g=function(a,b,h){var i,j,l;if(j=b[h],l=!1,0===h&&a instanceof _EntityList)a="#"===j?a.current:a[j];else{if(i=h===k,c||(i||(l=!0),35===j.charCodeAt(j.length-1)&&(l=!0,j=j.substring(0,j.length-1))),a instanceof _Entity)return void(a=a._get(j,d,function(a){a&&a instanceof _EntityList&&(c||l)&&(a=a.current),null==a||i?"function"==typeof e&&e(a):g(a,b,h+1)},f));a=a[j]}null==a||i?"function"==typeof e&&e(a):g(a,b,h+1)},!e){for(h=j=0,l=n.length;l>j;h=++j){if(m=n[h],p=!1,0===h&&a instanceof _EntityList)a="#"===m?a.current:a[m];else if(i=h===k,c||(i||(p=!0),35===m.charCodeAt(m.length-1)&&(p=!0,m=m.substring(0,m.length-1))),a instanceof _Entity){if(o=a._get(m,d,null,f),void 0===o&&f.unloaded){g(a,n,h),a=o;break}a=o,a&&a instanceof _EntityList&&(c||p)&&(a=a.current)}else a=a[m];if(null==a)break}return a}g(a,n,0)},_Entity._setValue=_setValue=function(a,b,c,d){var e,f,g;if(e=b.lastIndexOf("."),e>0){if(f=b.substring(0,e),g=b.substring(e+1),a=_evalDataPath(a,f,!0,"never",d),null==a)throw new cola.Exception("Cannot set value to "+a+".");if(a instanceof _EntityList)throw new cola.Exception('Cannot set value to EntityList "'+b+'".');a instanceof cola.AjaxServiceInvoker?a=void 0:"function"==typeof a._set?a._set(g,c):a[g]=c}else"function"==typeof a._set?a._set(b,c):a[b]=c},_Entity._getEntityId=function(a){return a?a instanceof cola.Entity?a.id:"object"==typeof a?(null==a._id&&(a._id=cola.uniqueId()),a._id):void 0:null},TYPE_SEVERITY={success:1,warning:2,error:4},cola.Entity.MessageHolder=function(){function a(){this.keyMessage={},this.propertyMessages={}}return a.prototype.compare=function(a,b){return(TYPE_SEVERITY[a.type]||0)-(TYPE_SEVERITY[b.type]||0)},a.prototype.add=function(a,b){var c,d,e,f;return e=this.propertyMessages[a],e?e.push(b):this.propertyMessages[a]=[b],c="$"===a,d?this.compare(b,d)>0&&(this.keyMessage[a]=b,f=c):(this.keyMessage[a]=b,f=c),f||c||(d=this.keyMessage.$,d?this.compare(b,d)>0&&(this.keyMessage.$=b,f=!0):(this.keyMessage.$=b,f=!0)),f},a.prototype.clear=function(a){var b,c,d,e,f,g,h,i;if(a){delete this.propertyMessages[a],delete this.keyMessage[a],h=this.propertyMessages;for(g in h)for(f=h[g],c=0,d=f.length;d>c;c++){if(e=f[c],b){if(!(this.compare(e,b)>0))continue;b=e}else b=e;if("error"===b.type)break}i=this.keyMessage.$!==b,i&&(this.keyMessage.$=b)}else i=!0,this.keyMessage={},this.propertyMessages={};return i},a.prototype.getMessages=function(a){return null==a&&(a="$"),this.propertyMessages[a]},a.prototype.getKeyMessage=function(a){return null==a&&(a="$"),this.keyMessage[a]},a.prototype.findMessages=function(a,b){var c,d,e,f,g,h,i,j,k;if(a)if(h=this.propertyMessages[a],b)for(g=[],c=0,d=h.length;d>c;c++)f=h[c],f.type===b&&g.push(f);else g=h;else{g=[],k=this.propertyMessages;for(j in k)for(h=k[j],i=0,e=h.length;e>i;i++)f=h[i],b&&f.type!==b||g.push(f)}return g},a}(),cola.each=function(a,b,c){a instanceof cola.EntityList?a.each(b,c):a instanceof Array&&("function"==typeof a.each?a.each(b):cola.util.each(a,b))},cola.util.filter=function(a,b,c){return b=cola._trimCriteria(b,c),_filterCollection(a,b,c)},cola.util.where=function(a,b,c){return null==c&&(c={}),void 0===c.caseSensitive&&(c.caseSensitive=!0),void 0===c.strict&&(c.strict=!0),b=cola._trimCriteria(b,c),_filterCollection(a,b,c)},cola.util.find=function(a,b,c){var d;return null==c&&(c={}),c.one=!0,d=cola.util.where(a,b,c),null!=d?d[0]:void 0},cola.util.sort=function(a,b,c){return _sortCollection(a,b,c)},cola.util.flush=function(a,b){(a instanceof cola.Entity||a instanceof cola.EntityList)&&a.parent instanceof cola.Entity&&a._parentProperty&&a.parent.flush(a._parentProperty,b)},EntityIndex=function(){function a(a,b,c){var d,e,f;if(this.data=a,this.property=b,this.option=null!=c?c:{},this.model=e=null!=(f=this.data._dataModel)?f.model:void 0,!e)throw new cola.Exception("The Entity or EntityList is not belongs to any Model.");if(this.deep=this.option.deep,this.isCollection=this.data instanceof cola.EntityList,!this.deep&&!this.isCollection)throw new cola.Exception("Can not build index for single Entity.");this.index={},this.idMap={},this.buildIndex(),e.data.addEntityListener(this),null==(d=this.data)._indexMap&&(d._indexMap={}),this.data._indexMap[this.property]=this}return a.prototype.buildIndex=function(){var a;a=this.data,a instanceof cola.Entity?this._buildIndexForEntity(a):a instanceof cola.EntityList&&this._buildIndexForEntityList(a)},a.prototype._buildIndexForEntityList=function(a){a.each(function(a){return function(b){a._buildIndexForEntity(b)}}(this))},a.prototype._buildIndexForEntity=function(a){var b,c,d;if(value=a.get(this.property),this.index[value+""]=a,this.idMap[a.id]=!0,this.deep){b=a._data;for(c in b)d=b[c],d&&(d instanceof cola.Entity?this._buildIndexForEntity(d):d instanceof cola.EntityList&&this._buildIndexForEntityList(d))}},a.prototype.onEntityAttach=function(a){var b,c;if(this.deep)for(b=a;b;){if(b===this.data){c=!0;break}b=b.parent}else c=this.isCollection?a.parent===this.data:a===this.data;c&&(value=a.get(this.property),this.idMap[a.id]=!0,this.index[value+""]=a)},a.prototype.onEntityDetach=function(a){this.idMap[a.id]&&(value=a.get(this.property),delete this.idMap[a.id],delete this.index[value+""])},a.prototype.find=function(a){return this.index[a+""]},a.prototype.destroy=function(){var a;this.model.data.removeEntityListener(this),null!=(a=this.data._indexMap)&&delete a[this.property]},a}(),cola.util.buildIndex=function(a,b,c){var d,e;return d=null!=(e=a._indexMap)?e[b]:void 0,d||new EntityIndex(a,b,c)},"undefined"!=typeof exports&&null!==exports?(cola=require("./entity"),"undefined"!=typeof module&&null!==module&&(module.exports=cola)):cola=this.cola,cola.model=function(a,b){if(2===arguments.length){if(b){if(cola.model.models[a])throw new cola.Exception('Duplicated model name "'+a+'".');cola.model.models[a]=b,a===cola.constants.DEFAULT_PATH&&"undefined"!=typeof window&&null!==window&&(window.modelRoot=b)}else b=cola.removeModel(a);return b}return cola.model.models[a||cola.constants.DEFAULT_PATH]},cola.model.models={},cola.removeModel=function(a){var b;return b=cola.model.models[a],delete cola.model.models[a],b},cola.Scope=function(){function a(){}return a.prototype.destroy=function(){var a,b,c,d;if(this._childScopes){for(d=this._childScopes,b=0,c=d.length;c>b;b++)a=d[b],a.destroy();delete this._childScopes}},a.prototype.get=function(a,b,c){return this.data.get(a,b,c)},a.prototype.getAsync=function(a,b,c){return $.Deferred(function(b){return function(d){return b.get(a,{complete:function(a,b){a?d.resolve(b):d.reject(b)}},c)}}(this))},a.prototype.set=function(a,b,c){return this.data.set(a,b,c),this},a.prototype.describe=function(a,b){return this.data.describe(a,b)},a.prototype.dataType=function(a){var b,c,d;if("string"==typeof a)return b=this.data.definition(a),b instanceof cola.DataType?b:null;if(a)if(a instanceof Array)for(c=0,d=a.length;d>c;c++)b=a[c],b instanceof cola.DataType||b.lazy!==!1&&(b=new cola.EntityDataType(b),b.name&&this.data.regDefinition(b.name,b));else if(b=a,!(b instanceof cola.DataType)&&b.lazy!==!1)return b=new cola.EntityDataType(b),b.name&&this.data.regDefinition(b.name,b),b},a.prototype.definition=function(a){return this.data.definition(a)},a.prototype.flush=function(a,b){return this.data.flush(a,b),this},a.prototype.disableObservers=function(){return this.data.disableObservers(),this},a.prototype.enableObservers=function(){return this.data.enableObservers(),this},a.prototype.notifyObservers=function(a){return this.data.notifyObservers(a),this},a.prototype.watch=function(a,b){var c,d,e,f;if(f={processMessage:function(a,c,d,e){b(c,d,e)}},a instanceof Array)for(c=0,d=a.length;d>c;c++)e=a[c],this.data.bind(e,f);else this.data.bind(a,f);return this},a.prototype.hasExBinding=function(){return this._hasExBinding},a.prototype.setHasExBinding=function(a){var b;this._hasExBinding!==a&&(this._hasExBinding=a,a&&null!=(b=this.parent)&&b.setHasExBinding(!0))},a.prototype.registerChild=function(a){null==this._childScopes&&(this._childScopes=[]),this._childScopes.push(a),this.data.bind("**",a)},a.prototype.unregisterChild=function(a){var b;this._childScopes&&(this.data.unbind("**",a),b=this._childScopes.indexOf(a),b>=0&&this._childScopes.splice(b,1))},a}(),cola.Model=function(a){function b(a,b){var c;null==cola.currentScope&&(cola.currentScope=this),a instanceof cola.Scope&&(b=a,a=void 0),a&&(this.name=a,cola.model(a,this)),b&&"string"==typeof b&&(c=b,b=cola.model(c)),this.parent=b,this.setHasExBinding(!0),this.data=new cola.DataModel(this),null!=b&&b.registerChild(this),this.action=function(a,b){var c,d,e,f,g,h;if(h=this.action,1===arguments.length){if("string"==typeof a){for(g=this;h;){if(e=h[a])return e.action||e;if(g=g.parent,!g)break;h=g.action}return cola.defaultAction[a]}if(a&&"object"==typeof a){d=a;for(f in d)c=d[f],this.action(f,c)}return null}return b?h[a]=b:delete h[a],this}}return extend(b,a),b.prototype.destroy=function(){var a,b;null!=(b=this.parent)&&b.unregisterChild(this),this.name&&cola.removeModel(this.name),"function"==typeof(a=this.data).destroy&&a.destroy()},b.prototype.processMessage=function(a,b,c,d){return this.data.onDataMessage(b,c,d)},b.prototype.$=function(a){return null==this._$doms&&(this._$doms=$(this._doms)),this._$doms.find(a)},b}(cola.Scope),cola.SubScope=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.watchPath=function(a){var b,c,d,e,f;if(!this._watchAllMessages&&this._watchPath!==a)if(a)if(this._watchPath=f=[],e=this.parent,a instanceof Array)for(b=0,c=a.length;c>b;b++)d=a[b],d+=".**",f.push(d),null!=e&&e.data.bind(d,this);else a+=".**",f.push(a),null!=e&&e.data.bind(a,this);else delete this._watchPath},b.prototype.unwatchPath=function(){var a,b,c,d,e;if(this._watchPath&&(e=this._watchPath,delete this._watchPath,d=this.parent,d&&e))if(e instanceof Array)for(a=0,b=e.length;b>a;a++)c=e[a],d.data.unbind(c,this);else d.data.unbind(e,this)},b.prototype.watchAllMessages=function(){var a;this._watchAllMessages||(this._watchAllMessages=!0,this.unwatchPath(),a=this.parent,a&&(this._watchPath=["**"],a.data.bind("**",this),"function"==typeof a.watchAllMessages&&a.watchAllMessages()))},b.prototype.destroy=function(){this.parent&&this.unwatchPath()},b}(cola.Scope),cola.ExpressionScope=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.repeatNotification=!0,b.prototype.setExpression=function(a){var b,c,d,e;if(this.expression=a,null==this.expressionPaths&&(this.expressionPaths=[]),a){if(a.paths)for(e=this.expression.paths,b=0,c=e.length;c>b;b++)d=e[b],this.expressionPaths.push(d.split("."));a.paths||!a.hasCallStatement||a.hasDefinedPath?this.watchPath(a.paths):this.watchAllMessages()}else this.unwatchPath()},b.prototype.evaluate=function(a,b,c){var d;return null==b&&(b="async"),null==c&&(c={}),null!=(d=this.expression)?d.evaluate(a,b,c):void 0},b.prototype.isParentOfTarget=function(a){var b,c,d,e,f,g,h,i,j,k;if(b=this.expressionPaths,!b.length)return!1;if(!a)return!0;if(b.length)for(e=0,f=b.length;f>e;e++){for(k=b[e],d=!0,c=h=0,g=a.length;g>h;c=++h)if(i=a[c],j=k[c],i!==j){if("**"===j)continue;if("*"===j&&c===a.length-1)continue;d=!1;break}if(d)return!0}return!1},b}(cola.SubScope),cola.AliasScope=function(a){function b(a,b){this.parent=a,this.setExpression(b),this.data=new cola.AliasDataModel(this,b.alias,this.dataType),this.action=this.parent.action}return extend(b,a),b.prototype.destroy=function(){b.__super__.destroy.call(this),this.data.destroy()},b.prototype.setExpression=function(a){b.__super__.setExpression.call(this,a),a&&1===typeof a.paths.length&&!a.hasCallStatement&&(this.dataType=this.parent.data.getDataType(a.paths[0]))},b.prototype.setTargetData=function(a){this.data.setTargetData(a)},b.prototype.retrieveData=function(){var a;cola.util.cancelDelay(this,"retrieve"),a=this.evaluate(this),this.setTargetData(a)},b.prototype.refreshTargetData=function(){this.data.onDataMessage([this.expression.alias],cola.constants.MESSAGE_REFRESH,{data:this.data.getTargetData()})},b.prototype.processMessage=function(a,b,c,d){var e;this.messageTimestamp>=d.timestamp||(e=this._processMessage(a,b,c,d),e||this.data.onDataMessage(b,c,d))},b.prototype._processMessage=function(a,b,c,d){var e,f;return c!==cola.constants.MESSAGE_REFRESH&&c!==cola.constants.MESSAGE_CURRENT_CHANGE&&c!==cola.constants.MESSAGE_PROPERTY_CHANGE&&c!==cola.constants.MESSAGE_REMOVE||(f=this.isParentOfTarget(b),f?(this.retrieveData(2>f),this.refreshTargetData(),e=!0):this.expression&&(this.expressionPaths||!this.expression.hasCallStatement||this.expression.hasDefinedPath||(cola.util.delay(this,"retrieve",100,function(a){return function(){a.retrieveData(),a.refreshTargetData()}}(this)),e=!0))),e},b}(cola.ExpressionScope),cola.ItemScope=function(a){function b(a,b){var c;this.parent=a,this.data=new cola.ItemDataModel(this,b,null!=(c=this.parent)?c.dataType:void 0),this.action=this.parent.action}return extend(b,a),b.prototype.watchPath=function(){},b.prototype.watchAllMessages=function(){var a;null!=(a=this.parent)&&"function"==typeof a.watchAllMessages&&a.watchAllMessages()},b.prototype.processMessage=function(a,b,c,d){return this.data.onDataMessage(b,c,d)},b}(cola.SubScope),cola.ItemsScope=function(a){function b(a,b){this.setParent(a),this.setExpression(b)}return extend(b,a),b.prototype.setParent=function(a){this.parent&&this.unwatchPath(),this.parent=a,this.data=a.data,this.action=a.action,this._watchAllMessages?this.watchAllMessages():this._watchPath&&this.watchPath(this._watchPath)},b.prototype.setExpression=function(a){b.__super__.setExpression.call(this,a),this.alias=a?a.alias:"item"},b.prototype.setItems=function(a){this._setItems(a)},b.prototype.retrieveData=function(){var a;cola.util.cancelDelay(this,"retrieve"),this._retrieveItems?this._retrieveItems():this.expression&&(a=this.evaluate(this.parent),this.setItems(a))},b.prototype._setItems=function(a){this.items=a,this.originItems=a instanceof Array?a.$origin:null},b.prototype.refreshItems=function(){"function"==typeof this.onItemsRefresh&&this.onItemsRefresh()},b.prototype.refreshItem=function(a){a.itemsScope=this,"function"==typeof this.onItemRefresh&&this.onItemRefresh(a)},b.prototype.insertItem=function(a){a.itemsScope=this,"function"==typeof this.onItemInsert&&this.onItemInsert(a)},b.prototype.removeItem=function(a){a.itemsScope=this,"function"==typeof this.onItemRemove&&this.onItemRemove(a)},b.prototype.itemsLoadingStart=function(a){return a.itemsScope=this,"function"==typeof this.onItemsLoadingStart?this.onItemsLoadingStart(a):void 0},b.prototype.itemsLoadingEnd=function(a){return a.itemsScope=this,"function"==typeof this.onItemsLoadingEnd?this.onItemsLoadingEnd(a):void 0},b.prototype.changeCurrentItem=function(a){a.itemsScope=this,"function"==typeof this.onCurrentItemChange&&this.onCurrentItemChange(a)},b.prototype.resetItemScopeMap=function(){this.itemScopeMap={}},b.prototype.getItemScope=function(a){var b;return b=cola.Entity._getEntityId(a),this.itemScopeMap[b]},b.prototype.regItemScope=function(a,b){this.itemScopeMap[a]=b},b.prototype.unregItemScope=function(a){delete this.itemScopeMap[a]},b.prototype.findItemDomBinding=function(a){var b,c,d,e,f,g,h,i,j;if(c=this.itemScopeMap,d=this.items,j=this.originItems,h=null!=j?j._multiItems:void 0,d||j)for(;a;){if(a instanceof cola.Entity){if(g=a.parent===d,!g&&j)if(h){for(e=0,f=j.length;f>e;e++)if(i=j[e],a.parent===i){g=!0;break}}else g=a.parent===j;if(g)return b=cola.Entity._getEntityId(a),b?c[b]:null}a=a.parent}return null},b.prototype.processMessage=function(a,b,c,d){var e,f,g,h;if(!(this.messageTimestamp>=d.timestamp))if(e=this._processMessage(a,b,c,d))this.messageTimestamp=d.timestamp;else if(this.itemScopeMap)if(g=this.findItemDomBinding(d.data||d.entity))g.processMessage(a,b,c,d);else if(this.hasExBinding()){h=this.itemScopeMap;for(f in h)g=h[f],g.hasExBinding()&&g.processMessage(a,b,c,d)}},b.prototype.isOriginItems=function(a){var b,c,d,e;if(!this.originItems)return!1;if(this.originItems===a)return!0;if(this.originItems instanceof Array&&this.originItems._multiItems)for(e=this.originItems,b=0,c=e.length;c>b;b++)if(d=e[b],d===a)return!0;return!1},b.prototype.isWatchPathPreciseMatch=function(a){var b,c,d,e,f,g,h,i,j,k;if(b=this.expressionPaths,!b.length)return!1;if(!a)return!0;if(b.length-a.length<2)for(e=0,f=b.length;f>e;e++){for(k=b[e],d=!0,c=h=0,g=a.length;g>h;c=++h)if(i=a[c],j=k[c],i!==j){d=!1;break}if(d&&b.length>a.length&&(j=b[b.length-1],"*"===j&&"**"===j||(d=!1)),d)return!0}return!1},b.prototype._processMessage=function(a,b,c,d){var e,f,g,h,i,j;return c===cola.constants.MESSAGE_REFRESH?d.originType!==cola.constants.MESSAGE_CURRENT_CHANGE||d.entityList!==this.items&&!this.isOriginItems(d.entityList)?this.isParentOfTarget(b)?(this.retrieveData(),this.refreshItems(),e=!0):i=!0:"function"==typeof this.onCurrentItemChange&&this.onCurrentItemChange(d):c===cola.constants.MESSAGE_PROPERTY_CHANGE?this.isParentOfTarget(b)?(this.retrieveData(),this.refreshItems(),e=!0):(h=null!=(j=d.entity)?j.parent:void 0,h===this.items||this.isOriginItems(d.parent)?this.refreshItem(d):i=!0):c===cola.constants.MESSAGE_CURRENT_CHANGE?d.entityList===this.items||this.isOriginItems(d.entityList)?"function"==typeof this.onCurrentItemChange&&this.onCurrentItemChange(d):this.isParentOfTarget(b)?(this.retrieveData(),this.refreshItems(),e=!0):i=!0:c===cola.constants.MESSAGE_INSERT?d.entityList===this.items?(this.insertItem(d),e=!0):this.isOriginItems(d.entityList)?(this.insertItem(d),e=!0):this.isWatchPathPreciseMatch(b,this.expressionPaths)?(this.retrieveData(),this.refreshItems(),e=!0):i=!0:c===cola.constants.MESSAGE_REMOVE?d.entityList===this.items?(this.removeItem(d),e=!0):this.isOriginItems(d.entityList)||this.isWatchPathPreciseMatch(b,this.expressionPaths)?(g=this.items,g instanceof Array&&(f=g.indexOf(d.entity),f>-1&&g.splice(f,1)),this.removeItem(d),e=!0):i=!0:c===cola.constants.MESSAGE_LOADING_START?this.isParentOfTarget(b)&&this.itemsLoadingStart(d):c===cola.constants.MESSAGE_LOADING_END&&this.isParentOfTarget(b)&&this.itemsLoadingEnd(d),i&&this.expression&&(this.expressionPaths||!this.expression.hasCallStatement||this.expression.hasDefinedPath||cola.util.delay(this,"retrieve",100,function(a){return function(){a.retrieveData(),a.refreshItems()}}(this))),e},b}(cola.ExpressionScope),cola.AbstractDataModel=function(){function a(a){this.model=a}return a.prototype.disableObserverCount=0,a.prototype.get=function(a,b,c){var d,e,f,g,h,i,j,k,l;return a?this._aliasMap&&(h=a.indexOf("."),g=h>0?a.substring(0,h):a,e=this._aliasMap[g])?(d=e.data,h>0?(!b||"function"!=typeof b&&"object"!=typeof b||(b="async",f=b),cola.Entity._evalDataPath(d,a.substring(h+1),!1,b,f,c)):d):(l=this._rootData,null!=l?this.model.parent?(h=a.indexOf("."),i=h>0?a.substring(0,h):a,l.hasValue(i)?l.get(a,b,c):this.model.parent.data.get(a,b,c)):l.get(a,b,c):null!=(k=this.model.parent)?k.data.get(a,b,c):void 0):this._getRootData()||(null!=(j=this.model.parent)?j.get():void 0)},a.prototype.set=function(a,b,c){var d,e,f,g,h;if(a)if(h=this._getRootData(),"string"==typeof a)if(f=a.indexOf("."),f>0){if(e=a.substring(0,f),this._aliasMap&&(d=this._aliasMap[e])){if(!d.data)throw new cola.Exception('Cannot set value to "'+a+'"');return cola.Entity._setValue(d.data,a.substring(f+1),b,c),this}this.model.parent?h.hasValue(e)?h.set(a,b,c):this.model.parent.data.set(a,b,c):h.set(a,b,c)}else this._set(a,b,c);else{b=a;for(g in b)this.set(g,b[g],c)}return this},a.prototype._set=function(a,b,c){var d,e,f,g,h,i;
h=this._rootData,d=h.hasValue(a),(null!=(g=this._aliasMap)?g[a]:void 0)&&this.removeAlias(a),null!=b&&(b.$provider||b.$dataType)&&(b.$provider&&(f=new cola.Provider(b.$provider)),i=h.dataType,e=i.getProperty(a),null==e&&(e=i.addProperty({property:a})),f&&e.set("provider",f),b.$dataType&&e.set("dataType",b.$dataType)),f&&!d||(b&&(b instanceof cola.Entity||b instanceof cola.EntityList)&&b.parent&&b!==h._data[a]?(null==this._aliasMap&&(this._aliasMap={}),this.addAlias(a,b)):h.set(a,b,c))},a.prototype.addAlias=function(a,b){var c,d,e,f,g,h;f=b.getPath("always"),e=null!=(g=this._aliasMap)&&null!=(h=g[a])?h.data:void 0,d=this,this._aliasMap[a]=c={data:b,path:f,bindingPath:f.slice(0).concat("**"),processMessage:function(b,c,e,f){var g;g=c.slice(this.path.length),d.onDataMessage([a].concat(g),e,f)}},this.bind(c.bindingPath,c),this.onDataMessage([a],cola.constants.MESSAGE_PROPERTY_CHANGE,{entity:this._rootData,property:a,oldValue:e,value:b})},a.prototype.removeAlias=function(a){var b,c;(null!=(c=this._aliasMap)?c[a]:void 0)&&(b=this._aliasMap[a],delete this._aliasMap[a],this.unbind(b.bindingPath,b))},a.prototype.reset=function(a){var b;return null!=(b=this._rootData)&&b.reset(a),this},a.prototype.flush=function(a,b){var c;return null!=(c=this._rootData)&&c.flush(a,b),this},a.prototype.bind=function(a,b){return this.bindingRegistry||(this.bindingRegistry={__path:"",__processorMap:{}}),"string"==typeof a&&(a=a.split(".")),a&&this._bind(a,b),this},a.prototype._bind=function(a,b){var c,d,e,f,g,h;if(e=this.bindingRegistry,a){for(c=0,d=a.length;d>c;c++)g=a[c],h=e[g],null==h&&(f=e.__path?e.__path+"."+g:g,e[g]=h={__path:f,__processorMap:{}}),e=h;null==b.id&&(b.id=cola.uniqueId()),e.__processorMap[b.id]=b}},a.prototype.unbind=function(a,b){return this.bindingRegistry?("string"==typeof a&&(a=a.split(".")),a&&this._unbind(a,b),this):void 0},a.prototype._unbind=function(a,b){var c,d,e,f;for(e=this.bindingRegistry,c=0,d=a.length;d>c&&(f=a[c],e=e[f],null!=e);c++);return null!=e?delete e.__processorMap[b.id]:void 0},a.prototype.disableObservers=function(){return this.disableObserverCount<0?this.disableObserverCount=1:this.disableObserverCount++,this},a.prototype.enableObservers=function(){return this.disableObserverCount<1?this.disableObserverCount=0:this.disableObserverCount--,this},a.prototype.notifyObservers=function(a){var b;return b=a?this.get(a,"never"):this._rootData,null!=b&&"function"==typeof b.notifyObservers&&b.notifyObservers(),this},a.prototype.onDataMessage=function(a,b,c){var d,e,f,g,h,i,j,k,l;if(null==c&&(c={}),this.bindingRegistry&&!(this.disableObserverCount>0)){k=cola.currentScope,cola.currentScope=this;try{if(null==c.timestamp&&(c.timestamp=cola.sequenceNo()),a)for(j=this.bindingRegistry,h=a.length-1,f=g=0,i=a.length;i>g&&(l=a[f],f===h&&(e=j["*"],e&&this.processDataMessage(e,a,b,c)),d=j["**"],d&&this.processDataMessage(d,a,b,c),j=j[l],j);f=++g);else j=this.bindingRegistry,e=j["*"],e&&this.processDataMessage(e,null,b,c),d=j["**"],d&&this.processDataMessage(d,null,b,c);j&&this.processDataMessage(j,a,b,c,!0)}finally{cola.currentScope=k}}},a.prototype.processDataMessage=function(a,b,c,d,e){var f,g,h,i,j,k;j=a.__processorMap;for(f in j)i=j[f],i.disabled||i.timestamp>=d.timestamp&&!i.repeatNotification||(i.timestamp=d.timestamp,i.processMessage(a.__path,b,c,d));if(e){g=!(cola.constants.MESSAGE_EDITING_STATE_CHANGE<=c&&c<=cola.constants.MESSAGE_VALIDATION_STATE_CHANGE||cola.constants.MESSAGE_LOADING_START<=c&&c<=cola.constants.MESSAGE_LOADING_END),g&&c===cola.constants.MESSAGE_CURRENT_CHANGE&&(c=cola.constants.MESSAGE_REFRESH,d=$.extend({originType:cola.constants.MESSAGE_CURRENT_CHANGE},d));for(h in a)k=a[h],k&&("**"===h||g)&&"__processorMap"!==h&&"__path"!==h&&this.processDataMessage(k,b,c,d,!0)}},a}(),cola.DataModel=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype._createRootData=function(a){return new cola.Entity(null,a)},b.prototype._getRootData=function(){var a,b;return null==this._rootData&&(null==this._rootDataType&&(this._rootDataType=new cola.EntityDataType),this._rootData=b=this._createRootData(this._rootDataType),b.state=cola.Entity.STATE_NEW,a=this,b._setDataModel(a)),this._rootData},b.prototype.describe=function(a,b){var c,d,e,f,g;if(this._getRootData(),"string"==typeof a){if(e=null!=(g=this._rootDataType)?g.getProperty(a):void 0,b)if(e||(e=this._rootDataType.addProperty({property:a})),"string"==typeof b){if(c=this.definition(b),!c)throw new cola.Exception('Unrecognized DataType "'+b+'".');e.set("dataType",c)}else b instanceof cola.DataType?e.set("dataType",b):e.set(b)}else if(a){b=a;for(f in b)d=b[f],this.describe(f,d)}},b.prototype.getProperty=function(a){var b,c,d,e,f,g,h,i;for(d=a.indexOf("."),d>0?(e=a.substring(0,d),f=a.substring(d+1)):(e=null,f=a),b=this;b&&(i=b._rootDataType,!i||!(c=e?null!=(g=i.getProperty(e))?g.get("dataType"):void 0:i));)b=null!=(h=b.model.parent)?h.data:void 0;return null!=c?c.getProperty(f):void 0},b.prototype.getDataType=function(a){var b,c;return c=this.getProperty(a),b=null!=c?c.get("dataType"):void 0},b.prototype.definition=function(a){var b,c;return b=null!=(c=this._definitionStore)?c[a]:void 0,b&&(b instanceof cola.Definition||(b=new cola.EntityDataType(b),this._definitionStore[a]=b),b||(b=this.model.parent.data.definition(a))),b||(b=cola.DataType.defaultDataTypes[a]),b},b.prototype.regDefinition=function(a,b){var c;if(a instanceof cola.Definition&&(b=a,a=a._name),!a)throw new cola.Exception('Attribute "name" cannot be emtpy.');if(b._scope&&b._scope!==this.model)throw new cola.Exception("DataType("+b._name+") is already belongs to anthor Model.");if(c=this._definitionStore,null==c)this._definitionStore=c={};else if(c[a])throw new cola.Exception('Duplicated Definition name "'+a+'".');return c[a]=b,this},b.prototype.unregDefinition=function(a){var b;return this._definitionStore&&(b=this._definitionStore[a],delete this._definitionStore[a]),b},b.prototype.addEntityListener=function(a){null==this._entityListeners&&(this._entityListeners=[]),this._entityListeners.push(a)},b.prototype.removeEntityListener=function(a){var b;this._entityListeners&&a&&(b=this._entityListeners.indexOf(a),b>-1&&this._entityListeners.splice(b,1))},b.prototype.onEntityAttach=function(a){var b,c,d,e;if(this._entityListeners)for(e=this._entityListeners,b=0,c=e.length;c>b;b++)d=e[b],d.onEntityAttach(a)},b.prototype.onEntityDetach=function(a){var b,c,d,e;if(this._entityListeners)for(e=this._entityListeners,b=0,c=e.length;c>b;b++)d=e[b],d.onEntityDetach(a)},b}(cola.AbstractDataModel),cola.AliasDataModel=function(a){function b(a,b,c){var d;for(this.model=a,this.alias=b,this.dataType=c,this.defaultDataType=this.dataType,d=this.model.parent;d;){if(d.data){this.parent=d.data;break}d=d.parent}}return extend(b,a),b.prototype.getTargetData=function(){return this._targetData},b.prototype.setTargetData=function(a,b){var c;c=this._targetData,this._targetData=a,(a instanceof cola.Entity||a instanceof cola.EntityList)&&(this.dataType=a.dataType||this.defaultDataType),b||this.onDataMessage([this.alias],cola.constants.MESSAGE_PROPERTY_CHANGE,{entity:null,property:this.alias,value:a,oldValue:c})},b.prototype.describe=function(a,c){return a===this.alias?b.__super__.describe.call(this,a,c):this.parent.describe(a,c)},b.prototype.getProperty=function(a){var b,c,d;return c=a.indexOf("."),c>0?a.substring(0,c)===this.alias?(b=this._targetData instanceof cola.Entity||this._targetData instanceof cola.EntityList?this._targetData.dataType:null,b&&(d=b.getProperty(a.substring(c+1)),b=null!=d?d.get("dataType"):void 0),b):this.parent.getDataType(a):a===this.alias?this._targetData instanceof cola.Entity||this._targetData instanceof cola.EntityList?this._targetData.dataType:null:this.parent.getProperty(a)},b.prototype.getDataType=function(a){var b,c,d,e;return c=a.indexOf("."),c>0?a.substring(0,c)===this.alias?(this._rootDataType&&(d=null!=(e=this._rootDataType)?e.getProperty(a.substring(c+1)):void 0,b=null!=d?d.get("dataType"):void 0),b):this.parent.getDataType(a):a===this.alias?this.dataType:this.parent.getDataType(a)},b.prototype.definition=function(a){return this.parent.definition(a)},b.prototype.regDefinition=function(a){return this.parent.regDefinition(a)},b.prototype.unregDefinition=function(a){return this.parent.unregDefinition(a)},b.prototype._bind=function(a,c){b.__super__._bind.call(this,a,c),this._exBindingProcessed||a[0]===this.alias||(this._exBindingProcessed=!0,this.model.setHasExBinding(!0),this.model.watchAllMessages())},b.prototype.get=function(a,b,c){var d,e,f,g;if(d=this.alias,e=d.length,a&&a.substring(0,e)===d)if(f=a.charCodeAt(e),46===f){if(a.indexOf(".")>0){if(g=this._targetData,g instanceof cola.Entity)return g.get(a.substring(e+1),b,c);if(g&&"object"==typeof g)return g[a.substring(e+1)]}}else if(isNaN(f))return this._targetData;return this.parent.get(a,b,c)},b.prototype.set=function(a,b,c){var d,e,f,g;if(d=this.alias,e=d.length,a&&a.substring(0,e)===d)if(f=a.charCodeAt(e),46===f){if(a.indexOf(".")>0)return null!=(g=this._targetData)&&g.set(a.substring(e+1),b,c),this}else if(isNaN(f))return this.setTargetData(b),this;return this.parent.set(a,b,c),this},b.prototype.dataType=function(a){return this.parent.dataType(a)},b.prototype.regDefinition=function(a,b){return this.parent.regDefinition(a,b),this},b.prototype.unregDefinition=function(a){return this.parent.unregDefinition(a)},b.prototype.flush=function(a,b){var c,d,e,f;if(c=this.alias,a.substring(0,c.length)===c){if(d=a.charCodeAt(1),46===d)return null!=(e=this._targetData)&&e.flush(a.substring(c.length+1),b),this;if(isNaN(d))return null!=(f=this._targetData)&&f.flush(b),this}return this.parent.flush(a,b),this},b.prototype.disableObservers=function(){return this.parent.disableObservers(),this},b.prototype.enableObservers=function(){return this.parent.enableObservers(),this},b.prototype.notifyObservers=function(a){return this.parent.notifyObservers(a),this},b.prototype.onDataMessage=function(a,c,d){var e,f,g,h;if(b.__super__.onDataMessage.call(this,a,c,d),this._targetData){for(h=this._targetData,e=d.data||d.entityList||d.entity;e;){if(e===h){f=!0;break}e=e.parent}f&&(g=a.slice(h.getPath().length),b.__super__.onDataMessage.call(this,[this.alias].concat(g),c,d))}},b}(cola.AbstractDataModel),cola.ItemDataModel=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.getIndex=function(){return this._index},b.prototype.setIndex=function(a,b){this._index=a,b||this.onDataMessage([cola.constants.REPEAT_INDEX],cola.constants.MESSAGE_PROPERTY_CHANGE,{entity:null,property:cola.constants.REPEAT_INDEX,value:a})},b.prototype.get=function(a,c,d){return a===cola.constants.REPEAT_INDEX?this.getIndex():b.__super__.get.call(this,a,c,d)},b.prototype.set=function(a,c,d){a===cola.constants.REPEAT_INDEX?this.setIndex(c):b.__super__.set.call(this,a,c,d)},b}(cola.AliasDataModel),new cola.Model(cola.constants.DEFAULT_PATH),cola.data=function(a){var b,c,d,e,f;if(!a)return a;if(a.provider)e=a.provider;else{e={};for(c in a)f=a[c],"dataType"!==c&&(e[c]=f)}if(b=a.dataType)if("string"==typeof b){if(d=b,b=cola.currentScope.dataType(d),!b)throw new cola.Exception('Unrecognized DataType "'+d+'".')}else b instanceof cola.DataType||(b=new cola.EntityDataType(b));return{$dataType:b,$provider:e}},cola.ElementAttrBinding=function(){function a(a,b,c,d){var e,f,g,h;for(this.element=a,this.attr=b,this.expression=c,this.scope=d,this.paths=this.expression.paths||[],this.watchingMoreMessage=!this.paths.length&&this.expression.hasCallStatement&&!this.expression.hasDefinedPath,h=this.paths,e=0,f=h.length;f>e;e++)g=h[e],d.data.bind(g,this)}return a.prototype.destroy=function(){var a,b,c,d;if(d=this.paths)for(a=0,b=d.length;b>a;a++)c=d[a],this.scope.data.unbind(c,this)},a.prototype.processMessage=function(a,b,c){(cola.constants.MESSAGE_REFRESH<=c&&c<=cola.constants.MESSAGE_CURRENT_CHANGE||this.watchingMoreMessage)&&this.refresh()},a.prototype.evaluate=function(a){return this.expression.evaluate(this.scope,"async",a)},a.prototype._refresh=function(){var a;value=this.evaluate(),a=this.element,a._duringBindingRefresh=!0;try{a.set(this.attr,value)}finally{a._duringBindingRefresh=!1}},a.prototype.refresh=function(){this._refresh&&(this.delay?cola.util.delay(this,"refresh",100,function(){this._refresh()}):this._refresh())},a}(),cola.submit=function(a,b){var c,d,e,f,g;e=a,a={};for(f in e)g=e[f],a[f]=g;if(c=a.data){if(!(c instanceof cola.Entity||c instanceof cola.EntityList))throw new cola.Exception("Invalid submit data.");this.dataFilter&&(d=cola.submit.filter[this.dataFilter],c=d?d(c):c)}return c||a.alwaysSubmit?(a.parameter?a.data={data:c,parameter:a.parameter}:a.data=c,$.post(a.url,a.data).done(function(a){cola.callback(b,!0,a)}).fail(function(a){cola.callback(b,!0,a)}),!0):!1},cola.submit.filter={dirty:function(a){var b;return a instanceof cola.EntityList?(b=[],a.each(function(a){a.state!==cola.Entity.STATE_NONE&&b.push(a)})):a.state!==cola.Entity.STATE_NONE&&(b=a),b},"child-dirty":function(a){return a},"dirty-tree":function(a){return a}},cola.util.dirtyTree=function(a,b,c){return a?(null==c&&(c={}),c.entityMap={},_extractDirtyTree(a,c,b||{})):void 0},_processEntity=function(a,b,c){var d,e,f,g,h;g={simpleValue:!0,entityId:c.entityId||!0,state:!0,oldData:c.oldData},a.state!==cola.Entity.STATE_NONE&&(e=a.toJSON(g)),d=a._data;for(f in d)h=d[f],36!==f.charCodeAt(0)&&h&&(h instanceof cola.Entity||h instanceof cola.EntityList)&&(b.parentProperty=f,h=_extractDirtyTree(h,b,c),null!=h&&(null==e&&(e=a.toJSON(g)),e[f]=h));return null!=e&&(b.entityMap[a.id]=a),e},_processEntityList=function(a,b,c){var d,e,f,g;if(d=[],g=a._first)for(f=g._first;g;)f?(e=_processEntity(f,b,c),null!=e&&d.push(e),f=f._next):(g=g._next,f=null!=g?g._first:void 0);return d.length?d:null},_extractDirtyTree=function(a,b,c){return a instanceof cola.EntityList?_processEntityList(a,b,c):_processEntity(a,b,c)},cola.util.update=function(a,b,c){var d;return null==c&&(c={}),b&&(b instanceof cola.Entity||b instanceof cola.EntityList)&&(d={},b=cola.util.dirtyTree(b,c,d)),b||c.alwaysExecute?$.ajax({url:a,type:c.method||"post",contentType:c.contentType||"application/json",dataType:"json",data:JSON.stringify(b),options:c}).then(function(a){var b,c,e,f,g,h,i,j,k;if(d){g=a.entityMap;for(e in g){if(c=g[e],j=null,b=d.entityMap[e],c){if(c.data){h=c.data;for(f in h)k=h[f],b._set(f,k,!0)}j=c.state}j?b.setState(j):b.state===cola.Entity.STATE_DELETED?null!=(i=b._page)&&i._removeElement(b):b.setState(cola.Entity.STATE_NONE)}}return a.result}):$.Deferred().reject("NO_DATA")},defaultActionTimestamp=0,cola.defaultAction=function(a,b){var c;if(a){if("string"==typeof a&&"function"==typeof b)cola.defaultAction[a]=b;else if("object"==typeof a)for(c in a)a.hasOwnProperty(c)&&(cola.defaultAction[c]=a[c]);defaultActionTimestamp=cola.uniqueId()}},cola.Chain=function(){function a(a){var b;if(this._data=a,cola.Chain.prototype.timestamp!==defaultActionTimestamp){cola.Chain.prototype.timestamp=defaultActionTimestamp;for(b in cola.defaultAction)!cola.Chain.prototype[b]&&cola.defaultAction.hasOwnProperty(b)&&"chain"!==b&&!function(a){return cola.Chain.prototype[a]=function(){var b,c;return b=1<=arguments.length?slice.call(arguments,0):[],this._data=(c=cola.defaultAction)[a].apply(c,[this._data].concat(slice.call(b))),this}}(b)}}return a}(),cola.defaultAction.chain=function(a){return new cola.Chain(a)},cola.defaultAction["default"]=function(a,b){return null==b&&(b=""),a||b},cola.defaultAction["int"]=function(a){return parseInt(a,10)||0},cola.defaultAction["float"]=function(a){return parseFloat(a)||0},cola.defaultAction.is=function(a){return!!a},cola.defaultAction.bool=cola.defaultAction.is,cola.defaultAction.not=function(a){return!a},cola.defaultAction.isEmpty=function(a){return a instanceof Array?0===a.length:a instanceof cola.EntityList?0===a.entityCount:"string"==typeof a?""===a:!a},cola.defaultAction.isNotEmpty=function(a){return!cola.defaultAction.isEmpty(a)},cola.defaultAction.len=function(a){return a?a instanceof Array?a.length:a instanceof cola.EntityList?a.entityCount:0:0},cola.defaultAction.upperCase=function(a){return null!=a?a.toUpperCase():void 0},cola.defaultAction.lowerCase=function(a){return null!=a?a.toLowerCase():void 0},cola.defaultAction.capitalize=function(a){return cola.util.capitalize(a)},cola.defaultAction.resource=function(){var a,b;return a=arguments[0],b=2<=arguments.length?slice.call(arguments,1):[],cola.resource.apply(cola,[a].concat(slice.call(b)))},_matchValue=function(a,b){return b.strict?b.caseSensitive||"string"!=typeof b.value?a===b.value:(a+"").toLowerCase()===b.value:b.caseSensitive?(a+"").indexOf(b.value)>-1:(a+"").toLowerCase().indexOf(b.value)>-1},cola.defaultAction.filter=function(a,b,c){return b=cola._trimCriteria(b,c),cola.util.filter(a,b,c)},cola.defaultAction.sort=cola.util.sort,cola.defaultAction.top=function(a,b){var c,d;return null==b&&(b=1),a?0>b?a:(d=[],d.$origin=a.$origin||a,c=0,cola.each(a,function(a){return c++,d.push(a),b>c}),d):null},cola.defaultAction.formatDate=cola.util.formatDate,cola.defaultAction.formatNumber=cola.util.formatNumber,cola.defaultAction.format=cola.util.format,cola.defaultAction.caption=function(a){var b,c,d,e;return b="",d=a.indexOf("."),d>0&&(c=a.substring(0,d),e=a.substring(d+1),c=this.definition(c),c&&(e=c.getProperty(e),e&&(b=e._caption||e._property))),b},_numberWords=["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen"],cola.defaultAction.number2Word=function(a){return _numberWords[a]},cola.defaultAction.backgroundImage=function(a,b){return a?"url("+a+")":b||"none"},cola.defaultAction.path=function(){var a;return a=1<=arguments.length?slice.call(arguments,0):[],cola.util.path(a)},cola.defaultAction.dictionary=function(a){return cola.util.dictionary(a)},cola.defaultAction.translate=function(a,b){return cola.util.translate(a,b)},cola.AjaxServiceInvoker=function(){function a(a,b){this.ajaxService=a,this.invokerOptions=b,this.callbacks=[]}return a.prototype.invokeCallback=function(a,b){var c,d,e,f;for(this.invoking=!1,d=this.callbacks,this.callbacks=[],e=0,f=d.length;f>e;e++)c=d[e],cola.callback(c,a,b)},a.prototype._internalInvoke=function(a){var b,c,d,e,f,g;null==a&&(a=!0),b=this.ajaxService,c=this.invokerOptions,f=void 0,d={};for(e in c)g=c[e],d[e]=g;return d.async=a,d.sendJson&&(d.data=JSON.stringify(d.data)),b.getListeners("beforeSend")&&b.fire("beforeSend",b,{options:d})===!1?void 0:(this._beforeSend&&this._beforeSend(d),$.ajax(d).done(function(a){return function(c){var e;c=b.translateResult(c,d),b.getListeners("response")&&(e={options:d,result:c},b.fire("response",b,e),c=e.result),a.invokeCallback(!0,c),b.getListeners("success")&&b.fire("success",b,{options:d,result:c}),b.getListeners("complete")&&b.fire("complete",b,{success:!0,options:d,result:c}),f=c}}(this)).fail(function(a){return function(c,e,g){var h,i;return h={xhr:c,status:e,message:g,data:c.responseJSON},i=a.invokeCallback(!1,h),void 0!==i&&(f=i),f===!1?f:(i=b.fire("error",b,{options:d,xhr:c,error:h}),void 0!==i&&(f=i),f===!1?f:(i=b.fire("complete",b,{success:!1,xhr:c,options:d,error:h}),void 0!==i&&(f=i),f))}}(this)),f)},a.prototype.invokeAsync=function(a){return this.callbacks.push(a),this.invoking?!1:(this.invoking=!0,this._internalInvoke(),!0)},a.prototype.invokeSync=function(a){if(this.invoking)throw new cola.Exception("Cannot perform synchronized request during an asynchronized request executing. ["+this.url+"]");return this.callbacks.push(a),this._internalInvoke(!1)},a}(),cola.AjaxService=function(a){function b(a){"string"==typeof a&&(a={url:a}),b.__super__.constructor.call(this,a)}return extend(b,a),b.attributes={url:null,method:null,sendJson:null,parameter:null,timeout:null,ajaxOptions:null},b.events={beforeSend:null,response:null,complete:null,success:null,error:null},b.prototype.getUrl=function(){return this._url},b.prototype.getInvokerOptions=function(a){var b,c,d,e;if(c={},b=this._ajaxOptions)for(d in b)e=b[d],c[d]=e;return c.url=this.getUrl(a),this._method&&(c.method=this._method),this._timeout&&(c.timeout=this._timeout),c.data=this._parameter,this._sendJson&&(c.sendJson=!0,c.method||(c.method="POST"),c.contentType||(c.contentType="application/json")),c},b.prototype.getInvoker=function(a){return new cola.AjaxServiceInvoker(this,this.getInvokerOptions(a))},b.prototype.translateResult=function(a,b){return a},b}(cola.Definition),cola.ProviderInvoker=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype._replaceSysParams=function(a){var b,c,d,e,f,g,h,i,j,k;if(j=a.originUrl||a.url,g=j.match(/{{\$[\w-]+}}/g))for(null==a.originUrl&&(a.originUrl=j),d=0,e=g.length;e>d;d++)f=g[d],h=f.substring(3,f.length-2),h&&(j=j.replace(f,this[h]+""||""),a.url=j,b=!0);if(c=a.originData||a.data)for(i in c)k=c[i],"string"==typeof k&&123===k.charCodeAt(0)&&k.match(/^{{\$[\w-]+}}$/)&&(null==a.originData&&(a.originData=$.extend(c,null)),c[i]=this[k.substring(3,k.length-2)],b=!0);return b},b.prototype.applyPagingParameters=function(a){this._replaceSysParams(a)||(null==a.data&&(a.data={}),"from"===cola.setting("pagingParamStyle")?(a.data.from=this.from,a.data.limit=this.limit+(this.detectEnd?1:0)):(a.data.pageSize=this.pageSize,a.data.pageNo=this.pageNo))},b.prototype._beforeSend=function(a){!this.pageNo>=1&&(this.pageNo=1),this.from=this.pageSize*(this.pageNo-1),this.limit=this.pageSize,this.pageSize&&this.applyPagingParameters(a)},b}(cola.AjaxServiceInvoker),_SYS_PARAMS=["$pageNo","$pageSize","$from","$limit"],_ExpressionDataModel=function(a){function b(a,c){this.entity=c,b.__super__.constructor.call(this,a)}return extend(b,a),b.prototype.get=function(a,b,c){var d;return 64===a.charCodeAt(0)?this.entity.get(a.substring(1)):null!=(d=this.model.parent)?d.data.get(a,b,c):void 0},b.prototype.set=cola._EMPTY_FUNC,b.prototype.processMessage=cola._EMPTY_FUNC,b.prototype.getDataType=cola._EMPTY_FUNC,b.prototype.getProperty=cola._EMPTY_FUNC,b.prototype.flush=cola._EMPTY_FUNC,b}(cola.AbstractDataModel),_ExpressionScope=function(a){function b(a,b){this.parent=a,this.entity=b,this.data=new _ExpressionDataModel(this,this.entity),this.action=this.parent.action}return extend(b,a),b}(cola.SubScope),cola.Provider=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.attributes={loadMode:{defaultValue:"lazy"},pageSize:null,detectEnd:null},b.prototype.getUrl=function(a){var b,c,d,e,f;if(f=this._url,e=f.match(/{{[^{{}}]+}}/g))for(null==a.expressionScope&&(a.expressionScope=new _ExpressionScope(this._scope,a.data)),b=0,c=e.length;c>b;b++)d=e[b],f=f.replace(d,this._evalParamValue(d,a));return f},b.prototype.getInvoker=function(a){var b;return b=new cola.ProviderInvoker(this,this.getInvokerOptions(a)),b.pageSize=this._pageSize,b.detectEnd=this._detectEnd,b},b.prototype._evalParamValue=function(a,b){var c;return 123===a.charCodeAt(0)&&a.match(/^{{[^{{}}]+}}$/)&&(c=a.substring(2,a.length-2),_SYS_PARAMS.indexOf(c)<0&&(c=cola._compileExpression(c)))?c.evaluate(b.expressionScope,"never"):a},b.prototype.getInvokerOptions=function(a){var c,d,e,f,g;if(d=b.__super__.getInvokerOptions.call(this,a),f=d.data,null!=f)if(null==a.expressionScope&&(a.expressionScope=new _ExpressionScope(this._scope,a.data)),"string"==typeof f)f=this._evalParamValue(f,a);else if("function"==typeof f&&(f=f(this,a)),"object"==typeof f){c=f,f={};for(e in c)g=c[e],"string"==typeof g&&(g=this._evalParamValue(g,a)),f[e]=g}return null==f?f={}:f instanceof Object||(f={parameter:f}),d.data=f,null==d.dataType&&(d.dataType="json"),d},b.prototype.translateResult=function(a,b){return this._detectEnd&&a instanceof Array&&(a=a.length>=this._pageSize?a.slice(0,this._pageSize):{$entityCount:(b.data.from||0)+a.length,$data:a}),a},b}(cola.AjaxService),_$=$(),_$.length=1,this.$fly=function(a){return _$[0]=a,_$},cola.util.setText=function(a,b){null==b&&(b=""),cola.browser.mozilla?("string"==typeof b&&(b=b.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\n/g,"<br>")),a.innerHTML=b):a.innerText=b},doms={},cola.util.cacheDom=function(a){cola._ignoreNodeRemoved=!0,doms.hiddenDiv||(doms.hiddenDiv=$.xCreate({tagName:"div",id:"_hidden_div",style:{display:"none"}}),doms.hiddenDiv.setAttribute(cola.constants.IGNORE_DIRECTIVE,""),document.body.appendChild(doms.hiddenDiv)),doms.hiddenDiv.appendChild(a),cola._ignoreNodeRemoved=!1},USER_DATA_KEY=cola.constants.DOM_USER_DATA_KEY,cola.util.userDataStore={size:0},cola.util.userData=function(a,b,c){var d,e,f,g,h,i,j;if(3!==a.nodeType)if(i=cola.util.userDataStore,8===a.nodeType?(h=a.nodeValue,d=h.indexOf("|"),d>-1&&(e=h.substring(d+1))):a.getAttribute&&(e=a.getAttribute(USER_DATA_KEY)),3===arguments.length)e?(g=i[e],g||(i[e]=g={__cleanStamp:cleanStamp})):(e=cola.uniqueId(),8===a.nodeType?d>-1?a.nodeValue=h.substring(0,d+1)+e:a.nodeValue=h?h+"|"+e:"|"+e:a.getAttribute&&a.setAttribute(USER_DATA_KEY,e),i[e]=g={__cleanStamp:cleanStamp},i.size++),g[b]=c;else if(2===arguments.length){if("string"==typeof b){if(e)return g=i[e],null!=g?g[b]:void 0}else if(b&&"object"==typeof b){e=cola.uniqueId(),8===a.nodeType?d>-1?a.nodeValue=h.substring(0,d+1)+e:a.nodeValue=h?h+"|"+e:"|"+e:a.getAttribute&&a.setAttribute(USER_DATA_KEY,e),i[e]=g={__cleanStamp:cleanStamp};for(f in b)j=b[f],g[f]=j}}else if(1===arguments.length&&e)return i[e]},cola.util.removeUserData=function(a,b){var c,d,e,f;return 8===a.nodeType?(f=a.nodeValue,c=f.indexOf("|"),c>-1&&(d=f.substring(c+1))):a.getAttribute&&(d=a.getAttribute(USER_DATA_KEY)),d&&(e=cola.util.userDataStore[d],e&&(b?(value=e[b],delete e[b]):(delete cola.util.userDataStore[d],userData.size--))),value},ON_NODE_REMOVED_KEY="__onNodeRemoved",cola.detachNode=function(a){a.parentNode&&(cola._ignoreNodeRemoved=!0,a.parentNode.removeChild(a),cola._ignoreNodeRemoved=!1)},cola.util.onNodeDispose=function(a,b){var c;c=cola.util.userData(a,ON_NODE_REMOVED_KEY),c?c instanceof Array?c.push(b):cola.util.userData(a,ON_NODE_REMOVED_KEY,[c,b]):cola.util.userData(a,ON_NODE_REMOVED_KEY,b)},_nodesToBeRemove={},_getNodeDataId=function(a){var b,c,d;if(3!==a.nodeType)return 8===a.nodeType?(d=a.nodeValue,b=d.indexOf("|"),b>-1&&(c=d.substring(b+1))):a.getAttribute&&(c=a.getAttribute(USER_DATA_KEY)),c},_DOMNodeInsertedListener=function(a){var b,c,d;if(d=a.target){for(b=d.firstChild;b;)c=_getNodeDataId(b),c&&delete _nodesToBeRemove[c],b=b.nextSibling;c=_getNodeDataId(d),c&&delete _nodesToBeRemove[c]}},_DOMNodeRemovedListener=function(a){var b,c,d;if(!cola._ignoreNodeRemoved&&!window.closed&&(d=a.target)){for(b=d.firstChild;b;)c=_getNodeDataId(b),c&&(_nodesToBeRemove[c]=b),b=b.nextSibling;c=_getNodeDataId(d),c&&(_nodesToBeRemove[c]=d)}},cleanStamp=1,cola.browser.ie&&cola.browser.ie<9?setTimeout(function(){var a;a=0,setInterval(function(){var b,c,d,e,f,g,h;if(!(cola.util.userDataStore.size<256)){for(h=cola.util.userDataStore,b=0,d=document.all.length;d>a;)if(e=document.all[a],c=null,8===e.nodeType?(g=e.nodeValue,a=g.indexOf("|"),a>-1&&(c=g.substring(a+1))):e.getAttribute&&(c=e.getAttribute(USER_DATA_KEY)),c&&(f=h[c],f&&(f.__cleanStamp=cleanStamp)),a++,b++,b>=64)return;for(c in h)f=h[c],f!==cleanStamp&&delete h[c];cleanStamp++}},1e3)},1e4):(document.addEventListener("DOMNodeInserted",_DOMNodeInsertedListener),document.addEventListener("DOMNodeRemoved",_DOMNodeRemovedListener),$fly(window).on("unload",function(){document.removeEventListener("DOMNodeInserted",_DOMNodeInsertedListener),document.removeEventListener("DOMNodeRemoved",_DOMNodeRemovedListener)}),setInterval(function(){var a,b,c,d,e,f,g,h;for(b in _nodesToBeRemove)if(f=_nodesToBeRemove[b],h=cola.util.userDataStore[b]){if(a=!0,g=h[ON_NODE_REMOVED_KEY])if(g instanceof Array)for(c=0,d=g.length;d>c;c++)(e=g[c])(f,h);else g(f,h);delete cola.util.userDataStore[b]}a&&(_nodesToBeRemove={})},1e4)),cola.util.getGlobalTemplate=function(a){var b,c;return c=document.getElementById(a),c&&(b=c.innerHTML,c.hasAttribute("shared")||$fly(c).remove()),b},cola.browser.webkit?(browser="webkit",cola.browser.chrome?browser+=" chrome":cola.browser.safari&&(browser+=" safari")):browser=cola.browser.ie?"ie":cola.browser.mozilla?"mozilla":"",os=cola.os.android?" android":cola.os.ios?" ios":cola.os.windows?" windows":"",cola.device.mobile?os+=" mobile":cola.device.desktop&&(os+=" desktop"),(browser||os)&&$fly(document.documentElement).addClass(browser+os),cola.loadSubView=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(l=[],e=!1,p=function(c,d,f){var g,h,i,j,k,m,n,o,p;if(c){if(!e&&(j=l.indexOf(f),j>-1&&l.splice(j,1),0===l.length)){if($fly(a).removeClass("loading"),a.hasAttribute(cola.constants.IGNORE_DIRECTIVE)&&(i=!0,a.removeAttribute(cola.constants.IGNORE_DIRECTIVE)),b.suspendedInitFuncs.length)for(o=b.model,p=b.suspendedInitFuncs,m=0,n=p.length;n>m;m++)(k=p[m])(a,b.model,b.param);else cola(a,b.model);cola._renderDomTemplate(a,o),i&&a.setAttribute(cola.constants.IGNORE_DIRECTIVE,!0),cola.getListeners("ready")&&(cola.fire("ready",cola),cola.off("ready")),cola.callback(b.callback,!0)}}else if(!e&&(e=!0,g=d,cola.callback(b.callback,!1,g)!==!1))throw h=g.xhr?g.status+" "+g.message:g.message,new cola.Exception("Failed to load resource from ["+f+"]. "+h)},$fly(a).addClass("loading"),f=b.htmlUrl,f&&l.push(f),b.jsUrl)if(h=[],b.jsUrl instanceof Array)for(n=b.jsUrl,i=0,j=n.length;j>i;i++)g=n[i],g=_compileResourceUrl(g,f,".js"),g&&(l.push(g),h.push(g));else g=_compileResourceUrl(b.jsUrl,f,".js"),g&&(l.push(g),h.push(g));if(b.cssUrl)if(d=[],b.cssUrl instanceof Array)for(o=b.cssUrl,m=0,k=o.length;k>m;m++)c=o[m],c=_compileResourceUrl(c,f,".css"),c&&(l.push(c),d.push(c));else c=_compileResourceUrl(b.cssUrl,f,".css"),c&&(l.push(c),d.push(c));b.suspendedInitFuncs=[],f&&_loadHtml(a,f,b,{complete:function(a,b){return p(a,b,f)}}),null!=h&&h.forEach(function(a){return _loadJs(b,a,{complete:function(b,c){return p(b,c,a)}})}),null!=d&&d.forEach(function(a){return _loadCss(b,a,{complete:function(b,c){return p(b,c,a)}})})},cola.unloadSubView=function(a,b){var c,d,e,f,g;if($fly(a).empty(),d=b.htmlUrl,b.cssUrl)if(b.cssUrl instanceof Array)for(g=b.cssUrl,e=0,f=g.length;f>e;e++)c=g[e],c=_compileResourceUrl(c,d,".css"),c&&_unloadCss(c);else c=_compileResourceUrl(b.cssUrl,d,".css"),c&&_unloadCss(c)},_compileResourceUrl=function(a,b,c){var d,e;return"$"===a?d=!0:0===a.indexOf("$.")&&(d=!0,c=a.substring(2)),d&&(a=null,b&&(e=b.indexOf("?"),e>0&&(b=b.substring(0,e)),e=b.lastIndexOf("."),a=(e>0?b.substring(0,e):b)+c)),a},_loadHtml=function(a,b,c,d){$.ajax(b,{timeout:c.timeout}).done(function(b){$(a).html(b),cola.callback(d,!0)}).fail(function(a,b,c){cola.callback(d,!1,{xhr:a,status:b,message:c})})},_jsCache={},_loadJs=function(a,b,c){var d;d=_jsCache[b],d?(Array.prototype.push.apply(a.suspendedInitFuncs,d),cola.callback(c,!0)):$.ajax(b,{dataType:"text",cache:!0,timeout:a.timeout}).done(function(d){var e,f,g;g=$.xCreate({tagName:"script",language:"javascript",type:"text/javascript",charset:cola.setting("defaultCharset")}),g.text=d,cola._suspendedInitFuncs=a.suspendedInitFuncs;try{try{f=document.querySelector("head")||document.documentElement,f.appendChild(g)}finally{delete cola._suspendedInitFuncs,_jsCache[b]=a.suspendedInitFuncs}cola.callback(c,!0)}catch(h){e=h,cola.callback(c,!1,e)}}).fail(function(a,b,d){cola.callback(c,!1,{xhr:a,status:b,message:d})})},_cssCache={},_loadCss=function(a,b,c){var d,e,f,g;return e=_cssCache[b],e?(f=parseInt(e.getAttribute("_refNum"))||1,e.setAttribute("_refNum",f+1+""),cola.callback(c,!0),!1):(e=$.xCreate({tagName:"link",rel:"stylesheet",type:"text/css",charset:cola.setting("defaultCharset"),href:b}),a.timeout&&(g=setTimeout(function(){$fly(e).remove(),cola.callback(c,!1,{status:"timeout"})},a.timeout)),cola.os.android&&cola.os.version<4.4||$(e).one("load",function(){g&&clearTimeout(g),cola.callback(c,!0)}).on("readystatechange",function(a){var b;"complete"===(null!=(b=a.target)?b.readyState:void 0)&&(g&&clearTimeout(g),$fly(this).off("readystatechange"),
cola.callback(c,!0))}).one("error",function(a){g&&clearTimeout(g),cola.callback(c,!1,a)}),d=document.querySelector("head")||document.documentElement,e.setAttribute("_refNum","1"),d.appendChild(e),_cssCache[b]=e,cola.os.android&&cola.os.version<4.4&&(g&&clearTimeout(g),cola.callback(c,!0)),!0)},_unloadCss=function(a){var b,c;b=_cssCache[a],b&&(c=parseInt(b.getAttribute("_refNum"))||1,c>1?b.setAttribute("_refNum",c-1+""):(delete _cssCache[a],$fly(b).remove()))},routerRegistry=null,currentRoutePath=null,currentRouter=null,trimPath=function(a){return a&&(47!==a.charCodeAt(0)&&(a="/"+a),47===a.charCodeAt(a.length-1)&&(a=a.substring(0,a.length-1))),a||""},ignoreRouterSettingChange=!1,cola.on("settingChange",function(a,b){var c,d;ignoreRouterSettingChange||"routerContextPath"!==b.key&&"defaultRouterPath"!==b.key||(c=cola.setting(b.key),d=trimPath(c),d!==c&&(ignoreRouterSettingChange=!0,cola.setting(b.key,d),ignoreRouterSettingChange=!1))}),cola.route=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(null==routerRegistry&&(routerRegistry=new cola.util.KeyedArray),"function"==typeof b&&(b={enter:b}),b.path=a=trimPath(a),a=a.slice(1),!b.name){for(h=a||cola.constants.DEFAULT_PATH,m=h.split(/[\/\-]/),i=[],d=e=0,f=m.length;f>e;d=++e)l=m[d],l&&58!==l.charCodeAt(0)&&i.push(i.length>0?cola.util.capitalize(l):l);b.name=i.join("")}if(b.pathParts=n=[],a){for(c=!1,o=a.split("/"),j=0,g=o.length;g>j;j++)l=o[j],58===l.charCodeAt(0)?(k=63===l.charCodeAt(l.length-1),p=k?l.substring(1,l.length-1):l.substring(1),c=!0,n.push({variable:p,optional:k})):n.push(l);b.hasVariable=c}return routerRegistry.add(b.path,b),b},cola.getCurrentRoutePath=function(){return currentRoutePath},cola.getCurrentRouter=function(){return currentRouter},cola.setRoutePath=function(a,b,c){var d,e,f,g,h;a&&35===a.charCodeAt(0)?(h="hash",a=a.substring(1)):h=cola.setting("routerMode")||"hash","hash"===h?(47!==a.charCodeAt(0)&&(a="/"+a),window.location.hash!==a&&(window.location.hash=a),c&&_onHashChange()):(e=cola.setting("routerContextPath"),g=e&&47===a.charCodeAt(0)?cola.util.path(e,a):a,f=g,d=f.indexOf("?"),d>=0&&(f=f.substring(0,d)),d=f.indexOf("#"),d>=0&&(f=f.substring(0,d)),location.pathname!==f?(b?window.history.replaceState({path:g},null,g):window.history.pushState({path:g},null,g),location.pathname!==f&&(g=location.pathname+location.search+location.hash,e&&0===g.indexOf(e)&&(a=g.substring(e.length)),window.history.replaceState({path:g,originPath:a},null,g)),_onStateChange(a)):c&&_onStateChange(f))},_findRouter=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(!routerRegistry)return null;for(null==a&&(a=cola.setting("defaultRouterPath")),a=trimPath(a).slice(1),l=a?a.split(/[\/\?\#]/):[],m=routerRegistry.elements,f=0,g=m.length;g>f;f++)if(n=m[f],c=n.pathParts,d=c.length-l.length,0===d||1===d&&c.length>0&&c[c.length-1].optional){for(i=!0,k={},e=j=0,h=c.length;h>j;e=++j)if(b=c[e],"string"==typeof b){if(b!==l[e]){i=!1;break}}else{if(e>=l.length&&!b.optional){i=!1;break}k[b.variable]=l[e]}if(i)break}return i?(n.param=k,n):null},cola.createRouterModel=function(a){var b,c;if(a.parentModel instanceof cola.Scope?b=a.parentModel:(c=a.parentModel||cola.constants.DEFAULT_PATH,b=cola.model(c)),!b)throw new cola.Exception('Parent Model "'+c+'" is undefined.');return new cola.Model(a.name,b)},_switchRouter=function(a,b){var c,d,e,f;return a.redirectTo?void cola.setRoutePath(a.redirectTo):(c={path:b,prev:currentRouter,next:a},void(cola.fire("beforeRouterSwitch",cola,c)!==!1&&(currentRouter&&("function"==typeof currentRouter.leave&&currentRouter.leave(currentRouter),currentRouter.targetDom&&(cola.unloadSubView(currentRouter.targetDom,{cssUrl:currentRouter.cssUrl}),e=cola.util.removeUserData(currentRouter.targetDom,"_model"),null!=e&&e.destroy())),a.templateUrl&&(a.target&&(f=a.target.nodeType?a.target:$(a.target)[0]),f||(f=document.getElementsByClassName(cola.constants.VIEW_PORT_CLASS)[0],f||(f=document.getElementsByClassName(cola.constants.VIEW_CLASS)[0],f||(f=document.body))),a.targetDom=f,$fly(f).empty()),currentRouter=a,a.templateUrl?(d=cola.createRouterModel(a),c.nextModel=d,cola.util.userData(a.targetDom,"_model",d),cola.loadSubView(a.targetDom,{model:d,htmlUrl:a.templateUrl,jsUrl:a.jsUrl,cssUrl:a.cssUrl,data:a.data,param:a.param,callback:function(){"function"==typeof a.enter&&a.enter(a,d),a.title&&(document.title=a.title)}})):("function"==typeof a.enter&&a.enter(a,null),a.title&&(document.title=a.title)),cola.fire("routerSwitch",cola,c))))},_getHashPath=function(){var a;return a=location.hash,a&&(a=a.substring(1)),33===(null!=a?a.charCodeAt(0):void 0)&&(a=a.substring(1)),a.indexOf("?")>=0&&(a=a.substring(0,a.indexOf("?"))),trimPath(a)},_onHashChange=function(){var a,b;"hash"===(cola.setting("routerMode")||"hash")&&(a=_getHashPath(),a!==currentRoutePath&&(currentRoutePath=a,b=_findRouter(a),b&&_switchRouter(b,a)))},_onStateChange=function(a){var b,c,d;"state"===cola.setting("routerMode")&&(a=trimPath(a),b=a.indexOf("#"),b>-1&&(a=a.substring(b+1)),47===a.charCodeAt(0)&&(d=cola.setting("routerContextPath"),d&&0===a.indexOf(d)&&(a=a.slice(d.length))),a!==currentRoutePath&&(currentRoutePath=a,b=a.indexOf("?"),b>-1&&(a=a.substring(0,b)),c=_findRouter(a),c&&_switchRouter(c,a)))},$(function(){setTimeout(function(){var a,b;$fly(window).on("hashchange",_onHashChange).on("popstate",function(){var a;location.hash||(a=window.history.state,_onStateChange((null!=a?a.path:void 0)||location.pathname+location.search+location.hash))}),$(document.body).delegate("a.state","click",function(){var a,b;return a=this.getAttribute("href"),a&&(b=this.getAttribute("target"),!b||"_self"===b)?(cola.setRoutePath(a),!1):void 0}),a=_getHashPath(),a?(b=_findRouter(a),b&&_switchRouter(b,a)):(b=_findRouter(null),b&&cola.setRoutePath((b.redirectTo||cola.setting("defaultRouterPath")||"")+location.search,!0,!0))},0)}),cola._BindingFeature=function(){function a(){}return a.prototype.init=function(){},a}(),cola._ExpressionFeature=function(a){function b(a){this.expression=a,this.expression&&(this.isStatic=this.expression.isStatic,this.paths=this.expression.paths||[],!this.paths.length&&this.expression.hasCallStatement&&(this.paths=["**"],this.isStatic||(this.delay=!0),this.watchingMoreMessage=!this.expression.hasDefinedPath))}return extend(b,a),b.prototype.evaluate=function(a,b,c){var d;return null==b&&(b={}),null==c&&(c="async"),d=a.scope,null==b.vars&&(b.vars={}),b.vars.$dom=a.dom,this.expression.evaluate(d,c,b)},b.prototype.refresh=function(a,b,c){null==c&&(c={}),this._refresh&&(this.delay&&!b?cola.util.delay(a,"refresh",100,function(b){return function(){b._refresh(a,c),b.isStatic&&!c.unloaded&&(b.disabled=!0)}}(this)):(this._refresh(a,c),this.isStatic&&!c.unloaded&&(this.disabled=!0)))},b}(cola._BindingFeature),cola._AliasFeature=function(a){function b(a){b.__super__.constructor.call(this,a),this.alias=a.alias}return extend(b,a),b.prototype.ignoreBind=!0,b.prototype.init=function(a){a.scope=new cola.AliasScope(a.scope,this.expression),a.subScopeCreated=!0},b.prototype._refresh=function(a,b){var c;c=this.evaluate(a,b),a.scope.data.setTargetData(c)},b}(cola._ExpressionFeature),cola._RepeatFeature=function(a){function b(a){b.__super__.constructor.call(this,a),this.alias=a.alias}return extend(b,a),b.prototype.ignoreBind=!0,b.prototype.init=function(a){var b;a.scope=b=new cola.ItemsScope(a.scope,this.expression),b.onItemsRefresh=function(b){return function(){b.onItemsRefresh(a)}}(this),b.onCurrentItemChange=function(b){var c,d,e;if(a.currentItemDom&&$fly(a.currentItemDom).removeClass(cola.constants.COLLECTION_CURRENT_CLASS),b.current&&a.itemDomBindingMap&&(e=cola.Entity._getEntityId(b.current))){if(d=a.itemDomBindingMap[e],!d)return void this.onItemsRefresh(a);c=d.dom,$fly(c).addClass(cola.constants.COLLECTION_CURRENT_CLASS)}a.currentItemDom=c},b.onItemInsert=function(b){return function(c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(e=a.dom,r=cola.util.userData(e,cola.constants.REPEAT_TAIL_KEY),s=cola.util.userData(e,cola.constants.REPEAT_TEMPLATE_KEY),d=c.entity,l=c.itemsScope,j=c.insertMode,j&&"end"!==j?"begin"===j?i=1:"before"===j?(q=l.getItemScope(c.refEntity),i=null!=q?q.data.getIndex():void 0):"after"===j&&(q=l.getItemScope(c.refEntity),i=(null!=q?q.data.getIndex():void 0)+1):i=c.entityList.entityCount,k=b.createNewItem(a,s,a.scope,d,i),j&&"end"!==j){"begin"===j?$fly(e).after(k):a.itemDomBindingMap&&(p=cola.Entity._getEntityId(c.refEntity),p&&(o=null!=(m=a.itemDomBindingMap[p])?m.dom:void 0,o&&("before"===j?$fly(o).before(k):$fly(o).after(k)))),n=l.itemScopeMap;for(h in n)g=n[h],f=g.data.getIndex(),f>=i&&g.data.getTargetData()!==d&&g.data.setIndex(f+1)}else $fly(r).before(k)}}(this),b.onItemRemove=function(b){var c,d,e,f,g,h,i,j,k,l;if(c=b.entity,k=b.itemsScope,i=cola.Entity._getEntityId(c),i&&(j=k.getItemScope(c),h=a.itemDomBindingMap[i],h&&(k.unregItemScope(i),h.remove(),h.dom===a.currentItemDom&&delete a.currentItemDom),j&&(g=j.data.getIndex(),g<b.entityList.entityCount))){l=k.itemScopeMap;for(f in l)e=l[f],d=e.data.getIndex(),d>g&&e.data.setIndex(d-1)}},a.subScopeCreated=!0},b.prototype._refresh=function(a,b){a.scope.retrieveData(),a.scope.refreshItems()},b.prototype.onItemsRefresh=function(a){var b,c,d,e,f,g,h,i,j;if(h=a.scope,f=h.items,g=h.originItems,f&&!(f instanceof cola.EntityList)&&!(f instanceof Array))throw new cola.Exception('Expression "'+this.expression+'" must bind to EntityList or Array.');if(f!==a.items||f&&f.timestamp!==a.timestamp)if(a.items=f,a.timestamp=(null!=f?f.timestamp:void 0)||0,d=a.dom,i=cola.util.userData(d,cola.constants.REPEAT_TAIL_KEY),j=cola.util.userData(d,cola.constants.REPEAT_TEMPLATE_KEY),i||(i=document.createComment("Repeat Tail |"+d.nodeValue.split("|")[1]),$fly(d).after(i),cola.util.userData(d,cola.constants.REPEAT_TAIL_KEY,i)),b=d,c=null,f&&(a.itemDomBindingMap={},h.resetItemScopeMap(),a.currentItemDom&&$fly(a.currentItemDom).removeClass(cola.constants.COLLECTION_CURRENT_CLASS),cola.each(f,function(c){return function(d,e){var k,l,m,n;null!=d&&(k=b.nextSibling,k===i&&(k=null),k?(l=cola.util.userData(k,cola.constants.DOM_BINDING_KEY),n=l.scope,m="object"==typeof d?cola.Entity._getEntityId(d):cola.uniqueId(),h.regItemScope(m,n),l.itemId=m,a.itemDomBindingMap[m]=l,n.data.setTargetData(d),n.data.setIndex(e+1)):(k=c.createNewItem(a,j,h,d,e+1),$fly(i).before(k)),d===(f.current||(null!=g?g.current:void 0))&&($fly(k).addClass(cola.constants.COLLECTION_CURRENT_CLASS),a.currentItemDom=k),b=k)}}(this))),c)$fly(i).before(c);else for(e=b.nextSibling;e&&e!==i;)b=e,e=b.nextSibling,$fly(b).remove()},b.prototype.createNewItem=function(a,b,c,d,e){var f,g,h,i,j;return i=new cola.ItemScope(c,this.alias),i.data.setTargetData(d,!0),i.data.setIndex(e,!0),g=b.cloneNode(!0),this.deepCloneNodeData(g,i,!1),j=cola.util.userData(b,cola.constants.DOM_BINDING_KEY),f=j.clone(g,i),this.refreshItemDomBinding(g,i),h="object"==typeof d?cola.Entity._getEntityId(d):cola.uniqueId(),c.regItemScope(h,i),f.itemId=h,a.itemDomBindingMap[h]=f,g},b.prototype.deepCloneNodeData=function(a,b,c){var d,e,f,g,h;if(g=cola.util.userData(a)){e={};for(f in g){if(h=g[f],f===cola.constants.DOM_BINDING_KEY)c&&(h=h.clone(a,b));else if("__"===f.substring(0,2))continue;e[f]=h}cola.util.userData(a,e)}for(d=a.firstChild;d;)3===d.nodeType||("function"==typeof d.hasAttribute?d.hasAttribute(cola.constants.IGNORE_DIRECTIVE):void 0)||this.deepCloneNodeData(d,b,!0),d=d.nextSibling},b.prototype.refreshItemDomBinding=function(a,b){var c,d,e,f,g,h,i;for(e=cola.util.userData(a,cola.constants.DOM_BINDING_KEY),e&&(e.refresh(),b=e.subScope||e.scope,e instanceof cola._RepeatDomBinding&&(d=cola.util.userData(e.dom,cola.constants.REPEAT_TAIL_KEY))),c=a.firstChild;c;)3===c.nodeType||("function"==typeof c.hasAttribute?c.hasAttribute(cola.constants.IGNORE_DIRECTIVE):void 0)||(c=this.refreshItemDomBinding(c,b)),c=c.nextSibling;if(g=cola.util.userData(a,cola.constants.DOM_INITIALIZER_KEY)){for(h=0,i=g.length;i>h;h++)(f=g[h])(b,a);cola.util.removeUserData(a,cola.constants.DOM_INITIALIZER_KEY)}return d||a},b}(cola._ExpressionFeature),cola._WatchFeature=function(a){function b(a,b){this.action=a,this.paths=b,this.watchingMoreMessage=!0}return extend(b,a),b.prototype.processMessage=function(a,b){this.refresh(a)},b.prototype.refresh=function(a){var b;if(b=a.scope.action(this.action),!b)throw new cola.Exception('No action named "'+this.action+'" found.');b(a.dom,a.scope)},b}(cola._BindingFeature),cola._EventFeature=function(a){function b(a,b){this.expression=a,this.event=b}return extend(b,a),b.prototype.ignoreBind=!0,b.prototype.init=function(a){a.$dom.on(this.event,function(b){return function(c){var d;d=cola.currentScope,cola.currentScope=a.scope;try{return b.evaluate(a,{vars:{$event:c}},"never")}finally{cola.currentScope=d}}}(this))},b}(cola._ExpressionFeature),cola._DomFeature=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.writeBack=function(a,b){var c,d;(null!=(d=this.expression)?d.writeable:void 0)&&(c=this.paths,c&&1===c.length&&(this.ignoreMessage=!0,a.scope.set(c[0],b),this.ignoreMessage=!1))},b.prototype.processMessage=function(a,b,c,d,e){(cola.constants.MESSAGE_REFRESH<=d&&d<=cola.constants.MESSAGE_CURRENT_CHANGE||this.watchingMoreMessage)&&this.refresh(a,!1)},b.prototype._refresh=function(a,b){this.ignoreMessage||(value=this.evaluate(a,b),this._doRender(a,value))},b}(cola._ExpressionFeature),cola._DomAttrFeature=function(a){function b(a,c){this.attr=c,b.__super__.constructor.call(this,a)}return extend(b,a),b.prototype._doRender=function(a,b){var c,d;b instanceof Date&&(d=cola.setting("defaultDateFormat"),d&&(b=cola.defaultAction.formatDate(b,d))),c=this.attr,"text"===c?cola.util.setText(a.dom,null!=b?b:""):"html"===c?a.$dom.html(null!=b?b:""):a.dom.setAttribute(c,null!=b?b:"")},b}(cola._DomFeature),cola._DomStylePropFeature=function(a){function b(a,c){this.prop=c,b.__super__.constructor.call(this,a)}return extend(b,a),b.prototype._doRender=function(a,b){a.$dom.css(this.prop,b)},b}(cola._DomFeature),cola._DomClassFeature=function(a){function b(a){b.__super__.constructor.call(this,a)}return extend(b,a),b.prototype._doRender=function(a,b){this._lastClassName&&a.$dom.removeClass(this._lastClassName),b&&(a.$dom.addClass(b),this._lastClassName=b)},b}(cola._DomFeature),cola._DomToggleClassFeature=function(a){function b(a,c){this.className=c,b.__super__.constructor.call(this,a)}return extend(b,a),b.prototype._doRender=function(a,b){a.$dom[b?"addClass":"removeClass"](this.className)},b}(cola._DomFeature),cola._TextBoxFeature=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.init=function(a){var c;c=this,a.$dom.on("input",function(){c.writeBack(a,this.value)}),b.__super__.init.call(this)},b.prototype._doRender=function(a,b){a.dom.value=null!=b?b:""},b}(cola._DomFeature),cola._CheckboxFeature=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.init=function(a){var c;c=this,a.$dom.on("click",function(){c.writeBack(a,this.checked)}),b.__super__.init.call(this)},b.prototype._doRender=function(a,b){var c;c=cola.DataType.defaultDataTypes["boolean"].parse(b),a.dom.checked=c},b}(cola._DomFeature),cola._RadioFeature=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.init=function(a){a.$dom.on("click",function(){var b;b=this.checked,b&&this.writeBack(a,b)}),b.__super__.init.call(this)},b.prototype._doRender=function(a,b){a.dom.checked=b===a.dom.value},b}(cola._DomFeature),cola._SelectFeature=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.init=function(a){var c;c=this,a.$dom.on("change",function(){value=this.options[this.selectedIndex],c.writeBack(a,null!=value?value.value:void 0)}),b.__super__.init.call(this)},b.prototype._doRender=function(a,b){a.dom.value=b},b}(cola._DomFeature),cola._DisplayFeature=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype._doRender=function(a,b){a.dom.style.display=b?"":"none"},b}(cola._DomFeature),cola._SelectOptionsFeature=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype._doRender=function(a,b){var c;(b instanceof Array||b instanceof cola.EntityList)&&(c=a.dom.options,b instanceof cola.EntityList?c.length=b.entityCount:c.length=b.length,cola.each(b,function(a,b){var d;d=c[b],cola.util.isSimpleValue(a)?(d.removeAttribute("value"),$fly(d).text(a)):a instanceof cola.Entity?d.setAttribute("value",a.get("value")||a.get("key")).text(a.get("text")||a.get("name")):d.setAttribute("value",a.value||a.key).text(a.text||a.name)}))},b}(cola._DomFeature),_destroyDomBinding=function(a,b){var c;c=b[cola.constants.DOM_BINDING_KEY],null!=c&&c.destroy()},cola._DomBinding=function(){function a(a,b,c){var d,e,f;if(this.scope=b,this.dom=a,this.$dom=$(a),c)for(e=0,f=c.length;f>e;e++)d=c[e],this.addFeature(d);cola.util.userData(a,cola.constants.DOM_BINDING_KEY,this),cola.util.onNodeDispose(a,_destroyDomBinding)}return a.prototype.destroy=function(){var a,b;if(a=this.features)for(b=a.length-1;b>=0;)this.unbindFeature(a[b]),b--;delete this.dom,delete this.$dom},a.prototype.addFeature=function(a){null==a.id&&(a.id=cola.uniqueId()),"function"==typeof a.init&&a.init(this),this.features?this.features.push(a):this.features=[a],a.ignoreBind||this.bindFeature(a)},a.prototype.removeFeature=function(a){var b,c;b=this.features,b&&(c=b.indexOf(a),c>-1&&b.splice(c,1),a.ignoreBind||this.unbindFeature(a))},a.prototype.bindFeature=function(a){var b,c,d,e;if(a.processMessage&&(e=a.paths))for(b=0,c=e.length;c>b;b++)d=e[b],this.bind(d,a)},a.prototype.unbindFeature=function(a){var b,c,d,e;if(a.processMessage&&(e=a.paths))for(b=0,c=e.length;c>b;b++)d=e[b],this.unbind(d,a)},a.prototype.bind=function(a,b){var c,d;d={path:a,processMessage:function(a){return function(c,e,f,g){b.disabled?d.disabled=!0:(b.processMessage(a,c,e,f,g),b.disabled&&(d.disabled=!0))}}(this)},this.scope.data.bind(a,d),c=this[b.id],c?c.push(d):this[b.id]=[d]},a.prototype.unbind=function(a,b){var c,d,e,f,g;if(c=this[b.id]){for(d=e=0,f=c.length;f>e;d=++e)if(g=c[d],g.path===a){this.scope.data.unbind(a,c[d]),c.splice(d,1);break}c.length||delete this[b.id]}},a.prototype.refresh=function(a){var b,c,d,e;if(this.features)for(e=this.features,c=0,d=e.length;d>c;c++)b=e[c],b.refresh(this,a)},a.prototype.clone=function(a,b){return new this.constructor(a,b,this.features,!0)},a}(),cola._AliasDomBinding=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.destroy=function(){b.__super__.destroy.call(this),this.subScopeCreated&&this.scope.destroy()},b}(cola._DomBinding),cola._RepeatDomBinding=function(a){function b(a,c,d,e){var f,g,h,i,j;if(e)b.__super__.constructor.call(this,a,c,d);else if(this.scope=c,g=document.createComment("Repeat Head "),cola._ignoreNodeRemoved=!0,a.parentNode.replaceChild(g,a),cola.util.cacheDom(a),cola._ignoreNodeRemoved=!1,this.dom=g,cola.util.userData(g,cola.constants.DOM_BINDING_KEY,this),cola.util.userData(g,cola.constants.REPEAT_TEMPLATE_KEY,a),cola.util.onNodeDispose(g,_destroyDomBinding),j=new cola._RepeatItemDomBinding(a,null),j.repeatDomBinding=this,j.isTemplate=!0,d)if(d instanceof Array)for(h=0,i=d.length;i>h;h++)f=d[h],f instanceof cola._RepeatFeature?this.addFeature(f):j.addFeature(f);else d instanceof cola._RepeatFeature?this.addFeature(d):j.addFeature(d)}return extend(b,a),b.prototype.destroy=function(){b.__super__.destroy.call(this),this.subScopeCreated&&this.scope.destroy(),delete this.currentItemDom},b}(cola._DomBinding),cola._RepeatItemDomBinding=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.prototype.destroy=function(){var a;b.__super__.destroy.call(this),this.isTemplate||null!=(a=this.repeatDomBinding.itemDomBindingMap)&&delete a[this.itemId]},b.prototype.clone=function(a,c){var d;return d=b.__super__.clone.call(this,a,c),d.repeatDomBinding=this.repeatDomBinding,d},b.prototype.bind=function(a,c){return this.isTemplate?void 0:b.__super__.bind.call(this,a,c)},b.prototype.bindFeature=function(a){return this.isTemplate?void 0:b.__super__.bindFeature.call(this,a)},b.prototype.processDataMessage=function(a,b,c){this.isTemplate||this.scope.data.processMessage("**",a,b,c)},b.prototype.refresh=function(){return this.isTemplate?void 0:b.__super__.refresh.call(this)},b.prototype.remove=function(){this.isTemplate||this.$dom.remove()},b}(cola._AliasDomBinding),IGNORE_NODES=["SCRIPT","STYLE","META","TEMPLATE"],ALIAS_REGEXP=new RegExp("\\$default","g"),cola._mainInitFuncs=[],cola._rootFunc=function(){var a,b,c,d,e,f,g,h,i,j,k,l;for(c=null,l=null,i=null,e=0,f=arguments.length;f>e;e++)a=arguments[e],"function"==typeof a?c=a:"string"==typeof a?i=a:a instanceof cola.Scope?h=a:((null!=a?a.nodeType:void 0)||"object"==typeof a&&a.length>0)&&(l=a);if(d=function(a,b,d){var e,f;e=cola.currentScope,cola.currentScope=b;try{a||(f=document.getElementsByClassName(cola.constants.VIEW_CLASS),(null!=f?f.length:void 0)&&(a=Array.prototype.slice.call(f))),null==a&&(a=document.body),b._doms?(!b._doms instanceof Array&&(b._doms=[b._dom]),b._doms.concat(a)):b._doms=a instanceof Array?a:[a],delete b._$doms,"function"==typeof c&&c(b,d)}finally{cola.currentScope=e}},cola._suspendedInitFuncs)cola._suspendedInitFuncs.push(d);else if(h||(null==i&&(i=cola.constants.DEFAULT_PATH),h=cola.model(i),null==h&&(h=new cola.Model(i))),cola._mainInitFuncs)cola._mainInitFuncs.push({targetDom:l,model:h,init:d});else for(d(l,h),k=h._doms,j=0,g=k.length;g>j;j++)b=k[j],cola._renderDomTemplate(b,h);return cola},cola._init=function(){var a,b,c,d,e,f,g,h,i,j,k;for(cola.getListeners("beforeInit")&&(cola.fire("beforeInit",cola),cola.off("beforeInit")),c=cola._mainInitFuncs,delete cola._mainInitFuncs,d=0,e=c.length;e>d;d++)b=c[d],b.init(b.targetDom,b.model);for(i=0,f=c.length;f>i;i++)for(b=c[i],h=b.model,k=h._doms,j=0,g=k.length;g>j;j++)a=k[j],cola._renderDomTemplate(a,h);cola.getListeners("ready")&&(cola.fire("ready",cola),cola.off("ready"))},$(function(){return cola._init()}),cola._userDomCompiler={$:[],$startContent:[],$endContent:[]},cola.xCreate=$.xCreate,cola.xRender=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(a){if(o=cola.currentScope,b=b||o,a.nodeType)g=a;else if("string"==typeof a){if(a.match(/^\#[\w\-\$]*$/)&&(a=cola.util.getGlobalTemplate(a.substring(1)),g=null),a)for(f=document.createDocumentFragment(),e=document.createElement("div"),e.innerHTML=a,d=e.firstChild;d;)l=d.nextSibling,f.appendChild(d),d=l}else{cola.currentScope=b;try{if(null==c&&(c={}),a instanceof Array)for(f=document.createDocumentFragment(),h=0,i=a.length;i>h;h++){for(m=a[h],d=null,r=cola.xRender.nodeProcessors,n=0,j=r.length;j>n&&(p=r[n],!(d=p(m,c)));n++);null==d&&(d=$.xCreate(m,c)),d&&f.appendChild(d)}else{for(s=cola.xRender.nodeProcessors,q=0,k=s.length;k>q&&(p=s[q],!(g=p(a,c)));q++);g||(g=$.xCreate(a,c))}}finally{cola.currentScope=o}}return g&&!g.parentNode&&g.getAttribute("c-repeat")&&(f=document.createDocumentFragment(),f.appendChild(g),g=null),g?cola._renderDomTemplate(g,b,c):f&&(cola._renderDomTemplate(f,b,c),g=f.firstChild===f.lastChild?f.firstChild:f),g}},cola.xRender.nodeProcessors=[],cola._renderDomTemplate=function(a,b,c){null==c&&(c={}),_doRenderDomTemplate(a,b,c)&&$(a).find("."+cola.constants.SHOW_ON_READY_CLASS).removeClass(cola.constants.SHOW_ON_READY_CLASS)},_doRenderDomTemplate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U;if(8!==a.nodeType&&"SVG"!==a.nodeName&&!(1===a.nodeType&&(a.hasAttribute(cola.constants.IGNORE_DIRECTIVE)||("function"==typeof(h=a.className).indexOf?h.indexOf(cola.constants.IGNORE_DIRECTIVE):void 0)>=0)||IGNORE_NODES.indexOf(a.nodeName)>-1)){if(3===a.nodeType)return i=a.nodeValue,G=cola._compileText(i),(null!=G?G.length:void 0)&&buildContent(G,a,b),a;if(11===a.nodeType){for(l=a.firstChild;l;)l=_doRenderDomTemplate(l,b,c)||l,l=l.nextSibling;return a}for(u=null,s=null,N=null,i=a.getAttribute("c-repeat"),i?(i=i.replace(ALIAS_REGEXP,c.defaultPath),j="repeat",r=cola._domFeatureBuilder[j](i,j,a),null==s&&(s=[]),s.push(r),a.removeAttribute("c-repeat")):(i=a.getAttribute("c-alias"),i&&(i=i.replace(ALIAS_REGEXP,c.defaultPath),j="alias",r=cola._domFeatureBuilder[j](i,j,a),null==s&&(s=[]),s.push(r),a.removeAttribute("c-alias"))),I=cola._userDomCompiler.$,w=0,x=I.length;x>w;w++)n=I[w],O=n(b,a,c),O&&(O instanceof cola._BindingFeature&&s.push(O),"function"==typeof O&&(null==u&&(u=[]),u.push(O)));for(J=a.attributes,F=0,y=J.length;y>F;F++)if(e=J[F],f=e.name,"c-"===f.substring(0,2)&&(null==N&&(N=[]),N.push(f),g=e.value,g&&c.defaultPath&&(g=g.replace(ALIAS_REGEXP,c.defaultPath)),g))if(f=f.substring(2),n=cola._userDomCompiler.hasOwnProperty(f)&&cola._userDomCompiler[f]){if(O=n(b,a,e,c))if(O instanceof cola._BindingFeature)s.push(O);else if(O instanceof Array)for(H=0,z=O.length;z>H;H++)q=O[H],s.push(q);else"function"==typeof O&&(null==u&&(u=[]),u.push(O))}else if(0===f.indexOf("on")?r=cola._domFeatureBuilder.event(g,f,a):(k=cola._domFeatureBuilder.hasOwnProperty(f)&&cola._domFeatureBuilder[f],r=(k||cola._domFeatureBuilder.$).call(cola._domFeatureBuilder,g,f,a)),r)if(null==s&&(s=[]),r instanceof cola._BindingFeature)s.push(r);else if(r instanceof Array)for(Q=0,A=r.length;A>Q;Q++)q=r[Q],s.push(q);if(N)for(S=0,B=N.length;B>S;S++)M=N[S],a.removeAttribute(M);if((null!=s?s.length:void 0)&&(p=cola._domBindingBuilder[j||"$"](a,b,s),b.data.alias&&(o=b.data.alias)),u)if(c.inRepeatTemplate||"repeat"===j)cola.util.userData(a,cola.constants.DOM_INITIALIZER_KEY,u);else for(T=0,C=u.length;C>T;T++)(t=u[T])(b,a);if(cola.util.userData(a,cola.constants.DOM_SKIP_CHILDREN))cola.util.removeUserData(a,cola.constants.DOM_SKIP_CHILDREN);else{m={};for(v in c)R=c[v],m[v]=R;if(m.inRepeatTemplate=c.inRepeatTemplate||"repeat"===j,o&&(m.defaultPath=o),cola._userDomCompiler.$startContent.length)for(K=cola._userDomCompiler.$startContent,U=0,D=K.length;D>U;U++)(n=K[U])(b,a,c,m);for(l=a.firstChild;l;)l=_doRenderDomTemplate(l,b,m)||l,l=l.nextSibling;if(cola._userDomCompiler.$endContent.length)for(L=cola._userDomCompiler.$endContent,d=0,E=L.length;E>d;d++)(n=L[d])(b,a,c,m)}return(null!=s?s.length:void 0)&&(c.inRepeatTemplate||p.refresh(!0),p instanceof cola._RepeatDomBinding&&(P=cola.util.userData(p.dom,cola.constants.REPEAT_TAIL_KEY),a=P||p.dom)),a}},createContentPart=function(a,b){var c,d,e,f;return a instanceof cola.Expression?(d=a,f=document.createElement("span"),e=new cola._DomAttrFeature(d,"text"),c=new cola._DomBinding(f,b,e),c.refresh()):f=document.createTextNode(a),f},buildContent=function(a,b,c){var d,e,f,g,h;if(1===a.length)d=createContentPart(a[0],c);else for(d=document.createDocumentFragment(),e=0,f=a.length;f>e;e++)g=a[e],h=createContentPart(g,c),d.appendChild(h);b.parentNode.replaceChild(d,b)},cola._domBindingBuilder={$:function(a,b,c){return new cola._DomBinding(a,b,c)},repeat:function(a,b,c){var d;return d=new cola._RepeatDomBinding(a,b,c),b=d.scope,d},alias:function(a,b,c){var d;return d=new cola._AliasDomBinding(a,b,c),b=d.scope,d}},cola._domFeatureBuilder={$:function(a,b,c){var d,e;return d=cola._compileExpression(a),d&&(e="display"===b?new cola._DisplayFeature(d):"options"===b&&"SELECT"===c.nodeName?new cola._SelectOptionsFeature(d):new cola._DomAttrFeature(d,b)),e},repeat:function(a){var b;return b=cola._compileExpression(a,"repeat"),b?new cola._RepeatFeature(b):void 0},alias:function(a){var b;return b=cola._compileExpression(a,"alias"),b?new cola._AliasFeature(b):void 0},bind:function(a,b,c){var d,e,f,g;return d=cola._compileExpression(a),f=c.nodeName,"INPUT"===f?(g=c.type,e="checkbox"===g?new cola._CheckboxFeature(d):"radio"===g?new cola._RadioFeature(d):new cola._TextBoxFeature(d)):e="SELECT"===f?new cola._SelectFeature(d):"TEXTAREA"===f?new cola._TextBoxFeature(d):new cola._DomAttrFeature(d,"text"),e},style:function(a){var b,c,d,e,f,g;if(!a)return!1;e=cola.util.parseStyleLikeString(a),d=[];for(g in e)f=e[g],b=cola._compileExpression(f),b&&(c=new cola._DomStylePropFeature(b,g),d.push(c));return d},classname:function(a){var b,c,d,e,f,g;if(!a)return!1;g=[];try{e=cola._compileExpression(a),e&&(f=new cola._DomClassFeature(e),g.push(f))}catch(h){b=cola.util.parseStyleLikeString(a);for(d in b)c=b[d],e=cola._compileExpression(c),e&&(f=new cola._DomToggleClassFeature(e,d),g.push(f))}return g},"class":function(){return this.classname.apply(this,arguments)},resource:function(a,b,c){a=cola.util.trim(a),a&&$fly(c).text(cola.resource(a))},watch:function(a){var b,c,d,e,f,g,h,i,j;if(d=a.indexOf(" on "),d>0&&(b=a.substring(0,d),h=a.substring(d+4))){for(i=[],j=h.split(","),e=0,f=j.length;f>e;e++)g=j[e],g=cola.util.trim(g),g&&i.push(g);i.length&&(c=new cola._WatchFeature(b,i))}if(!c)throw new cola.Exception('"'+expr+'" is not a valid watch expression.');return c},event:function(a,b){var c,d;return c=cola._compileExpression(a),c&&(d=new cola._EventFeature(c,b.substring(2))),d}},function(){var a,b;return a=function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},b=!!CSSStyleDeclaration.prototype.getPropertyValue,b?void 0:(CSSStyleDeclaration.prototype.getPropertyValue=function(a){return this.getAttribute(a)},CSSStyleDeclaration.prototype.setProperty=function(b,c,d){var e;return this.setAttribute(b,c),d="undefined"!=typeof d?d:"",""!==d?(e=new RegExp(a(b)+"\\s*:\\s*"+a(c)(NaN,"gmi")),this.cssText=this.cssText.replace(e,b+": "+c+" !"+d+";")):void 0},CSSStyleDeclaration.prototype.removeProperty=function(a){return this.removeAttribute(a)},CSSStyleDeclaration.prototype.getPropertyPriority=function(b){var c;return c=new RegExp(a(b)+"\\s*:\\s*[^\\s]*\\s*!important(\\s*;)?","gmi"),c.test(this.cssText)?"important":""})}(),cola.util.decideValueProperty=function(a){var b,c,d;return a instanceof Array?b=a[0]:a instanceof cola.EntityList&&(b=a.current),b&&(d=null,c=null,cola.util.isSimpleValue(b)||(b instanceof cola.Entity?b.hasValue("key")?(d="key",c="value"):(d="value",c="text"):b.hasOwnProperty("key")?(d="key",c="value"):(d="value",c="text"))),d?{valueProperty:d,textProperty:c}:null},cola.util.addClass=function(a,b,c){var d;return c?(1===a.nodeType&&(d=a.className?(" "+a.className+" ").replace(cola.constants.CLASS_REG," "):" ",d.indexOf(" "+b+" ")<0&&(d+=b+" ",a.className=$.trim(d))),cola.util):($(a).addClass(b),cola.util)},cola.util.removeClass=function(a,b,c){var d;return c?(1===a.nodeType&&(d=a.className?(" "+a.className+" ").replace(cola.constants.CLASS_REG," "):" ",d.indexOf(" "+b+" ")>=0&&(d=d.replace(" "+b+" "," "),a.className=$.trim(d))),cola.util):($(a).removeClass(b),cola.util)},cola.util.toggleClass=function(a,b,c,d){return d?(1===a.nodeType&&(c?this._addClass(a,b,!0):this._removeClass(a,b,!0)),cola.util):void $(a).toggleClass(b,!!c)},cola.util.hasClass=function(a,b){var c,d,e,f,g;for(g=b.split(/\s+/g),c=a.className?(" "+a.className+" ").replace(cola.constants.CLASS_REG," "):" ",d=0,e=g.length;e>d;d++)if(f=g[d],c.indexOf(" "+f+" ")<0)return!1;return!0},cola.util.style=function(a,b,c,d){var e;return e=a.style,"undefined"!=typeof b?"undefined"!=typeof c?(d="undefined"!=typeof d?d:"",e.setProperty(b,c,d)):e.getPropertyValue(b):e},cola.util.getTextChildData=function(a){var b;for(b=a.firstChild;b;){if(3===b.nodeType)return b.textContent;b=b.nextSibling}return null},cola.util.eachNodeChild=function(a,b){var c;if(!a||!b)return cola.util;for(c=a.firstChild;c&&b(c)!==!1;)c=c.nextSibling;return cola.util},cola.util.hasContent=function(a){var b;for(b=a.firstChild;b;){if(3===b.nodeType||1===b.nodeType)return!0;b=b.nextSibling}return!1},cola.util.getScrollerRender=function(a){var b,c,d;return b=document.createElement("div"),c=cola.Fx.perspectiveProperty,d=cola.Fx.transformProperty,void 0!==b.style[c]?function(b,c,e){a.style[d]="translate3d("+-b+"px,"+-c+"px,0) scale("+e+")"}:void 0!==b.style[d]?function(b,c,e){a.style[d]="translate("+-b+"px,"+-c+"px) scale("+e+")"}:function(b,c,d){
a.style.marginLeft=b?-b/d+"px":"",a.style.marginTop=c?-c/d+"px":"",a.style.zoom=d||""}},cola.util.getType=function(){var a,b,c,d,e;for(a={},e="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),b=0,c=e.length;c>b;b++)d=e[b],a["[object "+d+"]"]=d.toLowerCase();return function(b){var c;return c=Object.prototype.toString.call(b),a[c]||"object"}}(),cola.util.typeOf=function(a,b){return cola.util.getType(a)===b},cola.util.getDomRect=function(a){var b;return b=a.getBoundingClientRect(),isNaN(b.height)&&(b.height=b.bottom-b.top),isNaN(b.width)&&(b.width=b.right-b.left),b},$.xCreate.templateProcessors.push(function(a){var b;return a instanceof cola.Widget?(b=a.getDom(),b.setAttribute(cola.constants.IGNORE_DIRECTIVE,""),b):void 0}),$.xCreate.attributeProcessor["c-widget"]=function(a,b,c,d){var e,f;c&&("string"==typeof c?a.attr(b,c):d&&(e=cola.uniqueId(),a.attr("c-widget-config",e),f=d.widgetConfigs,f||(d.widgetConfigs=f={}),f[e]=c))},cola.xRender.nodeProcessors.push(function(a,b){var c,d;return a instanceof cola.Widget?d=a:a.$type&&(d=cola.widget(a,b.namespace)),d&&(c=d.getDom(),c.setAttribute(cola.constants.IGNORE_DIRECTIVE,"")),c}),cola.Model.prototype.widgetConfig=function(a,b){var c,d,e;if(1===arguments.length){if("string"==typeof a)return null!=(d=this._widgetConfig)?d[a]:void 0;b=a;for(c in b)e=b[c],this.widgetConfig(c,e)}else null==this._widgetConfig&&(this._widgetConfig={}),this._widgetConfig[a]=b},ALIAS_REGEXP=new RegExp("\\$default","g"),_findWidgetConfig=function(a,b){for(var c,d;a&&!(d=null!=(c=a._widgetConfig)?c[b]:void 0);)a=a.parent;return d},_compileWidgetDom=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o;for(null==c&&(c={}),b.attributes._inited&&b.events._inited||cola.preprocessClass(b),c.$constr=b,o=null,n=a.attributes,i=0,j=n.length;j>i;i++)e=n[i],f=e.name,0===f.indexOf("c-")?(g=e.value,d.defaultPath&&(g=g.replace(ALIAS_REGEXP,d.defaultPath)),m=f.slice(2),b.attributes.$has(m)&&"class"!==m?("bind"===m?c[m]=g:c[m]=cola._compileExpression(g),null==o&&(o=[]),o.push(f)):(h=b.events.$has(m),h||0!==m.indexOf("on")||b.events.$has(m.slice(2))&&(h=!0,m=m.slice(2)),h&&(c[m]=cola._compileExpression(e.value),null==o&&(o=[]),o.push(f)))):(g=e.value,d.defaultPath&&"bind"===f&&(g=g.replace(ALIAS_REGEXP,d.defaultPath)),m=f,b.attributes.$has(m)?c[m]=g:(h=b.events.$has(m),h||0!==m.indexOf("on")||b.events.$has(m.slice(2))&&(h=!0,m=m.slice(2),null==o&&(o=[]),o.push(f)),h&&(c[m]=g)));if(o)for(l=0,k=o.length;k>l;l++)e=o[l],a.removeAttribute(e);return c},_compileWidgetAttribute=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;if(p=b.getAttribute("c-config")){for(g=p.split(/[,;]/),d={},j=0,k=g.length;k>j;j++)if(f=g[j],e=_findWidgetConfig(a,f))for(h in e)i=e[h],d[h]=i}else if(p=b.getAttribute("c-widget"),p&&(b.removeAttribute("c-widget"),c.defaultPath&&(p=p.replace(ALIAS_REGEXP,c.defaultPath)),d=cola.util.parseStyleLikeString(p,"$type"))){g=null;for(n in d)o=d[n],f=null,64===n.charCodeAt(0)?f=n.substring(1):"$type"===n&&"string"==typeof o&&35===o.charCodeAt(0)&&(f=o.substring(1)),f&&(delete d[n],null==g&&(g=[]),g.push(f));if(g)for(m=0,l=g.length;l>m;m++)if(f=g[m],e=_findWidgetConfig(a,f))for(h in e)i=e[h],d[h]=i}return d},cola._userDomCompiler.$.push(function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;if(cola.util.userData(b,cola.constants.DOM_ELEMENT_KEY))return null;if(1!==b.nodeType)return null;if(b.id&&(g=_findWidgetConfig(a,b.id)),i=c.parentWidget,l=b.tagName,e=b.getAttribute("c-widget-config"),e?(b.removeAttribute("c-widget-config"),d=null!=(j=c.widgetConfigs)?j[e]:void 0):(d=_compileWidgetAttribute(a,b,c),d&&(d.$type||d.$constr)||(n=null!=i&&null!=(k=i.childTagNames)?k[l]:void 0,null==n&&(n=WIDGET_TAGS_REGISTRY[l]),n&&(d=_compileWidgetDom(b,n,d,c)))),!d&&!g)return null;if(null==d&&(d={}),g)for(h in g)m=g[h],d.hasOwnProperty(h)||(d[h]=m);return"string"==typeof d&&(d={$type:d}),f=d.$constr instanceof Function?d.$constr:cola.resolveType((null!=i?i.CHILDREN_TYPE_NAMESPACE:void 0)||"widget",d,cola.Widget),d.$constr=f,cola.util.isCompatibleType(cola.AbstractLayer,f)&&d.lazyRender&&cola.util.userData(b,cola.constants.DOM_SKIP_CHILDREN,!0),function(a,b){var c,e;d.dom=b,c=cola.currentScope,cola.currentScope=a;try{return e=cola.widget(d)}finally{cola.currentScope=c}}}),cola._userDomCompiler.$startContent.push(function(a,b,c,d){var e;return e=cola.util.userData(b,cola.constants.DOM_ELEMENT_KEY),e?d.parentWidget=e.constructor:void 0}),cola.registerTypeResolver("widget",function(a){return a?a.$constructor&&cola.util.isSuperClass(cola.Widget,a.$constructor)?a.$constructor:a.$type&&"string"==typeof a.$type?cola[cola.util.capitalize(a.$type)]:void 0:void 0}),cola.registerType("widget","_default",cola.Widget),cola.widget=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;if(!a)return null;if(i=function(a){var b,d;for(b=!1,d=a._scope;d;){if(d===c){b=!0;break}d=d.parent}return b},"string"==typeof a){if(g=window[a],!g)return null;if(g.nodeType)return n=cola.util.userData(g,cola.constants.DOM_ELEMENT_KEY),c&&!i(n)&&(n=null),n;for(h=[],j=0,k=g.length;k>j;j++)f=g[j],n=cola.util.userData(f,cola.constants.DOM_ELEMENT_KEY),n instanceof cola.Widget&&(!c||i(n))&&h.push(n);return h.length?1===h.length?h[0]:cola.Element.createGroup(h):null}if(a instanceof Array){for(h=[],m=0,l=a.length;l>m;m++)d=a[m],h.push(cola.widget(d,b,c));return cola.Element.createGroup(h)}return 1===a.nodeType?(n=cola.util.userData(a,cola.constants.DOM_ELEMENT_KEY),c&&!i(n)&&(n=null),n instanceof cola.Widget?n:null):(e=a.$constr||cola.resolveType(b||"widget",a,cola.Widget),c&&!a.scope&&(a.scope=c),new e(a))},cola.findWidget=function(a,b){var c,d,e;return d=function(a,b){var c;return c||(c=a.cola.resolveType("widget",{$type:b})),c},(e="function"==typeof b?b:d(window,b))?(a instanceof cola.Widget&&(a=a.getDom()),(c=function(a,e,f){var g,h,i,j;for(h=e.parentNode;h;){if(e=h,j=a.cola.util.userData(e,a.cola.constants.DOM_ELEMENT_KEY),j&&(!f||j instanceof f))return j;h=e.parentNode}if(a.parent){try{i=a.parent.$("iframe,frame")}catch(k){}i&&(g=null,i.each(function(){return this.contentWindow===a?(g=this,!1):void 0}),g&&(f=d(a.parent,b),f&&(j=c(a.parent,g,f))))}return j})(window,a,e)):null},cola.Model.prototype.widget=function(a){return cola.widget(a,null,this)},WIDGET_TAGS_REGISTRY={},_extendWidget=function(a,b){var c,d,e,f,g;c=function(a){c.attributes._inited&&c.events._inited||cola.preprocessClass(c),b.create&&this.on("create",b.create),b.destroy&&this.on("destroy",b.destroy),b.initDom&&this.on("initDom",function(a){return function(b,c){return a.initDom(c.dom)}}(this)),b.refreshDom&&this.on("refreshDom",function(a){return function(b,c){return a.refreshDom(c.dom)}}(this)),this.on("attributeChange",function(a){return function(b,c){var d;d=c.attribute,a._widgetModel.data.onDataMessage([d],cola.constants.MESSAGE_PROPERTY_CHANGE,{}),value=a._get(d),value&&(value instanceof cola.Entity||value instanceof cola.EntityList)?a._entityProps[d]=value:delete a._entityProps[d]}}(this)),this._entityProps={},this._widgetModel=new cola.WidgetModel(this,(null!=a?a.scope:void 0)||cola.currentScope),c.__super__.constructor.call(this,a)},extend(c,a),c.tagName=(null!=(f=b.tagName)?f.toUpperCase():void 0)||"",b.parentWidget&&(c.parentWidget=b.parentWidget),c.attributes=b.attributes||{},c.attributes.widgetModel={readOnly:!0,getter:function(){return this._widgetModel}},c.attributes.template={readOnlyAfterCreate:!0},b.events&&(c.events=b.events),b.template&&(g=b.template,"string"==typeof g&&g.match(/^\#[\w\-\$]*$/)?g=cola.util.getGlobalTemplate(g.substring(1)):g&&"object"==typeof g&&g.nodeType&&(g=g.outerHTML),c.attributes.template={defaultValue:g}),c.prototype._createDom=function(){var b;return this._template?(b=cola.xRender(this._template||{},this._widgetModel),this._domCreated=!0,b):a.prototype._createDom.apply(this)},c.prototype._initDom=function(b){var c,d,e,f,h,i,j;if(a.prototype._initDom.call(this,b),g=this._template,g&&!this._domCreated&&(j=this.xRender(g),11===(null!=j?j.nodeType:void 0)&&(j=j.firstElementChild),j)){if(j.attributes)for(i=j.attributes,f=0,h=i.length;h>f;f++)c=i[f],d=c.name,"class"===d?$fly(b).addClass(c.value):"style"!==d&&(b.hasAttribute(d)||b.setAttribute(d,c.value));for(e in j.style)""===b.style[e]&&(b.style[e]=j.style[e]);for(;j.firstChild;)b.appendChild(j.firstChild)}},c.prototype.xRender=function(a,b){return cola.xRender(a,this._widgetModel,b)};for(e in b)d=b[e],b.hasOwnProperty(e)&&"function"==typeof d&&(c.prototype[e]=d);return c},cola.defineWidget=function(a,b){var c,d,e,f,g,h,i;if(cola.util.isSuperClass(cola.Widget,a)||(b=a,a=cola.TemplateWidget),b&&(a=_extendWidget(a,b)),i=null!=(f=a.tagName)?f.toUpperCase():void 0)for(g=i.split(/\s|,|;/),d=0,e=g.length;e>d;d++)if(h=g[d],h&&a.parentWidget){if(c=a.parentWidget.childTagNames,c||(a.parentWidget.childTagNames=c={}),c[h])throw new cola.Exception('Tag name "'+h+'" is already registered in "'+a.parentWidget.tagName+'".');c[h]=a}else if(h){if(WIDGET_TAGS_REGISTRY[h])throw new cola.Exception('Tag name "'+h+'" is already registered.');WIDGET_TAGS_REGISTRY[h]=a}return a},cola.registerWidget=cola.defineWidget,ACTIVE_PINCH_REG=/^pinch/i,ACTIVE_ROTATE_REG=/^rotate/i,PAN_VERTICAL_events=["panUp","panDown"],SWIPE_VERTICAL_events=["swipeUp","swipeDown"],"string"!=typeof document.documentElement.style.flex&&$(document.documentElement).addClass("flex-unsupported"),cola.ClassNamePool=function(){function a(a,b){null==b&&(b=[]),this.elements=[],a=a?(" "+a+" ").replace(cola.constants.CLASS_REG," "):" ",b.forEach(function(b){return function(c){var d;d=" "+c+" ",a.indexOf(d)>-1&&(a=a.replace(d," "),b.add(c))}}(this)),$.trim(a).split(" ").forEach(function(a){return function(b){a.add(b)}}(this))}return a.prototype.add=function(a){var b;if(a&&(b=this.elements.indexOf(a),!(b>-1)))return this.elements.push(a)},a.prototype.remove=function(a){var b;return b=this.elements.indexOf(a),b>-1&&this.elements.splice(b,1),this},a.prototype.destroy=function(){return delete this.elements},a.prototype.join=function(){return this.elements.join(" ")},a.prototype.toggle=function(a,b){b?this.add(a):this.remove(a)},a}(),_destroyRenderableElement=function(a,b){var c;c=b[cola.constants.DOM_ELEMENT_KEY],("function"==typeof c?c(_destroyed):void 0)||(c._domRemoved=!0,c.destroy())},cola.RenderableElement=function(a){function b(a){var c;a&&(c=a.dom,c&&delete a.dom),null==this._doms&&(this._doms={}),b.__super__.constructor.call(this,a),c&&this._setDom(c,!0)}return extend(b,a),b.events={initDom:null,refreshDom:null},b.prototype._initDom=function(a){},b.prototype._parseDom=function(a){},b.prototype._setDom=function(a,b){var c;a&&(this._dom=a,cola.util.userData(a,cola.constants.DOM_ELEMENT_KEY,this),cola.util.onNodeDispose(a,_destroyRenderableElement),b&&this._parseDom(a),this._initDom(a),c={dom:a},this.fire("initDom",this,c),this._refreshDom(),this._rendered=!0)},b.prototype._createDom=function(){var a,b;return b=document.createElement(this.constructor.tagName||"div"),a=this.constructor.CLASS_NAME||"",a&&$fly(b).addClass("ui "+a),b},b.prototype._doSet=function(a,c,d){return(null!=c?c.refreshDom:void 0)&&this._dom&&cola.util.delay(this,"refreshDom",50,this._refreshDom),b.__super__._doSet.call(this,a,c,d)},b.prototype._doRefreshDom=function(){var a,b,c,d,e;if(cola.util.cancelDelay(this,"_refreshDom"),this._dom){if(a=this.constructor.CLASS_NAME)for(this._classNamePool.add("ui"),e=$.trim(a).split(" "),b=0,c=e.length;c>b;b++)d=e[b],this._classNamePool.add(d);this._resetDimension()}},b.prototype._refreshDom=function(){var a;!this._dom&&this._destroyed||(this._classNamePool=new cola.ClassNamePool(this._dom.className,this.constructor.SEMANTIC_CLASS),this._doRefreshDom(),a=$.trim(this._classNamePool.join()),this._dom.className=a,this._classNamePool.destroy(),delete this._classNamePool)},b.prototype._resetDimension=function(){},b.prototype.getDom=function(){var a;return this._destroyed?null:(this._dom||(a=this._createDom(),this._setDom(a)),this._dom)},b.prototype.get$Dom=function(){return this._destroyed?null:(null==this._$dom&&(this._$dom=$(this.getDom())),this._$dom)},b.prototype.refresh=function(){var a;return this._dom?(this._refreshDom(),a={dom:this._dom},this.fire("refreshDom",this,a),this):this},b.prototype.appendTo=function(a){return a&&this.getDom()&&$(a).append(this._dom),this},b.prototype.remove=function(){return this.get$Dom().remove(),this},b.prototype.destroy=function(){this._destroyed||(cola.util.cancelDelay(this,"refreshDom"),this._dom&&(this._domRemoved||this.remove(),delete this._dom,delete this._$dom),b.__super__.destroy.call(this),this._destroyed=!0)},b.prototype.addClass=function(a,b){return b?cola.util.addClass(this._dom,a,!0):this.get$Dom().addClass(a),this},b.prototype.removeClass=function(a,b){return b?cola.util.removeClass(this._dom,a,!0):this.get$Dom().removeClass(a),this},b.prototype.toggleClass=function(a,b,c){return c?cola.util.toggleClass(this._dom,a,b,!0):this.get$Dom().toggleClass(a,b),this},b.prototype.hasClass=function(a,b){return b?cola.util.hasClass(this._dom,a,!0):this.get$Dom().hasClass(a)},b}(cola.Element),cola.Widget=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b.SEMANTIC_CLASS=["left floated","right floated"],b.attributes={display:{defaultValue:!0,refreshDom:!0,type:"boolean"},"float":{refreshDom:!0,"enum":["left","right",""],defaultValue:"",setter:function(a){var b;b=this._float,this._dom&&b&&b!==a&&cola.util.removeClass(this._dom,b+" floated",!0),this._float=a}},"class":{refreshDom:!0,setter:function(a){var b;b=this._class,b&&this._dom&&b!==a&&this.get$Dom().removeClass(b),this._class=a}},popup:null,dimmer:{setter:function(a){var b,c;null==this._dimmer&&(this._dimmer={});for(b in a)c=a[b],this._dimmer[b]=c}},height:{refreshDom:!0},width:{refreshDom:!0},focusable:{type:"boolean",refreshDom:!0,defaultValue:!1}},b.events={click:{$event:"click"},dblClick:{$event:"dblclick"},mouseDown:{$event:"mousedown"},mouseUp:{$event:"mouseup"},tap:{hammerEvent:"tap"},press:{hammerEvent:"press"},panStart:{hammerEvent:"panstart"},panMove:{hammerEvent:"panmove"},panEnd:{hammerEvent:"panend"},panCancel:{hammerEvent:"pancancel"},panLeft:{hammerEvent:"panleft"},panRight:{hammerEvent:"panright"},panUp:{hammerEvent:"panup"},panDown:{hammerEvent:"pandown"},pinchStart:{hammerEvent:"pinchstart"},pinchMove:{hammerEvent:"pinchmove"},pinchEnd:{hammerEvent:"pinchend"},pinchCancel:{hammerEvent:"pinchcancel"},pinchIn:{hammerEvent:"pinchin"},pinchOut:{hammerEvent:"pinchout"},rotateStart:{hammerEvent:"rotatestart"},rotateMove:{hammerEvent:"rotatemove"},rotateEnd:{hammerEvent:"rotateend"},rotateCancel:{hammerEvent:"rotatecancel"},swipeLeft:{hammerEvent:"swipeleft"},swipeRight:{hammerEvent:"swiperight"},swipeUp:{hammerEvent:"swipeup"},swipeDown:{hammerEvent:"swipedown"}},b.prototype._initDom=function(a){var c,d;return b.__super__._initDom.call(this,a),c=this._popup,c?(d={},"string"==typeof c||c.constructor===Object.prototype.constructor&&c.tagName||1===c.nodeType?d.html=cola.xRender(c):c.constructor===Object.prototype.constructor&&(d=c,d.content?d.html=cola.xRender(d.content):d.html&&(d.html=cola.xRender(d.html))),$fly(a).popup(d)):void 0},b.prototype._setDom=function(a,c){var d;if(a){b.__super__._setDom.call(this,a,c);for(d in this.constructor.events)this.getListeners(d)&&this._bindEvent(d)}},b.prototype._on=function(a,c,d){return b.__super__._on.call(this,a,c,d),this._dom&&this._bindEvent(a),this},b.prototype.fire=function(a,c,d){var e;if(this._eventRegistry&&(e=this.constructor.events.$get(a),!(this.constructor.attributes.hasOwnProperty("disabled")&&this.get("disabled")&&e&&(e.$event||e.hammerEvent)||(this._hasFireTapEvent||(this._hasFireTapEvent="tap"===a),"click"===a&&this._hasFireTapEvent))))return b.__super__.fire.call(this,a,c,d)},b.prototype._doRefreshDom=function(){var a,c,d,e;if(this._dom&&(b.__super__._doRefreshDom.call(this),this._float&&this._classNamePool.add(this._float+" floated"),this._classNamePool.toggle("display-none",!this._display),!this._rendered&&this._class))for(e=this._class.split(" "),a=0,c=e.length;c>a;a++)d=e[a],this._classNamePool.add(d)},b.prototype._bindEvent=function(a){var b,c;if(this._dom&&(null==this._bindedEvents&&(this._bindedEvents={}),!this._bindedEvents[a]))return b=this.get$Dom(),c=this.constructor.events.$get(a),(null!=c?c.$event:void 0)?(b.on(c.$event,function(b){return function(c){var d;return d={dom:b._dom,event:c},b.fire(a,b,d)}}(this)),void(this._bindedEvents[a]=!0)):(null!=c?c.hammerEvent:void 0)?(null==this._hammer&&(this._hammer=new Hammer(this._dom,{})),ACTIVE_PINCH_REG.test(a)&&this._hammer.get("pinch").set({enable:!0}),ACTIVE_ROTATE_REG.test(a)&&this._hammer.get("rotate").set({enable:!0}),PAN_VERTICAL_events.indexOf(a)>=0&&this._hammer.get("pan").set({direction:Hammer.DIRECTION_ALL}),SWIPE_VERTICAL_events.indexOf(a)>=0&&this._hammer.get("swipe").set({direction:Hammer.DIRECTION_ALL}),this._hammer.on(c.hammerEvent,function(b){return function(c){var d;return d={dom:b._dom,event:c,eventName:a},b.fire(a,b,d)}}(this)),void(this._bindedEvents[a]=!0)):void 0},b.prototype._resetDimension=function(){var a,b,c,d;a=this.get$Dom(),c=cola.constants.WIDGET_DIMENSION_UNIT,b=this.get("height"),isFinite(b)&&(b=""+parseInt(b)+c),b&&a.css("height",b),d=this.get("width"),isFinite(d)&&(d=""+parseInt(d)+c),d&&a.css("width",d)},b.prototype.showDimmer=function(a){var b,c,d,e,f,g;if(null==a&&(a={}),!this._dom)return this;c=a.content,!c&&this._dimmer&&(c=this._dimmer.content),c&&("string"==typeof c?e=$.xCreate({tagName:"div",content:c}):c.constructor===Object.prototype.constructor&&c.tagName?e=$.xCreate(c):1===c.nodeType&&(e=c)),null==this._dimmer&&(this._dimmer={});for(f in a)g=a[f],"content"!==f&&(this._dimmer[f]=g);return b=this.get$Dom(),d=b.dimmer("get dimmer"),e&&(d?$(d).empty():b.dimmer("create"),b.dimmer("add content",e)),b.dimmer(this._dimmer),b.dimmer("show"),this},b.prototype.hideDimmer=function(){return this._dom?(this.get$Dom().dimmer("hide"),this):this},b.prototype.destroy=function(){this._destroyed||(this._dom&&(delete this._hammer,delete this._bindedEvents,delete this._parent,delete this._doms),b.__super__.destroy.call(this),this._destroyed=!0)},b}(cola.RenderableElement),cola.floatWidget={_zIndex:1100,zIndex:function(){return++cola.floatWidget._zIndex}},cola.Exception.showException=function(a){var b;return b=a instanceof cola.Exception||a instanceof Error?a.message:a+"",cola.alert(b)},cola.WidgetDataModel=function(a){function b(a,c){this.widget=c,b.__super__.constructor.call(this,a)}return extend(b,a),b.prototype._getRealPath=function(a){var b,c;return b=a.indexOf("."),c=b>1?this._transferDynaProperty(a.substring(1,b))+a.substring(b):this._transferDynaProperty(a.substring(1))},b.prototype.get=function(a,b,c){var d,e;return d=a.charCodeAt(0),36===d?void 0:64===d?null!=(e=this.model.parent)?e.data.get(this._getRealPath(a),b,c):void 0:this.widget.get(a)},b.prototype.set=function(a,b){var c;64===a.charCodeAt(0)?null!=(c=this.model.parent)&&c.data.set(this._getRealPath(a),b):(this.widget.set(a,b),this.onDataMessage(a.split("."),cola.constants.MESSAGE_PROPERTY_CHANGE,{}))},b.prototype._bind=function(a,c){var d;return 64===a[0].charCodeAt(0)&&(d=a[0].substring(1),this.dynaPropertyMap||(this.dynaPropertyMap={},this.dynaPropertyPathMap={}),this.dynaPropertyMap[d]?this.dynaPropertyMap[d]=this.dynaPropertyMap[d]+1:this.dynaPropertyMap[d]=1),b.__super__._bind.call(this,a,c)},b.prototype._unbind=function(a,c){var d;return this.dynaPropertyMap&&64===a[0].charCodeAt(0)&&(d=a[0].substring(1),this.dynaPropertyMap[d]>1?this.dynaPropertyMap[d]=this.dynaPropertyMap[d]-1:(delete this.dynaPropertyMap[d],delete this.dynaPropertyPathMap[d])),b.__super__._unbind.call(this,a,c)},b.prototype._transferDynaProperty=function(a){var b,c;return b=this.dynaPropertyPathMap[a],c=this.widget.get(a),c!==(null!=b?b.join("."):void 0)&&(b&&this.model.unwatchPath(b),this.dynaPropertyPathMap[a]=c?c.split("."):null,c&&this.model.watchPath(c)),c},b.prototype.processMessage=function(a,b,c,d){var e,f,g,h,i;if(f=function(a,b){var c,d,e,f,g,h;for(d=!0,c=e=0,f=b.length;f>e;c=++e)if(g=b[c],h=a[c],g!==h){if("**"===h)continue;if("*"===h&&c===b.length-1)continue;d=!1;break}return d},this.dynaPropertyPathMap){h=this.dynaPropertyPathMap;for(g in h)e=h[g],f(e,b)?c!==cola.constants.MESSAGE_REFRESH&&c!==cola.constants.MESSAGE_CURRENT_CHANGE&&c!==cola.constants.MESSAGE_PROPERTY_CHANGE&&c!==cola.constants.MESSAGE_REMOVE||(this._transferDynaProperty(g),this.onDataMessage(["@"+g],cola.constants.MESSAGE_REFRESH,d)):f(b,e)&&(i=b.slice(e.length),this.onDataMessage(["@"+g].concat(i),c,d))}},b.prototype.getDataType=function(a){var b;return 64===a.charCodeAt(0)?null!=(b=this.model.parent)?b.data.getDataType(a.substring(1)):void 0:null},b.prototype.getProperty=function(a){var b;return 64===a.charCodeAt(0)?null!=(b=this.model.parent)?b.data.getProperty(a.substring(1)):void 0:null},b.prototype.flush=function(a,b){var c;return 64===path.charCodeAt(0)&&null!=(c=this.model.parent)&&c.data.getDataType(a.substring(1),b),this},b}(cola.AbstractDataModel),cola.WidgetModel=function(a){function b(a,b){var c;this.widget=a,this.parent=b,c=this.widget,this.data=new cola.WidgetDataModel(this,c),this.action=function(a){var b;return b=c[a],b instanceof Function?function(){return b.apply(c,arguments)}:c._scope.action(a)}}return extend(b,a),b.prototype.repeatNotification=!0,b.prototype.processMessage=function(a,b,c,d){return this.messageTimestamp>=d.timestamp?void 0:this.data.processMessage(a,b,c,d)},b}(cola.SubScope),cola.TemplateWidget=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return extend(b,a),b}(cola.Widget)}).call(this),/*! Cola UI - 1.0.8
 * Copyright (c) 2002-2016 BSTEK Corp. All rights reserved.
 *
 * This file is dual-licensed under the AGPLv3 (http://www.gnu.org/licenses/agpl-3.0.html)
 * and BSDN commercial (http://www.bsdn.org/licenses) licenses.
 *
 * If you are unsure which license is appropriate for your use, please contact the sales department
 * at http://www.bstek.com/contact.
 */
function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J=function(a,b){function c(){this.constructor=a}for(var d in b)K.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},K={}.hasOwnProperty;l=null,cola.TemplateSupport={_templateSupport:!0,destroy:function(){var a;if(this._templates)for(a in this._templates)delete this._templates[a]},_parseTemplates:function(){var a;if(this._dom){for(a=this._dom.firstElementChild;a;)"TEMPLATE"===a.nodeName&&this.regTemplate(a),a=a.nextElementSibling;this._regDefaultTempaltes()}},_trimTemplate:function(a){var b,c;for(b=a.firstChild;b;)c=b.nextSibling,3===b.nodeType&&""===$.trim(b.nodeValue)&&a.removeChild(b),b=c},regTemplate:function(a,b){1===arguments.length&&(b=a,a=b.nodeType?b.getAttribute("name"):b.name),null==this._templates&&(this._templates={}),this._templates[a||"default"]=b},_regDefaultTempaltes:function(){var a,b,c,d;b=this.constructor.TEMPLATES;for(a in b)d=b[a],(null!=(c=this._templates)?c.hasOwnProperty(a):0)||!d||this.regTemplate(a,d)},trimTemplate:function(a){var b,c,d,e,f,g,h;if(a.nodeType){if("TEMPLATE"===a.nodeName)if(a.firstChild||(d=a.innerHTML,d&&(null==l&&(l=document.createElement("div")),a=l,a.innerHTML=d)),this._trimTemplate(a),a.firstChild===a.lastChild)a=a.firstChild;else{for(g=[],c=a.firstChild;c;)g.push(c),c=c.nextSibling;a=g}}else if(null==this._doms&&(this._doms={}),a=$.xCreate(a,this._doms),this._doms.widgetConfigs)if(null==this._templateContext&&(this._templateContext={}),this._templateContext.widgetConfigs){h=this._templateContext.widgetConfigs,f=this._doms.widgetConfigs;for(e in f)b=f[e],h[e]=b}else this._templateContext.widgetConfigs=this._doms.widgetConfigs;return a._trimed=!0,a},getTemplate:function(a,b){var c;return null==a&&(a="default"),this._templates?(c=this._templates[a],!c&&b&&(a=b,c=this._templates[a]),!c&&"string"==typeof a&&a.match(/^\#[\w\-\$]*$/)&&(c=cola.util.getGlobalTemplate(a)),c&&!c._trimed&&(c=this.trimTemplate(c)),c):null},_cloneTemplate:function(a,b){var c,d,e,f;if(a instanceof Array){if(b&&a.length>1){for(c=document.createDocumentFragment(),e=0,d=a.length;d>e;e++)f=a[e],c.appendChild(f.cloneNode(!0));return c}return a[0].cloneNode(!0)}return a.cloneNode(!0)}},cola.DataWidgetMixin={_dataWidget:!0,_bindSetter:function(a){var b,c,d,e,f,g,h,i,j,k,l,m;if(this._bind!==a){if(this._bindInfo){if(b=this._bindInfo,this._watchingPaths)for(l=this._watchingPaths,g=0,e=l.length;e>g;g++)j=l[g],this._scope.data.unbind(j.join("."),this._bindProcessor);delete this._bindInfo}if(this._bind=a,a&&this._scope){if(this._bindInfo=b={},b.expression=c=cola._compileExpression(a),b.writeable=c.writeable,c.repeat||c.setAlias)throw new cola.Exception('Expression "'+a+'" must be a simple expression.');if(b.writeable&&(d=a.lastIndexOf("."),d>0?(b.entityPath=a.substring(0,d),b.property=a.substring(d+1)):(b.entityPath=null,b.property=a)),this._bindProcessor||(this._bindProcessor={processMessage:function(a){return function(b,c,d,e){if(a._filterDataMessage){if(!a._filterDataMessage(c,d,e))return}else if(!(cola.constants.MESSAGE_REFRESH<=d&&d<=cola.constants.MESSAGE_CURRENT_CHANGE||a._watchingMoreMessage))return;a._bindInfo.watchingMoreMessage?cola.util.delay(a,"processMessage",100,function(){this._processDataMessage?this._processDataMessage(this._bindInfo.watchingPaths[0],cola.constants.MESSAGE_REFRESH,{}):this._refreshBindingValue()}):a._processDataMessage?a._processDataMessage(c,d,e):a._refreshBindingValue()}}(this)}),k=c.paths,b.watchingMoreMessage=!k&&c.hasCallStatement&&!c.hasDefinedPath,k){for(this._watchingPaths=m=[],d=h=0,f=k.length;f>h;d=++h)i=k[d],this._scope.data.bind(i,this._bindProcessor),m[d]=i.split(".");this._processDataMessage?this._processDataMessage(null,cola.constants.MESSAGE_REFRESH,{}):this._refreshBindingValue()}}}},destroy:function(){var a,b,c,d;if(this._watchingPaths)for(d=this._watchingPaths,b=0,a=d.length;a>b;b++)c=d[b],this._scope.data.unbind(c.join("."),this._bindProcessor)},readBindingValue:function(a){var b;if(null!=(b=this._bindInfo)?b.expression:void 0)return null==a&&(a={}),this._bindInfo.expression.evaluate(this._scope,"async",a)},writeBindingValue:function(a){var b;if(null!=(b=this._bindInfo)?b.expression:void 0){if(!this._bindInfo.writeable)throw new cola.Exception('Expression "'+this._bind+'" is not writable.');this._scope.set(this._bind,a)}},getBindingProperty:function(){var a;if((null!=(a=this._bindInfo)?a.expression:void 0)&&this._bindInfo.writeable)return this._scope.data.getProperty(this._bind)},getBindingDataType:function(){var a;if((null!=(a=this._bindInfo)?a.expression:void 0)&&this._bindInfo.writeable)return this._scope.data.getDataType(this._bind)}},cola.DataItemsWidgetMixin={_dataItemsWidget:!0,_alias:"item",_bindSetter:function(a){var b;if(this._bind!==a){if(this._bind=a,this._itemsRetrieved=!1,delete this._simpleBindPath,a){if(b=cola._compileExpression(a,"repeat"),!b.repeat)throw new cola.Exception('Expression "'+a+'" must be a repeat expression.');this._alias=b.alias,"MemberExpression"!==b.type&&"Identifier"!==b.type||b.hasCallStatement||b.hasDefinedPath||(this._simpleBindPath=b.paths[0])}this._itemsScope.setExpression(b)}},constructor:function(){var a;return this._itemsScope=a=new cola.ItemsScope(this._scope),a.onItemsRefresh=function(a){return function(b){return a._onItemsRefresh(b)}}(this),a.onItemRefresh=function(a){return function(b){return a._onItemRefresh(b)}}(this),a.onItemInsert=function(a){return function(b){return a._onItemInsert(b)}}(this),a.onItemRemove=function(a){return function(b){return a._onItemRemove(b)}}(this),a.onItemsLoadingStart=function(a){return function(b){return"function"==typeof a._onItemsLoadingStart?a._onItemsLoadingStart(b):void 0}}(this),a.onItemsLoadingEnd=function(a){return function(b){return"function"==typeof a._onItemsLoadingEnd?a._onItemsLoadingEnd(b):void 0}}(this),this._onCurrentItemChange?a.onCurrentItemChange=function(a){return function(b){return a._onCurrentItemChange(b)}}(this):void 0},_getItems:function(){return this._itemsRetrieved||(this._itemsRetrieved=!0,this._itemsScope.retrieveData()),{items:this._itemsScope.items,originItems:this._itemsScope.originItems}},_getBindDataType:function(){var a,b,c;return c=this._getItems().originItems,c?c instanceof cola.EntityList?a=c.dataType:c instanceof Array&&c.length&&(b=c[0],b&&b instanceof cola.Entity&&(a=b.dataType)):this._simpleBindPath&&(a=this._scope.data.getDataType(this._simpleBindPath)),a}},function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o;return c=window.document.documentElement.style,m=!1,window.opera&&"[object Opera]"===Object.prototype.toString.call(opera)?d="presto":"MozAppearance"in c?d="gecko":"WebkitAppearance"in c?d="webkit":"string"==typeof navigator.cpuClass&&(d="trident"),o={trident:"ms",gecko:"Moz",webkit:"Webkit",presto:"O"}[d],b={trident:"-ms-",gecko:"-moz-",webkit:"-webkit-",presto:"-o-"}[d],f=document.createElement("div"),g=o+"Perspective",h=o+"Transform",i=b+"transform",k=o+"Transition",l=b+"transition",j=o.toLowerCase()+"TransitionEnd",void 0!==f.style[g]&&(m=!0),e=function(a){var b,c,d;return c={left:0,top:0},null===a||null===a.style?c:(d=a.style[h],b=/translate\(\s*(-?\d+(\.?\d+?)?)px,\s*(-?\d+(\.\d+)?)px\)\s*translateZ\(0px\)/g.exec(d),b&&(c.left=+b[1],c.top=+b[3]),c)},a=function(a){var b;if(null!==a&&null!==a.style)return b=a.style[h],b?(b=b.replace(/translate\(\s*(-?\d+(\.?\d+?)?)px,\s*(-?\d+(\.\d+)?)px\)\s*translateZ\(0px\)/g,""),a.style[h]=b):void 0},n=function(b,c,d){var f,g;if((null!==c||null!==d)&&null!==b&&null!==b.style&&(b.style[h]||0!==c||0!==d))return null!==c&&null!==d||(f=e(b),null==c&&(c=f.left),null==d&&(d=f.top)),a(b),g=" translate("+(c?c+"px":"0px")+","+(d?d+"px":"0px")+")",m&&(g+=" translateZ(0px)"),b.style[h]+=g,b},cola.Fx={transitionEndProperty:j,translate3d:m,transformProperty:h,transformStyleName:i,transitionProperty:k,transitionStyleName:l,perspectiveProperty:g,getElementTranslate:e,translateElement:n,cancelTranslateElement:a}}(),cola.semantic={fixVisibilityOnUpdate:function(a){null==this._offset&&(this._offset={left:this.offsetLeft,top:this.offsetTop}),a.offset=this._offset},fixVisibilityOnRefresh:function(){this._offset={left:this.offsetLeft,top:this.offsetTop}}},t=[],cola.AbstractContainer=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.attributes={content:{setter:function(a){return this._setContent(a,"content"),this}}},b.prototype._initDom=function(a){var b,c,d,e;if(this._content)for(e=this._content,d=0,c=e.length;c>d;d++)b=e[d],this._render(b,"content")},b.prototype._parseDom=function(a){var b,c;for(null==this._content&&(this._content=[]),b=a.firstChild;b;)1===b.nodeType&&(c=cola.widget(b),c&&this._content.push(c)),b=b.nextSibling},b.prototype.getContentContainer=function(){return this.getDom()},b.prototype._clearContent=function(a){var b,c,d,e;if(e=this["_"+a]){for(d=0,c=e.length;c>d;d++)b=e[d],b instanceof cola.widget&&b.destroy();this["_"+a]=[]}null==this._doms&&(this._doms={}),this._doms[a]&&$(this._doms[a]).empty()},b.prototype._setContent=function(a,b){var c,d,e,f;if(this._clearContent(b),a instanceof Array)for(e=0,d=a.length;d>e;e++)c=a[e],f=cola.xRender(c,this._scope),f&&this._addContentElement(f,b);else f=cola.xRender(a,this._scope),f&&this._addContentElement(f,b)},b.prototype._makeContentDom=function(a){return null==this._doms&&(this._doms={}),this._doms[a]=this._dom,this._dom},b.prototype._addContentElement=function(a,b){var c,d,e;d="_"+b,null==this[d]&&(this[d]=[]),e=this[d],c=null,a instanceof cola.Widget?(e.push(a),this._dom&&(c=a.getDom())):a.nodeType&&(e.push(a),c=a),c&&this._dom&&this._render(c,b)},b.prototype._render=function(a,b){var c;null==this._doms&&(this._doms={}),this._doms[b]||this._makeContentDom(b),c=a,a instanceof cola.Widget&&(c=a.getDom()),c.parentNode!==this._doms[b]&&this._doms[b].appendChild(c)},b.prototype.destroy=function(){var a,c,d,e;if(!this._destroyed){if(this._content){for(e=this._content,d=0,c=e.length;c>d;d++)a=e[d],"function"==typeof a.destroy&&a.destroy();delete this._content}return b.__super__.destroy.call(this),this}},b}(cola.Widget),cola.Link=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="a",b.attributes={href:{refreshDom:!0},target:{refreshDom:!0}},b.prototype._setDom=function(a,c){var d,e;return c&&(this._href||(d=a.getAttribute("href"),d&&(this._href=d)),this._target||(e=a.getAttribute("target"),e&&(this._target=e))),b.__super__._setDom.call(this,a,c)},b.prototype._doRefreshDom=function(){var a;if(this._dom)return b.__super__._doRefreshDom.call(this),a=this.get$Dom(),this._href?a.attr("href",this._href):a.removeAttr("href"),a.attr("target",this._target||"")},b}(cola.AbstractContainer),cola.AbstractButton=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.attributes={size:{"enum":["mini","tiny","small","medium","large","big","huge","massive"],refreshDom:!0,setter:function(a){var b;b=this._size,b&&b!==a&&this._dom&&this.removeClass(b),this._size=a}},color:{refreshDom:!0,"enum":["red","orange","yellow","olive","green","teal","blue","violet","purple","pink","brown","grey","black"],setter:function(a){var b;b=this._color,b&&b!==a&&this._dom&&this.removeClass(b),this._color=a}},attached:{refreshDom:!0,defaultValue:"","enum":["left","right","top","bottom",""],setter:function(a){var b;b=this._attached,b&&b!==a&&this._dom&&this.removeClass(b+" attached",!0),this._attached=a}}},b.prototype._doRefreshDom=function(){var a,c,d;this._dom&&(b.__super__._doRefreshDom.call(this),d=this.get("size"),d&&this._classNamePool.add(d),c=this.get("color"),c&&this._classNamePool.add(c),a=this.get("attached"),a&&this._classNamePool.add(a+" attached"))},b}(cola.Widget),cola.Button=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-button",b.SEMANTIC_CLASS=["left floated","right floated","top attached","bottom attached","left attached","right attached"],b.CLASS_NAME="button",b.attributes={caption:{refreshDom:!0},icon:{refreshDom:!0,setter:function(a){var b,c;b=this._icon,this._icon=a,b&&b!==a&&this._dom&&(null!=(c=this._doms)?c.iconDom:void 0)&&$fly(this._doms.iconDom).removeClass(b)}},iconPosition:{refreshDom:!0,defaultValue:"left","enum":["left","right"]},focusable:{type:"boolean",refreshDom:!0,defaultValue:!1},disabled:{type:"boolean",refreshDom:!0,defaultValue:!1},state:{refreshDom:!0,defaultValue:"","enum":["loading","active",""],setter:function(a){var b;b=this._state,b&&b!==a&&this._dom&&$fly(this._dom).removeClass(b),this._state=a}}},b.prototype._parseDom=function(a){var b,c;if(!this._caption)for(b=a.firstChild;b;){if(3===b.nodeType&&(c=b.textContent)){this._caption=c,b.textContent="";break}b=b.nextSibling}!this._disabled&&this.get$Dom().hasClass("disabled")&&(this._disabled=!0)},b.prototype._refreshIcon=function(){var a,b,c,d,e;if(this._dom)if(c=this.get("icon"),e=this.get("iconPosition"),b=this.get("caption"),c){if(null==(a=this._doms).iconDom&&(a.iconDom=document.createElement("i")),d=this._doms.iconDom,$fly(d).addClass(c+" icon"),d.parentNode!==this._dom){if(!this._doms.captionDom)return void this._dom.appendChild(d);"right"===e?$fly(this._doms.captionDom).after(d):$fly(this._doms.captionDom).before(d)}}else this._doms.iconDom&&(this._classNamePool.remove("icon"),$fly(this._doms.iconDom).remove())},b.prototype._doRefreshDom=function(){var a,c,d,e,f;this._dom&&(b.__super__._doRefreshDom.call(this),a=this.get$Dom(),e=this._classNamePool,c=this._caption,d=this._doms.captionDom,c?(d||(d=document.createElement("span"),this._doms.captionDom=d),$fly(d).text(c),d.parentNode!==this._dom&&a.append(d)):d&&$fly(d).remove(),this.get("focusable")?a.attr("tabindex","0"):a.removeAttr("tabindex"),this._refreshIcon(),f=this._state,f&&e.add(f),e.toggle("disabled",this._disabled))},b}(cola.AbstractButton),cola.registerWidget(cola.Button),cola.buttonGroup={},cola.buttonGroup.Separator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="separator",b.parentWidget=cola.ButtonGroup,b.SEMANTIC_CLASS=[],b.CLASS_NAME="or",b.attributes={text:{defaultValue:"or",refreshDom:!0}},b.prototype._parseDom=function(a){var b;a&&(this._text||(b=this._dom.getAttribute("data-text"),b&&(this._text=b)))},b.prototype._doRefreshDom=function(){return this._dom?(b.__super__._doRefreshDom.call(this),this._dom&&this.get$Dom().attr("data-text",this._text),this):void 0},b}(cola.Widget),cola.registerWidget(cola.buttonGroup.Separator),cola.buttonGroup.emptyItems=[],cola.ButtonGroup=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-buttonGroup",b.SEMANTIC_CLASS=["left floated","right floated","top attached","bottom attached","left attached","right attached"],b.CHILDREN_TYPE_NAMESPACE="button-group",b.CLASS_NAME="buttons",b.attributes={fluid:{type:"boolean",refreshDom:!0,attrName:"c-fuild",defaultValue:!1},mutuallyExclusive:{type:"boolean",refreshDom:!0,defaultValue:!0},items:{setter:function(a){var b,c,d;if(this.clear(),a instanceof Array)for(d=0,c=a.length;c>d;d++)b=a[d],this.addItem(b)}}},b.prototype._setDom=function(a,c){var d,e,f,g,h,i,j;if(b.__super__._setDom.call(this,a,c),null!=(i=this._items)?i.length:void 0)for(j=this._items,h=0,g=j.length;g>h;h++)e=j[h],f=e.getDom(),f.parentNode!==a&&e.appendTo(this._dom);return d=function(a){return function(b){var c;a._mutuallyExclusive&&(cola.util.hasClass(b,"disabled")||cola.util.hasClass(b,"loading")||cola.util.hasClass(b,"active")||($(">.ui.button.active",a._dom).each(function(a,c){var d;c!==b&&(d=cola.widget(c),d?d.set("state",""):$(c).removeClass("active"))}),c=cola.widget(b),c?c.set("state","active"):$fly(b).addClass("active")))}}(this),this.get$Dom().delegate(">.ui.button","click",function(a){return d(this,a)})},b.prototype._parseDom=function(a){var b,c;if(a)for(b=a.firstChild;b;)1===b.nodeType&&(c=cola.widget(b),c&&(c instanceof cola.Button||c instanceof cola.buttonGroup.Separator)&&this.addItem(c)),b=b.nextSibling},b.prototype._resetFluid=function(){var a,b,c,d,e,f,g,h,i;if(this._dom){for(a=this.get$Dom(),b=this.constructor.attributes.fluid.attrName,i=a.attr(b),h=0,e=this._items||[],g=0,f=e.length;f>g;g++)d=e[g],d instanceof cola.Button&&h++;h!==i&&i&&this._classNamePool.remove(""+i),c=this.get("fluid"),c&&(this._classNamePool.add(""+h),this._classNamePool.add("fluid"),a.attr(b,h))}},b.prototype._doRefreshDom=function(){this._dom&&(b.__super__._doRefreshDom.call(this),this._resetFluid())},b.prototype.addItem=function(a){var b,c;return this._destroyed?this:(null==this._items&&(this._items=[]),c=null,a instanceof cola.Widget?c=a:a.$type?"Separator"===a.$type||"-"===a.$type?(delete a.$type,c=new cola.buttonGroup.Separator(a)):c=cola.widget(a):"string"==typeof a&&(c=new cola.buttonGroup.Separator({text:a})),c&&(this._items.push(c),this._dom&&(b=c.getDom(),b.parentNode!==this._dom&&(this.get$Dom().append(b),cola.util.delay(this,"refreshDom",50,this._refreshDom)))),this)},b.prototype.add=function(){var a,b,c;for(c=0,b=arguments.length;b>c;c++)a=arguments[c],this.addItem(a);return this},b.prototype.removeItem=function(a){var b;return this._items?(b=this._items.indexOf(a),b>-1&&(this._items.splice(b,1),a.remove(),cola.util.delay(this,"refreshDom",50,this._refreshDom)),this):this},b.prototype.destroy=function(){var a,c,d,e;if(!this._destroyed){if(this._items){for(e=this._items,d=0,c=e.length;c>d;d++)a=e[d],a.destroy();delete this._items}b.__super__.destroy.call(this)}},b.prototype.clear=function(){var a,b,c,d,e;if(null!=(d=this._items)?d.length:void 0){for(e=this._items,c=0,b=e.length;b>c;c++)a=e[c],a.destroy();this._items=[],cola.util.delay(this,"refreshDom",50,this._refreshDom)}},b.prototype.getItem=function(a){var b;return null!=(b=this._items)?b[a]:void 0},b.prototype.getItems=function(){return this._items||cola.buttonGroup.emptyItems},b}(cola.AbstractButton),cola.registerWidget(cola.ButtonGroup),cola.registerType("button-group","_default",cola.Button),cola.registerType("button-group","separator",cola.buttonGroup.Separator),cola.registerTypeResolver("button-group",function(a){return cola.resolveType("widget",a)}),null==cola.slotPicker&&(cola.slotPicker={}),cola.slotPicker.ZyngaScroller=function(a){function b(a,c){var d;d=this,null==c&&(c={}),this.options=c,this.container=a,"static"===$fly(a).css("position")&&$fly(a).css("position","relative"),d.container.style.overflowX="hidden",d.container.style.overflowY="hidden",d.content=$fly(a).children(":first")[0],d.render=c.render,c.scrollingX=!1,c.scrollingY=!0,c.scrollingComplete=function(){return cola.util.delay(d,"scrolled",50,d._scrolled)},d.scroller=new Scroller(function(a,b,c){d.render(a,b,c),cola.util.delay(d,"scrolled",50,d._scrolled),d._scrolling(a,b,c)},c),this._bindEvents(),b.__super__.constructor.call(this,c)}return J(b,a),b.events={scrolled:null},b.prototype.scrollSize=function(a,b,c){var d,e;return e=cola.Fx.getElementTranslate(c),cola.Fx.cancelTranslateElement(c),d="h"===a?Math.max(b.scrollWidth,c.clientWidth):Math.max(b.scrollHeight,c.clientHeight),cola.Fx.translateElement(c,e.left,e.top),d},b.prototype.update=function(){var a,b,c,d,e,f,g;return this._contentInited||(a=this.content=this.container.children[0],this._contentInited=!!this.content),this.content?(g=this.container.clientWidth,f=this.container.clientHeight,e=this.scrollSize("h",this.container,this.content),b=this.scrollSize("v",this.container,this.content),this.scroller.options.scrollingX=!1,this.scroller.options.scrollingY=!0,this.scrollHeight=b,this.scroller.setDimensions(g,f,e,b),(this.snapHeight||this.snapWidth)&&this.scroller.setSnapSize(this.snapWidth||100,this.snapHeight||100),d=this.defaultScrollTop,c=this.defaultScrollLeft,void 0===d&&void 0===c||(this.scroller.scrollTo(c,d,!1),this.defaultScrollTop=void 0,this.defaultScrollLeft=void 0),this):void 0},b.prototype._scrolled=function(){var a,b,c;c=this.getValues(),a=this._scrollTop,a!==c.top&&(b=60*Math.round(c.top/60),this._scrollTop=b,this.scrollTo(c.left,b,!0),this.fire("scrolled",this,{left:c,top:b}))},b.prototype._scrolling=function(){},b.prototype._bindEvents=function(){var a,b,c,d,e;return e=this,d=this._handleStart=function(){var a;return a=window.event,a.target.tagName.match(/input|select/i)?void a.stopPropagation():(cola.os.mobile?e.scroller.doTouchStart(a.touches,a.timeStamp):e.scroller.doTouchStart([{pageX:a.pageX,pageY:a.pageY}],a.timeStamp),e._touchStart=!0,void a.preventDefault())},c=this._handleMove=function(){var a;a=window.event,e._touchStart&&(cola.os.mobile?e.scroller.doTouchMove(a.touches,a.timeStamp):e.scroller.doTouchMove([{pageX:a.pageX,pageY:a.pageY}],a.timeStamp))},a=this._handleEnd=function(){var a;e._touchStart&&(a=window.event,e.scroller.doTouchEnd(a.timeStamp),e._touchStart=!1)},b=this._handleMouseWheel=function(a){e.scroller.scrollBy(0,a.wheelDelta,!0)},e.container.addEventListener("mousewheel",b),cola.os.mobile?$(e.container).on("touchstart",d).on("touchmove",c).on("touchend",a):$(e.container).on("mousedown",d).on("mousemove",c).on("mouseup",a),this},b.prototype.scrollTo=function(a,b,c){this.scroller.scrollTo(a,b,c)},b.prototype.scrollBy=function(a,b){this.scroller.scrollBy(a,b,animate)},b.prototype.getValues=function(){return this.scroller.getValues()},b.prototype.destroy=function(){cola.util.cancelDelay(this,"scrolled"),cola.os.mobile?$(this.container).off("touchstart",this._handleStart).off("touchmove",this._handleMove).off("touchend",this._handleEnd):$(this.container).off("mousedown",this._handleStart).off("mousemove",this._handleMove).off("mouseup",this._handleEnd),delete this.container,delete this.content},b}(cola.Element),cola.AbstractSlotList=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b}(cola.RenderableElement),cola.SlotList=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.CLASS_NAME="list",b.attributes={viewItemCount:{type:"number",refreshDom:!0,defalutValue:3},items:{refreshDom:!0,setter:function(a){var b;return b=this._items,this._oldItems=b||[],this._items=a,this._dom?this._itemChanged=!0:void 0}},value:{getter:function(){var a,b;return b=this.doGetItems(),a=this._currentIndex||0,b&&void 0!==a?b[a]:void 0},setter:function(a){var b,c,d;return b=this.doGetItems(),d=this._currentIndex,c=b.indexOf(a),c!==d?(this._currentIndex=b.indexOf(a),this._dom?this.syncScroll():void 0):void 0}},defaultValue:null,currentIndex:{type:"number",refreshDom:!0,defaultValue:0},formatter:null},b.events={valueChange:null},b.prototype.doTouchStart=function(a,b){var c;cola.slotPicker._activePicker=this,null!=(c=this._scroller)&&c.doTouchMove(a,b)},b.prototype.doTouchMove=function(a,b){var c;null!=(c=this._scroller)&&c.doTouchMove(a,b)},b.prototype.doTouchEnd=function(a){var b;null!=(b=this._scroller)&&b.doTouchEnd(a),cola.slotPicker._activePicker=null},b.prototype.syncScroll=function(){var a,b,c;if(this._zyngaScroller)return a=this._doms,c=this.get("value"),void 0!==c&&(b=$fly(a.body).find(" > .slot-item")[this._currentIndex])?(this._disableScrollEvent=!0,this._zyngaScroller.scrollTo(0,b.offsetTop-60,!1),this._disableScrollEvent=!1):void 0},b.prototype._createDom=function(){var a,b,c,d,e,f,g,h,i;for(h=this,null==this._doms&&(this._doms={}),b=this._doms,a=$.xCreate({"class":this.constructor.CLASS_NAME,content:[{"class":"items-wrap",contextKey:"body"}]},this._doms),i=this._viewItemCount||3,c=Math.floor(i/2),e=0;c>e;)f=document.createElement("div"),f.className="dummy-item",b.body.appendChild(f),e++;for(g=h.doGetItems(),d=this._formatter||function(a,b){return b},e=0;e<g.length;)f=document.createElement("div"),f.className="slot-item",f.innerHTML=d(e,g[e]),b.body.appendChild(f),e++;for(e=0;c>e;)f=document.createElement("div"),f.className="dummy-item",b.body.appendChild(f),e++;return a},b.prototype._initDom=function(a){var b,c,d,e,f,g,h;f=this,e=this.doGetItems(),b=this._defaultValue,h=0,void 0!==b&&(c=this._currentIndex=e.indexOf(b),d=$fly(this._doms.body).find(" > *")[c],g=$fly(d).position(),h=g.top),f._zyngaScroller=new cola.slotPicker.ZyngaScroller(a,{render:cola.util.getScrollerRender(this._doms.body)}),f._zyngaScroller.on("scrolled",function(a,b){var c,d;return c=Math.round(b.top/60),g=60*c,g===b.top?(f._currentIndex=Math.abs(c),d=f.get("value"),f.fire("valueChange",f,{currentIndex:Math.abs(c),value:d})):void 0})},b.prototype._updateScroller=function(){var a,b,c;return this._scroller?(c=this._dom.getBoundingClientRect(),a=this._dom,b=this._doms,this._scroller.setPosition(c.left+a.clientLeft,c.top+a.clientTop),this._scroller.setDimensions(a.clientWidth,a.clientHeight,b.body.offsetWidth,b.body.offsetHeight)):void 0},b.prototype._refreshItemDoms=function(){var a,b,c,d,e,f,g,h,i,j,k,l;if(h=this.doGetItems(),a=this._doms,l=this._viewItemCount||3,b=Math.floor(l/2),d=this._formatter||function(a,b){return b},i=a.body.children.length,c=h.length+2*b,c>i)for(j=a.body.children[i-b],f=c-i,e=0;f>e;)g=document.createElement("div"),g.className="slot-item",a.body.insertBefore(g,j),e++;else if(i>c)for(k=i-c,e=0;k>e;)$fly(a.body.children[c-b]).remove(),e++;for(e=0;e<h.length;)g=a.body.children[e+1],g.className="slot-item",g.innerHTML=d(e,h[e]),e++;return this._itemChanged=!1},b.prototype._doRefreshDom=function(){var a;if(this._dom)return a=this,this._refreshItemDoms(),a._zyngaScroller?(a._zyngaScroller.update(),a.syncScroll()):void 0},b.prototype.doGetItems=function(){return this._items||[]},b}(cola.AbstractSlotList),cola.RangeSlotList=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.attributes={range:{refreshDom:!0,setter:function(a){return this._oldItems=this.doGetItems(),this._range=a,this._dom&&(this._itemChanged=!0),this}},step:{defaultValue:1}},b.prototype.doGetItems=function(){var a,b,c,d,e,f;if(d=this._range,c=[],d&&2===d.length)for(e=d[0],f=this._step,b=(d[1]-e)/f+1,a=0;b>a;)c.push(e+a*f),a++;return c},b}(cola.SlotList),cola.MultiSlotPicker=function(a){function b(a){this.slotConfigs&&this.initSlotConfigs(),b.__super__.constructor.call(this,a)}return J(b,a),b.CLASS_NAME="multi-slot-picker",b.slotConfigs=[],b.attributes={height:null},b.prototype._createDom=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;for(i=this,c={},a=$.xCreate({"class":this.constructor.CLASS_NAME,content:[{"class":"body",contextKey:"body"}]},c),i._doms=c,i._slotListMap={},k=i.slotConfigs,f=[],m=[],d=0,g=k.length;g>d;)j=k[d],n=j.name,b={},e=$.xCreate({"class":"slot-picker",style:{webkitBoxFlex:1},content:[{content:j.unit||"","class":"unit"},{"class":"slot",contextKey:"slot",content:[{"class":"mask",content:{"class":"bar"}}]}]},b),l=b.slot,h="Range"===j.$type?new cola.RangeSlotList({range:j.range,formatter:j.formatter,defaultValue:j.defaultValue,valueChange:function(a,b){var c;return c=b.value,i.setSlotValue(a._slotIndex,c)}}):new cola.SlotList({items:j.items,formatter:j.formatter,defaultValue:j.defaultValue,valueChange:function(a,b){var c;return c=b.value,i.setSlotValue(a._slotIndex,c)}}),h._slotIndex=d,i._slotListMap[n]=h,h.appendTo(l),c.body.appendChild(e),m.push(h),f.push(l),d++;return i._slotLists=m,i._items=f,a},b.prototype.initSlotConfigs=function(){var a,b,c,d,e,f,g;for(e=this.slotConfigs,f=this._slotMap={},g=this._values=[],b=0,c=e.length;c>b;)a=e[b],d=a.name,a["class"]=a.className||"slot",a.range=a.range||[null,null],f[d]=a,g[b]=a.defaultValue,b++},b.prototype.getSlotValue=function(a){return"string"==typeof a&&(a=this.getSlotIndexByName(a)),this._values[a]},b.prototype.setSlotValue=function(a,b){var c,d,e,f,g;return f=this,"string"==typeof a&&(a=f.getSlotIndexByName(a)),0>a?void 0:(null!==b&&(c=f.slotConfigs[a],g=c.range||[],e=g[0],d=g[1],b=parseInt(b,10),isNaN(b)&&(b=c.defaultValue||0),null!==d&&b>d?b=d:null!==e&&e>b&&(b=e)),this._values[a]=b,this._dom&&this._slotLists?this._slotLists[a].set("value",b):void 0)},b.prototype.getSlotText=function(a){var b,c,d,e,f,g;if(f=this,"string"==typeof a&&(a=f.getSlotIndexByName(a)),0>a)return"";if(b=f.slotConfigs[a],g=f.getSlotValue(a),null===g)if(b.digit>0)for(g="",c=0;c<b.digit;)g+="&nbsp;",c++;else g="&nbsp;";else{if(e=g,d=0>e,g=Math.abs(e)+"",b.digit>0&&g.length<b.digit)for(c=g.length;c<=b.digit-1;)g="0"+g,c++;g=(null!=d?d:{"-":""})+g}return g},b.prototype.getText=function(){var a,b,c,d,e;for(c=this,d=c.slotConfigs,e="",b=0;b<d.length;)a=d[b],e+=a.prefix||"",e+=c.getSlotText(b),e+=a.suffix||"",b++;return e},b.prototype.getSlotIndexByName=function(a){var b;return this._slotMap||this.initSlotConfigs(),b=this._slotMap[a],b?this.slotConfigs.indexOf(b):-1},b.prototype.doOnResize=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(l=this,h=l._items||[],b=l._dom,d=[],f=k=0,j=h.length;j>k;f=++k)g=h[f],q=l.slotConfigs[f].width||90,d.push(q);for(p=b.clientWidth,a=d.length,n=0,e=0;a>e;)c=d[e],n+=parseInt(c,10)||90,e++;for(o=p/n,i=0,e=0,m=[];a>e;)e!==a-1?($fly(h[e]).css({width:Math.floor(o*d[e])}),i+=Math.floor(o*d[e])):$fly(h[e]).css({width:p-i}),m.push(e++);return m},b.prototype.updateItems=function(){var a,b,c,d;for(d=this._slotLists,c=0,a=d.length;a>c;c++)b=d[c],b.refresh();return this},b}(cola.AbstractSlotList),F=new Date,z=F.getFullYear(),x=F.getMonth()+1,u=F.getDate(),v=F.getHours(),w=F.getMinutes(),y=F.getSeconds(),A={year:{$type:"Range",name:"year",range:[z-50,z+50],defaultValue:z,unit:"",width:120},month:{$type:"Range",name:"month",range:[1,12],defaultValue:x,unit:"",width:90},date:{$type:"Range",name:"date",range:[1,31],defaultValue:u,unit:"",width:90},hours:{$type:"Range",name:"hours",range:[0,23],defaultValue:v,unit:"",width:90},minutes:{$type:"Range",name:"minutes",range:[0,59],defaultValue:0,unit:"",width:90},seconds:{$type:"Range",name:"seconds",range:[0,59],defaultValue:0,unit:"",width:90}},H=function(a){return this.getSlotValue(a)},I=function(a,b){return this.setSlotValue(b,a)},B={year:[A.year],month:[A.year,A.month],date:[A.year,A.month,A.date],time:[A.hours,A.minutes,A.seconds],dateTime:[A.year,A.month,A.date,A.hours,A.minutes,A.seconds],hours:[A.hours],minutes:[A.hours,A.minutes],dateHours:[A.year,A.month,A.date,A.hours],dateMinutes:[A.year,A.month,A.date,A.hours,A.minutes]},null==cola.mobile&&(cola.mobile={}),cola.mobile.DateTimePicker=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.CLASS_NAME="multi-slot-picker",b.slotConfigs=[],b.attributes={type:{"enum":["year","month","date","time","datetime","hours","minutes","dateHours","dateMinutes"],defaultValue:"date"},year:{getter:H,setter:I},month:{getter:H,setter:I},date:{getter:H,setter:I},hours:{getter:H,setter:I},minutes:{getter:H,setter:I},seconds:{getter:H,setter:I},value:{getter:function(){var a,b,c,d,e,f;return f=this.getSlotValue("year")||1980,d=this.getSlotValue("month")-1||0,a=this.getSlotValue("date")||1,b=this.getSlotValue("hours")||0,c=this.getSlotValue("minutes")||0,e=this.getSlotValue("seconds")||0,new Date(f,d,a,b,c,e)},setter:function(a){var b,c,d,e,f,g;return g=0,e=1,b=1,c=0,d=1,f=1,a&&(g=a.getFullYear(),e=a.getMonth()+1,b=a.getDate(),c=a.getHours(),d=a.getMinutes(),f=a.getSeconds()),this.setSlotValue("year",g),this.setSlotValue("month",e),this.setSlotValue("date",b),this.setSlotValue("hours",c),this.setSlotValue("minutes",d),this.setSlotValue("seconds",f)}}},b.prototype._createDom=function(){var a,c,d,e,f,g,h;return f=this,g=f._type,a=B[g],f.slotConfigs=a,f.initSlotConfigs(),d=b.__super__._createDom.call(this),f._slotMap.date&&(h=f.getSlotValue("year"),e=f.getSlotValue("month"),c=XDate.getDaysInMonth(h,e-1),f.refreshSlotList("date",{range:[1,c]})),d},b.prototype._doRefreshDom=function(){this._dom&&(b.__super__._doRefreshDom.call(this),this._classNamePool.add("multi-slot-picker"))},b.prototype.refreshSlotList=function(a,b){var c,d;return c=this,d=c._slotListMap[a],d&&void 0!==b&&d.set(b),this},b.prototype.setSlotValue=function(a,c){var d,e,f,g,h,i,j,k,l;return j=this,null===c?void b.__super__.setSlotValue.call(this,a,c):("number"==typeof a?(d=j.slotConfigs[a],d&&(k=d.name)):(k=a,a=j.getSlotIndexByName(k)),
k&&j._slotMap[k]?j._slotMap.date?(f=j.getSlotIndexByName("date"),e=j._values[f],i=0,l=0===a?c:j._values[0],h=1===a?c:j._values[1],g=XDate.getDaysInMonth(l,h-1),"year"!==k&&"month"!==k||j.refreshSlotList("date",{range:[1,g]}),e>=28&&e>g&&(i=g),i?"year"===k||"month"===k?(j.setSlotValue("date",i),j._slotListMap[k]._value=i,j.refreshSlotList("date"),b.__super__.setSlotValue.call(this,a,c)):b.__super__.setSlotValue.call(this,a,i):b.__super__.setSlotValue.call(this,a,c)):void b.__super__.setSlotValue.call(this,a,c):void 0)},b}(cola.MultiSlotPicker),cola.mobile.showDateTimePicker=function(a){var b,c,d,e;return e=cola.mobile._cacheDateTimer,e&&a.type!==e._picker.get("type")&&(e.destroy(),cola.mobile._cacheDateTimer=null,e=null),e||(d=new cola.mobile.DateTimePicker({type:a.type||"date"}),e=new cola.Layer({animation:"slide up",vertical:!0,horizontal:!0,"class":"date-timer"}),e._picker=d,c=e.getDom(),c.appendChild(d.getDom()),b=$.xCreate({"class":"actions ui two fluid bottom attached buttons",content:[{"class":"ui button",content:cola.resource("cola.message.deny"),click:function(){return cola.commonDimmer.hide(),e.hide()}},{"class":"ui positive button",content:cola.resource("cola.message.approve"),click:function(){return cola.commonDimmer.hide(),e.hide(),"function"==typeof e._hideCallback&&e._hideCallback(d),delete e._hideCallback}}]}),c.appendChild(b),$fly(c).css("top","auto"),window.document.body.appendChild(c),cola.mobile._cacheDateTimer=e),e=cola.mobile._cacheDateTimer,null==a&&(a={}),a.onHide&&(e._hideCallback=a.onHide,delete a.onHide),cola.commonDimmer.show(),e.show(function(){return e._picker.set(a),e._picker.updateItems()}),e._picker},function(){var a,b,c;return b=function(a){var b,c,d,e;for(c=a.srcElement||a.target,d=-1,b=-1;c&&c!==c.ownerDocument.body;){if(e=c.tagName.toLowerCase(),"td"===e){d=c.parentNode.rowIndex,b=c.cellIndex;break}c=c.parentNode}return c!==c.ownerDocument.body?{row:d,column:b,element:c}:null},null==cola.calendar&&(cola.calendar={}),cola.calendar.getCellPosition=b,cola.calendar.DateGrid=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return J(d,a),d.attributes={calendar:null,columnCount:{type:"number",defaultValue:1},rowCount:{type:"number",defaultValue:1},cellClassName:null,selectedCellClassName:"",rowClassName:null,tableClassName:null},d.events={cellClick:null,refreshCellDom:null},d.prototype._createDom=function(){var a,c,d,e,f,g,h,i;for(f=this,a=this._columnCount,g=this._rowCount,null==this._doms&&(this._doms={}),c=$.xCreate({tagName:"table",cellSpacing:0,"class":(f._className||"")+" "+(f._tableClassName||""),content:{tagName:"tbody",contextKey:"body"}},this._doms),d=0;g>d;){for(i=document.createElement("tr"),e=0;a>e;)h=document.createElement("td"),this._cellClassName&&(h.className=this._cellClassName),this.doRenderCell(h,d,e),i.appendChild(h),e++;this._rowClassName&&(i.className=this._rowClassName),this._doms.body.appendChild(i),d++}return $fly(c).on("click",function(a){var c;if(c=b(a),c&&c.element){if(c.row>=f._rowCount)return;return f.fire("cellClick",f,c)}}),c},d.prototype.doFireRefreshEvent=function(a){return this.fire("refreshCellDom",this,a),this},d.prototype.refreshGrid=function(){var a,b,c,d,e,f,g,h,i,j;for(h=this,c=this._doms.body,b=this._columnCount,i=this._rowCount,g=this._lastSelectedCell,g&&($fly(g).removeClass(this._selectedCellClassName||"selected"),this._lastSelectedCell=null),e=0;i>e;){for(j=c.rows[e],f=0;b>f;)a=j.cells[f],h._cellClassName&&(a.className=h._cellClassName),d={cell:a,row:e,column:f},this.doFireRefreshEvent(d),d.processDefault!==!1&&this.doRefreshCell(a,e,f),f++;e++}return this},d.prototype.setSelectionCell=function(a,b){var c,d,e,f;return e=this,d=this._lastSelectedCell,a=null,b=null,this._dom?(d&&($fly(d).removeClass(this._selectedCellClassName||"selected"),this._lastSelectedCell=null),f=e._doms.body,f.rows[a]&&(c=f.rows[a].cells[b]),c?($fly(c).addClass(this._selectedCellClassName||"selected"),this._lastSelectedCell=c,this):this):(this._selectionPosition={row:a,column:b},this)},d.prototype.getYMForState=function(a){var b,c;return b=this._month,c=this._year,"prev-month"===a.type?(c=0===b?c-1:c,b=0===b?11:b-1):"next-month"===a.type&&(c=11===b?c+1:c,b=11===b?0:b+1),{year:c,month:b}},d.prototype.doFireRefreshEvent=function(a){var b,c,d,e;return d=a.row,c=a.column,this._state&&this._year&&(b=this._state[7*d+c],e=this.getYMForState(b),a.date=new Date(e.year,e.month,b.text)),this.fire("refreshCellDom",this,a),this},d.prototype.doRenderCell=function(a,b,c){var d;d=document.createElement("div"),d.className="label",a.appendChild(d)},d.prototype.getDateCellDom=function(a){var b;return b=new XDate(a).toString("yyyy-M-d"),$(this._dom).find("td[cell-date='"+b+"']")},d.prototype.doRefreshCell=function(a,b,c){var d,e,f;return(e=this._state)?(d=e[7*b+c],$fly(a).removeClass("prev-month next-month").addClass(d.type).find(".label").html(d.text),f=this.getYMForState(d),$fly(a).attr("cell-date",f.year+"-"+(f.month+1)+"-"+d.text),"normal"===d.type&&this._year===this._calendar._year&&this._month===this._calendar._month&&d.text===this._calendar._monthDate?($fly(a).addClass("selected"),this._lastSelectedCell=a):void 0):void 0},d.prototype.setState=function(a,b){var d,e;return e=this._year,d=this._month,e===a&&d===b||(this._year=a,this._month=b,this._state=c(new Date(a,b,1)),this.refreshGrid()),this.onCalDateChange()},d.prototype.onCalDateChange=function(){var a,b,c,d,e,f,g,h,i,j,k;return this._dom?(c=this._calendar._date,k=this._year,f=this._month,c&&k===c.getFullYear()&&f===c.getMonth()&&c.getDate()?(g=c.getDate(),i=this._state,e=i.firstDayPosition,d=g+e-1,b=d%7,h=Math.floor(d/7),j=this._doms.body,a=j.rows[h].cells[b],this._lastSelectedCell&&$fly(this._lastSelectedCell).removeClass("selected"),a&&$fly(a).addClass("selected"),this._lastSelectedCell=a):(this._lastSelectedCell&&$fly(this._lastSelectedCell).removeClass("selected"),this._lastSelectedCell=null),this):this},d}(cola.RenderableElement),cola.calendar.SwipePicker=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.CLASS_NAME="ui swipe-picker",b.attributes={calendar:null},b.events={change:null,monthChange:null},b.prototype.createDateTable=function(a){var b,c;return b=this._calendar,c=new cola.calendar.DateGrid({rowCount:6,columnCount:7,calendar:b,tableClassName:"date-table",refreshCellDom:function(a,c){return b.doFireCellRefresh(c)},cellClick:function(a,c){var d,e,f;return e=c.element,f=a._state,e?(d=f[7*c.row+c.column],"prev-month"===d.type?b.prevMonth():"next-month"===d.type&&b.nextMonth(),b.setDate(d.text),b.fire("change",b,{date:b._date}),b.fire("cellClick",b,{date:b._date,element:e})):void 0}}),c.appendTo(a),c},b.prototype.doOnSwipeNext=function(){return this._calendar.nextMonth(),this},b.prototype.doOnSwipePrev=function(){return this._calendar.prevMonth(),this},b.prototype.setState=function(a,b){var c,d,e,f,g;return this._current.setState(a,b),f=0===b?a-1:a,e=0===b?11:b-1,this._prev.setState(f,e),d=11===b?a+1:a,c=11===b?0:b+1,this._next.setState(d,c),null!=(g=this._calendar)&&g.fire("monthChange",this._calendar,{year:a,month:b}),this},b.prototype.setDate=function(){return this._dom?(this._current.onCalDateChange(),this._prev.onCalDateChange(),this._next.onCalDateChange(),this):this},b.prototype._createDom=function(){var a,b,c,d;return a=document.createElement("div"),b=this,a.className="date-table-wrapper",c=function(a){b["_"+a]=this},this._stack=new cola.Stack({change:function(a){return function(b,c){var d;return d=a._current.getDom(),c.prev===d.parentNode?a.doNext():a.doPrev()}}(this)}),d=this._stack.getDom(),a.appendChild(d),this._current=this.createDateTable(this._stack._currentItem),this._current.setType=c,this._current.setType("current"),this._next=this.createDateTable(this._stack._nextItem),this._next.setType=c,this._next.setType("next"),this._prev=this.createDateTable(this._stack._prevItem),this._prev.setType=c,this._prev.setType("prev"),a},b.prototype.doNext=function(){var a,b,c,d;return c=this,a=c._current,d=c._prev,b=c._next,a.setType("prev"),b.setType("current"),d.setType("next"),this.fire("change",this,{target:"next"})},b.prototype.doPrev=function(){var a,b,c,d;return c=this,a=c._current,d=c._prev,b=c._next,a.setType("next"),b.setType("prev"),d.setType("current"),this.fire("change",this,{target:"prev"})},b.prototype.next=function(a){return this._stack.next(),"function"==typeof a&&a(),this},b.prototype.prev=function(a){return this._stack.prev(),"function"==typeof a&&a(),this},b.prototype.getDateCellDom=function(a){return this._current.getDateCellDom(a)},b}(cola.RenderableElement),a={getDayCountOfMonth:function(a,b){return 3===b||5===b||8===b||10===b?30:1===b?a%4===0&&a%100!==0||a%400===0?29:28:31},getFirstDayOfMonth:function(a){var b;return b=new Date(a.getTime()),b.setDate(1),b.getDay()},getWeekNumber:function(a){var b;return b=new Date(+a),b.setHours(0,0,0),b.setDate(b.getDate()+4-(b.getDay()||7)),Math.ceil(((b-new Date(b.getFullYear(),0,1))/864e5+1)/7)}},c=function(b){var c,d,e,f,g,h,i,j,k,l;for(f=b.getDay(),l=a.getDayCountOfMonth(b.getFullYear(),b.getMonth()),j=0===b.getMonth()?11:b.getMonth()-1,k=a.getDayCountOfMonth(b.getFullYear(),j),f=0===f?7:f,d=[],e=1,g=null,h=0;6>h;){for(i=0;7>i;)c={row:h,column:i,type:"normal"},0===h?i>=f?(c.text=e++,2===e&&(g=7*h+i)):(c.text=k-(f-i%7)+1,c.type="prev-month"):l>=e?(c.text=e++,2===e&&(g=7*h+i)):(c.text=e++-l,c.type="next-month"),d.push(c),i++;h++}return d.firstDayPosition=g,d},cola.getDateTableState=c,cola.Calendar=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.CLASS_NAME="calendar",b.tagName="c-calendar",b.attributes={date:{getter:function(){return this._date||new Date}}},b.events={refreshCellDom:null,change:null,monthChange:null,cellClick:null},b.prototype.doFireCellRefresh=function(a){return this.fire("refreshCellDom",this,a)},b.prototype.bindButtonsEvent=function(){var a,b,c;return a=this,b=this._doms,c=this._datePicker,$fly(b.prevMonthButton).on("click",function(){return c.prev()}),$fly(b.nextMonthButton).on("click",function(){return c.next()}),$fly(b.prevYearButton).on("click",function(){return a.prevYear()}),$fly(b.nextYearButton).on("click",function(){return a.nextYear()})},b.prototype._initDom=function(a){var b,c,d,e,f;return b=cola.resource("cola.date.dayNamesShort"),f=b.split(","),d=this,null==this._doms&&(this._doms={}),c=$.xCreate({tagName:"div",content:{tagName:"div","class":"caption-panel",content:[{tagName:"div","class":"header",contextKey:"header",content:[{tagName:"div","class":"month",content:[{tagName:"span","class":"button prev",contextKey:"prevMonthButton"},{tagName:"span","class":"button next",contextKey:"nextMonthButton"},{tagName:"div","class":"label",contextKey:"monthLabel"}]},{tagName:"div","class":"year",content:[{tagName:"span","class":"button prev",contextKey:"prevYearButton"},{tagName:"span","class":"button next",contextKey:"nextYearButton"},{tagName:"div","class":"label",contextKey:"yearLabel"}]}]},{tagName:"table",cellPadding:0,cellSpacing:0,border:0,"class":"date-header",contextKey:"dateHeader",content:[{tagName:"tr",content:[{tagName:"td",content:f[0]},{tagName:"td",content:f[1]},{tagName:"td",content:f[2]},{tagName:"td",content:f[3]},{tagName:"td",content:f[4]},{tagName:"td",content:f[5]},{tagName:"td",content:f[6]}]}]}]}},this._doms),e=d._datePicker=new cola.calendar.SwipePicker({className:"date-table-wrapper",calendar:d,change:function(a,b){return"next"===b.target?d.nextMonth():d.prevMonth()}}),e.appendTo(c),this._doms.dateTableWrapper=e._dom,d.bindButtonsEvent(),$(a).append(c)},b.prototype.setState=function(a,b){var c;return c=this._doms,this._year=a,this._month=b,$fly(c.monthLabel).html(b+1||""),$fly(c.yearLabel).html(a||""),this._datePicker.setState(a,b)},b.prototype.setDate=function(a){return this._date=new Date(this._year,this._month,a),this._monthDate=a,this._datePicker.setDate(a),this},b.prototype.prevMonth=function(){var a,b,c,d;return d=this._year,a=this._month,void 0!==d&&void 0!==a&&(c=0===a?d-1:d,b=0===a?11:a-1,this.setState(c,b)),this},b.prototype.nextMonth=function(){var a,b,c,d;return d=this._year,a=this._month,void 0!==d&&void 0!==a&&(c=11===a?d+1:d,b=11===a?0:a+1,this.setState(c,b)),this},b.prototype.prevYear=function(){var a,b;return b=this._year,a=this._month,void 0!==b&&void 0!==a&&this.setState(b-1,a),this},b.prototype.setYear=function(a){var b,c;return c=this._year,b=this._month,void 0!==c&&void 0!==b?this.setState(a,b):void 0},b.prototype.nextYear=function(){var a,b;return b=this._year,a=this._month,void 0!==b&&void 0!==a&&this.setState(b+1,a),this},b.prototype._doRefreshDom=function(){var a;if(this._dom)return b.__super__._doRefreshDom.call(this),a=this.get("date"),a?(this.setState(a.getFullYear(),a.getMonth()),this.setDate(a.getDate())):void 0},b.prototype.getDateCellDom=function(a){return this._datePicker.getDateCellDom(a)},b}(cola.Widget)}(),cola.registerWidget(cola.Calendar),cola.Divider=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-divider",b.CLASS_NAME="divider",b.attributes={direction:{"enum":["vertical","horizontal",""],defaultValue:"",refreshDom:!0,setter:function(a){var b;b=this._direction,this._direction=a,this._dom&&b&&b!==a&&this.removeClass(b)}}},b.prototype._doRefreshDom=function(){this._dom&&(b.__super__._doRefreshDom.call(this),this._direction&&this._classNamePool.add(this._direction))},b}(cola.AbstractContainer),cola.registerWidget(cola.Divider),a="about:blank",cola.IFrame=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return J(c,b),c.tagName="c-iframe",c.CLASS_NAME="iframe",c.attributes={path:{defaultValue:a,setter:function(a){this._path=a,this._loaded=!1,this._replaceUrl(this._path)}},loadingText:null},c.events={load:null},c.prototype._initDom=function(a){var b,c,d;c=this,d=this._doms,b=$(a),b.addClass("loading").empty().append($.xCreate([{tagName:"div","class":"ui active inverted dimmer",content:{tagName:"div","class":"ui medium text loader",content:this._loadingText||"",contextKey:"loader"},contextKey:"dimmer"},{tagName:"iframe",contextKey:"iframe",frameBorder:0}],d)),$(d.iframe).load(function(){return c.fire("load",this,{}),c._loaded=!0,$(d.dimmer).removeClass("active")}).attr("src",this._path)},c.prototype.getLoaderContainer=function(){return this._dom||this.getDom(),this._doms.dimmer},c.prototype.getContentWindow=function(){var a,b;null==this._doms&&(this._doms={});try{this._doms.iframe&&(a=this._doms.iframe.contentWindow)}catch(c){b=c}return a},c.prototype.open=function(a,b){b&&this.one("load",function(){return cola.callback(b,!0)}),this.set("path",a)},c.prototype.reload=function(a){return a&&this.one("load",function(){return cola.callback(a,!0)}),this._replaceUrl(this._path),this},c.prototype._replaceUrl=function(a){var b;return this._doms&&this._doms.dimmer&&$fly(this._doms.dimmer).addClass("active"),b=this.getContentWindow(),b?b.location.replace(a):this._doms.iframe&&$fly(this._doms.iframe).prop("src",a),this},c}(cola.Widget),cola.registerWidget(cola.IFrame),cola.SubView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-subView",b.CLASS_NAME="sub-view",b.attributes={loading:null,url:{readOnlyAfterCreate:!0},jsUrl:{readOnlyAfterCreate:!0},cssUrl:{readOnlyAfterCreate:!0},timeout:{readOnlyAfterCreate:!0},parentModel:null,modelName:null,contentModel:{readOnly:!0,getter:function(){return this._dom?cola.util.userData(this._dom,"_model"):null}},param:{readOnlyAfterCreate:!0},showLoadingContent:null},b.events={load:null,loadError:null,unload:null},b.prototype._initDom=function(a){var b,c;b=$fly(a),0===b.find(">.content").length&&(c={"class":"content"},c[cola.constants.IGNORE_DIRECTIVE]=!0,b.xAppend(c)),this._url&&this.load({url:this._url,jsUrl:this._jsUrl,cssUrl:this._cssUrl,param:this._param})},b.prototype.load=function(a,b){var c,d,e,f,g,h;"function"==typeof a&&(b=a,a=null),f=this._dom,this.unload(),a&&(a.parentModel&&(this._parentModel=a.parentModel),a.modelName&&(this._modelName=a.modelName),a.url&&(this._url=a.url),a.jsUrl&&(this._jsUrl=a.jsUrl),a.cssUrl&&(this._cssUrl=a.cssUrl),a.timeout&&(this._timeout=a.timeout),a.param&&(this._param=a.param)),h=this._parentModel instanceof cola.Scope?this._parentModel:this._parentModel?cola.model(this._parentModel):this._scope||cola.model(cola.constants.DEFAULT_PATH),g=this._modelName?new cola.Model(this._modelName,h):new cola.Model(h),cola.util.userData(f,"_model",g),this._loading=!0,e=$(this._dom),c=e.find(">.content"),this._showLoadingContent||c.css("visibility","hidden"),d=e.find(">.ui.dimmer"),0===d.length&&(e.xAppend({"class":"ui inverted dimmer",content:{"class":"ui loader"}}),d=e.find(">.ui.dimmer")),d.addClass("active"),cola.loadSubView(c[0],{model:g,htmlUrl:this._url,jsUrl:this._jsUrl,cssUrl:this._cssUrl,timeout:this._timeout,param:this._param,callback:{complete:function(a){return function(c,d){var f,g;return a._currentUrl=a._url,a._currentJsUrl=a._jsUrl,a._currentCssUrl=a._cssUrl,a._showLoadingContent||e.find(">.content").css("visibility",""),e.find(">.ui.dimmer").removeClass("active"),a._loading=!1,g=c?a.fire("load",a):a.fire("loadError",a,{error:d}),f=cola.callback(b,c,d),void 0!==f&&(g=f),g}}(this)}})},b.prototype.loadIfNecessary=function(a,b){"function"==typeof a&&(b=a,a=null),this._currentUrl&&this._currentUrl===(null!=a?a.url:void 0)&&this._currentJsUrl===a.jsUrl&&this._currentCssUrl===a.cssUrl?cola.callback(b,!0):this.load(a,b)},b.prototype.unload=function(){var a,b;(this._dom||this._currentUrl)&&(cola.unloadSubView($fly(this._dom).find(">.content")[0],{htmlUrl:this._currentUrl,cssUrl:this._currentCssUrl}),delete this._currentUrl,delete this._currentCssUrl,a=this._dom,b=cola.util.userData(a,"_model"),null!=b&&b.destroy(),cola.util.removeUserData(a,"_model"),this.fire("unload",this))},b.prototype.reload=function(a){return this.load(a)},b}(cola.Widget),cola.registerWidget(cola.SubView),cola.Image=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="img",b.CLASS_NAME="image",b.attributes={src:{refreshDom:!0},size:{"enum":["mini","tiny","small","medium","large","big","huge","massive"],refreshDom:!0,setter:function(a){var b;b=this._size,b&&b!==a&&this._dom&&this.get$Dom().removeClass(b),this._size=a}},disabled:{type:"boolean",refreshDom:!0,defaultValue:!1}},b.prototype._parseDom=function(a){var b;if(a)return!this._src&&(b=a.getAttribute("src"))?this._src=b:void 0},b.prototype._doRefreshDom=function(){var a,c,d;this._dom&&(b.__super__._doRefreshDom.call(this),a=this.get$Dom(),c=this._classNamePool,d=this.get("size"),d&&c.add(d),a.attr("src",this._src),c.toggle("disabled",this._disabled))},b}(cola.Widget),cola.Avatar=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.CLASS_NAME="avatar image",b}(cola.Image),cola.Label=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-label",b.SEMANTIC_CLASS=["left floated","right floated","left top attached","right top attached","right bottom attached","left bottom attached","top attached","bottom attached","left ribbon","right ribbon","center aligned"],b.CLASS_NAME="label",b.attributes={size:{"enum":["mini","tiny","small","medium","large","big","huge","massive"],refreshDom:!0,setter:function(a){var b;b=this._size,b&&b!==a&&this._dom&&this.removeClass(b),this._size=a}},text:{refreshDom:!0},icon:{refreshDom:!0,setter:function(a){var b,c;b=this._icon,this._icon=a,b!==a&&this._dom&&(null!=(c=this._doms)?c.iconDom:void 0)&&$fly(this._doms.iconDom).removeClass(b)}},iconPosition:{refreshDom:!0,defaultValue:"left","enum":["left","right"]},horizontal:{type:"boolean",defaultValue:!1,refreshDom:!0},color:{refreshDom:!0,"enum":["black","yellow","green","blue","orange","purple","red","pink","teal"],setter:function(a){var b;b=this._color,b&&b!==a&&this._dom&&this.removeClass(b),this._color=a}},attached:{refreshDom:!0,defaultValue:"","enum":["left top","left bottom","right top","right bottom","top","bottom",""],setter:function(a){var b;b=this._attached,b&&this._dom&&this.removeClass(b+" attached",!0),this._attached=a}}},b.prototype._parseDom=function(a){var b;if(a)return this._text||(b=cola.util.getTextChildData(a),b&&(this._text=b)),this.get$Dom().empty()},b.prototype._refreshIcon=function(){var a,b,c,d;this._dom&&(null==this._doms&&(this._doms={}),b=this._icon,d=this._iconPosition,b?(null==(a=this._doms).iconDom&&(a.iconDom=document.createElement("i")),c=this._doms.iconDom,$(c).addClass(b+" icon"),"left"===d&&this._doms.textDom?$(this._doms.textDom).before(c):this._dom.appendChild(c)):this._doms.iconDom&&cola.detachNode(this._doms.iconDom))},b.prototype._doRefreshDom=function(){var a,c,d,e,f,g;this._dom&&(b.__super__._doRefreshDom.call(this),c=this._classNamePool,f=this._text||"",g=this._doms.textDom,f?(g||(g=document.createElement("span"),this._doms.textDom=g),$fly(g).text(f),this._dom.appendChild(g)):g&&cola.detachNode(g),e=this.get("size"),e&&c.add(e),d=this.get("color"),d&&c.add(d),this._refreshIcon(),a=this.get("attached"),a&&c.add(a+" attached"))},b}(cola.Widget),cola.registerWidget(cola.Label),cola.ImageLabel=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-imageLabel",b.CLASS_NAME="image label",b.attributes={image:null,iconPosition:{refreshDom:!0,defaultValue:"right","enum":["left","right"]},detail:null},b.prototype._doRefreshDom=function(){var a;if(this._dom)return b.__super__._doRefreshDom.call(this),null==this._doms&&(this._doms={}),this._image?(this._doms.image||(this._doms.image=$.xCreate({tagName:"img",src:this._image})),this._doms.image.parentNode!==this._dom&&this.get$Dom().prepend(this._doms.image),$fly(this._doms.image).attr("src",this._image)):this._doms.image&&cola.detachNode(this._doms.image),a=$(".detail",this._dom),this._detail?a.length>0?a.text(this._detail):(a=$.xCreate({tagName:"div","class":"detail",content:this._detail}),this._dom.appendChild(a)):a.remove()},b}(cola.Label),cola.registerWidget(cola.ImageLabel),cola.PointingLabel=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-pointingLabel",b.CLASS_NAME="pointing label",b.attributes={pointing:{refreshDom:!0,defaultValue:"top","enum":["left","right","top","bottom"],setter:function(a){var b;b=this._pointing,b&&this._dom&&this.removeClass(b),this._pointing=a}}},b.prototype._doRefreshDom=function(){return this._dom?(b.__super__._doRefreshDom.call(this),this._pointing?this._classNamePool.add(this._pointing):void 0):void 0},b}(cola.Label),cola.registerWidget(cola.PointingLabel),cola.Tag=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-tag",b.CLASS_NAME="tag label",b}(cola.Label),cola.registerWidget(cola.Tag),cola.Corner=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-corner",b.CLASS_NAME="corner label",b.attributes={position:{"enum":["left","right"],defaultValue:"right",refreshDom:!0,setter:function(a){var b;b=this._position,b&&b!==a&&this._dom&&this.removeClass(b),this._position=a}}},b.prototype._doRefreshDom=function(){return this._dom?(b.__super__._doRefreshDom.call(this),this._classNamePool.add(this._position)):void 0},b}(cola.Label),cola.registerWidget(cola.Corner),cola.Ribbon=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-ribbon",b.CLASS_NAME="ribbon label",b.attributes={position:{"enum":["left","right"],defaultValue:"left",setter:function(a){var b;b=this._position,b!==a&&("right"===b&&this._dom&&(this.removeClass("right ribbon",!0),this.addClass("ribbon")),this._position=a)}}},b.prototype._doRefreshDom=function(){var a;if(this._dom)return b.__super__._doRefreshDom.call(this),a=this._position,"right"===a?(this._classNamePool.remove("ribbon"),this._classNamePool.add("right ribbon")):void 0},b}(cola.Label),cola.registerWidget(cola.Ribbon),function(){var a,b;return cola.commonDimmer={show:function(){var a;a=cola.commonDimmer._dom,a||(a=$.xCreate({tagName:"Div","class":"ui dimmer sys-dimmer",contextKey:"dimmer"}),window.document.body.appendChild(a),cola.commonDimmer._dom=a),$(a).addClass("active")},hide:function(){return $(cola.commonDimmer._dom).removeClass("active")}},b={settings:{info:{title:"Information",i18n:"cola.messageBox.info.title",icon:"blue info icon"},warning:{title:"Warning",icon:"yellow warning sign icon",i18n:"cola.messageBox.warning.title"},error:{title:"Error",icon:"red warning sign icon",i18n:"cola.messageBox.error.title"},question:{title:"Question",icon:"black help circle icon",i18n:"cola.messageBox.question.title"}},"class":"standard",dialogMode:!0,level:{WARNING:"warning",ERROR:"error",INFO:"info",QUESTION:"question"},box:[],_getAnimation:function(){return b.dialogMode?"scale":"slide up"},_executeCallback:function(a){var c,d,e;d=null!=(e=b.currentOptions)?e["on"+a]:void 0,d&&(c=d,"function"==typeof c&&c.apply(null,[]))},_doApprove:function(){b._executeCallback("Approve"),b._doHide()},_doDeny:function(){b._executeCallback("Deny"),b._doHide()},_doHide:function(){var a,c;return $(b._dom).transition(b._settings.animation),cola.commonDimmer.hide(),b._executeCallback("Hide"),a=b.box,a.pop(),b.currentOptions=null,a.length?(c=b.getDom(),$(c).transition("stop all"),b.show(a[a.length-1],!0)):void 0},getDom:function(){return b._dom||a(),b._dom},_doShow:function(a){var c,d,e,f,g,h,i,j,k,l,m,n;return b.currentOptions=a,g=b.getDom(),c=$(g),a=b.currentOptions,c.removeClass("warning error info question").addClass(a.level),k=c.attr("_class"),e=a["class"]||b["class"],k!==e&&(k&&c.removeClass(k),c.addClass(e).attr("_class",e)),h=b._doms,j="alert"===a.mode,$(h.actions).toggleClass("hidden",j),$(h.close).toggleClass("hidden",!j),$(h.description).html(a.content),$(h.title).text(a.title),h.icon.className=a.icon,d=b._getAnimation(),f={zIndex:cola.floatWidget.zIndex()},c=$(b._dom),b.dialogMode&&(n=c.width(),i=c.height(),m=$(window).width(),l=$(window).height(),f.left=(m-n)/2,f.top=(l-i)/2),c.css(f),c.transition(d),cola.commonDimmer.show()},show:function(a,c){var d,e;return e=b.settings,d=a.level||b.level.INFO,null==a.title&&(a.title=cola.resource(e[d].i18n)),null==a.icon&&(a.icon=e[d].icon),a.level=d,c||b.box.unshift(a),b.currentOptions||b._doShow(a),this}},a=function(){var a,c,d,e;return b._settings={dialogMode:b.dialogMode,className:b.dialogMode?"desktop":"mobile layer",animation:b.dialogMode?"scale":"slide up"},e={},d=$.xCreate({tagName:"Div","class":"ui "+b._settings.className+" message-box transition hidden",contextKey:"messageBox",content:{"class":"content-container ",contextKey:"contentContainer",content:[{tagName:"div","class":"header",content:[{tagName:"div","class":"caption",contextKey:"title"},{tagName:"div",contextKey:"close","class":" close-btn",click:b._doHide,content:{tagName:"i","class":"close icon"}}]},{tagName:"div","class":"image content",contextKey:"content",content:[{tagName:"div","class":"image",content:{tagName:"i","class":"announcement icon",contextKey:"icon",style:{"font-size":"4rem"}}},{tagName:"div","class":"description",contextKey:"description"}]}]}},e),a=$.xCreate({tagName:"div","class":"actions "+(b._settings.dialogMode?"":"ui buttons two fluid top attached"),contextKey:"actions",content:[{tagName:"div",contextKey:"no",content:cola.resource("cola.message.deny"),click:b._doDeny,"class":"ui button"},{tagName:"div",contextKey:"yes",click:b._doApprove,"class":"ui positive button ",content:[{tagName:"span",content:cola.resource("cola.message.approve"),contextKey:"yesCaption"}]}]},e),b._settings.dialogMode?e.contentContainer.appendChild(a):$(e.content).before(a),c=window.document.body,c?c.appendChild(d):$(window).on("load",function(){return $(window.document.body).append(d)}),b._dom=d,b._doms=e,d},cola.alert=function(a,c){var d,e,f;if(e={},c)if("function"==typeof c)e.onHide=c;else for(d in c)f=c[d],e[d]=f;return e.content=a,e.mode="alert",b.show(e),this},cola.confirm=function(a,c){var d,e,f;if(e={},e.actions="block",c)if("function"==typeof c)e.onApprove=c;else for(d in c)f=c[d],e[d]=f;return e.content=a,e.level=b.level.QUESTION,null==e.title&&(e.title=cola.resource(b.settings.question.i18n)),null==e.icon&&(e.icon=b.settings.question.icon),e.mode="confirm",b.show(e),this},cola.os.mobile&&b.getDom(),cola.MessageBox=b}(),cola.Reveal=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-reveal",b.CLASS_NAME="ui reveal",b.attributes={type:{refreshDom:!0,defaultValue:"fade","enum":["fade","move","rotate"],setter:function(a){var b;b=this._type,b&&this._dom&&b!==a&&this.get$Dom().removeClass(b),this._type=a}},direction:{refreshDom:!0,"enum":["left","right","up","down"],defaultValue:"left",setter:function(a){var b;b=this._direction,b&&this._dom&&b!==a&&this.get$Dom().removeClass(b),this._direction=a}},active:{type:"boolean",refreshDom:!0,defaultValue:!1},instant:{type:"boolean",refreshDom:!0,defaultValue:!1},disabled:{type:"boolean",refreshDom:!0,defaultValue:!1},visibleContent:{refreshDom:!0,setter:function(a){return this._setContent(a,"visibleContent"),this}},hiddenContent:{refreshDom:!0,setter:function(a){return this._setContent(a,"hiddenContent"),this}}},b.prototype._initDom=function(a){var c,d,e,f,g,h,i,j,k,l;for(b.__super__._initDom.call(this,a),j=["visibleContent","hiddenContent"],h=0,f=j.length;f>h;h++)if(c=j[h],e="_"+c,null!=(k=this[e])?k.length:void 0)for(l=this[e],i=0,g=l.length;g>i;i++)d=l[i],this._render(d,c)},b.prototype._parseDom=function(a){var b,c,d,e,f;if(a){for(null==this._doms&&(this._doms={}),c=a.firstChild,d=[];c;)1===c.nodeType&&(e=cola.widget(c),e?(f=e.get$Dom(),f.has("visible content")&&(this._visibleContent=e),f.has("hidden content")&&(this._hiddenContent=e)):(b=$(c),b.has("visible content")&&(this._doms.visibleContent=e),b.has("hidden content")&&(this._doms.hiddenContent=e))),d.push(c=c.nextSibling);return d}},b.prototype._clearContent=function(a){var b,c,d,e;if(e=this["_"+a]){for(d=0,c=e.length;c>d;d++)b=e[d],b instanceof cola.widget&&b.destroy();this["_"+a]=[]}null==this._doms&&(this._doms={}),this._doms[a]&&$fly(this._doms[a]).empty()},b.prototype._setContent=function(a,b){var c,d,e,f;if(this._clearContent(b),a instanceof Array)for(e=0,d=a.length;d>e;e++)c=a[e],f=cola.xRender(c,this._scope),f&&this._addContentElement(f,b);else f=cola.xRender(a,this._scope),f&&this._addContentElement(f,b)},b.prototype._makeContentDom=function(a){return null==this._doms&&(this._doms={}),this._doms[a]||(this._doms[a]=document.createElement("div"),this._doms[a].className=("visibleContent"===a?"visible":"hidden")+" content",this._dom.appendChild(this._doms[a])),this._doms[a]},b.prototype._addContentElement=function(a,b){var c,d;c="_"+b,null==this[c]&&(this[c]=[]),d=this[c],d.push(a),a&&this._dom&&this._render(a,b)},b.prototype._render=function(a,b){var c;null==this._doms&&(this._doms={}),this._doms[b]||this._makeContentDom(b),c=a,a instanceof cola.Widget&&(c=a.getDom()),c.parentNode!==this._doms[b]&&this._doms[b].appendChild(c)},b.prototype._doRefreshDom=function(){var a,c,d;this._dom&&(b.__super__._doRefreshDom.call(this),a=this._classNamePool,["active","instant","disabled"].forEach(function(b){return function(c){var d;return d=b.get(c),a.toggle(c,!!d)}}(this)),d=this.get("type"),d&&a.add(d),c=this.get("direction"),c&&a.add(c))},b.prototype._getContentContainer=function(a){return this._dom?(this._doms[a]||this._makeContentDom(a),this._doms[a]):void 0},b.prototype.getVisibleContentContainer=function(){return this._getContentContainer("visible")},b.prototype.getHiddenContentContainer=function(){return this._getContentContainer("hidden")},b}(cola.Widget),cola.registerWidget(cola.Reveal),cola.ToolbarButton=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-toolbar-button",b.CLASS_NAME="toolbar-button",b.attributes={
caption:{refreshDom:!0},icon:{refreshDom:!0,setter:function(a){var b,c;b=this._icon,this._icon=a,b&&b!==a&&this._dom&&(null!=(c=this._doms)?c.iconDom:void 0)&&$fly(this._doms.iconDom).removeClass(b)}},iconPosition:{refreshDom:!0,defaultValue:"left","enum":["left","right"]},focusable:{type:"boolean",refreshDom:!0,defaultValue:!1},disabled:{type:"boolean",refreshDom:!0,defaultValue:!1}},b.prototype._initDom=function(a){return this._doms={},$(a).append($.xCreate({tagName:"div",contextKey:"innerDom","class":"ui button"},this._doms))},b.prototype._refreshIcon=function(){var a,b,c,d,e,f;this._dom&&(c=this.get("icon"),e=this.get("iconPosition"),b=this.get("caption"),a=$(this._doms.innerDom),d=a.find(">i"),this._icon?(d.length||(d=$.xCreate({tagName:"i","class":"icon"})),f="right"===e?"append":"prepend",a[f](d),$(d).addClass(c)):$(d).remove())},b.prototype._doRefreshDom=function(){var a,c,d,e;this._dom&&(b.__super__._doRefreshDom.call(this),a=$(this._doms.innerDom),e=this._classNamePool,c=this._caption,d=a.find(".caption"),c?(d.length||(d=$.xCreate({tagName:"span","class":"caption"}),a.append(d)),$(d).text(c)):$(d).empty(),this.get("focusable")?a.attr("tabindex","0"):a.removeAttr("tabindex"),this._refreshIcon(),a.toggleClass("disabled",this._disabled))},b}(cola.Widget),cola.Toolbar=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-toolbar",b.CLASS_NAME="ui toolbar",b}(cola.Widget),cola.registerWidget(cola.ToolbarButton),cola.registerWidget(cola.Toolbar),cola.Segment=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-segment",b.CLASS_NAME="segment",b.SEMANTIC_CLASS=["left floated","right floated","top attached","bottom attached","left attached","right attached","very basic","left aligned","right aligned","center aligned","vertical segment","horizontal segment"],b.attributes={textAlign:{refreshDom:!0,"enum":["left","right","center"],setter:function(a){var b;b=this._textAlign,b&&this._dom&&b!==a&&cola.util.removeClass(this._dom,b+" aligned",!0),this._textAlign=a}},attached:{refreshDom:!0,"enum":["left","right","top","bottom"],setter:function(a){var b;b=this._attached,b&&this._dom&&b!==a&&$removeClass(this._dom,b+" attached",!0),this._attached=a}},color:{refreshDom:!0,"enum":["black","yellow","green","blue","orange","purple","red","pink","teal"],setter:function(a){var b;b=this._color,this._color=a,b&&b!==a&&this._dom&&this.get$Dom().removeClass(b)}}},b.prototype._doRefreshDom=function(){var a,c,d,e;this._dom&&(b.__super__._doRefreshDom.call(this),c=this._classNamePool,d=this.get("color"),d&&c.add(d),a=this.get("attached"),a&&c.add(a+" attached"),e=this.get("textAlign"),e&&c.add(e+" aligned"))},b}(cola.AbstractContainer),cola.registerWidget(cola.Segment),s=function(a){var b,c,d,e;for(e=["Moz","Webkit","O","ms"],c=0,b=e.length;b>c;c++)d=e[c],a.style[d+"Transform"]="";return a.style.transform=""},cola.AbstractLayer=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-layer",b.attributes={duration:{defaultValue:300},visible:{type:"boolean",readOnly:!0,getter:function(){return this.isVisible()}},lazyRender:{type:"boolean"}},b.events={show:null,hide:null,beforeShow:null,beforeHide:null},b.prototype._onShow=function(){},b.prototype._onHide=function(){},b.prototype._zIndex=function(){return this.get$Dom().css({zIndex:cola.floatWidget.zIndex()})},b.prototype._transition=function(a,b){return this.fire("before"+cola.util.capitalize(a.target),this,{})===!1?!1:(this._doTransition(a,b),this)},b.prototype._doTransition=function(a,b){},b.prototype.show=function(a,b){return null==a&&(a={}),!this._dom||this.isVisible()?this:(this._lazyRender&&!this._contentRendered&&(this._contentRendered=!0,cola.xRender(this._dom,this._scope)),"function"==typeof a&&(b=a,a={}),a.target="show",this._zIndex(),this._transition(a,b),this)},b.prototype.hide=function(a,b){return null==a&&(a={}),this._dom&&this.isVisible()?("function"==typeof a&&(b=a,a={}),a.target="hide",this._transition(a,b),this):this},b.prototype.toggle=function(){return this[this.isVisible()?"hide":"show"].apply(this,arguments)},b.prototype.isVisible=function(){return this.get$Dom().transition("stop all").hasClass("visible")},b}(cola.AbstractContainer),cola.Layer=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.CLASS_NAME="layer transition hidden",b.attributes={animation:{defaultValue:"slide left","enum":["scale","drop","browse right","browse","slide left","slide right","slide up","slide down","fade left","fade right","fade up","fade down","fly left","fly right","fly up","fly down","swing left","swing right","swing up","swing down","horizontal flip","vertical flip"]}},b.SLIDE_ANIMATIONS=["slide left","slide right","slide up","slide down"],b.prototype._transitionStart=function(a){},b.prototype._doTransition=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;return j=this,k=function(){return"function"==typeof b&&b.call(j),"show"===a.target?j._onShow():j._onHide(),j.fire(a.target,j,{}),null},"none"===a.animation?(this.get$Dom().transition(a.target),k(),this):(d=a.animation||this._animation||"slide left",f=a.duration||this._duration||300,void(this.constructor.SLIDE_ANIMATIONS.indexOf(d)<0?this.get$Dom().transition({animation:d,duration:f,onComplete:k,queue:!0,onStart:function(a){return function(){return a._transitionStart()}}(this)}):(c=this.get$Dom(),l=c.width(),g=c.height(),h="slide left"===d||"slide right"===d,"slide left"===d?(m=l,n=0):"slide right"===d?(m=-l,n=0):"slide up"===d?(m=0,n=g):(m=0,n=-g),i="show"===a.target,i&&cola.Fx.translateElement(this._dom,m,n),e={duration:f,complete:function(a){return function(){return i||c.removeClass("visible").addClass("hidden"),s(a._dom),k()}}(this)},h?(e.x=i?0:m,e.y=0):(e.y=i?0:n,e.x=0),c.removeClass("hidden").addClass("visible").transit(e),this._transitionStart(a.target))))},b}(cola.AbstractLayer),cola.registerWidget(cola.Layer),cola.Dialog=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-dialog",b.CLASS_NAME="dialog transition hidden",b.attributes={context:null,animation:{defaultValue:"scale","enum":["scale","drop","browse right","browse","slide left","slide right","slide up","slide down","fade left","fade right","fade up","fade down","fly left","fly right","fly up","fly down","swing left","swing right","swing up","swing down","horizontal flip","vertical flip"]},header:{setter:function(a){return this._setContent(a,"header"),this}},actions:{setter:function(a){return this._setContent(a,"actions"),this}},modal:{type:"boolean",defaultValue:!0},closeable:{type:"boolean",defaultValue:!0},modalOpacity:{type:"number",defaultValue:.6},dimmerClose:{type:"boolean",defaultValue:!1}},b.prototype.getContentContainer=function(){return this._dom?(this._doms.content||this._makeContentDom("content"),this._doms.content):null},b.prototype._initDom=function(a){var c,d,e,f,g,h,i,j,k,l;for(b.__super__._initDom.call(this,a),j=["header","actions"],h=0,f=j.length;f>h;h++)if(c=j[h],e="_"+c,null!=(k=this[e])?k.length:void 0)for(l=this[e],i=0,g=l.length;g>i;i++)d=l[i],this._render(d,c)},b.prototype._transitionStart=function(){var a,b,c,d,e;return a=this.get$Dom(),"show"===this._currentAnimation?(e=a.width(),b=a.height(),d=$(window).width(),c=$(window).height(),b>c&&(b=c),e>d&&(e=d),a.css({left:(d-e)/2,top:(c-b)/2,zIndex:cola.floatWidget.zIndex()})):void 0},b.prototype._createCloseButton=function(){var a;return a=this._closeBtn=$.xCreate({tagName:"div","class":"ui icon button close-btn",content:[{tagName:"i","class":"close icon"}],click:function(a){return function(){return a.hide()}}(this)})},b.prototype._doRefreshDom=function(){return this._dom?(b.__super__._doRefreshDom.call(this),this.get("closeable")?(this._closeBtn||this._createCloseButton(),this._closeBtn.parentNode!==this._dom?this._dom.appendChild(this._closeBtn):void 0):$(this._closeBtn).remove()):void 0},b.prototype._onShow=function(){var a,c,d,e,f,g,h;return this._doms.content&&(f=this._dom.offsetHeight,h=$(window).height(),d="min-height",f>h&&(f=h,d="height"),a=this._doms.actions,a&&(c=a.offsetHeight,e=0,this._doms.header&&(e=this._doms.header.offsetHeight),g=f-c-e,$(this._doms.content).css(d,g+"px"))),b.__super__._onShow.call(this)},b.prototype._transition=function(a,b){var c;return this.fire("before"+cola.util.capitalize(a.target),this,{})===!1?!1:(c="show"===a.target,c?this._currentAnimation="show":this._currentAnimation="hide",this.get("modal")&&(c?this._showModalLayer():this._hideModalLayer()),a.animation=a.animation||this._animation||"scale",this._doTransition(a,b))},b.prototype._makeContentDom=function(a){var b,c;return null==this._doms&&(this._doms={}),c=document.createElement("div"),c.className=a,"content"===a?this._doms.actions?$(this._doms.actions).before(c):this._dom.appendChild(c):"header"===a?(b=this._doms.content||this._doms.actions,b?$(b).before(c):this._dom.appendChild(c)):this._dom.appendChild(c),this._doms[a]=c,c},b.prototype._parseDom=function(a){var b,c,d,e,f,g,h;for(null==this._doms&&(this._doms={}),c=function(a){return function(b,c){var d,e;for(d=b.firstChild;d;)1===d.nodeType&&(e=cola.widget(d),a._addContentElement(e||d,c)),d=d.nextSibling}}(this),d=a.firstChild;d;){if(1===d.nodeType)if("I"===d.nodeName)this._doms.icon=d,null==this._icon&&(this._icon=d.className);else for(b=$(d),h=["header","content","actions"],g=0,f=h.length;f>g;g++)if(e=h[g],b.hasClass(e)){this._doms[e]=d,c(d,e);break}d=d.nextSibling}},b.prototype._showModalLayer=function(){var a,b;null==this._doms&&(this._doms={}),a=this._doms.modalLayer,a||(a=$.xCreate({tagName:"Div","class":"ui fixed dimmer",contextKey:"dimmer"}),this._dimmerClose&&$(a).on("click",function(a){return function(){return a.hide()}}(this)),b=this._context||this._dom.parentNode,"string"==typeof b&&("body"===b?b=document.body:"parent"===b&&(b=this._dom.parentNode)),b.appendChild(a),this._doms.modalLayer=a),$(a).css({opacity:this.get("modalOpacity"),zIndex:cola.floatWidget.zIndex()}).addClass("active")},b.prototype._hideModalLayer=function(){var a;return null==this._doms&&(this._doms={}),a=this._doms.modalLayer,$(a).removeClass("active")},b}(cola.Layer),cola.registerWidget(cola.Dialog),cola.Sidebar=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-sidebar",b.CLASS_NAME="ui sidebar",b.attributes={direction:{defaultValue:"left",refreshDom:!0,"enum":["left","right","top","bottom"]},size:{defaultValue:200,refreshDom:!0},modal:{type:"boolean",defaultValue:!0},modalOpacity:{type:"number",defaultValue:.6},dimmerClose:{type:"boolean",defaultValue:!0}},b.prototype._doTransition=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;$(window.document.body).toggleClass("hide-overflow","show"===a.target),this.get("modal")&&("show"===a.target?(this._showModalLayer(),this._zIndex()):this._hideModalLayer()),k=this,j=function(){return"function"==typeof b&&b.call(k),"show"===a.target?k._onShow():k._onHide(),k.fire(a.target,k,{}),null},e=this._direction,f=a.duration||this._duration||300,c=this.get$Dom(),l=c.width(),g=c.height()||c.outerHeight(),h="left"===e||"right"===e,"left"===e?(m=-l,n=0):"right"===e?(m=l,n=0):"top"===e?(m=0,n=-g):(m=0,n=g),i="show"===a.target,i&&cola.Fx.translateElement(this._dom,m,n),d={duration:f,complete:function(a){return function(){return i||c.removeClass("visible").addClass("hidden"),s(a._dom),j()}}(this)},h?(d.x=i?0:m,d.y=0):(d.y=i?0:n,d.x=0),c.removeClass("hidden").addClass("visible").transit(d)},b.prototype._doRefreshDom=function(){return this._dom?(b.__super__._doRefreshDom.call(this),this._setSize(),this._classNamePool.add(this._direction||"left")):void 0},b.prototype._setSize=function(){var a,b,c,d;d=cola.constants.WIDGET_DIMENSION_UNIT,b=this.get("size"),isFinite(b)&&(b=""+parseInt(b)+d),a=this._direction||"left",c="left"===a||"right"===a?"width":"height",cola.util.style(this._dom,c,b,"important")},b.prototype._showModalLayer=function(){var a,b;null==this._doms&&(this._doms={}),a=this._doms.modalLayer,a||(a=$.xCreate({tagName:"Div","class":"ui dimmer",contextKey:"dimmer"}),this._dimmerClose&&$(a).on("click",function(a){return function(){return a.hide()}}(this)),$(a).css("position","fixed"),b=this._context||this._dom.parentNode,b.appendChild(a),this._doms.modalLayer=a),$(a).css({opacity:0,zIndex:cola.floatWidget.zIndex()}).addClass("active").transit({opacity:this._modalOpacity})},b.prototype._hideModalLayer=function(){var a;return null==this._doms&&(this._doms={}),a=this._doms.modalLayer,$(a).transit({opacity:0,complete:function(){return $(a).removeClass("active").css({zIndex:0})}})},b.prototype.isVisible=function(){return this._dom?this.get$Dom().hasClass("visible"):!1},b}(cola.AbstractLayer),cola.registerWidget(cola.Sidebar),G=[],$(window).resize(function(){var a,b,c;for(b=0,a=G.length;a>b;b++)c=G[b],c.refreshNavButtons()}),cola.Tab=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-tab",b.CLASS_NAME="c-tab",b.attributes={direction:{refreshDom:!0,"enum":["left","right","top","bottom"],defaultValue:"top",setter:function(a){var b;return b=this._direction,b&&b!==a&&this._dom&&this.get$Dom().removeClass(b+"-tab"),this._direction=a,this}},tabs:{setter:function(a){var b,c,d;for(this.clear(),c=0,b=a.length;b>c;c++)d=a[c],this.addTab(d)}},currentTab:{getter:function(){var a,b;return a=this._currentTab,b=this.getTab(a),this._currentTab=b,b},setter:function(a){return this.setCurrentTab(a),this}}},b.events={beforeChange:null,change:null},b.prototype._tabContentRender=function(a){var b,c,d;return d=this.getContentsContainer(),b=a.get("contentContainer"),b&&b.parentNode===d?void 0:(b=$.xCreate({tagName:"content",name:a.get("name")}),d.appendChild(b),a.set("contentContainer",b),c=a.getContentDom(),c?b.appendChild(c):void 0)},b.prototype._makeControlBtn=function(){var a,b;a=$(this._dom).find(">nav"),b=this,a.prepend($.xCreate({tagName:"div","class":"pre-button control-button"})),a.append($.xCreate({tagName:"div","class":"next-button control-button"})),a.find(">.next-button").on("click",function(){return $(this).hasClass("disabled")?void 0:b._doMove(!0)}),a.find(">.pre-button").on("click",function(){return $(this).hasClass("disabled")?void 0:b._doMove(!1)})},b.prototype.getTabIndex=function(a){var b,c,d,e,f,g,h,i;for(b=a.getDom(),h=$(b).parent(),d=-1,i=h.find("tab"),c=g=0,f=i.length;f>g;c=++g)if(e=i[c],e===b)return c;return d},b.prototype._getTabButtonsSize=function(){var a,b,c,d,e,f,g,h,i,j;return a=this._$dom||$(this._dom),b=a.find(">nav>tabs>tab"),c=this._direction,g="top"===c||"bottom"===c,i=b[b.length-1],e=b[0],g?(d=$(e).offset().left,h=$(i).offset().left,h+$(i).outerWidth()-d):(f=$(e).offset().top,j=$(i).offset().top,j+$(i).outerHeight()-f)},b.prototype.refreshNavButtons=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;return a=this._$dom||$(this._dom),b=a.find(">nav>tabs>tab"),u=!1,e=this._direction,s=a.find(">nav>tabs"),i="top"===e||"bottom"===e,p=a.find(">nav"),o=i?"left":"top",i||setTimeout(function(){return p.css("width",s.width()+"px")},100),b.length<=1?(a.find(".control-button").toggleClass("visible",!1),void s.css(o,"0px")):(l=b[b.length-1],g=b[0],c=this._getTabButtonsSize(),i?(r=a.find(">nav").innerWidth(),f=$(g).offset().left,u=c>r):(q=a.find(">nav").innerHeight(),h=$(g).offset().top,u=c>q),u&&(d=p.find(">.control-button"),d.length<1&&this._makeControlBtn(),i?(n=s.css("left"),n=parseInt(n.replace("px","")),0===n&&s.css("left",p.find(">.next-button").width()+"px"),m=a.find(">nav").offset().left,j=$(l).offset().left+$(l).outerWidth(),p.find(">.next-button").toggleClass("disabled",m+r>j),p.find(">.pre-button").toggleClass("disabled",f>m)):(n=s.css("top"),n=parseInt(n.replace("px","")),s.css("left","0px"),0===n&&s.css("top",p.find(">.next-button").height()+"px"),t=a.find(">nav").offset().top,k=$(l).offset().top+$(l).outerHeight(),p.find(">.next-button").toggleClass("disabled",t+q>k),p.find(">.pre-button").toggleClass("disabled",h>t))),a.find(".control-button").toggleClass("visible",u),void(u||s.css(o,"0px")))},b.prototype._doMove=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;return b=this._$dom||$(this._dom),f=this._direction,j="top"===f||"bottom"===f,s=j?"left":"top",r=this._getTabButtonsSize()/b.find(">nav>tabs>tab").length,j&&(r/=2),v=b.find(">nav>tabs"),q=v.css(s),q=parseInt(q.replace("px","")),a&&(r=-1*r),d=b.find(">nav>tabs>tab"),f=this._direction,j="top"===f||"bottom"===f,n=d[d.length-1],h=d[0],c=b.find(">nav"),u=c.offset(),e=c.find(".next-button"),j?(g=$(h).offset().left+r,m=$(n).offset().left+r,p=$(n).outerWidth(),a?(k=u.left+c.outerWidth()-e.outerWidth(),k>m+p&&(r=r+k-(m+p))):(k=u.left+e.outerWidth(),g>k&&(r-=g-k))):(i=$(h).offset().top+r,o=$(n).offset().top+r,l=$(n).outerHeight(),a?(t=u.top+c.outerHeight()-e.outerHeight(),t>o+l&&(r=r+t-(o+l))):(t=u.top+e.outerHeight(),i>t&&(r-=i-t))),v.css(s,q+r+"px"),this.refreshNavButtons()},b.prototype._doRefreshDom=function(){this._dom&&(b.__super__._doRefreshDom.call(this),this._classNamePool.remove("top-tab"),this._classNamePool.add(this._direction+"-tab"),this.refreshNavButtons())},b.prototype._getTabContentDom=function(a){var b,c;return c=this.getContentsContainer(),b=$(c).find(">content[name='"+a._name+"']"),b.length>0?b[0]:void 0},b.prototype.getCurrentTab=function(a){var b;return b=this._$dom.find(">nav>tabs>tab.active"),b.length>0?cola.widget(b[0]):void 0},b.prototype.setCurrentTab=function(a){var b,c,d,e;return e=this.getCurrentTab(),d=this.getTab(a),e===d?!0:(b={oldTab:e,newTab:d},this.fire("beforeChange",this,b)===!1?!1:(e&&(e.get$Dom().removeClass("active"),$(this._getTabContentDom(e)).removeClass("active")),d&&(d.get$Dom().addClass("active"),c=this._getTabContentDom(d),c||(this._tabContentRender(d),c=d.get("contentContainer")),$(c).addClass("active")),this._currentTab=d,this.fire("change",this,b),!0))},b.prototype._initDom=function(a){var c,d,e,f,g;if(b.__super__._initDom.call(this,a),c=function(a){return function(b){var c;c=cola.widget(b),c&&c instanceof cola.TabButton&&a.setCurrentTab(c)}}(this),$(a).delegate("> nav > tabs > tab","click",function(a){return c(this,a)}),G.push(this),!this._tabs)return this;for(f=this._tabs,e=0,d=f.length;d>e;e++)g=f[e],this._tabRender(g);return this.setCurrentTab(this._currentTab||0),setTimeout(function(a){return function(){return a.refreshNavButtons()}}(this),150),this},b.prototype.destroy=function(){var a;if(!this._destroyed)return a=G.indexOf(this),a>-1&&G.splice(a,1),b.__super__.destroy.call(this)},b.prototype.getTabBarDom=function(){var a;return null==this._doms&&(this._doms={}),this._doms.tabBar||(a=this._doms.tabBar=$.xCreate({tagName:"nav","class":"tab-bar"}),this._dom.appendChild(a)),this._doms.tabBar},b.prototype.getTabsContainer=function(){var a;return null==this._doms&&(this._doms={}),this._doms.tabs||(a=this._doms.tabs=$.xCreate({tagName:"ul","class":"tabs"}),this.getTabBarDom().appendChild(a)),this._doms.tabs},b.prototype.getContentsContainer=function(){var a,b;return(a=$(this._dom).find(">contents"))?a[0]:(b=$.xCreate({tagName:"contents","class":"contents"}),this._dom.appendChild(b),b)},b.prototype._tabRender=function(a){var b,c;b=this.getTabsContainer(),c=a.getDom(),c.parentNode!==b&&b.appendChild(c)},b.prototype.addTab=function(a){return null==this._tabs&&(this._tabs=[]),a.constructor===Object.prototype.constructor&&(a=new cola.TabButton(a)),this._tabs.indexOf(a)>-1?this:(this._tabs.push(a),a.set("parent",this),this._dom&&this._tabRender(a),this.refreshNavButtons(),this)},b.prototype.getTab=function(a){var b,c,d,e;if(e=this._tabs||[],"string"==typeof a){for(c=0,b=e.length;b>c;c++)if(d=e[c],d.get("name")===a)return d}else{if("number"==typeof a)return e[a];if(a instanceof cola.TabButton)return a}return null},b.prototype.removeTab=function(a){var b,c,d,e,f;if(a instanceof cola.TabButton?c=a:"string"==typeof a&&(c=this.getTab(a)),c){if(this.get("currentTab")===c&&(d=c._dom,e=d.previousElementSibling||d.nextElementSibling,e&&(f=cola.widget(e),!this.setCurrentTab(f))))return!1;b=c.get("contentContainer"),b||(b=this._getTabContentDom(c)),c.remove(),(null!=b?b.parentNode:void 0)===this._doms.contents&&$(b).remove()}return this.refreshNavButtons(),!0},b.prototype.clear=function(){var a,b,c,d;if(d=this._tabs||[],d.length<1)return this;for(b=0,a=d.length;a>b;b++)c=d[b],c.destroy();return this._tabs=[]},b}(cola.Widget),cola.registerWidget(cola.Tab),null==cola.tab&&(cola.tab={}),cola.tab.AbstractTabButton=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.attributes={icon:{refreshDom:!0,setter:function(a){var b,c;b=this._icon,this._icon=a,b&&b!==a&&this._dom&&(null!=(c=this._doms)?c.icon:void 0)&&$fly(this._doms.icon).removeClass(b)}},closeable:{type:"boolean",refreshDom:!0,defaultValue:!1},caption:{refreshDom:!0},name:{refreshDom:!0}},b.prototype.getCaptionDom=function(){var a;return null==this._doms&&(this._doms={}),this._doms.caption||(a=this._doms.caption=document.createElement("div"),a.className="caption",this._dom.appendChild(a)),this._doms.caption},b.prototype.getCloseDom=function(){var a,b;return null==this._doms&&(this._doms={}),b=this,null==(a=this._doms)._closeBtn&&(a._closeBtn=$.xCreate({tagName:"div","class":"close-btn",content:{tagName:"i","class":"close icon"},click:function(){return b.close(),!1}})),this._doms._closeBtn},b.prototype._refreshIcon=function(){var a,b,c;this._dom&&(this._icon?(b=this.getCaptionDom(),null==(a=this._doms).icon&&(a.icon=document.createElement("i")),c=this._doms.icon,$fly(c).addClass(this._icon+" icon"),c.parentNode!==b&&b.appendChild(c)):this._doms.iconDom&&$fly(this._doms.iconDom).remove())},b.prototype._refreshCaption=function(){var a,b,c;this._dom&&(this._caption?(b=this.getCaptionDom(),null==(a=this._doms).span&&(a.span=document.createElement("span")),c=this._doms.span,$(c).text(this._caption),c.parentNode!==b&&b.appendChild(c)):this._doms.span&&$(this._doms.span).remove())},b.prototype._parseDom=function(a){var b,c,d;for(b=a.firstChild,d=this,null==this._doms&&(this._doms={}),c=function(a){return function(b){var c;for(c=b.firstChild;c;)1===c.nodeType&&("SPAN"===c.nodeName&&(a._doms.span=c,null==a._caption&&(a._caption=cola.util.getTextChildData(c))),"I"===c.nodeName&&(a._doms.icon=c,null==a._icon&&(a._icon=c.className))),c=c.nextSibling}}(this);b;)1===b.nodeType&&(!this._doms.caption&&cola.util.hasClass(b,"caption")?(this._doms.caption=b,c(b)):!this._doms.closeBtn&&cola.util.hasClass(b,"close-btn")&&(this._doms._closeBtn=b,$(b).on("click",function(){return d.close(),!1}))),b=b.nextSibling},b.prototype._doRefreshDom=function(){var a;this._dom&&(b.__super__._doRefreshDom.call(this),this._refreshIcon(),this._refreshCaption(),this._closeable?(a=this.getCloseDom(),a.parentNode!==this._dom&&this._dom.appendChild(a)):this._doms&&this._doms.closeDom&&$(this._doms.closeDom).remove())},b.prototype._createCaptionDom=function(){var a;return null==this._doms&&(this._doms={}),a=$.xCreate({tagName:"div","class":"caption",contextKey:"caption",content:[{tagName:"i",contextKey:"icon","class":"icon"},{tagName:"span",contextKey:"span",content:this._caption||""}]},this._doms),this._dom.appendChild(a)},b.prototype.destroy=function(){return this._destroyed?void 0:(b.__super__.destroy.call(this),delete this._doms,this)},b}(cola.Widget),cola.TabButton=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="tab",b.CLASS_NAME="tab-button",b.parentWidget=cola.Tab,b.attributes={content:{setter:function(a){return this._content=cola.xRender(a,this._scope)}},contentContainer:null,parent:null},b.events={beforeClose:null,afterClose:null},b.prototype.close=function(){var a,b;return a={tab:this},this.fire("beforeClose",this,a),a.processDefault===!1?this:(b=cola.findWidget(this._dom,cola.Tab),b.removeTab(this),this.destroy(),this.fire("afterClose",this,a),this)},b.prototype.getContentDom=function(){return this._content},b.prototype.destroy=function(){return this._destroyed?void 0:(b.__super__.destroy.call(this),delete this._content,delete this._contentContainer,delete this._parent,this)},b}(cola.tab.AbstractTabButton),cola.registerWidget(cola.TabButton),cola.Panel=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.CLASS_NAME="panel",b.tagName="c-panel",b.attributes={collapsible:{type:"boolean",defaultValue:!0},closable:{type:"boolean",defaultValue:!1},caption:{refreshDom:!0},icon:{refreshDom:!0}},b.TEMPLATES={tools:{tagName:"div"}},b.events={open:null,collapsedChange:null,close:null,beforeOpen:null,beforeCollapsedChange:null,beforeClose:null},b.prototype.collapsedChange=function(){var a,b,c,d,e,f;return a=this._$dom,b=this.isCollapsed(),this.fire("beforeCollapsedChange",this,{})===!1?this:(f=this.get("height"),f||(c=a.outerHeight(),a.css("height","initial"),e=a.outerHeight(),a.css("height",c)),a.toggleClass("collapsed",!b),d=$(this._headerContent).outerHeight(),void a.transit({duration:300,height:b?e||this.get("height"):d,complete:function(c){return function(){return b&&!f&&a.css("height","initial"),c.fire("collapsedChange",c,{})}}(this)}))},b.prototype.isCollapsed=function(){var a;return null!=(a=this._$dom)?a.hasClass("collapsed"):void 0},b.prototype.isClosed=function(){var a;return null!=(a=this._$dom)?a.hasClass("transition hidden"):void 0},b.prototype.open=function(){return this.isClosed()?this.toggle():void 0},b.prototype.close=function(){return this.isClosed()?void 0:this.toggle()},b.prototype.toggle=function(){var a,b;return a="beforeOpen",b="open",this.isClosed||(a="beforeClose",b="close"),this.fire(a,this,{})!==!1?this._$dom.transition({animation:"scale",onComplete:function(a){return function(){return a.fire(b,a,{})}}(this)}):void 0},b.prototype.getContentContainer=function(){return this._dom?(this._doms.content||this._makeContentDom("content"),this._doms.content):null},b.prototype._initDom=function(a){var c,d,e,f,g,h,i;for(this._regDefaultTempaltes(),b.__super__._initDom.call(this,a),this._headerContent=c=$.xCreate({tagName:"div","class":"content"}),this._doms.icon=$.xCreate({tagName:"i","class":"panel-icon"}),c.appendChild(this._doms.icon),this._doms.caption=$.xCreate({tagName:"span","class":"caption"}),c.appendChild(this._doms.caption),h=this.getTemplate("tools"),cola.xRender(h,this._scope),i=this._doms.tools=$.xCreate({"class":"tools"}),i.appendChild(h),g=$.xCreate([{tagName:"i",click:function(a){return function(){return a.collapsedChange()}}(this),"class":"icon chevron down collapse-btn"},{tagName:"i",click:function(a){return function(){return a.toggle()}}(this),"class":"icon close close-btn"}]),e=0,d=g.length;d>e;e++)f=g[e],i.appendChild(f);c.appendChild(i),this._render(c,"header"),this._doms.content||this._makeContentDom("content")},b.prototype._doRefreshDom=function(){return this._dom?(b.__super__._doRefreshDom.call(this),$fly(this._doms.caption).text(this._caption||""),this._icon?$fly(this._doms.icon).show().removeClass(this._doms.icon._icon):$fly(this._doms.icon).hide(),$fly(this._doms.icon).addClass("icon "+(this._icon||"")),this._doms.icon._icon=this._icon,$fly(this._doms.tools).find(".collapse-btn")[this._collapsible?"show":"hide"](),$fly(this._doms.tools).find(".close-btn")[this._closable?"show":"hide"]()):void 0},b.prototype._makeContentDom=function(a){var b;return null==this._doms&&(this._doms={}),b=document.createElement("div"),b.className=a,"header"===a?$(this._dom).prepend(b):this._dom.appendChild(b),this._doms[a]=b,b},b.prototype._parseDom=function(a){var b,c,d;for(null==this._doms&&(this._doms={}),c=function(a){return function(b,c){var d,e;for(d=b.firstChild;d;)1===d.nodeType&&(e=cola.widget(d),a._addContentElement(e||d,c)),d=d.nextSibling}}(this),d=a.firstChild;d;){if(1===d.nodeType){if("TEMPLATE"!==d.nodeName){if(b=$(d),!b.hasClass("content")){d=d.nextSibling;continue}this._doms.content=d,c(d,"content");break}this.regTemplate(d)}d=d.nextSibling}},b}(cola.AbstractContainer),cola.Element.mixin(cola.Panel,cola.TemplateSupport),cola.FieldSet=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.CLASS_NAME="panel fieldset",b.tagName="c-fieldset",b}(cola.Panel),cola.GroupBox=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.CLASS_NAME="panel groupbox",b.tagName="c-groupbox",b}(cola.Panel),cola.registerWidget(cola.Panel),cola.registerWidget(cola.FieldSet),cola.registerWidget(cola.GroupBox),m=[],cola.NotifyTip=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="message",b.CLASS_NAME="notify-tip transition hidden message",b.attributes={type:{defaultValue:"","enum":["info","warning","error","success",""]},message:{refreshDom:!0},description:{refreshDom:!0},showDuration:null},b.prototype._initDom=function(a){var c;return b.__super__._initDom.call(this,a),c=this,null==this._doms&&(this._doms={}),$(a).xAppend([{tagName:"i","class":"close icon",contextKey:"closeBtn"},{tagName:"div","class":"header",contextKey:"header"},{tagName:"p",contextKey:"description"}],this._doms),$(this._doms.closeBtn).on("click",function(){return c.hide()})},b.prototype._doRefreshDom=function(){return this._dom?(b.__super__._doRefreshDom.call(this),$(this._doms.header).text(this._message||""),$(this._doms.description).text(this._description||""),$(this._dom).addClass(this._type)):void 0},b.prototype._doTransition=function(a,c){var d,e;return e=this,d="show"===a.target,d?(cola.device.mobile&&(a.animation="scale"),this._type&&this.get$Dom().addClass(this._type),this._showDuration&&setTimeout(function(){return e.hide()},parseInt(this._showDuration))):a.animation="scale",b.__super__._doTransition.call(this,a,c)},b.prototype._onHide=function(){var a;return b.__super__._onHide.call(this),this.destroy(),a=$("#c-notify-tip-container"),0===a.children().length?a.remove():void 0},b.prototype.close=b.hide,b}(cola.Layer),cola.NotifyTipManager={show:function(a){var b,c,d;return"string"==typeof a&&(a={message:a}),d=new cola.NotifyTip(a),c=d.getDom(),b=$("#c-notify-tip-container"),0===b.length&&(b=$.xCreate({tagName:"div",id:"c-notify-tip-container"}),document.body.appendChild(b)),$(b).append(c),d.show(),d},info:function(a){return"string"==typeof a&&(a={message:a}),a.type="info",cola.NotifyTipManager.show(a)},warning:function(a){return"string"==typeof a&&(a={message:a}),a.type="warning",cola.NotifyTipManager.show(a)},error:function(a){return"string"==typeof a&&(a={message:a}),a.type="error",cola.NotifyTipManager.show(a)},success:function(a){return"string"==typeof a&&(a={message:a}),a.type="success",cola.NotifyTipManager.show(a)},clear:function(){return $("#c-notify-tip-container").find(">.notify-tip").each(function(){return cola.widget(this).hide()})}},cola.SplitPane=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-split-pane",b.CLASS_NAME="ui split-pane",b.attributes={direction:{refreshDom:!0,"enum":["left","right","top","bottom"],defaultValue:"top"},position:{defaultValue:100}},b.prototype._doRefreshDom=function(){this._dom&&(b.__super__._doRefreshDom.call(this),this._setPosition(this._position))},b.prototype._setPosition=function(a){var b,c,d,e,f;switch(e=this._direction,c=$(this._doms.sideDom),b=$(this._doms.mainDom),d=$(this._doms.splitter),f=isFinite(a)?a+4:"calc("+a+" + 4px)",e){case"left":return c.css({width:a}),d.css({left:a}),b.css({left:f});case"right":return c.css({width:a}),d.css({right:a}),b.css({right:f});case"top":return c.css({height:a}),d.css({top:a}),b.css({top:f});case"bottom":return c.css({height:a}),d.css({bottom:a}),b.css({bottom:f})}},b.prototype._initDom=function(a){var c,d,e,f,g,h,i,j,k,l,m,n;return b.__super__._initDom.call(this,a),c=$(a),e=this._doms,e.splitter||(e.splitter=$.xCreate({tagName:"div","class":"splitter"}),$(c.find(">.pane")[1]).before(e.splitter)),c.addClass("fixed-"+this._direction),$(e.sideDom).addClass("side-pane"),
$(e.mainDom).addClass("main-pane"),k=function(a,b){var c;return c="page"+b,void 0!==a[c]?a[c]:void 0!==a.originalEvent[c]?a.originalEvent[c]:a.originalEvent.touches?a.originalEvent.touches[0][c]:void 0},l=function(a){return k(a,"X")},m=function(a){return k(a,"Y")},n=this,i=function(a,b){return parseInt($(a).css("min-"+b),10)||0},j=function(a){return i(a,"width")},h=function(a){return i(a,"height")},g=function(b){var c,d,f;return f=j(e.sideDom),d=a.offsetWidth-j(e.mainDom)-e.splitter.offsetWidth,c=e.splitter.offsetLeft-b,function(b){var e;return"function"==typeof b.preventDefault&&b.preventDefault(),e=Math.min(Math.max(f,c+l(b)),d),"right"===n._direction&&(e=a.offsetWidth-e),n._setPosition(e)}},f=function(b){var c,d,f;return d=h(e.sideDom),c=a.offsetHeight-h(e.mainDom)-e.splitter.offsetHeight,f=e.splitter.offsetTop-b,function(b){var e;return"function"==typeof b.preventDefault&&b.preventDefault(),e=Math.min(Math.max(d,f+m(b)),c),"bottom"===n._direction&&(e=a.offsetHeight-e),n._setPosition(e)}},d=function(a,b,c){var d;return d=n._direction,"left"===d||"right"===d?g(b):f(c)},$(e.splitter).on("mousedown",function(){var a,b,c;return event.preventDefault(),b=$(this),a=b.parent(),b.addClass("dragged"),c=d(a,l(event),m(event)),$(document).on("mousemove",c),$(document).one("mouseup",function(a){return $(document).off("mousemove",c),b.removeClass("dragged touch")})}),this},b.prototype.destroy=function(){return this._destroyed?void 0:b.__super__.destroy.call(this)},b.prototype._parseDom=function(a){var b,c,d,e,f;null==this._doms&&(this._doms={}),b=$(a),d=b.find(">.pane"),e=0,c=1,"left"!==this._direction&&"top"!==this._direction&&(e=1,c=0),this._doms.sideDom=d[e],this._doms.mainDom=d[c],f=b.find(">.splitter"),f.length&&(this._doms.splitter=f[0])},b}(cola.Widget),cola.registerWidget(cola.SplitPane),cola.AbstractEditor=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.attributes={value:{refreshDom:!0,setter:function(a){return this._setValue(a)}},bind:{refreshDom:!0,setter:function(a){return this._bindSetter(a)}},readOnly:{refreshDom:!0,type:"boolean",defaultValue:!1},state:{setter:function(a){var b,c;c=this._state,c!==a&&(b=this._dom,b&&c&&cola.util.removeClass(b,c),this._state=a,b&&a&&cola.util.addClass(b,a))}}},b.events={beforePost:null,post:null,beforeChange:null,change:null},b.prototype._initDom=function(a){var b,c;this._state&&cola.util.addClass(a,this._state),this._bind||(c=a.parentNode,"FIELD"===(null!=c?c.nodeName:void 0)&&(this._field=cola.widget(c),this._field&&(this._field._bind||this._field._property)&&(b=this._field._bind,!b&&this._field._form&&(b=this._field._form._bind+"."+this._field._property),this.set("bind",b))))},b.prototype._setValue=function(a){var b;return this._value===a?!1:(b={oldValue:this._value,value:a},this.fire("beforeChange",this,b)!==!1?(this._value=a,a!==this._modelValue&&this.post(),"function"==typeof this.onSetValue&&this.onSetValue(a),this.fire("change",this,b),!0):void 0)},b.prototype.post=function(){return this.fire("beforePost",this)===!1?this:(this._post(),this.fire("post",this),this)},b.prototype._post=function(){this.writeBindingValue(this._value)},b.prototype._filterDataMessage=function(a,b,c){return cola.constants.MESSAGE_REFRESH<=b&&b<=cola.constants.MESSAGE_CURRENT_CHANGE||b===cola.constants.MESSAGE_VALIDATION_STATE_CHANGE||this._watchingMoreMessage},b.prototype._processDataMessage=function(a,b,c){var d,e,f,g;(b===cola.constants.MESSAGE_VALIDATION_STATE_CHANGE||cola.constants.MESSAGE_REFRESH<=b&&b<=cola.constants.MESSAGE_CURRENT_CHANGE)&&(null!=(f=this._bindInfo)?f.writeable:void 0)&&(d=this._scope.get(this._bindInfo.entityPath),d instanceof cola.EntityList&&(d=d.current),d&&(e=d.getKeyMessage(this._bindInfo.property),this.set("state",null!=e?e.type:void 0))),b!==cola.constants.MESSAGE_VALIDATION_STATE_CHANGE&&(g=this.readBindingValue(),null!=g&&this._dataType&&(g=this._dataType.parse(g)),this._modelValue=g,this._setValue(g)&&cola.util.delay(this,"refreshDom",50,this._refreshDom))},b}(cola.Widget),cola.Element.mixin(cola.AbstractEditor,cola.DataWidgetMixin),cola.AbstractCheckbox=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-checkbox",b.CLASS_NAME="checkbox",b.INPUT_TYPE="checkbox",b.attributes={label:{refreshDom:!0},name:{refreshDom:!0},onValue:{defaultValue:!0},offValue:{defaultValue:!1},disabled:{refreshDom:!0,type:"boolean",defaultValue:!1},checked:{refreshDom:!0,type:"boolean",defaultValue:!1,getter:function(){return this._value===this._onValue},setter:function(a){var b,c;return b=!!a,c=b?this.get("onValue"):this.get("offValue"),this._setValue(c),this}},value:{defaultValue:!1,refreshDom:!0,setter:function(a){return this._setValue(a)}}},b._modelValue=!1,b.prototype._parseDom=function(a){var b,c;for(null==this._doms&&(this._doms={}),null==this._$dom&&(this._$dom=$(a)),b=a.firstChild;b;)1===b.nodeType&&("LABEL"===b.nodeName?(this._doms.label=b,null==this._label&&(this._label=cola.util.getTextChildData(b))):"INPUT"===b.nodeName&&(c=b.getAttribute("name"),c&&null==this._name&&(this._name=c),this._doms.input=b)),b=b.nextSibling;this._doms.label||this._doms.input||this._$dom.append($.xCreate([{tagName:"input",type:this.constructor.INPUT_TYPE,contextKey:"input",name:this._name||""},{tagName:"label",content:this._label||"",contextKey:"label"}],this._doms)),this._doms.label||(this._doms.label=$.xCreate({tagName:"label",content:this._label||""}),this._$dom.append(this._doms.label)),this._doms.input||(this._doms.input=$.xCreate({tagName:"input",type:this.constructor.INPUT_TYPE,name:this._name||""}),$(this._doms.label).before(this._doms.input)),this._bindToSemantic()},b.prototype._createDom=function(){return $.xCreate({tagName:"DIV","class":"ui "+this.constructor.CLASS_NAME,content:[{tagName:"input",type:this.constructor.INPUT_TYPE,contextKey:"input",name:this.get("name")||""},{tagName:"label",content:this._label||"",contextKey:"label"}]},this._doms)},b.prototype._bindToSemantic=function(){return this.get$Dom().checkbox({onChange:function(a){return function(){return a._setValue(a._getValue())}}(this)})},b.prototype._setDom=function(a,c){this._dom=a,c||this._bindToSemantic(),b.__super__._setDom.call(this,a,c)},b.prototype._refreshEditorDom=function(){return this.get$Dom().checkbox(this._value===this._onValue?"check":"uncheck")},b.prototype._doRefreshDom=function(){var a,c,d;if(this._dom)return b.__super__._doRefreshDom.call(this),null==this._doms&&(this._doms={}),c=this.get("label")||"",$(this._doms.label).text(c),d=this.get("readOnly"),this._classNamePool.toggle("read-only",d),a=this.get$Dom(),a.checkbox(this._disabled?"disable":"enable"),this._refreshEditorDom()},b.prototype._getValue=function(){return this.get$Dom().checkbox("is checked")?this.get("onValue"):this.get("offValue")},b.prototype.toggle=function(){var a;return a=!!this.get("checked"),this.set("checked",!a),this},b}(cola.AbstractEditor),cola.Checkbox=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.attributes={indeterminateValue:null,triState:{type:"boolean",defaultValue:!1}},b.prototype._getValue=function(){return this._triState&&!this.get$Dom().checkbox("is determinate")?this.get("indeterminateValue"):b.__super__._getValue.call(this)},b.prototype._refreshEditorDom=function(){return this._triState&&this._value!==this._onValue&&this._value!==this._offValue?void this.get$Dom().checkbox("set indeterminate"):b.__super__._refreshEditorDom.call(this)},b}(cola.AbstractCheckbox),cola.registerWidget(cola.Checkbox),cola.Toggle=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-toggle",b.prototype._doRefreshDom=function(){return this._dom?(b.__super__._doRefreshDom.call(this),this.hasClass("slider")?void 0:this._classNamePool.add("toggle")):void 0},b}(cola.AbstractCheckbox),cola.registerWidget(cola.Toggle),b="yyyy-MM-dd",c="yyyyMMdd",e="HH:mm:ss",f="HHmmss",E=/Trident\/7\./.test(navigator.userAgent),cola.AbstractInput=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.CLASS_NAME="input",b.SEMANTIC_CLASS=["left floated","right floated","corner labeled","right labeled","left icon","left action"],b.attributes={name:{readOnlyAfterCreate:!0},value:{setter:function(a){return this._dataType&&(a=this._dataType.parse(a)),this._setValue(a)}},dataType:{setter:function(a){return cola.DataType.dataTypeSetter.call(this,a)}},size:{"enum":["mini","tiny","small","medium","large","big","huge","massive"],refreshDom:!0,setter:function(a){var b;b=this._size,b&&b!==a&&this._dom&&this.get$Dom().removeClass(b),this._size=a}},placeholder:{refreshDom:!0},icon:{refreshDom:!0,setter:function(a){var b,c,d;c=this._icon,this._icon=a,c&&c!==a&&this._dom&&(null!=(d=this._doms)?d.iconDom:void 0)&&(b=$(this._doms.iconDom),b.removeClass(c))}},iconPosition:{refreshDom:!0,defaultValue:"right","enum":["left","right"],setter:function(a){var b;b=this._iconPosition,this._iconPosition=a,b&&b!==a&&"left"===b&&this._dom&&$removeClass(this._dom,"left icon",!0)}},corner:{getter:function(){return this._corner?cola.widget(this._corner):null},setter:function(a){var b,c,d;b=this._corner,b&&null!=(c=cola.widget(b))&&c.destroy(),delete this._corner,a&&("corner"===(null!=(d=a.$type)?d.toLowerCase():void 0)&&(a=cola.widget(a)),a instanceof cola.Corner&&(this._corner=a.getDom()))}},label:{refreshDom:!0,getter:function(){return this._label?cola.widget(this._label):null},setter:function(a){var b,c,d;b=this._label,b&&null!=(c=cola.widget(b))&&c.destroy(),delete this._label,a&&("label"===(null!=(d=a.$type)?d.toLowerCase():void 0)&&(a=cola.widget(a)),a instanceof cola.Label&&(this._label=a.getDom()))}},labelPosition:{refreshDom:!0,defaultValue:"left","enum":["left","right"]},actionButton:{refreshDom:!0,getter:function(){return this._actionButton?cola.widget(this._actionButton):null},setter:function(a){var b,c,d;b=this._actionButton,b&&null!=(c=cola.widget(b))&&c.destroy(),delete this._actionButton,a&&("button"===(null!=(d=a.$type)?d.toLowerCase():void 0)&&(a=cola.widget(a)),a instanceof cola.Label&&(this._actionButton=a.getDom()))}},buttonPosition:{refreshDom:!0,defaultValue:"right","enum":["left","right"]}},b.prototype.destroy=function(){this._destroyed||(b.__super__.destroy.call(this),delete this._doms,delete this._corner,delete this._actionButton,delete this._label)},b.prototype._bindSetter=function(a){var c;b.__super__._bindSetter.call(this,a),c=this.getBindingDataType(),c&&cola.DataType.dataTypeSetter.call(this,c)},b.prototype._parseDom=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(a){for(null==this._doms&&(this._doms={}),j=-1,d=0,k=0,f={},n=a.childNodes,h=m=0,l=n.length;l>m;h=++m)e=n[h],1===e.nodeType&&(g=e.tagName,"C-CORNER"===g?f.corner=this._corner=e:"C-LABEL"===g?(k=h,f.label=this._label=e):"C-BUTTON"===g?(d=h,f.actionButton=this._actionButton=e):"I"===g?(this._doms.iconDom=e,this._icon=e.className):this._isEditorDom(e)&&(j=h,this._doms.input=e));return f.label&&j>-1&&k>j&&!config.labelPosition&&(this._labelPosition="right"),f.actionButton&&j>-1&&j>d&&!config.buttonPosition&&(this._buttonPosition="left"),-1===j&&(i=this._doms.input=this._createEditorDom(),f.label?(c=$fly(f.label),"right"===this._labelPosition?c.before(i):c.after(i)):f.actionButton?(b=$fly(f.actionButton),"left"===this._buttonPosition?b.after(i):b.before(i)):f.corner?$fly(f.corner).before(i):this.get$Dom().append(i)),this}},b.prototype._createEditorDom=function(){return $.xCreate({tagName:"input",type:"text"})},b.prototype._isEditorDom=function(a){return"INPUT"===a.nodeName},b.prototype._createDom=function(){var a,b,c;return a=this.constructor.CLASS_NAME,null==this._doms&&(this._doms={}),c=this._doms.input=this._createEditorDom(),b=$.xCreate({tagName:"DIV","class":"ui "+a},this._doms),b.appendChild(c),b},b.prototype._refreshCorner=function(){var a;a=this.get("corner"),a&&(a.parentNode!==this._dom&&this._dom.appendChild(a),this._classNamePool.remove("labeled"),this._classNamePool.add("corner labeled"))},b.prototype._refreshLabel=function(){var a,b,c;this._dom&&(a=this.get("label"),b=this.get("labelPosition"),this._classNamePool.remove("right labeled"),this._classNamePool.remove("labeled"),a&&(c="right"===b,this._classNamePool.add(c?"right labeled":"labeled"),c?this._dom.appendChild(a):$(this._doms.input).before(a)))},b.prototype._refreshButton=function(){var a,b,c,d;b=$(this._dom).find(">c-button"),b.length>0&&(a=b[0]),c=this.get("buttonPosition"),this._classNamePool.remove("left action"),this._classNamePool.remove("action"),a&&(d="left"===c,this._classNamePool.add(d?"left action":"action"),d?$(this._doms.input).before(a):this._dom.appendChild(a))},b.prototype._refreshIcon=function(){var a,b,c,d,e,f;c=this.get("icon"),e=this.get("iconPosition"),b=this._classNamePool,b.remove("left icon"),b.remove("icon"),c?(null==(a=this._doms).iconDom&&(a.iconDom=document.createElement("i")),d=this._doms.iconDom,$(d).addClass(c+" icon"),f="left"===e,b.add(f?"left icon":"icon"),f?$(this._doms.input).before(d):this._dom.appendChild(d)):this._doms.iconDom&&$(this._doms.iconDom).remove()},b.prototype._refreshInput=function(){var a,b,c,d,e;a=$fly(this._doms.input),this._name&&a.attr("name",this._name),a.attr("placeholder",this.get("placeholder")),a.prop("readOnly",this._finalReadOnly),null!=(e=this.get("actionButton"))&&e.set("disabled",this._finalReadOnly),c=this._dataType,c&&!this._inputType&&(d="text",b="left",c instanceof cola.NumberDataType&&(d="number",b="right"),a.prop("type",d).css("text-align",b)),this._refreshInputValue(this._value)},b.prototype._refreshInputValue=function(a){$fly(this._doms.input).val(null!=a?a+""||"":void 0)},b.prototype._doRefreshDom=function(){this._dom&&(b.__super__._doRefreshDom.call(this),this._finalReadOnly=!!this.get("readOnly"),this._refreshIcon(),this._refreshButton(),this._refreshCorner(),this._refreshLabel(),this._refreshInput())},b.prototype.focus=function(){var a;null!=(a=this._doms.input)&&a.focus()},b}(cola.AbstractEditor),cola.Input=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return J(d,a),d.tagName="c-input",d.CLASS_NAME="input",d.attributes={displayFormat:null,inputFormat:null,inputType:{defaultValue:"text"},maxLength:{refreshDom:!0,type:"number"},postOnInput:{type:"boolean",defaultValue:!1}},d.events={focus:null,blur:null,keyDown:null,keyPress:null},d.prototype._createEditorDom=function(){var a;return a={tagName:"input",type:this._inputType||"text"},"number"===this._inputType&&(a.style={"text-align":"right"}),$.xCreate(a)},d.prototype._isEditorDom=function(a){return"INPUT"===a.nodeName},d.prototype._initDom=function(a){var b;d.__super__._initDom.call(this,a),b=function(a){return function(){var b,d,e,f;e=a._readOnly,e||(f=$(a._doms.input).val(),b=a._dataType,b&&("text"===a._inputType&&(d=a._inputFormat,b instanceof cola.DateDataType&&(null==d&&(d=c),f=d+"||"+f)),f=b.parse(f)),a.set("value",f))}}(this),$(this._doms.input).on("change",function(a){return function(){b()}}(this)).on("focus",function(a){return function(){a._inputFocused=!0,a._refreshInputValue(a._value),a._finalReadOnly||a.addClass("focused"),a.fire("focus",a)}}(this)).on("blur",function(a){return function(){var b,c,d;a._inputFocused=!1,a.removeClass("focused"),a._refreshInputValue(a._value),a.fire("blur",a),(null==a._value||""===a._value&&(null!=(d=a._bindInfo)?d.writeable:void 0))&&(c=a.getBindingProperty(),(null!=c?c._required:void 0)&&c._validators&&(b=a._scope.get(a._bindInfo.entityPath),b&&b.validate(a._bindInfo.property)))}}(this)).on("input",function(a){return function(){a._postOnInput&&b()}}(this)).on("keydown",function(a){return function(c){var d;return d={keyCode:c.keyCode,shiftKey:c.shiftKey,ctrlKey:c.ctrlKey,altKey:c.altKey,event:c},a.fire("keyDown",a,d),c.altKey&&18===c.keyCode&&E?b():void 0}}(this)).on("keypress",function(a){return function(c){var d;return d={keyCode:c.keyCode,shiftKey:c.shiftKey,ctrlKey:c.ctrlKey,altKey:c.altKey,event:c},a.fire("keyPress",a,d)!==!1&&13===c.keyCode&&E?b():void 0}}(this))},d.prototype._refreshInputValue=function(a){var f,g;return g=this._inputType,"text"===g?(f=this._inputFocused?this._inputFormat:this._displayFormat,"number"==typeof a?f&&(a=formatNumber(f,a)):a instanceof Date&&(f||(f=this._inputFocused?c:b),a=new XDate(a).toString(f))):a instanceof Date&&(f="date"===g?b:"time"===g?e:ISO_FORMAT_STRING,a=new XDate(a).toString(f)),d.__super__._refreshInputValue.call(this,a)},d.prototype._doRefreshDom=function(){var a;if(this._dom)return d.__super__._doRefreshDom.call(this),a=$(this._doms.input),this._maxLength?a.attr("maxlength",this._maxLength):a.removeAttr("maxlength")},d}(cola.AbstractInput),cola.registerWidget(cola.Input),cola.Progress=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-progress",b.CLASS_NAME="progress",b.attributes={total:{type:"number",defaultValue:0,refreshDom:!0},value:{type:"number",defaultValue:0,refreshDom:!0},strokeWidth:{type:"number",defaultValue:5.2,refreshDom:!0},circle:{readonlyAfterCreate:!0,type:"boolean",defaultValue:!1}},b.prototype._initDom=function(a){var b;return null==this._doms&&(this._doms={}),this._circle?(b='<svg viewBox="0 0 100 100"><path class="track" d="M 50 50 m 0 -47 a 47 47 0 1 1 0 94 a 47 47 0 1 1 0 -94"></path><path class="progress" d="M 50 50 m 0 -47 a 47 47 0 1 1 0 94 a 47 47 0 1 1 0 -94"></path></svg>',$(a).addClass("circle").append(b).append(document.createElement("text"))):$(a).addClass("basic").append($.xCreate([{tagName:"div","class":"track",content:{tagName:"div","class":"progress"}},{tagName:"text"}]))},b.prototype._doRefreshDom=function(){var a,c,d,e,f,g,h,i,j,k,l;this._dom&&(b.__super__._doRefreshDom.call(this),a=this.get$Dom(),l=this._value,j=this._total||100,i="",l===j?i="success":l>j&&(i="exception"),d=Math.ceil(Math.round(l/j*1e4)/100),g=d+"%",this._circle?(e=2*Math.PI*47,h=a.find(">svg>path.progress")[0],k=a.find(">svg>path.track")[0],k.setAttribute("stroke-width",this._strokeWidth),h.setAttribute("stroke-width",this._strokeWidth),h.setAttribute("stroke-dasharray",e+"px, "+e+"px"),c=0,"exception"!==i&&(c=(1-l/j)*e+"px"),h.setAttribute("stroke-dashoffset",c)):(a.find(">.track>.progress").css("width","exception"!==i?g:"100%"),a.hasClass("inline")&&a.find("text").css("right","exception"!==i?100-d+"%":"0%")),a.find(">text").text(g),f=this._classNamePool,f.remove("exception"),f.remove("success"),i&&f.add(i))},b.prototype.reset=function(){return this.set("value",0)},b.prototype.progress=function(a){return this.set("value",a)},b.prototype.complete=function(){return this.set("value",this.get("total")||100)},b.prototype.destroy=function(){var a;this._destroyed||(null!=(a=this._$dom)&&a.progress("destroy"),b.__super__.destroy.call(this),delete this._doms)},b}(cola.Widget),cola.registerWidget(cola.Progress),cola.RadioButton=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-radio",b.CLASS_NAME="checkbox",b.INPUT_TYPE="radio",b.attributes={type:{"enum":["radio","toggle","slider"],defaultValue:"radio",refreshDom:!0,setter:function(a){var b;return b=this._type,this._type=a,b&&this._dom&&b!==a&&$fly(this._dom).removeClass(b),this}},label:{refreshDom:!0},name:{refreshDom:!0},disabled:{type:"boolean",refreshDom:!0,defaultValue:!1},checked:{type:"boolean",refreshDom:!0,defaultValue:!1},value:{defaultValue:!0,refreshDom:!0},readOnly:{type:"boolean",refreshDom:!0,defaultValue:!1}},b._modelValue=!1,b.prototype._parseDom=function(a){var b,c,d;for(null==this._doms&&(this._doms={}),b=this.get$Dom(),c=a.firstChild;c;)1===c.nodeType&&("LABEL"===c.nodeName?(this._doms.label=c,null==this._label&&(this._label=cola.util.getTextChildData(c))):"INPUT"===c.nodeName&&(d=c.getAttribute("name"),d&&null==this._name&&(this._name=d),this._doms.input=c)),c=c.nextSibling;this._doms.label||this._doms.input||b.append($.xCreate([{tagName:"input",type:this.constructor.INPUT_TYPE,contextKey:"input",name:this._name||""},{tagName:"label",content:this._label||"",contextKey:"label"}],this._doms)),this._doms.label||(this._doms.label=$.xCreate({tagName:"label",content:this._label||this._value||""}),b.append(this._doms.label)),this._doms.input||(this._doms.input=$.xCreate({tagName:"input",type:this.constructor.INPUT_TYPE,name:this._name}),$(this._doms.label).before(this._doms.input)),this._bindToSemantic()},b.prototype._createDom=function(){return $.xCreate({tagName:"DIV","class":"ui "+this.constructor.CLASS_NAME,content:[{tagName:"input",type:this.constructor.INPUT_TYPE,contextKey:"input",name:this._name},{tagName:"label",content:this._label||this._value||"",contextKey:"label"}]},this._doms)},b.prototype._bindToSemantic=function(){return this.get$Dom().checkbox({onChange:function(a){return function(){return a._changeState()}}(this)})},b.prototype._changeState=function(){var a;return this._checked=this.get$Dom().checkbox("is checked"),this._checked&&null!=(a=this._parent)?a.set("value",this._value):void 0},b.prototype._setDom=function(a,c){this._dom=a,c||this._bindToSemantic(),b.__super__._setDom.call(this,a,c)},b.prototype._refreshEditorDom=function(){var a;return a=this.get$Dom(),this._checked!==a.checkbox("is checked")?a.checkbox(this._checked?"check":"uncheck"):void 0},b.prototype._doRefreshDom=function(){var a,c,d;if(this._dom)return b.__super__._doRefreshDom.call(this),null==this._doms&&(this._doms={}),c=this._label||this._value||"",$(this._doms.label).text(c),d=this.get("readOnly"),this._classNamePool.toggle("read-only",d),this._classNamePool.add(this._type),a=this.get$Dom(),a.checkbox(this._disabled?"disable":"enable"),$(this._doms.input).attr("name",this._name).attr("value",this._value),this._refreshEditorDom()},b.prototype.toggle=function(){var a;return a=!!this.get("checked"),this.set("checked",!a),this},b.prototype.remove=function(){return b.__super__.remove.call(this),delete this._parent},b.prototype.destroy=function(){return this._destroyed?this:(delete this._parent,b.__super__.destroy.call(this),delete this._doms)},b}(cola.Widget),cola.registerWidget(cola.RadioButton),D=[],cola.RadioGroup=function(a){function b(a){b.__super__.constructor.call(this,a),null==this._name&&(this._name=(new Date).getTime()+"")}return J(b,a),b.tagName="c-radioGroup",b.CLASS_NAME="grouped",b.attributes={name:null,items:{setter:function(a){var b,c,d,e,f,g,h,i,j;if("string"==typeof a)for(a=a.split(/[\,,\;]/),b=h=0,e=a.length;e>h;b=++h)d=a[b],c=d.indexOf("="),c>=0&&(a[b]={value:d.substring(0,c),label:d.substring(c+1)});else if(a instanceof Array)for(i=0,f=a.length;f>i;i++)d=a[i],null==d.value&&(d.value=d.key),null==d.label&&(d.label=d.text);for(this.clear(),j=0,g=a.length;g>j;j++)d=a[j],this._addItem(d);return this}},type:{"enum":["radio","toggle","slider"],defaultValue:"radio",refreshDom:!0,setter:function(a){var b,c,d,e;if(this._type=a,this._items)for(e=this._items,d=0,c=e.length;c>d;d++)b=e[d],b.set("type",a);return this}}},b.prototype._doRefreshDom=function(){var a,c,d,e,f;if(this._dom&&(b.__super__._doRefreshDom.call(this),f=this._value,this._items))for(e=this._items,d=0,c=e.length;c>d;d++)a=e[d],a.set("readOnly",this._readOnly),a.set("checked",a.get("value")===f)},b.prototype._initDom=function(a){var c,d,e,f,g;if(b.__super__._initDom.call(this,a),this._items)for(g=this._items,f=0,e=g.length;e>f;f++)c=g[f],d=c.getDom(),d.parentNode!==this._dom&&this._dom.appendChild(d)},b.prototype._parseDom=function(a){var b,c;for(b=a.firstChild;b;)1===b.nodeType&&(c=cola.widget(b),c&&c instanceof cola.RadioButton&&this._addItem(c)),b=b.nextSibling},b.prototype._addItem=function(a){var b,c,d,e;return this._destroyed?this:(null==this._items&&(this._items=[]),a instanceof cola.RadioButton?d=a:(b=cola.util.getType(a),"number"===b||"string"===b?c={value:a}:a.hasOwnProperty("key")?(c=$.extend(a,null),c.label=a.value,c.value=a.key):c=a,d=new cola.RadioButton(c)),d?(d.set({name:this._name,type:this._type}),d._parent=this,this._items.push(d),this._dom&&(e=d.getDom(),e.parentNode!==this._dom,this._dom.appendChild(e)),this):void 0)},b.prototype.addRadioButton=function(a){return this._addItem(a),this},b.prototype.getRadioButton=function(a){var b,c,d,e;if(this._items){if("string"!=typeof a)return this._items[a];for(e=this._items,d=0,c=e.length;c>d;d++)if(b=e[d],b.get("value")===a)return;return null}},b.prototype.removeRadioButton=function(a){var b;return(b=a instanceof cola.RadioButton?a:getRadioButton(a))?(a=this._items.indexOf(b),this._items.splice(a,1),b.remove(),this):this},b.prototype.clear=function(){var a,b,c,d;if(this._items){for(d=this._items,c=0,b=d.length;b>c;c++)a=d[c],a.destroy();return this._items=[]}},b.prototype.destroy=function(){var a,c,d,e;if(this._destroyed)return this;if(this._items){for(e=this._items,d=0,c=e.length;c>d;d++)a=e[d],a.destroy();delete this._items}return b.__super__.destroy.call(this),this},b}(cola.AbstractEditor),cola.registerWidget(cola.RadioGroup),cola.Rating=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-rating",b.CLASS_NAME="rating",b.attributes={rating:{type:"number",defaultValue:0,refreshDom:!0},maxRating:{type:"number",refreshDom:!0,defaultValue:1,setter:function(a){return this._maxRating=a,this._refreshRating=!0}},disabled:{type:"boolean",refreshDom:!0,defaultValue:!1}},b.events={rate:null},b.prototype._fireRate=function(){return cola.util.cancelDelay(this,"_fireRate"),this.fire("rate",this,{rating:this._rating})},b.prototype._doRefreshRating=function(){var a,b;this._refreshRating=!1,b=this.get("rating"),a=this.get("maxRating"),b>a&&(this._rating=b=a),this.get$Dom().empty().rating({initialRating:b,maxRating:a,onRate:function(a){return function(b){return b!==a._rating?(a.set("rating",b),cola.util.delay(a,"_fireRate",50,a._fireRate)):void 0}}(this)}).rating(this._disabled?"disable":"enable")},b.prototype._initDom=function(a){return this._doRefreshRating()},b.prototype._doRefreshDom=function(){var a;this._dom&&(b.__super__._doRefreshDom.call(this),this._refreshRating?this._doRefreshRating():(a=this.get$Dom(),a.rating(this._disabled?"disable":"enable"),a.rating("get rating")!==this._rating&&a.rating("set rating",this._rating)))},b.prototype.clear=function(){return this.set("rating",0),this},b}(cola.Widget),cola.Element.mixin(cola.Rating,cola.DataWidgetMixin),cola.registerWidget(cola.Rating),cola.Select=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-select",b.CLASS_NAME="input select",b.attributes={options:{setter:function(a){var b,c,d,e,f,g,h;if("string"==typeof a)for(a=a.split(/[\,,\;]/),b=f=0,e=a.length;e>f;b=++f)d=a[b],c=d.indexOf("="),c>=0?a[b]={value:d.substring(0,c),text:d.substring(c+1)}:a[b]={value:null,text:d};(a instanceof Array||a instanceof cola.EntityList)&&(this._options=a,h=null!=(g=this._doms)?g.input:void 0,h&&this._refreshSelectOptions(h))}}},b.prototype._createEditorDom=function(){return $.xCreate({tagName:"select","class":"editor"})},b.prototype._isEditorDom=function(a){return"SELECT"===a.nodeName},b.prototype._parseDom=function(a){var c,d;if(b.__super__._parseDom.call(this,a),!this._icon){for(c=this._doms.input.nextSibling;c;){if(1===c.nodeType&&"TEMPLATE"!==c.nodeName){d=!0;break}c=c.nextSibling}d||this.set("icon","dropdown")}},b.prototype._initDom=function(a){this._options&&this._refreshSelectOptions(this._doms.input),$(this._doms.input).on("change",function(a){return function(){var b,c;b=a._readOnly,b||(c=$(a._doms.input).val(),a.set("value",c))}}(this))},b.prototype._refreshSelectOptions=function(a){var b;b=a.options,this._options instanceof cola.EntityList?b.length=this._options.entityCount:b.length=this._options.length,cola.each(this._options,function(a){return function(c,d){var e,f,g,h;f=b[d],cola.util.isSimpleValue(c)?(h=null,g=c):c instanceof cola.Entity?c.hasValue("key")?(h=c.get("key")||"",g=c.get("value")):(h=c.get("value")||"",g=c.get("text")):c.hasOwnProperty("key")?(h=c.key||"",g=c.value):(h=c.value||"",g=c.text),e=$fly(f),null==h?e.removeAttr("value"):(e.attr("value",h),""!==h||g||(g=a._placeholder)),e.text(g||"")}}(this))},b.prototype._refreshInputValue=function(a){b.__super__._refreshInputValue.call(this,a),cola.util.toggleClass(this._doms.input,"placeholder",null==a||""===a)},b.prototype._doRefreshDom=function(){return this._dom?(b.__super__._doRefreshDom.call(this),$(this._doms.input).prop("disabled",this._readOnly)):void 0},b}(cola.AbstractInput),cola.registerWidget(cola.Select),C=0,cola.findDropDown=function(a){var b;for(b=cola.findWidget(a,cola.AbstractLayer);b&&!b.hasClass("drop-container");)b=cola.findWidget(b,cola.AbstractLayer);return null!=b?b._dropdown:void 0},cola.AbstractDropdown=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.CLASS_NAME="input drop",b.attributes={disabled:{type:"boolean",refreshDom:!0,defaultValue:!1},items:{expressionType:"repeat",setter:function(a){var b,c,d,e,f,g,h;if("string"==typeof a)for(a=a.split(/[\,,\;]/),c=g=0,f=a.length;f>g;c=++g)e=a[c],d=e.indexOf("="),d>=0&&(a[c]={key:e.substring(0,d),value:e.substring(d+1)});this._valueProperty||this._textProperty||(h=cola.util.decideValueProperty(a),h&&(this._valueProperty=h.valueProperty,this._textProperty=h.textProperty)),b=this._items!==a||this._itemsTimestamp!==(null!=a?a.timestamp:void 0),this._items=a,b&&((null!=a?a.timestamp:void 0)&&(this._itemsTimestamp=a.timestamp),delete this._itemsIndex)}},currentItem:{readOnly:!0},valueProperty:null,textProperty:null,openOnActive:{type:"boolean",defaultValue:!0},openMode:{"enum":["auto","drop","dialog","layer","sidebar"],defaultValue:"auto"},opened:{readOnly:!0},dropdownLayer:null,dropdownWidth:null,dropdownHeight:null},b.events={initDropdownBox:null,beforeOpen:null,open:null,close:null,selectData:null,focus:null,blur:null,keyDown:null,keyPress:null,input:null},b.prototype._initDom=function(a){b.__super__._initDom.call(this,a),this._useValueContent&&$fly(this._doms.input).xInsertAfter({tagName:"div","class":"value-content",contextKey:"valueContent"},this._doms),$fly(a).attr("tabIndex",1).delegate(">.icon","click",function(a){return function(){if(a._finalReadOnly&&!a._disabled&&!a._opened)return void a.open();if(a._opened)a.close();else{if(a._disabled)return;a.open()}}}(this)).on("keydown",function(a){return function(b){var c;c={keyCode:b.keyCode,shiftKey:b.shiftKey,ctrlKey:b.ctrlKey,altKey:b.altKey,event:b,inputValue:a._doms.input.value},a.fire("keyDown",a,c),a._onKeyDown(b)!==!1&&a._dropdownContent&&$(a._dropdownContent).trigger(b)}}(this)).on("keypress",function(a){return function(b){var c;c={keyCode:b.keyCode,shiftKey:b.shiftKey,ctrlKey:b.ctrlKey,altKey:b.altKey,event:b,inputValue:a._doms.input.value},a.fire("keyPress",a,c)===!1}}(this)),$(this._doms.input).on("focus",function(a){return function(){return a._doFocus()}}(this)).on("blur",function(a){return function(){return a._doBlur()}}(this)).on("input",function(a){return function(b){var c;return c={event:b,inputValue:a._doms.input.value},a.fire("input",a,c)}}(this)).on("keypress",function(a){return function(){return a._inputEdited=!0}}(this)),this._skipSetIcon||this._icon||this.set("icon","dropdown"),this._items&&this._valueProperty&&this._setValue(this._value)},b.prototype._doBlur=function(){this.fire("blur",this,{})},b.prototype._doFocus=function(){this._inputEdited=!1,this.fire("focus",this,{})},b.prototype._parseDom=function(a){var c;if(a&&(b.__super__._parseDom.call(this,a),this._parseTemplates(),!this._icon))for(c=this._doms.input.nextSibling;c;){if(1===c.nodeType&&"TEMPLATE"!==c.nodeName){this._skipSetIcon=!0;break}c=c.nextSibling}},b.prototype._createEditorDom=function(){return $.xCreate({tagName:"input",type:"text",click:function(a){return function(b){var c;if(!a._disabled)return a._openOnActive&&(a._opened?(c=b.target,c.readOnly&&a.close()):a.open()),a.focus()}}(this),input:function(a){return function(b){var c;a._useValueContent&&(c=$fly(a._doms.valueContent),b.target.value?c.hide():c.show());
}}(this)})},b.prototype._isEditorDom=function(a){return"INPUT"===a.nodeName},b.prototype._isEditorReadOnly=function(){return cola.device.mobile},b.prototype._refreshInput=function(){var a,b;a=$fly(this._doms.input),a.attr("placeholder",this.get("placeholder")),a.prop("readonly",this._finalReadOnly||this._isEditorReadOnly()||this._disabled),null!=(b=this.get("actionButton"))&&b.set("disabled",this._finalReadOnly),this._setValueContent()},b.prototype._setValue=function(a){var c,d,e;return this._dom&&!this._skipFindCurrentItem&&(this._itemsIndex?c=this._itemsIndex[a+""]:this._items&&this._valueProperty&&(this._itemsIndex=d={},e=this._valueProperty,cola.each(this._items,function(a){var b;b=a instanceof cola.Entity?a.get(e):a[e],d[b+""]=a}),c=d[a+""]),this._currentItem=c),b.__super__._setValue.call(this,a)},b.prototype._setValueContent=function(){var a,b,c,d,e,f,g,h,i;f=this._currentItem,null==f&&(this._textProperty?(f={},f[this._textProperty]=this._value):f=this._value),e=this._doms.input,f?(this._useValueContent&&(d=null!=(g=this._elementAttrBindings)?g.items:void 0,a=(null!=d?d.expression.alias:void 0)||"item",c=this._currentItemScope,c&&c.data.alias!==a&&(c=null),c||(this._currentItemScope=c=new cola.ItemScope(this._scope,a)),c.data.setTargetData(f),i=this._doms.valueContent,i._inited||(i._inited=!0,b={defaultPath:a},this._initValueContent(i,b),cola.xRender(i,c,b)),$fly(i).show()),h=f instanceof cola.Entity||"object"==typeof f&&!(f instanceof Date)?cola.Entity._evalDataPath(f,this._textProperty||this._valueProperty):f,e.value=h||"",e.placeholder="",this.get$Dom().removeClass("placeholder")):(e.value="",e.placeholder=this._placeholder||"",this.get$Dom().addClass("placeholder"),this._useValueContent&&$fly(this._doms.valueContent).hide())},b.prototype._initValueContent=function(a,b){var c,d;c=this._textProperty||this._valueProperty,c&&(b.defaultPath+="."+c),d=this.getTemplate("value-content"),d&&a.appendChild(d)},b.prototype._getFinalOpenMode=function(){var a;return a=this._openMode,a&&"auto"!==a||(a=cola.device.desktop?"drop":cola.device.phone?"layer":"dialog"),a},b.prototype._getTitleContent=function(){return cola.xRender({tagName:"div","class":"box",content:{tagName:"c-titlebar",content:[{tagName:"a",icon:"chevron left",click:function(a){return function(){return a.close()}}(this)}]}},this._scope,{})},b.prototype._getContainer=function(){var a,b,c,d;return this._container?("function"==typeof this._refreshDropdownContent&&this._refreshDropdownContent(),this._container):(this._finalOpenMode=c=this._getFinalOpenMode(),a={"class":"drop-container",dom:$.xCreate({content:this._getDropdownContent()}),beforeHide:function(a){return function(){$fly(a._dom).removeClass("opened")}}(this),hide:function(a){return function(){a._opened=!1}}(this)},this._dropdownContent=a.dom.firstChild,this._dropdownWidth&&(a.width=this._dropdownWidth),this._dropdownHeight&&(a.height=this._dropdownHeight),"drop"===c?(a.duration=200,a.dropdown=this,a.ui=a.ui+" "+this._ui,b=new g(a)):"layer"===c?("Sidebar"===c&&(a.animation="slide up",a.height="50%"),d=this._getTitleContent(),$fly(a.dom.firstChild.firstChild).before(d),b=new cola.Layer(a)):"sidebar"===c?(a.direction="bottom",a.size=document.body.clientHeight/2,$fly(a.dom.firstChild.firstChild).before(d),b=new cola.Sidebar(a)):"dialog"===c&&(a.modalOpacity=.05,a.closeable=!1,a.dimmerClose=!0,b=new cola.Dialog(a)),this._container=b,b.appendTo(document.body),b)},b.prototype.open=function(a){var b,c,d,e,f,g,h;if(!(this._finalReadOnly&&this._disabled||this.fire("beforeOpen",this)===!1))return g=function(b){return function(){b.fire("open",b),"function"==typeof a&&a()}}(this),e=this._getContainer(),e?(e._dropdown=this,e.on("hide",function(a){delete a._dropdown}),e instanceof cola.Dialog&&(c=$(this._doms.flexContent),c.height(""),b=e.get$Dom(),b.removeClass("hidden"),f=b.height(),d=document.body.clientHeight,f>d-2*C?(h=c.height()-(f-(d-2*C)),b.addClass("hidden"),c.height(h)):b.addClass("hidden")),this.fire("initDropdownBox",this,{dropdownBox:e}),e.constructor.events.$has("hide")&&e.on("hide:dropdown",function(a){return function(){a.fire("close",a)}}(this),!0),"function"==typeof e.show&&e.show(g),this._opened=!0,$fly(this._dom).addClass("opened"),!0):void 0},b.prototype.close=function(a,b){var c;void 0!==a?this._selectData(a):this._inputEdited&&this.refresh(),c=this._getContainer(),null!=c&&"function"==typeof c.hide&&c.hide(b)},b.prototype._getItemValue=function(a){var b;return b=this._valueProperty&&a?a instanceof cola.Entity?a.get(this._valueProperty):a[this._valueProperty]:a},b.prototype._selectData=function(a){var b;this._inputEdited=!1,b=this._getItemValue(a),this._skipFindCurrentItem=!0,this.fire("selectData",this,{data:a})!==!1&&(this._currentItem=a,this.set("value",b)),this._skipFindCurrentItem=!1,this.refresh()},b.prototype._doRefreshDom=function(){return b.__super__._doRefreshDom.call(this),this._dom?$(this._dom).toggleClass("disabled",this._disabled):void 0},b}(cola.AbstractInput),cola.Element.mixin(cola.AbstractDropdown,cola.TemplateSupport),g=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.CLASS_NAME="drop-box transition",b.attributes={dropdown:null},b.prototype.show=function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;d=this.get$Dom(),k=this._dropdown._doms.input,this._height||d.css("height",""),d.removeClass("hidden"),g=d.width(),f=d.height(),d.addClass("hidden"),n=$fly(k).offset(),i=document.body.offsetWidth,h=document.body.clientHeight,o=document.body.scrollTop,e=Math.abs(h-n.top-k.clientHeight-o),e>=f?j="down":(q=n.top-o,q>e?(j="up",f>q&&(l=q)):(j="down",f>e&&(l=e))),p="down"===j?n.top+k.clientHeight:n.top-(l||f),m=n.left,g>k.offsetWidth&&g+n.left>i&&(m=i-g,0>m&&(m=0)),l&&d.css("height",l),d.removeClass("down"===j?"direction-up":"direction-down").addClass("direction-"+j).toggleClass("x-over",g>k.offsetWidth).css("left",m).css("top",p).css("min-width",k.offsetWidth).css("max-width",document.body.clientWidth),this._animation="fade",b.__super__.show.call(this,a,c)},b.prototype._onShow=function(){b.__super__._onShow.call(this),this._bodyListener=function(a){return function(b){var c,d,e,f;for(f=b.target,d=a._dropdown._dom,c=a._dom;f;){if(f===d||f===c){e=!0;break}f=f.parentNode}e||a._dropdown.close()}}(this),$fly(document.body).on("click",this._bodyListener)},b.prototype.hide=function(a,c){$fly(document.body).off("click",this._bodyListener),b.__super__.hide.call(this,a,c)},b}(cola.Layer),cola.Dropdown=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-dropdown",b.attributes={filterable:{readOnlyAfterCreate:!0,defaultValue:!0},filterValue:{readOnly:!0},filterProperty:null,filterInterval:{defaultValue:300}},b.events={filterItem:null},b.TEMPLATES={"default":{tagName:"li","c-bind":"$default"},list:{tagName:"div",contextKey:"flexContent",content:{tagName:"c-listview",contextKey:"list",allowNoCurrent:!1,changeCurrentItem:!1,highlightCurrentItem:!0,style:"overflow:auto"},keydown:function(a){return this._disableKeyBubble||(this._disableKeyBubble=!0,$fly(this).find(">c-listview").trigger(a),this._disableKeyBubble=!1),!0}},"filterable-list":{tagName:"div","class":"v-box",content:[{tagName:"div","class":"box filter-container",content:{tagName:"c-input",contextKey:"input","class":"fluid",icon:"search"}},{tagName:"div",contextKey:"flexContent","class":"flex-box list-container",style:"min-height:2em",content:{tagName:"c-listview",contextKey:"list",allowNoCurrent:!1,changeCurrentItem:!1,highlightCurrentItem:!0}}],keydown:function(a){return this._disableKeyBubble||(this._disableKeyBubble=!0,$fly(this).find(">.flex-box >c-listview").trigger(a),this._disableKeyBubble=!1),!0}}},b.prototype._initDom=function(a){var c;return this._filterable&&$fly(a).addClass("filterable"),this._regDefaultTempaltes(),c=this._doms.input,$fly(c).on("input",function(a){return function(){return a._onInput(c.value)}}(this)),b.__super__._initDom.call(this,a)},b.prototype.open=function(){var a;return b.__super__.open.call(this)?(a=this._list,a&&this._currentItem!==a.get("currentItem")&&a.set("currentItem",this._currentItem),this._opened&&this._filterable&&null!==this._list.get("filterCriteria")&&this._list.set("filterCriteria",null).refresh(),!0):void 0},b.prototype._onInput=function(a){this._inputDirty=!0,cola.util.delay(this,"filterItems",150,function(){var b,c,d,e,f,g,h,i;this._list&&(b=a,this._opened&&this._filterable&&(f=this._filterProperty||this._textProperty,a||f&&(b={},b[f]=a),this._list.set("filterCriteria",b).refresh()),i=this._list.getItems(),c=null,this._filterable?(null!==a&&(g=i[0],g&&(e=f?cola.Entity._evalDataPath(g,f)===a:g===a),e&&(c=this._list._getFirstItemDom())),this._list._setCurrentItemDom(c)):(h=cola.util.find(i,b),h?(d=cola.Entity._getEntityId(h),d?this._list.set("currentItem",h):this._list._setCurrentItemDom(c)):this._list._setCurrentItemDom(null)))})},b.prototype._onKeyDown=function(a){var b;return 13===a.keyCode?(this.close((null!=(b=this._list)?b.get("currentItem"):void 0)||null),!1):void(27===a.keyCode&&this.close(this._currentItem||null))},b.prototype._selectData=function(a){return this._inputDirty=!1,b.__super__._selectData.call(this,a)},b.prototype._doBlur=function(){var a;return this._inputDirty&&this.close((null!=(a=this._list)?a.get("currentItem"):void 0)||null),b.__super__._doBlur.call(this)},b.prototype._getDropdownContent=function(){var a,b,c,d,e,f,g;if(!this._dropdownContent){if(g=this._filterable&&"drop"!==this._finalOpenMode?"filterable-list":"list",f=this.getTemplate(g),this._dropdownContent=f=cola.xRender(f,this._scope),this._list=b=cola.widget(this._doms.list),this._templates){d=this._templates;for(c in d)e=d[c],["list","filterable-list","value-content"].indexOf(c)<0&&("default"===c&&(a=!0),b.regTemplate(c,e))}a||b.regTemplate("default",{tagName:"li","c-bind":"$default"}),b.on("itemClick",function(a){return function(){return a.close(b.get("currentItem"))}}(this))}return"function"==typeof this._refreshDropdownContent&&this._refreshDropdownContent(),f},b.prototype._refreshDropdownContent=function(){var a,b,c;return a=null!=(c=this._elementAttrBindings)?c.items:void 0,b=this._list,b._textProperty=this._textProperty||this._valueProperty,a?b.set("bind",a.expression.raw):b.set("items",this._items),b.refresh()},b}(cola.AbstractDropdown),cola.registerWidget(cola.Dropdown),cola.CustomDropdown=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-customDropdown",b.attributes={content:null},b.TEMPLATES={"default":{tagName:"div",content:"<Undefined>"},"value-content":{tagName:"div","c-bind":"$default"}},b.prototype._isEditorReadOnly=function(){return!1},b.prototype._getDropdownContent=function(){var a;return this._dropdownContent||(a=this._content?this._content:this.getTemplate(),this._dropdownContent=cola.xRender(a,this._scope)),this._dropdownContent},b}(cola.AbstractDropdown),cola.registerWidget(cola.CustomDropdown),cola.DateGrid=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.CLASS_NAME="calendar mild",b.attributes={columnCount:{type:"number",defaultValue:7},rowCount:{type:"number",defaultValue:6},cellClassName:null,selectedCellClassName:"",rowClassName:null,autoSelect:{defaultValue:!0},tableClassName:{defaultValue:"ui date-table"}},b.events={cellClick:null,refreshCellDom:null},b.prototype._initDom=function(a){var b,c,d,e,f,g,h,i,j,k,l;for(g=this,c=this._columnCount,h=this._rowCount,null==this._doms&&(this._doms={}),b=cola.resource("cola.date.dayNamesShort"),l=b.split(","),d=$.xCreate({tagName:"div","class":"caption-panel",content:[{tagName:"div","class":"header",contextKey:"header",content:[{tagName:"div","class":"month",content:[{tagName:"span","class":"button prev",contextKey:"prevMonthButton",click:function(){return g.prevMonth()}},{tagName:"span","class":"button next",contextKey:"nextMonthButton",click:function(){return g.nextMonth()}},{tagName:"div","class":"label",contextKey:"monthLabel"}]},{tagName:"div","class":"year",content:[{tagName:"span","class":"button prev",contextKey:"prevYearButton",click:function(){return g.prevYear()}},{tagName:"span","class":"button next",contextKey:"nextYearButton",click:function(){return g.nextYear()}},{tagName:"div","class":"label",contextKey:"yearLabel"}]}]},{tagName:"table",cellPadding:0,cellSpacing:0,border:0,"class":"date-header",contextKey:"dateHeader",content:[{tagName:"tr",content:[{tagName:"td",content:l[0]},{tagName:"td",content:l[1]},{tagName:"td",content:l[2]},{tagName:"td",content:l[3]},{tagName:"td",content:l[4]},{tagName:"td",content:l[5]},{tagName:"td",content:l[6]}]}]}]},this._doms),i=$.xCreate({tagName:"table",cellSpacing:0,"class":(g._className||"")+" "+(g._tableClassName||""),content:{tagName:"tbody",contextKey:"body"}},this._doms),e=0;h>e;){for(k=document.createElement("tr"),f=0;c>f;)j=document.createElement("td"),this._cellClassName&&(j.className=this._cellClassName),this.doRenderCell(j,e,f),k.appendChild(j),f++;this._rowClassName&&(k.className=this._rowClassName),this._doms.body.appendChild(k),e++}return $fly(i).on("click",function(a){var b,c;if(b=cola.calendar.getCellPosition(a),b&&b.element){if(b.row>=g._rowCount)return;return g._autoSelect&&(g.setSelectionCell(b.row,b.column),c=$fly(b.element).attr("cell-date"),g._currentDate=new Date(Date.parse(c))),g.fire("cellClick",g,b)}}),a.appendChild(d),this._doms.tableWrapper=$.xCreate({tagName:"div","class":"date-table-wrapper"}),this._doms.tableWrapper.appendChild(i),a.appendChild(this._doms.tableWrapper),a},b.prototype.doFireRefreshEvent=function(a){return this.fire("refreshCellDom",this,a),this},b.prototype.refreshHeader=function(){var a,b;return this._doms?(a=this._doms.monthLabel,b=this._doms.yearLabel,$fly(b).text(this._year||""),$fly(a).text(this._month+1||"")):void 0},b.prototype.refreshGrid=function(){var a,b,c,d,e,f,g,h,i,j;for(h=this,c=this._doms.body,b=this._columnCount,i=this._rowCount,g=this._lastSelectedCell,g&&($fly(g).removeClass(this._selectedCellClassName||"selected"),this._lastSelectedCell=null),e=0;i>e;){for(j=c.rows[e],f=0;b>f;)a=j.cells[f],h._cellClassName&&(a.className=h._cellClassName),d={cell:a,row:e,column:f},this.doFireRefreshEvent(d),d.processDefault!==!1&&this.doRefreshCell(a,e,f),f++;e++}return this},b.prototype._doRefreshDom=function(){return b.__super__._doRefreshDom.call(this),this._dom?(this.refreshGrid(),this.refreshHeader()):void 0},b.prototype.setSelectionCell=function(a,b){var c,d,e,f;return e=this,d=this._lastSelectedCell,this._dom?(d&&($fly(d).removeClass(this._selectedCellClassName||"selected"),this._lastSelectedCell=null),f=e._doms.body,f.rows[a]&&(c=f.rows[a].cells[b]),c?($fly(c).addClass(this._selectedCellClassName||"selected"),this._lastSelectedCell=c,this):this):(this._selectionPosition={row:a,column:b},this)},b.prototype.getYMForState=function(a){var b,c;return b=this._month,c=this._year,"prev-month"===a.type?(c=0===b?c-1:c,b=0===b?11:b-1):"next-month"===a.type&&(c=11===b?c+1:c,b=11===b?0:b+1),{year:c,month:b}},b.prototype.doFireRefreshEvent=function(a){var b,c,d,e;return d=a.row,c=a.column,this._state&&this._year&&this._month&&(b=this._state[7*d+c],e=this.getYMForState(b),a.date=new Date(e.year,e.month,b.text)),this.fire("refreshCellDom",this,a),this},b.prototype.doRenderCell=function(a,b,c){var d;d=document.createElement("div"),d.className="label",a.appendChild(d)},b.prototype.getDateCellDom=function(a){var b;return b=new XDate(a).toString("yyyy-MM-dd"),$(this._dom).find("td[cell-date='"+b+"']")[0]},b.prototype.setCurrentDate=function(a){var b,c;return this._currentDate=a,b=a.getMonth(),c=a.getFullYear(),this.setState(c,b),this.selectCell(this.getDateCellDom(a))},b.prototype.selectCell=function(a){var b;return b=this._lastSelectedCell,this._dom?(b&&($fly(b).removeClass(this._selectedCellClassName||"selected"),this._lastSelectedCell=null),a?($fly(a).addClass(this._selectedCellClassName||"selected"),this._lastSelectedCell=a):this):this},b.prototype.doRefreshCell=function(a,b,c){var d,e,f,g,h;return(g=this._state)?(d=g[7*b+c],$fly(a).removeClass("prev-month next-month").addClass(d.type).find(".label").html(d.text),h=this.getYMForState(d),f=h.month+1,e=d.text,10>f&&(f="0"+f),parseInt(e)<10&&(e="0"+e),$fly(a).attr("cell-date",h.year+"-"+f+"-"+e)):void 0},b.prototype.setState=function(a,b){var c,d;return d=this._year,c=this._month,d===a&&c===b||(this._year=a,this._month=b,this._state=cola.getDateTableState(new Date(a,b,1)),this._dom&&(this.refreshGrid(),this.refreshHeader())),this.onCalDateChange()},b.prototype.prevMonth=function(){var a,b,c,d;return d=this._year,a=this._month,void 0!==d&&void 0!==a&&(c=0===a?d-1:d,b=0===a?11:a-1,this.setState(c,b)),this},b.prototype.nextMonth=function(){var a,b,c,d;return d=this._year,a=this._month,void 0!==d&&void 0!==a&&(c=11===a?d+1:d,b=11===a?0:a+1,this.setState(c,b)),this},b.prototype.prevYear=function(){var a,b;return b=this._year,a=this._month,void 0!==b&&void 0!==a&&this.setState(b-1,a),this},b.prototype.setYear=function(a){var b,c;return c=this._year,b=this._month,void 0!==c&&void 0!==b?this.setState(a,b):void 0},b.prototype.nextYear=function(){var a,b;return b=this._year,a=this._month,void 0!==b&&void 0!==a&&this.setState(b+1,a),this},b.prototype.onCalDateChange=function(){return this._dom?this:this},b}(cola.RenderableElement),b="yyyy-MM-dd",d="yyyy-MM-dd HH:mm:ss",cola.DatePicker=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return J(c,a),c.tagName="c-datepicker",c.CLASS_NAME="date input drop",c.attributes={displayFormat:null,inputFormat:null,icon:{defaultValue:"calendar"},content:{$type:"calender"},inputType:{defaultValue:"date"}},c.events={focus:null,blur:null,keyDown:null,keyPress:null},c.prototype._initDom=function(a){var e;c.__super__._initDom.call(this,a),e=function(a){return function(){var c,e,f,g;e=a._readOnly,e||(f=$(a._doms.input).val(),c=a._inputFormat||a._displayFormat,c||(c="date"===a._inputType?b:d),c&&f&&(f=c+"||"+f,g=new XDate(f),f=g.toDate()),a.set("value",f))}}(this),$(this._doms.input).on("change",function(a){return function(){e()}}(this)).on("focus",function(a){return function(){a._inputFocused=!0,a._refreshInputValue(a._value),a._finalReadOnly||a.addClass("focused"),a.fire("focus",a)}}(this)).on("blur",function(a){return function(){var b,c,d;a._inputFocused=!1,a.removeClass("focused"),a._refreshInputValue(a._value),a.fire("blur",a),(null==a._value||""===a._value&&(null!=(d=a._bindInfo)?d.writeable:void 0))&&(c=a.getBindingProperty(),(null!=c?c._required:void 0)&&c._validators&&(b=a._scope.get(a._bindInfo.entityPath),b&&b.validate(a._bindInfo.property)))}}(this)).on("keydown",function(a){return function(b){var c;return c={keyCode:b.keyCode,shiftKey:b.shiftKey,ctrlKey:b.ctrlKey,altlKey:b.altlKey,event:b},a.fire("keyDown",a,c)}}(this)).on("keypress",function(a){return function(b){var c;return c={keyCode:b.keyCode,shiftKey:b.shiftKey,ctrlKey:b.ctrlKey,altlKey:b.altlKey,event:b},a.fire("keyPress",a,c)!==!1&&13===b.keyCode&&E?e():void 0}}(this))},c.prototype._refreshInputValue=function(a){var e,f;return f=this._inputType,a instanceof Date&&("Invalid Date"===a.toDateString()?a="":(e=this._inputFormat||this._displayFormat,e||(e="date"===f?b:d),a=new XDate(a).toString(e))),c.__super__._refreshInputValue.call(this,a)},c.prototype._refreshInput=function(){var a,b;a=$fly(this._doms.input),this._name&&a.attr("name",this._name),a.attr("placeholder",this.get("placeholder")),a.prop("readOnly",this._finalReadOnly),null!=(b=this.get("actionButton"))&&b.set("disabled",this._finalReadOnly),a.prop("type","text").css("text-align","left"),this._refreshInputValue(this._value)},c.prototype.open=function(){var a,b;return c.__super__.open.call(this)?(b=this.get("value"),b?b instanceof Date||(b=new Date(Date.parse(b))):b=new Date,"Invalid Date"===b.toDateString()&&(b=new Date),this._dataGrid.setCurrentDate(b),null!=(a=this._timeEditor)&&a.set({hour:b.getHours(),minute:b.getMinutes(),second:b.getSeconds()}),!0):void 0},c.prototype._getDropdownContent=function(){return"date"===this._inputType?this._getDateDropdownContent():this._getDateTimeDropdownContent()},c.prototype._getDateTimeDropdownContent=function(){var a,b,c,d;return d=this,d._selectedDate=null,this._dropdownContent||(this._dataGrid=c=new cola.DateGrid({cellClick:function(a){return function(a,b){var c;return c=$fly(b.element).attr("cell-date"),d._selectedDate=c}}(this)}),u=new Date,c.setCurrentDate(u),b={},a=$.xCreate({"class":"v-box date-time-picker",content:[{"class":"flex-box",contextKey:"dateGridBox"},{"class":"box",contextKey:"timeBox",content:{"class":"h-box",content:[{"class":"label box",content:cola.resource("cola.date.time")+":"},{"class":"flex-box",content:{contextKey:"timeEditorBox"}},{"class":"box actions",content:{"class":"ui button primary",content:cola.resource("cola.message.approve"),contextKey:"approveBtn"}}]}}]},b),this._timeEditor=new cola.TimeEditor({hour:u.getHours(),minute:u.getMinutes(),second:u.getSeconds()}),b.dateGridBox.appendChild(c.getDom()),b.timeEditorBox.appendChild(this._timeEditor.getDom()),$(b.approveBtn).on("click",function(){var a;return a=d._dataGrid._currentDate,a.setHours(d._timeEditor.get("hour")),a.setMinutes(d._timeEditor.get("minute")),a.setSeconds(d._timeEditor.get("second")),d.close(a)}),this._dropdownContent=a),this._dropdownContent},c.prototype._getDateDropdownContent=function(){var a,b;return b=this,this._dropdownContent||(this._dataGrid=a=new cola.DateGrid({cellClick:function(a){return function(a,c){var d,e;return e=$fly(c.element).attr("cell-date"),d=Date.parse(e),b.close(new Date(d))}}(this)}),a.setCurrentDate(new Date),this._dropdownContent=a.getDom()),this._dropdownContent},c}(cola.CustomDropdown),cola.YearMonthGrid=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.CLASS_NAME="year-month-grid",b.tagName="c-yearMonthGrid",b.attributes={value:{refreshDom:!0},autoSelect:{defaultValue:!0}},b.events={cellClick:null,refreshCellDom:null},b.prototype._initDom=function(a){var b,c,d,e,f,g,h;for(e=this,null==this._doms&&(this._doms={}),b=$.xCreate({tagName:"div","class":"header",contextKey:"header",content:[{tagName:"div","class":"year",content:[{tagName:"div","class":"button prev",contextKey:"prevYearButton",click:function(){return e.prevYear()}},{tagName:"div","class":"label",contextKey:"yearLabel"},{tagName:"div","class":"button next",contextKey:"nextYearButton",click:function(){return e.nextYear()}}]}]},this._doms),f=$.xCreate({tagName:"table",cellSpacing:0,content:{tagName:"tbody",contextKey:"body"}},this._doms),c=0;3>c;){for(h=document.createElement("tr"),d=0;4>d;)g=document.createElement("td"),this.doRenderCell(g,c,d),h.appendChild(g),d++;this._doms.body.appendChild(h),c++}return $fly(f).on("click",function(a){var b,c;if(c=cola.calendar.getCellPosition(a),c&&c.element){if(c.row>=e._rowCount)return;return e._autoSelect&&(b=e._doms.body.rows[c.row].cells[c.column],e.selectCell(b)),e.fire("cellClick",e,c)}}),a.appendChild(b),this._doms.tableWrapper=$.xCreate({tagName:"div","class":"table-wrapper"}),this._doms.tableWrapper.appendChild(f),a.appendChild(this._doms.tableWrapper),a},b.prototype.doFireRefreshEvent=function(a){return this.fire("refreshCellDom",this,a),this},b.prototype.refreshHeader=function(){var a;return this._doms?(a=this._doms.yearLabel,$fly(a).text(this._year||"")):void 0},b.prototype._doRefreshDom=function(){var a,c,d;return a=new Date,this._value?(d=this._value.split("-"),this._year=parseInt(d[0]),this._month=parseInt(d[1])):(null==this._year&&(this._year=a.getFullYear()),null==this._month&&(this._month=a.getMonth()+1),c=this._month<10?"0"+this._month:this._month,this._value=this._year+"-"+c),b.__super__._doRefreshDom.call(this),this._dom?(this.refreshHeader(),this.refreshGrid()):void 0},b.prototype.doRenderCell=function(a,b,c){var d,e;d=c+1+4*b,e=cola.resource("cola.date.monthNames"),$(a).attr("month",d),a.appendChild($.xCreate({tagName:"div",content:e.split(",")[d-1]}))},b.prototype.selectCell=function(a){var b,c;return b=$(a).attr("month"),c=this._year,parseInt(b)<10&&(b="0"+b),this.set("value",c+"-"+b)},b.prototype.setState=function(a,b){var c,d;return d=this._year,c=this._month,d===a&&c===b||(this._year=a,this._month=b,!this._dom)?void 0:(this.refreshHeader(),this.refreshGrid())},b.prototype.refreshGrid=function(){var a,b,c,d;return c=this._value.split("-"),d=parseInt(c[0]),b=parseInt(c[1]),a=$(this._dom),a.find(".selected").removeClass("selected"),this._year===d?$(a.find("td[month='"+b+"']")[0]).addClass("selected"):void 0},b.prototype.prevYear=function(){var a,b;return b=this._year,a=this._month,void 0!==b&&void 0!==a&&this.setState(b-1,a),this},b.prototype.setYear=function(a){var b,c;return c=this._year,b=this._month,void 0!==c&&void 0!==b?this.setState(a,b):void 0},b.prototype.nextYear=function(){var a,b;return b=this._year,a=this._month,void 0!==b&&void 0!==a&&this.setState(b+1,a),this},b.prototype.onCalDateChange=function(){return this._dom?this:this},b}(cola.RenderableElement),cola.YearMonthDropDown=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-yearmonthdropdown",b.CLASS_NAME="year-month input date drop",b.attributes={icon:{defaultValue:"calendar"}},b.events={focus:null,blur:null,keyDown:null,keyPress:null},b.prototype._initDom=function(a){var c;b.__super__._initDom.call(this,a),c=function(a){return function(){var b,c;b=a._readOnly,b||(c=$(a._doms.input).val(),a.set("value",c))}}(this),$(this._doms.input).on("change",function(a){return function(){c()}}(this)).on("focus",function(a){return function(){a._inputFocused=!0,a._refreshInputValue(a._value),a._finalReadOnly||a.addClass("focused"),a.fire("focus",a)}}(this)).on("blur",function(a){return function(){var b,c,d;a._inputFocused=!1,a.removeClass("focused"),a._refreshInputValue(a._value),a.fire("blur",a),(null==a._value||""===a._value&&(null!=(d=a._bindInfo)?d.writeable:void 0))&&(c=a.getBindingProperty(),(null!=c?c._required:void 0)&&c._validators&&(b=a._scope.get(a._bindInfo.entityPath),b&&b.validate(a._bindInfo.property)))}}(this)).on("keydown",function(a){return function(b){var c;return c={keyCode:b.keyCode,shiftKey:b.shiftKey,ctrlKey:b.ctrlKey,altlKey:b.altlKey,event:b},a.fire("keyDown",a,c)}}(this)).on("keypress",function(a){return function(b){var d;return d={keyCode:b.keyCode,shiftKey:b.shiftKey,ctrlKey:b.ctrlKey,altlKey:b.altlKey,event:b},a.fire("keyPress",a,d)!==!1&&13===b.keyCode&&E?c():void 0}}(this))},b.prototype._refreshInput=function(){var a,b;a=$fly(this._doms.input),this._name&&a.attr("name",this._name),a.attr("placeholder",this.get("placeholder")),a.prop("readOnly",this._finalReadOnly),null!=(b=this.get("actionButton"))&&b.set("disabled",this._finalReadOnly),a.prop("type","text").css("text-align","left"),this._refreshInputValue(this._value)},b.prototype.open=function(){var a,c;return b.__super__.open.call(this)?(c=this.get("value"),c||(a=new Date,c=a.getFullYear()+"-"+(a.getMonth()+1)),this._dataGrid.set("value",c),!0):void 0},b.prototype._getDropdownContent=function(){var a,b;return b=this,this._dropdownContent||(this._dataGrid=a=new cola.YearMonthGrid({cellClick:function(a){return function(a,c){return b.close(a.get("value"))}}(this)}),this._dropdownContent=a.getDom()),this._dropdownContent},b}(cola.CustomDropdown),cola.YearMonthPicker=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-monthpicker",b.CLASS_NAME="year-month input date drop",b}(cola.YearMonthDropDown),cola.TimeEditor=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.CLASS_NAME="ui time-editor",b.attributes={hour:{defaultValue:"00",refreshDom:!0},minute:{defaultValue:"00",refreshDom:!0},second:{defaultValue:"00",refreshDom:!0}},b.events={change:null},b.prototype._initDom=function(a){var b,c;return null==this._doms&&(this._doms={}),b=$.xCreate({"class":"time-wrapper",content:[{"class":"edit ui input",content:{tagName:"input","class":"hour",contextKey:"hour"}},{"class":"separator",content:":"},{"class":"edit ui input",content:{tagName:"input","class":"minute",contextKey:"minute"}},{"class":"separator",content:":"},{"class":"edit ui input",content:{tagName:"input","class":"second",contextKey:"second"}}]},this._doms),c=function(a){return function(b){return a["_"+b.className]=parseInt($(b).val()||"00"),a.fire("change",a,{hour:a._hour,minute:a._minute,second:a._second})}}(this),$(b).find("input").keyup(function(){var a,b,d;return d=this.value.replace(/[^\d]/g,""),37!==event.keyCode&&39!==event.keyCode?(8!==event.keyCode&&d&&(a=parseInt(this.value),38===event.keyCode?a++:40===event.keyCode&&a--,b="hour"===this.className?24:60,a>=b?this.value=b-1:0>=a?this.value=d.length>=2?"00":"0":a>0&&10>a?this.value=d.length>=2?"0"+a:a:this.value=a),c(this)):void 0}),a.appendChild(b)},b.prototype._doRefreshDom=function(){var a,c,d,e;for(b.__super__._doRefreshDom.call(this),d=["hour","minute","second"],c=0,a=d.length;a>c;c++)e=d[c],$fly(this._doms[e]).val(this["_"+e])},b}(cola.Widget),cola.registerWidget(cola.DatePicker),cola.registerWidget(cola.YearMonthDropDown),cola.registerWidget(cola.YearMonthPicker),E=/Trident\/7\./.test(navigator.userAgent),cola.Textarea=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.CLASS_NAME="input textarea",b.tagName="c-textarea",b.attributes={postOnInput:{type:"boolean",defaultValue:!1},placeholder:{refreshDom:!0},rows:{type:"number",refreshDom:!0},value:{setter:function(a){return this._dataType&&(a=this._dataType.parse(a)),this._setValue(a)}}},b.events={focus:null,blur:null,keyDown:null,keyPress:null},b.prototype.destroy=function(){this._destroyed||(b.__super__.destroy.call(this),delete this._doms)},b.prototype._bindSetter=function(a){var c;b.__super__._bindSetter.call(this,a),c=this.getBindingDataType(),c&&cola.DataType.dataTypeSetter.call(this,c)},b.prototype.focus=function(){var a;null!=(a=this._doms.input)&&a.focus()},b.prototype._initDom=function(a){var c,d;b.__super__._initDom.call(this,a),null==this._doms&&(this._doms={}),"TEXTAREA"!==a.nodeName?(d=$.xCreate({tagName:"textarea"}),this._doms.input=d,a.appendChild(d)):this._doms.input=a,c=function(a){return function(){var b,c;b=a._readOnly,b||(c=$(a._doms.input).val(),a.set("value",c))}}(this),$(this._doms.input).on("change",function(a){return function(){c()}}(this)).on("focus",function(a){return function(){a._inputFocused=!0,a._refreshInputValue(a._value),a._finalReadOnly||a.addClass("focused"),a.fire("focus",a)}}(this)).on("blur",function(a){return function(){var b,c,d;a._inputFocused=!1,a.removeClass("focused"),a._refreshInputValue(a._value),a.fire("blur",a),(null==a._value||""===a._value&&(null!=(d=a._bindInfo)?d.writeable:void 0))&&(c=a.getBindingProperty(),(null!=c?c._required:void 0)&&c._validators&&(b=a._scope.get(a._bindInfo.entityPath),b&&b.validate(a._bindInfo.property)))}}(this)).on("input",function(a){return function(){a._postOnInput&&c()}}(this)).on("keydown",function(a){return function(b){var c;return c={keyCode:b.keyCode,shiftKey:b.shiftKey,ctrlKey:b.ctrlKey,altlKey:b.altlKey,event:b},a.fire("keyDown",a,c)}}(this)).on("keypress",function(a){return function(b){var d;return d={keyCode:b.keyCode,shiftKey:b.shiftKey,ctrlKey:b.ctrlKey,altlKey:b.altlKey,event:b},a.fire("keyPress",a,d)!==!1&&13===b.keyCode&&E?c():void 0}}(this))},b.prototype._refreshInputValue=function(a){$fly(this._doms.input).val(null!=a?a+""||"":void 0)},b.prototype._doRefreshDom=function(){return this._dom?(b.__super__._doRefreshDom.call(this),this._refreshInputValue(this._value),$fly(this._doms.input).prop("readOnly",this._readOnly).attr("placeholder",this._placeholder),this._rows&&$fly(this._doms.input).attr("rows",this._rows)):void 0},b.prototype._resetDimension=function(){var a,b,c,d;a=this.get$Dom(),c=cola.constants.WIDGET_DIMENSION_UNIT,b=this.get("height"),isFinite(b)&&(b=""+parseInt(b)+c),b&&$fly(this._doms.input).css("height",b),
d=this.get("width"),isFinite(d)&&(d=""+parseInt(d)+c),d&&a.css("width",d)},b}(cola.AbstractEditor),cola.registerWidget(cola.Textarea),cola.SelectButton=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-select-button",b.CLASS_NAME="ui select-button buttons",b.attributes={items:{expressionType:"repeat",setter:function(a){var b,c,d,e,f,g;if("string"==typeof a)for(a=a.split(/[\,,\;]/),b=f=0,e=a.length;e>f;b=++f)d=a[b],c=d.indexOf("="),c>=0&&(a[b]={key:d.substring(0,c),value:d.substring(c+1)});this._valueProperty||this._textProperty||(g=cola.util.decideValueProperty(a),g&&(this._valueProperty=g.valueProperty,this._textProperty=g.textProperty)),this._items=a,this._itemsTimestamp!==(null!=a?a.timestamp:void 0)&&(a&&(this._itemsTimestamp=a.timestamp),delete this._itemsIndex)}},valueProperty:null,textProperty:null},b.prototype._initDom=function(a){var c;return b.__super__._initDom.call(this,a),c=this,$(a).delegate(".ui.button","click",function(){var a;if(!c._readOnly)return a=$(this).attr("value"),c._setValue($(this).attr("value")),c._select(a)})},b.prototype._doRefreshDom=function(){var a,c;return b.__super__._doRefreshDom.call(this),a=this._getItemsDom(),a&&($fly(this._dom).empty(),$fly(this._dom).append(a)),c=this._value,this._select(c)},b.prototype._select=function(a){var b;return b=$(this._dom),b.find(".positive").removeClass("positive"),b.find("[value='"+a+"']").addClass("positive")},b.prototype._getItemsDom=function(){var a,b,c,d,e,f,g,h,i,j;if(a=null!=(i=this._elementAttrBindings)?i.items:void 0)b=this._textProperty?"item."+this._textProperty:"item",c=this._valueProperty?"item."+this._valueProperty:"item",h=a.expression.raw,e=cola.xRender({tagName:"c-button","c-repeat":"item in "+h,"c-caption":b,"c-value":c},a.scope);else for(e=document.createDocumentFragment(),j=this._items,g=0,f=j.length;f>g;g++)d=j[g],e.appendChild($.xCreate({"class":"ui button",value:this._valueProperty?d[this._valueProperty]:d,content:this._textProperty?d[this._textProperty]:d}));return e},b}(cola.AbstractEditor),cola.registerWidget(cola.SelectButton),cola.Form=function(a){function b(a){this._messageHolder=new cola.Entity.MessageHolder,b.__super__.constructor.call(this,a)}return J(b,a),b.tagName="c-form",b.CLASS_NAME="form",b.attributes={bind:{setter:function(a){return this._bindSetter(a)}},defaultCols:{defaultValue:3},fields:{readOnlyAfterCreate:!0}},b.prototype._initDom=function(a){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(b.__super__._initDom.call(this,a),this._$messages=this.get$Dom().find("messages, .ui.message").addClass("messages"),this._fields){for(f=this.getBindingDataType(),e=[],m=this._defaultCols,g=1,s=m,r=this._fields,n=0,k=r.length;k>n;n++)h=r[n],f&&(p=f.getProperty(h.property)),p?(c=h.caption||p.get("caption")||h.property,q=p.get("dataType")):(c=h.caption||h.property,q=null),s+(h.cols||g)>m&&(s=0,j={tagName:"fields","class":"cols-"+m,content:[]},e.push(j)),i=h.editContent?[{tagName:"label",content:c},h.editContent]:"checkbox"===h.type||q instanceof cola.BooleanDataType?[{tagName:"label",content:c},{tagName:"c-checkbox",bind:this._bind+"."+h.property}]:"date"===h.type||q instanceof cola.DateDataType?[{tagName:"label",content:c},{tagName:"c-datepicker",bind:this._bind+"."+h.property}]:"textarea"===h.type?[{tagName:"label",content:c},{tagName:"c-textarea",bind:this._bind+"."+h.property,height:h.height||"4em"}]:[{tagName:"label",content:c},{tagName:"c-input",bind:this._bind+"."+h.property}],s+=h.cols||g,j.content.push({tagName:"field","class":"cols-"+(h.cols||g),property:h.property,content:i});for(e.push({tagName:"field",content:{tagName:"messages"}}),e=$.xCreate(e),o=0,l=e.length;l>o;o++)d=e[o],$(a).append(d),cola.xRender(d)}},b.prototype.setMessages=function(a){var b,c,d;if(a)for(this._messages=[],a instanceof Array||(a=[a]),d=0,b=a.length;b>d;d++)c=a[d],"string"==typeof c?this._messages.push({type:"error",text:c}):this._messages.push(c);else delete this._messages;this.refreshMessages()},b.prototype.refreshMessages=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(this._$messages.length){for(k=this._messageHolder,k.clear(),c=this._dom.querySelectorAll("field"),m=0,e=c.length;e>m;m++)b=c[m],a=cola.widget(b),(null!=a?a._message:void 0)&&k.add("$",null!=a?a._message:void 0);if(null!=(p=this._messages)?p.length:void 0)for(q=this._messages,n=0,f=q.length;f>n;n++)i=q[n],k.add("$",i);if(d=k.getKeyMessage(),r=null!=d?d.type:void 0,j=[],l=k.findMessages(null,r))for(o=0,g=l.length;g>o;o++)h=l[o],h.text&&j.push({tagName:"li",content:h.text});this._$dom.removeClass("error warning success").addClass(r),this._$messages.removeClass("error warning success").addClass(r).empty(),j.length>0&&this._$messages.xAppend({tagName:"ul","class":"list",content:j})}},b.prototype._refreshBindingValue=cola._EMPTY_FUNC,b}(cola.Widget),cola.Element.mixin(cola.Form,cola.DataWidgetMixin),cola.registerWidget(cola.Form),cola.Field=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="field",b.CLASS_NAME="field",b.attributes={bind:{setter:function(a){this._domParsed?this._bindSetter(a):this._bind=a}},property:null,message:{readOnly:!0,getter:function(){return this._messageDom?this._message:void 0}}},b.prototype._parseDom=function(a){var b,c,d,e,f,g,h,i,j,k;if(this._domParsed=!0,!this._bind&&this._property&&(a.parentNode&&("C-FORM"===a.parentNode.nodeName?this._formDom=a.parentNode:"C-FORM"===(null!=(h=a.parentNode.parentNode)?h.nodeName:void 0)&&(this._formDom=a.parentNode.parentNode)),this._formDom&&(this._form=cola.widget(this._formDom),d=null!=(i=this._form)?i._bind:void 0,c=d?d+"."+this._property:this._property)),c&&0===a.childElementCount&&(a.appendChild($.xCreate({tagName:"label"})),a.appendChild($.xCreate({tagName:"c-input",bind:c}))),this._labelDom=a.querySelector("label"),this._messageDom=a.querySelector("message"),c=c||this._bind,c&&(this._bind=null,this._bindSetter(c),g=this.getBindingProperty(),g&&(b=$fly(this._labelDom),b.text(g._caption||g._name),g._validators)))for(j=g._validators,f=0,e=j.length;e>f;f++)if(k=j[f],k instanceof cola.RequiredValidator){b.addClass("required");break}},b.prototype._filterDataMessage=function(a,b,c){return b===cola.constants.MESSAGE_VALIDATION_STATE_CHANGE||cola.constants.MESSAGE_REFRESH},b.prototype._processDataMessage=function(a,b,c){var d,e,f;(b===cola.constants.MESSAGE_VALIDATION_STATE_CHANGE||cola.constants.MESSAGE_REFRESH)&&(null!=(f=this._bindInfo)?f.writeable:void 0)&&(d=this._scope.get(this._bindInfo.entityPath),d instanceof cola.EntityList&&(d=d.current),d&&(e=d.getKeyMessage(this._bindInfo.property),this.setMessage(e)))},b.prototype.setMessage=function(a){var b,c;"string"==typeof a&&(a={type:"error",text:a}),this._message=a,this._messageDom&&(b=$fly(this._messageDom),b.removeClass("error warning success"),a?b.addClass(a.type).text(a.text):b.empty()),null!=(c=this._form)&&c.refreshMessages()},b}(cola.Widget),cola.Element.mixin(cola.Field,cola.DataWidgetMixin),cola.registerWidget(cola.Field),cola.AbstractItemGroup=function(a){function b(a){this._items=[],b.__super__.constructor.call(this,a)}return J(b,a),b.attributes={items:{setter:function(a){var b,c,d;for(this.clearItems(),d=0,c=a.length;c>d;d++)b=a[d],this.addItem(b);return this}},currentIndex:{type:"number",defaultValue:-1,setter:function(a){return this.setCurrentIndex(a),this}}},b.events={renderItem:null},b.prototype.getContentContainer=function(){return this.getDom()},b.prototype.getItems=function(){return this._items},b.prototype.getItemDom=function(a){var b,c;return b=a,"number"==typeof a&&(b=this._items[a]),b instanceof cola.Widget?c=b.getDom():1===b.nodeType&&(c=b),c},b.prototype._addItemToDom=function(a){var b,c;this._dom&&(b=this.getContentContainer(),c=this.getItemDom(a),c.parentNode!==b&&b.appendChild(c),this.fire("renderItem",this,{dom:c,item:a}))},b.prototype._itemsRender=function(){var a,b,c,d;if(this._items)for(d=this._items,c=0,b=d.length;b>c;c++)a=d[c],this._addItemToDom(a)},b.prototype.setCurrentIndex=function(a){var b,c;return null==this._currentIndex&&(this._currentIndex=-1),this._currentIndex===a?this:(this._currentIndex>-1&&(c=this.getItemDom(this._currentIndex),c&&$(c).removeClass("active")),a>-1&&(b=this.getItemDom(a),b&&$(b).addClass("active")),this._currentIndex=a,this)},b.prototype._doOnItemsChange=function(){return cola.util.delay(this,"_refreshItems",50,this.refreshItems)},b.prototype.refreshItems=function(){return cola.util.cancelDelay(this,"_refreshItems"),this},b.prototype.addItem=function(a){var b,c;return(c=cola.xRender(a,this._scope))?(b=cola.util.hasClass(c,"active"),null==this._items&&(this._items=[]),this._items.indexOf(c)>=0?void 0:(this._items.push(c),this._addItemToDom(c),b&&this.setCurrentIndex(this._items.indexOf(c)),this._doOnItemsChange(),c)):this},b.prototype.clearItems=function(){var a,b,c,d;if(0===this._items.length)return this;for(d=this._items,c=0,b=d.length;b>c;c++)a=d[c],a instanceof cola.Widget?a.destroy():$(a).remove();return this._items=[],this._doOnItemsChange(),this},b.prototype.removeItem=function(a){var b,c;return"number"==typeof a?(c=this._items[a],b=a):(c=a,b=this._items.indexOf(a)),this._items.splice(b,1),c instanceof cola.Widget?c.destroy():$(c).remove(),this._doOnItemsChange(),c},b.prototype.destroy=function(){return cola.util.cancelDelay(this,"_refreshItems"),this.clearItems(),delete this._items,b.__super__.destroy.call(this)},b}(cola.Widget),p=cola.Entity._getEntityId,cola.ItemsView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.attributes={allowNoCurrent:{type:"boolean",defaultValue:!0},currentItem:{getter:function(){var a;return this._currentItemDom&&(a=cola.util.userData(this._currentItemDom,"item")),a},setter:function(a){var b;a&&(b=this._itemDomMap[p(a)]),this._setCurrentItemDom(b)}},currentPageOnly:null,highlightCurrentItem:{type:"boolean",defaultValue:!0},focusable:{type:"boolean",refreshDom:!0,defaultValue:!0}},b.events={getItemTemplate:null,renderItem:null,itemClick:null,itemDoubleClick:null,itemPress:null},b.prototype._doSet=function(a,c,d){return(null!=c?c.refreshItems:void 0)&&(c.refreshDom=!0,this._refreshItemsScheduled=!0),b.__super__._doSet.call(this,a,c,d)},b.prototype._createDom=function(){var a;return null==this._doms&&(this._doms={}),a=$.xCreate({tagName:"div",content:{tagName:"ul",contextKey:"itemsWrapper"}},this._doms)},b.prototype._parseDom=function(a){var b,c,d,e;if(a){for(null==this._doms&&(this._doms={}),b=a.firstChild;b;)d=b.nextSibling,e=b.nodeName,c||"UL"!==e?"TEMPLATE"===e?this.regTemplate(b):a.removeChild(b):c=b,b=d;c||(c=document.createElement("ul"),a.appendChild(c)),this._doms.itemsWrapper=c}},b.prototype._initDom=function(a){var b;this._regDefaultTempaltes(),null==this._templateContext&&(this._templateContext={}),b=$fly(this._doms.itemsWrapper),b.addClass("items").delegate(".item","click",function(a){return function(b){return a._onItemClick(b)}}(this)).delegate(".item","dblclick",function(a){return function(b){return a._onItemDoubleClick(b)}}(this)),this._onItemsWrapperScroll&&b.on("scroll",function(a){return function(b){return a._onItemsWrapperScroll(b),!0}}(this)),this._focusable&&this.get$Dom().attr("tabIndex",1).on("keydown",function(a){return function(b){return a._onKeyDown(b)}}(this))},b.prototype.getItems=function(){return this._realItems},b.prototype._doRefreshDom=function(){this._dom&&(b.__super__._doRefreshDom.call(this),this._refreshItemsScheduled&&(delete this._refreshItemsScheduled,this._refreshItems()))},b.prototype._getItemType=function(a){var b,c;return c=this.fire("getItemTemplate",this,{item:a}),c?c:(null!=a?a.isDataWrapper:void 0)?(null!=(b=a._data)?b._itemType:void 0)||"default":a._itemType||"default"},b.prototype._onItemsRefresh=function(){return this._refreshItems()},b.prototype._onItemInsert=function(a){var b,c,d,e,f,g,h;this._realItems===this._realOriginItems?(this._refreshEmptyItemDom(),c=a.entity,e=this._getItemType(c),f=this._doms.itemsWrapper,b=a.insertMode,b&&"end"!==b?"begin"===b?(d=this._createNewItem(e,c),this._refreshItemDom(d,c),$fly(f.firstChild).before(d)):this._itemDomMap&&(h=p(a.refEntity),h&&(g=null!=this._itemDomMap[h],g&&(d=this._createNewItem(e,c),this._refreshItemDom(d,c),"before"===b?$fly(g).before(d):$fly(g).after(d)))):(d=this._createNewItem(e,c),this._refreshItemDom(d,c),$fly(f).append(d))):this._refreshItems()},b.prototype._onItemRemove=function(a){var b,c;c=p(a.entity),c&&(a.itemsScope.unregItemScope(c),b=this._itemDomMap[c],delete this._itemDomMap[c],b&&($fly(b).remove(),b===this._currentItemDom&&(this._currentItemDom=null))),this._refreshEmptyItemDom()},b.prototype._showLoadingTip=function(){var a,b;b=this._$loaderContainer,b?(b.remove(),b.appendTo(this._doms.itemsWrapper)):(a=$fly(this._doms.itemsWrapper),a.xAppend({"class":"loader-container protected",content:{"class":"ui loader"}}),this._$loaderContainer=b=a.find(">.loader-container")),b.addClass("active")},b.prototype._hideLoadingTip=function(){var a;null!=(a=this._$loaderContainer)&&a.removeClass("active")},b.prototype._onItemsLoadingStart=function(a){this._showLoadingTip()},b.prototype._onItemsLoadingEnd=function(a){this._hideLoadingTip()},b.prototype._setCurrentItemDom=function(a){this._currentItemDom&&$fly(this._currentItemDom).removeClass(cola.constants.COLLECTION_CURRENT_CLASS),this._currentItemDom=a,a&&this._highlightCurrentItem&&$fly(a).addClass(cola.constants.COLLECTION_CURRENT_CLASS)},b.prototype._getFirstItemDom=function(){var a;for(a=this._doms.itemsWrapper.firstChild;a;){if(a._itemType)return a;a=a.nextSibling}},b.prototype._getLastItemDom=function(){var a;for(a=this._doms.itemsWrapper.lastChild;a;){if(a._itemType)return a;a=a.previousSibling}},b.prototype._getPreviousItemDom=function(a){for(;a;)if(a=a.previousSibling,null!=a?a._itemType:void 0)return a},b.prototype._getNextItemDom=function(a){for(;a;)if(a=a.nextSibling,null!=a?a._itemType:void 0)return a},b.prototype._onCurrentItemChange=function(a){var b,c;return a.current&&this._itemDomMap&&(c=p(a.current),c&&(b=this._itemDomMap[c],!b))?void this._refreshItems():void this._setCurrentItemDom(b)},b.prototype._refreshItems=function(){return this._dom?this._doRefreshItems(this._doms.itemsWrapper):void(this._refreshItemsScheduled=!0)},b.prototype._doRefreshItems=function(a){var b,c,d,e,f,g,h,i,j;if(null==this._itemDomMap&&(this._itemDomMap={}),j=this._getItems(),f=j.items,this._realOriginItems=j.originItems,this._convertItems&&f&&(f=this._convertItems(f)),this._realItems=f,d=null,h=a.firstChild,b=null!=f?f.current:void 0,this._currentItemDom&&(b||(b=cola.util.userData(this._currentItemDom,"item")),$fly(this._currentItemDom).removeClass(cola.constants.COLLECTION_CURRENT_CLASS),delete this._currentItemDom),this._currentItem=b,this._itemsScope.resetItemScopeMap(),"function"==typeof this._refreshEmptyItemDom&&this._refreshEmptyItemDom(),g=null,f&&cola.each(f,function(b){return function(c){var e,f,i;if(g=c,i=b._getItemType(c),h){for(;h&&h._itemType!==i;)e=h.nextSibling,cola.util.hasClass(h,"protected")||a.removeChild(h),h=e;f=h,h&&(h=h.nextSibling)}else f=null;f?b._refreshItemDom(f,c):(f=b._createNewItem(i,c),b._refreshItemDom(f,c),null==d&&(d=document.createDocumentFragment()),d.appendChild(f))}}(this),{currentPage:this._currentPageOnly}),h)for(e=h;e;)h=e.nextSibling,cola.util.hasClass(e,"protected")||(a.removeChild(e),e._itemId&&delete this._itemDomMap[e._itemId]),e=h;delete this._currentItem,this._currentItemDom&&this._highlightCurrentItem&&$fly(this._currentItemDom).addClass(cola.constants.COLLECTION_CURRENT_CLASS),d&&a.appendChild(d),!this._currentPageOnly&&this._autoLoadPage&&(f===this._realOriginItems||!this._realOriginItems)&&f instanceof cola.EntityList&&f.pageSize>0&&(c=null!=g&&null!=(i=g._page)?i.pageNo:void 0,c&&(c<f.pageCount||!f.pageCountDetermined)&&(!this._loadingNextPage&&a.scrollHeight===a.clientHeight&&(a.scrollTop=0)?(this._showLoadingTip(),f.loadPage(c+1,function(a){return function(){a._hideLoadingTip()}}(this))):"function"==typeof this._appendTailDom&&this._appendTailDom(a)))},b.prototype._refreshItemDom=function(a,b,c){var d,e,f,g,h;null==c&&(c=this._itemsScope),b===this._currentItem?this._currentItemDom=a:this._currentItemDom||this._allowNoCurrent||(this._currentItemDom=a),(null!=b?b.isDataWrapper:void 0)?(h=b,b=b._data):h=b,"object"==typeof b&&(e=p(b)),d=b._alias,d||(d=null!=h?h._alias:void 0,null==d&&(d=this._alias)),this._templateContext.defaultPath=("function"==typeof this._getDefaultBindPath?this._getDefaultBindPath(h):void 0)||d,f=cola.util.userData(a,"scope"),g=cola.currentScope;try{if(f){if(cola.currentScope=f,f.data.getTargetData()!==b){if(a._itemId&&this._itemDomMap[a._itemId]===a&&delete this._itemDomMap[a._itemId],f.data.alias!==d)throw new cola.Exception('Repeat alias mismatch. Expect "'+f.alias+'" but "'+d+'".');cola.util.userData(a,"item",h),f.data.setTargetData(b)}"function"==typeof this._doRefreshItemDom&&this._doRefreshItemDom(a,b,f)}else f=new cola.ItemScope(c,d),cola.currentScope=f,f.data.setTargetData(b,!0),cola.util.userData(a,"scope",f),cola.util.userData(a,"item",h),"function"==typeof this._doRefreshItemDom&&this._doRefreshItemDom(a,b,f),cola.xRender(a,f,this._templateContext);e&&c.regItemScope(e,f),this.getListeners("renderItem")&&this.fire("renderItem",this,{item:h,dom:a,scope:f})}finally{cola.currentScope=g}return e&&(a._itemId=e,this._itemDomMap[e]=a),f},b.prototype.refreshItem=function(a){var b,c;c=p(a),b=this._itemDomMap[c],b&&"function"==typeof this._doRefreshItemDom&&this._doRefreshItemDom(b,a,this._itemsScope)},b.prototype._onItemRefresh=function(a){var b;b=a.entity,"object"==typeof b&&this.refreshItem(b)},b.prototype._findItemDom=function(a){for(var b;a;){if(a._itemType){b=a;break}a=a.parentNode}return b},b.prototype._onKeyDown=function(a){var b;switch(a.keyCode){case 38:return b=this._currentItemDom?this._getPreviousItemDom(this._currentItemDom):this._getFirstItemDom(),b&&this._setCurrentItemDom(b),!1;case 40:return b=this._currentItemDom?this._getNextItemDom(this._currentItemDom):this._getFirstItemDom(),b&&this._setCurrentItemDom(b),!1}},b.prototype._onItemClick=function(a){var b,c;c=a.currentTarget,c&&(b=cola.util.userData(c,"item"),"default"===c._itemType&&b&&(this._changeCurrentItem&&b.parent instanceof cola.EntityList?b.parent.setCurrent(b):this._setCurrentItemDom(c)),this.fire("itemClick",this,{event:a,item:b,dom:c}))},b.prototype._onItemDoubleClick=function(a){var b,c;c=a.currentTarget,c&&(b=cola.util.userData(c,"item"),this.fire("itemDoubleClick",this,{event:a,item:b,dom:c}))},b.prototype._bindEvent=function(a){return"itemPress"!==a?b.__super__._bindEvent.call(this,a):void this._on("press",function(a){return function(b,c){var d;d=a._findItemDom(c.event.target),d&&(c.itemDom=d,c.item=cola.util.userData(d,"item"),a.fire("itemPress",list,c))}}(this))},b}(cola.Widget),cola.Element.mixin(cola.ItemsView,cola.TemplateSupport),cola.Element.mixin(cola.ItemsView,cola.DataItemsWidgetMixin),cola.defineWidget({tagName:"c-breadcrumb",attributes:{bind:null},events:{itemClick:null},template:{"class":"ui breadcrumb",content:{tagName:"item","c-repeat":"item in @bind","c-onclick":"itemClick(item,$dom)",content:[{tagName:"a","c-bind":"item.text","c-href":"item.href||'#'","c-target":"item.target||'_black'"},{tagName:"i"}]}},itemClick:function(a,b){return this.fire("itemClick",this,{item:a,dom:b}),a.get("href")?void 0:event.preventDefault()}}),cola.CardBook=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-cardBook",b.CLASS_NAME="card-book",b.events={beforeChange:null,change:null},b.prototype._initDom=function(a){b.__super__._initDom.call(this,a),this._items&&this._itemsRender()},b.prototype._parseDom=function(a){},b.prototype.setCurrent=function(a){var b,c,d;if(this._dom)return b=this.get$Dom(),d=b.find(">[name='"+a+"']"),d.length>0&&(c=$(d).index(),this.setCurrentIndex(c)),this},b.prototype.setCurrentIndex=function(a){var b,c,d,e,f;if(null==this._currentIndex&&(this._currentIndex=-1),c={},this._dom){if(b=$(this._dom),d=b.find(">.item,>item"),f=b.find(">.item.active,>item.active")[0],d.length>a){if(e=d[a],e===f)return;if(this._currentIndex=a,c={oldItem:f,newItem:e},this.fire("beforeChange",this,c)===!1)return this;this._currentIndex=a,f&&$(f).removeClass("active"),e&&$(e).addClass("active"),this.fire("change",this,c)}}else this._currentIndex=a;return this},b}(cola.AbstractItemGroup),cola.registerWidget(cola.CardBook),cola.Carousel=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-carousel",b.CLASS_NAME="carousel",b.attributes={bind:{readonlyAfterCreate:!0,setter:function(a){a&&delete this._item,this._bindSetter(a)}},orientation:{defaultValue:"horizontal","enum":["horizontal","vertical"]},controls:{defaultValue:!0},pause:{defaultValue:3e3}},b.events={change:null,beforeChange:null},b.prototype.getContentContainer=function(){return this._doms.wrap||this._createItemsWrap(this._dom),this._doms.wrap},b.prototype._parseDom=function(a){var b,c,d;for(d=function(a){return function(b){var c;for(c=b.firstChild;c;)1===c.nodeType&&(a._items||(a._items=[]),a.addItem(c)),c=c.nextSibling}}(this),c=this._doms,b=a.firstChild;b;)1===b.nodeType&&(cola.util.hasClass(b,"items-wrap")?(c.wrap=b,d(b)):!c.indicators&&cola.util.hasClass(b,"indicators")?c.indicators=b:"TEMPLATE"===b.nodeName&&this.regTemplate(b)),b=b.nextSibling;c.indicators?this.refreshIndicators():this._createIndicatorContainer(a),c.wrap||this._createItemsWrap(a)},b.prototype._createIndicatorContainer=function(a){var b;return null==this._doms&&(this._doms={}),this._doms.indicators=$.xCreate({tagName:"div","class":"indicators indicators-"+this._orientation,contextKey:"indicators"}),b=this,a.appendChild(this._doms.indicators),$(this._doms.indicators).delegate(">span","click",function(){return b.goTo($fly(this).index())}),null},b.prototype._createItemsWrap=function(a){return null==this._doms&&(this._doms={}),this._doms.wrap=$.xCreate({tagName:"div","class":"items-wrap",contextKey:"wrap"}),a.appendChild(this._doms.wrap),null},b.prototype._initDom=function(a){var b,c,d;this._doms.indicators||this._createIndicatorContainer(a),this._doms.wrap||this._createItemsWrap(a),d=this.getTemplate(),b=this,d&&(this._bind&&$fly(d).attr("c-repeat",this._bind),this._doms.wrap.appendChild(d),cola.xRender(d,this._scope),c=function(a){return b._refreshItemsTimer&&clearTimeout(b._refreshItemsTimer),b._refreshItemsTimer=setTimeout(function(){return b.refreshItems()},100)},this._doms.wrap.addEventListener("DOMNodeRemoved",c,!1),this._doms.wrap.addEventListener("DOMNodeInserted",c,!1)),this._getDataItems().items&&(this._itemsRender(),this.refreshIndicators()),this.setCurrentIndex(0),b=this,setTimeout(function(){return b._scroller=new Swipe(b._dom,{vertical:"vertical"===b._orientation,disableScroll:!1,continuous:!1,callback:function(a){b.setCurrentIndex(a)}})},0),cola.device.desktop&&this._controls&&a.appendChild($.xCreate({tagName:"div","class":"controls",content:[{tagName:"A","class":"prev",click:function(a){return function(){return a.replay(),b.previous()}}(this)},{tagName:"A","class":"next",click:function(a){return function(){return a.replay(),b.next()}}(this)}]}))},b.prototype._getDataItems=function(){return this._bind?this._getItems():{items:this._items}},b.prototype.setCurrentIndex=function(a){var b,c,d;if(!isNaN(a)&&this._currentIndex!==a&&this.fire("beforeChange",this,{index:a})!==!1){if(this._currentIndex=a,this._dom){if(this._doms.indicators)try{$(".active",this._doms.indicators).removeClass("active"),b=this._doms.indicators.children[a],null!=b&&(b.className="active")}catch(e){c=e}this._scroller&&(d=this._scroller.getPos(),d!==a&&this._scroller.slide(a))}return this.fire("change",this,{index:a}),this}},b.prototype.refreshIndicators=function(){var a,b,c,d,e,f,g;if(d=this._getDataItems().items,e=d?d instanceof cola.EntityList?d.entityCount:d.length:0,null!=(f=this._doms)?f.indicators:void 0){if($(this._doms.indicators).find(">span").remove(),c=0,e>c)for(b=c;e>b;)g=document.createElement("span"),b>0?$($(this._doms.indicators).find(">span")[b-1]).before(g):$fly(this._doms.indicators).prepend(g),b++;return null==this._currentIndex&&(this._currentIndex=-1),a=this._currentIndex,$("span",this._doms.indicators).removeClass("active"),-1!==a&&$("span:nth-child("+(a+1)+")",this._doms.indicators).addClass("indicator-active"),this}},b.prototype.next=function(){var a;return a=this._getDataItems().items,a&&this._scroller&&this._scroller.next(),this},b.prototype.previous=function(){var a;return a=this._getDataItems().items,a&&this._scroller&&this._scroller.prev(),this},b.prototype.refreshItems=function(){var a;return b.__super__.refreshItems.call(this),null!=(a=this._scroller)&&a.refresh(),this.refreshIndicators(),this.setCurrentIndex(0),this},b.prototype._doRefreshDom=function(){this._dom&&(b.__super__._doRefreshDom.call(this),this._classNamePool.add("carousel-"+this._orientation),this.refreshIndicators())},b.prototype._onItemsRefresh=function(a){return this._itemDomsChanged()},b.prototype._onItemInsert=function(a){return this._itemDomsChanged()},b.prototype._onItemRemove=function(a){return this._itemDomsChanged()},b.prototype._itemDomsChanged=function(){},b.prototype.play=function(a){var b;return this._interval&&clearInterval(this._interval),b=this,a&&(this._pause=a),this._interval=setInterval(function(){return b.next()},this._pause),this},b.prototype.replay=function(){return this._interval?this.play():void 0},b.prototype.pause=function(){return this._interval&&clearInterval(this._interval),this},b.prototype.goTo=function(a){return null==a&&(a=0),this.replay(),this.setCurrentIndex(a)},b}(cola.AbstractItemGroup),cola.Element.mixin(cola.Carousel,cola.TemplateSupport),cola.Element.mixin(cola.Carousel,cola.DataItemsWidgetMixin),cola.registerWidget(cola.Carousel),cola.Menu=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-menu",b.CLASS_NAME="ui menu",b.CHILDREN_TYPE_NAMESPACE="menu",b.SEMANTIC_CLASS=["top fixed","right fixed","bottom fixed","left fixed"],b.attributes={items:{setter:function(a){var b,c,d,e;if(this._items&&this.clearItems(),a){for(e=[],d=0,c=a.length;c>d;d++)b=a[d],e.push(this.addItem(b));return e}}},showActivity:{type:"boolean",defaultValue:!1},rightItems:{setter:function(a){var b,c,d,e;if(this._rightItems&&this.clearRightItems(),a){for(e=[],d=0,c=a.length;c>d;d++)b=a[d],e.push(this.addRightItem(b));return e}}},centered:{type:"boolean",defaultValue:!1}},b.events={itemClick:null},b.prototype._parseItems=function(a){var b,c,d,e;for(d=function(a){return function(b){var c,d;for(c=b.firstChild,null==a._rightItems&&(a._rightItems=[]);c;)1===c.nodeType&&(d=cola.widget(c),d?a.addRightItem(d):cola.util.hasClass(c,"item")&&(d=new cola.menu.MenuItem({dom:c}),a.addRightItem(d))),c=c.nextSibling}}(this),b=a.firstChild,e=[];b;)1===b.nodeType&&(c=cola.widget(b),c?this.addItem(c):!this._rightMenuDom&&cola.util.hasClass(b,"right menu")?(this._rightMenuDom=b,d(b)):cola.util.hasClass(b,"item")&&(c=new cola.menu.MenuItem({dom:b}),this.addItem(c))),e.push(b=b.nextSibling);return e},b.prototype._parseDom=function(a){var b;null==this._items&&(this._items=[]),b=$(a).find(">.container"),b.length?(this._centered=!0,this._containerDom=b[0],this._parseItems(this._containerDom)):this._parseItems(a)},b.prototype._doRefreshDom=function(){this._dom&&(b.__super__._doRefreshDom.call(this),$(this._containerDom).toggleClass("ui container",!!this._centered),this._isSubMemu&&this._classNamePool.remove("ui"))},b.prototype._initDom=function(a){var b,c,d,e,f,g,h,i,j,k,l;if(h=this._items,l=this._rightItems,g=this,h)for(b=this._getItemsContainer(),i=0,e=h.length;e>i;i++)c=h[i],d=c.getDom(),d.parentNode!==b&&b.appendChild(d);if(l)for(this._rightMenuDom||(this._rightMenuDom=this._createRightMenu(),a.appendChild(this._rightMenuDom)),j=0,f=l.length;f>j;j++)c=l[j],k=c.getDom(),k.parentNode!==this._rightMenuDom&&this._rightMenuDom.appendChild(k);$(a).prepend($.xCreate({tagName:"div","class":"left-items"})).hover(function(){return g._bindToSemantic()}).delegate(">.item,.right.menu>.item","click",function(){return g._setActive(this)}),setTimeout(function(){g._bindToSemantic()},300)},b.prototype._bindToSemantic=function(){var a;this._parent instanceof cola.menu.MenuItem||(a=this.get$Dom(),a.find(">.dropdown.item,.right.menu>.dropdown.item").each(function(a){return function(a,b){var c;return c=$(b),c.hasClass("c-dropdown")?void 0:(c.addClass("c-dropdown"),c.find(".dropdown.item").addClass("c-dropdown"),c.dropdown({on:"hover"}))}}(this)))},b.prototype._setDom=function(a,c){b.__super__._setDom.call(this,a,c),this._activeItem&&this._setActive(this._activeItem.getDom())},b.prototype.setActiveItem=function(a){a.get("active")||a.set("active",!0),this._activeItem=a,this._rendered&&this._setActive(a.getDom())},b.prototype.getActiveItem=function(){return this._activeItem},b.prototype._setActive=function(a){this._parent&&this._parent instanceof cola.menu.DropdownMenuItem||this._showActivity&&($(">a.item:not(.dropdown),.right.menu>a.item:not(.dropdown)",this._dom).each(function(){a===this?$fly(this).addClass("active"):$fly(this).removeClass("active").find(".item").removeClass("active")}),$fly(a).hasClass("dropdown")||$(">.menu",a).length&&!this._isSubMemu&&$fly(a).removeClass("active"))},b.prototype._getItemsContainer=function(){return this._centered&&(this._containerDom||(this._containerDom=$.xCreate({tagName:"div","class":"container"}),this._dom.appendChild(this._containerDom))),this._containerDom||this._dom},b.prototype.getParent=function(){return this._parent},b.prototype.onItemClick=function(a,b){var c,d;d=this.getParent(),c={item:b,event:a},this.fire("itemClick",this,c),d&&(d instanceof cola.menu.AbstractMenuItem||d instanceof cola.Menu||d instanceof cola.Button)&&d.onItemClick(a,b)},b.prototype._createItem=function(a,b){var c;return c=null,a.constructor===Object.prototype.constructor?c=a.$type?"dropdown"===a.$type?new cola.menu.DropdownMenuItem(a):new cola.menu.MenuItem({content:a,type:"container"}):new cola.menu.MenuItem(a):a instanceof cola.menu.AbstractMenuItem&&(c=a),c},b.prototype.addItem=function(a){var b,c,d,e;return(e=this._createItem(a))?(e._parent=this,null==this._items&&(this._items=[]),this._items.push(e),b=e.get("active"),b&&(this._activeItem=e),this._dom&&(c=this._getItemsContainer(),d=e.getDom(),d.parentNode!==c&&(this._rightMenuDom?$(this._rightMenuDom).before(d):c.appendChild(d))),d):void 0},b.prototype.addRightItem=function(a){var b,c,d,e;return(e=this._createItem(a,!0))?(e._parent=this,null==this._rightItems&&(this._rightItems=[]),this._rightItems.push(e),b=e.get("active"),b&&(this._activeItem=e),this._dom&&(c=this._getItemsContainer(),d=e.getDom(),this._rightMenuDom||(this._rightMenuDom=this._createRightMenu(),c.appendChild(this._rightMenuDom)),d.parentNode!==this._rightMenuDom&&this._rightMenuDom.appendChild(d)),d):this},b.prototype.clearItems=function(){var a,b,c,d;if(c=this._items,null!=c?c.length:void 0){for(d=0,b=c.length;b>d;d++)a=c[d],a.destroy();this._items=[]}return this},b.prototype.clearRightItems=function(){var a,b,c,d;if(c=this._rightItems,null!=c?c.length:void 0){for(d=0,b=c.length;b>d;d++)a=c[d],a.destroy();this._rightItems=[]}return this},b.prototype._doRemove=function(a,b){var c;c=a.indexOf(b),c>-1&&(a.splice(c,1),b.destroy())},b.prototype.removeItem=function(a){var b;return(b=this._items)?("number"==typeof a&&(a=b[a]),a&&this._doRemove(b,a),this):this},b.prototype.removeRightItem=function(a){var b;return(b=this._rightItems)?("number"==typeof a&&(a=b[a]),a&&this._doRemove(b,a),this):this},b.prototype.getItem=function(a){var b;return null!=(b=this._items)?b[a]:void 0},b.prototype.getRightItem=function(a){var b;return null!=(b=this._rightItems)?b[a]:void 0},b.prototype._createRightMenu=function(){return $.xCreate({tagName:"DIV","class":"right menu"})},b.prototype.destroy=function(){return this._destroyed?void 0:(b.__super__.destroy.call(this),
delete this._activeItem,this.clearRightItems(),this.clearItems(),delete this._containerDom,this)},b}(cola.Widget),cola.registerWidget(cola.Menu),null==cola.menu&&(cola.menu={}),cola.menu.AbstractMenuItem=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.attributes={parent:null,disabled:{type:"boolean",refreshDom:!0,defaultValue:!1},active:{type:"boolean",defaultValue:!1,setter:function(a){var b;return b=this._active,this._active=a,b!==a&&a?this.onActive(this):void 0},getter:function(){return!this._active&&this._rendered&&(this._active=this.get$Dom().hasClass("active")),this._active}}},b.prototype.onItemClick=function(a,b){var c;c=this._parent,c instanceof cola.Menu&&c.onItemClick(a,b)},b.prototype.onActive=function(a){var b;return b=this._parent,b instanceof cola.Menu?b.setActiveItem(a):void 0},b.prototype.getParent=function(){return this._parent},b.prototype.hasSubMenu=function(){return!!this._subMenu},b.prototype._doRefreshDom=function(){var a;this._dom&&(b.__super__._doRefreshDom.call(this),a=this._classNamePool,a.toggle("disabled",this._disabled))},b.prototype.destroy=function(){return this._destroyed?void 0:(b.__super__.destroy.call(this),delete this._parent)},b}(cola.AbstractContainer),cola.menu.MenuItem=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="a,item",b.parentWidget=cola.Menu,b.CLASS_NAME="item",b.attributes={caption:{refreshDom:!0},icon:{refreshDom:!0},href:{refreshDom:!0},target:{refreshDom:!0},type:null,items:{setter:function(a){return this._resetSubMenu(a)},getter:function(){var a;return null!=(a=this._subMenu)?a.get("items"):void 0}}},b.prototype._parseDom=function(a){var b,c;for(b=a.firstChild,null==this._doms&&(this._doms={});b;)1===b.nodeType&&(c=cola.widget(b),c instanceof cola.Menu?(this._subMenu=c,c._isSubMemu=!0):"I"===b.nodeName?(this._doms.iconDom=b,null==this._icon&&(this._icon=b.className)):cola.util.hasClass(b,"caption")&&(this._doms.captionDom=b)),b=b.nextSibling;this._doms.captionDom||(this._doms.captionDom=$.xCreate({tagName:"span",content:this._caption||""}),this._doms.iconDom?$fly(this._doms.iconDom).after(this._doms.captionDom):$fly(a).prepend(this._doms.captionDom))},b.prototype.fire=function(a,c,d){return this._$dom&&"click"===a&&this._$dom.hasClass("disabled")?void 0:b.__super__.fire.call(this,a,c,d)},b.prototype._initDom=function(a){var c;b.__super__._initDom.call(this,a),null==this._$dom&&(this._$dom=$(a)),this._$dom.click(function(a){return function(b){return a._subMenu?void 0:a._$dom.hasClass("disabled")?!1:a.onItemClick(b,a)}}(this)),this._subMenu&&(c=this._subMenu.getDom(),c.parentNode!==a&&a.appendChild(c))},b.prototype._setDom=function(a,c){var d,e;return c&&(this._href||(d=a.getAttribute("href"),d&&(this._href=d)),this._target||(e=a.getAttribute("target"),e&&(this._target=e))),b.__super__._setDom.call(this,a,c)},b.prototype._createDom=function(){var a,b,c;return b=this.get("icon")||"",a=this.get("caption")||"",c="container"===this._type?"item":"a",$.xCreate({tagName:c,"class":this.constructor.CLASS_NAME,content:[{tagName:"span",content:a,contextKey:"captionDom"}]},this._doms)},b.prototype._refreshIcon=function(){var a;return a=this.get$Dom(),this._icon&&!this._caption&&this._classNamePool.add("icon"),this._icon?(this._doms.iconDom||(this._doms.iconDom=$.xCreate({tagName:"i","class":"icon"})),this._doms.iconDom.parentNode!==this._dom&&a.prepend(this._doms.iconDom),$fly(this._doms.iconDom).addClass(this._icon)):$fly(this._doms.iconDom).remove()},b.prototype._doRefreshDom=function(){var a,c;this._dom&&(b.__super__._doRefreshDom.call(this),a=this.get$Dom(),a.find(">.ui.menu").removeClass("ui"),this._refreshIcon(),$fly(this._doms.captionDom).text(this._caption||""),this._subMenu&&(c=this._subMenu.getDom(),c.parentNode!==this._dom&&this._dom.appendChild(c)),this._href?a.attr("href",this._href):a.removeAttr("href"),a.attr("target",this._target||""))},b.prototype._resetSubMenu=function(a){var b;return null!=(b=this._subMenu)&&b.destroy(),a?(this._subMenu=new cola.Menu({items:a}),this._subMenu._parent=this,this._subMenu._isSubMemu=!0):delete this._subMenu},b.prototype.destroy=function(){var a;if(!this._destroyed)return null!=(a=this._subMenu)&&a.destroy(),b.__super__.destroy.call(this)},b}(cola.menu.AbstractMenuItem),cola.registerWidget(cola.menu.MenuItem),cola.menu.DropdownMenuItem=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="dropdown-item",b.parentWidget=cola.Menu,b.CLASS_NAME="dropdown item",b.attributes={icon:{refreshDom:!0,defaultValue:"dropdown"}},b.prototype._createDom=function(){var a;return a=this.get("caption")||"",$.xCreate({tagName:"DIV","class":this.constructor.CLASS_NAME,content:[{tagName:"span",content:a,contextKey:"captionDom"},{tagName:"i","class":"dropdown icon",contextKey:"iconDom"}]},this._doms)},b.prototype._refreshIcon=function(){return this._doms.iconDom||(this._doms.iconDom=document.createElement("i"),this._dom.appendChild(this._doms.iconDom)),this._doms.iconDom.className=(this._icon||"dropdown")+" icon"},b}(cola.menu.MenuItem),cola.registerWidget(cola.menu.DropdownMenuItem),cola.TitleBar=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-titleBar",b.CLASS_NAME="menu title-bar",b.CHILDREN_TYPE_NAMESPACE="menu",b.attributes={title:{refreshDom:!0}},b.prototype._parseDom=function(a){var c,d;for(c=a.firstChild,null==this._doms&&(this._doms={});c;){if(1===c.nodeType&&!this._doms.title&&cola.util.hasClass(c,"title")){this._doms.title=c,null==this._title&&(this._title=cola.util.getTextChildData(c));break}c=c.nextSibling}b.__super__._parseDom.call(this,a),d=a.children[0],this._doms.title&&d!==this._doms.title&&($(this._doms.title).remove(),$(d).before(this._doms.title))},b.prototype._doRefreshDom=function(){return this._dom?(b.__super__._doRefreshDom.call(this),null==this._doms&&(this._doms={}),this._title?(this._doms.title||(this._doms.title=$.xCreate({tagName:"div","class":"title"}),this.get$Dom().prepend(this._doms.title)),$(this._doms.title).text(this._title)):$(this._doms.title).empty(),null):void 0},b}(cola.Menu),cola.registerWidget(cola.TitleBar),cola.registerType("menu","_default",cola.menu.MenuItem),cola.registerType("menu","item",cola.menu.MenuItem),cola.registerType("menu","dropdownItem",cola.menu.DropdownMenuItem),cola.registerTypeResolver("menu",function(a){return cola.resolveType("widget",a)}),cola.ButtonMenu=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.prototype.onItemClick=function(a,b){var c;return null!=(c=this._parent)&&c.onItemClick(a,b),null},b.prototype._toDropDown=function(a){return this._parent instanceof cola.MenuButton||b.__super__._toDropDown.call(this,a),null},b}(cola.Menu),cola.MenuButton=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-menuButton",b.CLASS_NAME="dropdown button",b.attributes={menuItems:{setter:function(a){return this._resetMenu(a)},getter:function(){var a;return null!=(a=this._menu)?a.get("items"):void 0}}},b.events={menuItemClick:null},b.prototype._setDom=function(a,c){var d;b.__super__._setDom.call(this,a,c),this._menu&&(d=this._menu.getDom(),d.parentNode!==this._dom&&this._dom.appendChild(d)),this.get$Dom().dropdown()},b.prototype._parseDom=function(a){var b,c;for(b=a.firstChild;b;){if(1===b.nodeType&&(c=cola.widget(b),c&&c instanceof cola.Menu)){this._menu=c,c._parent=this;break}b=b.nextSibling}},b.prototype.onItemClick=function(a,b){this.fire("menuItemClick",this,{item:b,event:a})},b.prototype._resetMenu=function(a){var b;null!=(b=this._menu)&&b.destroy(),this._menu=new cola.ButtonMenu({items:a}),this._menu._parent=this,this._dom&&this.get$Dom().append(this._menu.getDom())},b.prototype.destroy=function(){var a;this._destroyed||(null!=(a=this._menu)&&a.destroy(),delete this._menu,b.__super__.destroy.call(this))},b.prototype.addMenuItem=function(a){var b;return null!=(b=this._menu)&&b.addItem(a),this},b.prototype.clearMenuItems=function(){var a;return null!=(a=this._menu)&&a.clearItems(),this},b.prototype.removeMenuItem=function(a){var b;return null!=(b=this._menu)&&b.removeItem(a),this},b.prototype.getMenuItem=function(a){var b;return null!=(b=this._menu)?b.getItem(a):void 0},b}(cola.Button),cola.registerWidget(cola.MenuButton),cola.registerType("menuButton","_default",cola.ButtonMenu),cola.registerType("menuButton","menu",cola.ButtonMenu),cola.registerTypeResolver("menuButton",function(a){return cola.resolveType("widget",a)}),cola.Shape=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-shape",b.CLASS_NAME="shape",b.attributes={bind:{readonlyAfterCreate:!0,setter:function(a){return this._bindSetter(a)}}},b.events={beforeChange:null,afterChange:null},b.directions=["up","down","left","right","over","back"],b.prototype.getContentContainer=function(){return this._doms.wrap||this._createItemsWrap(dom),this._doms.wrap},b.prototype._createItemsWrap=function(a){return null==this._doms&&(this._doms={}),this._doms.wrap=$.xCreate({tagName:"div","class":"sides"}),a.appendChild(this._doms.wrap),null},b.prototype.setCurrentIndex=function(a){var b,c,d,e;if(this._currentIndex=a,this._dom){if(b=this._current,this._doms){if(d=$(this._doms.wrap).find(".side"),b&&(c=d.index(b),console.log(c),a===c))return;d.removeClass("active"),e=d.eq(a).addClass("active")}return this}},b.prototype._parseDom=function(a){var b,c,d;for(d=function(a){return function(b){var c;for(a._items=[],c=b.firstChild;c;)1===c.nodeType&&a.addItem(c),$fly(c).addClass("side"),c=c.nextSibling}}(this),null==this._doms&&(this._doms={}),c=this._doms,b=a.firstChild;b;)1===b.nodeType&&(cola.util.hasClass(b,"sides")?(c.wrap=b,d(b)):"TEMPLATE"===b.nodeName&&this.regTemplate(b)),b=b.nextSibling},b.prototype._initDom=function(a){var b,c;this._doms.wrap||this._createItemsWrap(a),c=this.getTemplate(),c&&(this._bind&&$fly(c).attr("c-repeat",this._bind),this._doms.wrap.appendChild(c),cola.xRender(c,this._scope)),this._items&&this._itemsRender(),b=this,setTimeout(function(){return $(a).shape({beforeChange:function(){b.fire("beforeChange",b,{current:b._current})},onChange:function(a){b._current=a,b.fire("afterChange",b,{current:a})}})},0),this.setCurrentIndex(0)},b.prototype.flip=function(a){var b;return null==a&&(a="right"),this.constructor.directions.indexOf(a)>=0&&(b=this.get$Dom(),b.shape("is animating")||b.shape("flip "+a)),this},b.prototype.setNextSide=function(a){return this._dom?(this.get$Dom().shape("set next side",a),this):void 0},b}(cola.AbstractItemGroup),cola.Element.mixin(cola.Shape,cola.TemplateSupport),cola.Element.mixin(cola.Shape,cola.DataItemsWidgetMixin),cola.registerWidget(cola.Shape),cola.Steps=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-steps",b.CHILDREN_TYPE_NAMESPACE="steps",b.CLASS_NAME="steps",b.SEMANTIC_CLASS=["tablet stackable","left floated","right floated"],b.attributes={size:{"enum":["mini","tiny","small","medium","large","big","huge","massive"],refreshDom:!0,setter:function(a){var b;b=this._size,b&&b!==a&&this._dom&&this.get$Dom().removeClass(b),this._size=a}},steps:{refreshDom:!0,setter:function(a){var b,c,d;for(this.clear(),c=0,b=a.length;b>c;c++)d=a[c],d instanceof cola.steps.Step?this.addStep(d):d.constructor===Object.prototype.constructor&&this.addStep(new cola.steps.Step(d))}},currentIndex:{type:"number",setter:function(a){return this._currentIndex=a,this.setCurrent(a)},getter:function(){return this._current&&this._steps?this._steps.indexOf(this._current):-1}},autoComplete:{type:"boolean",defaultValue:!0}},b.events={beforeChange:null,change:null,complete:null},b.prototype._doRefreshDom=function(){var a;if(this._dom)return b.__super__._doRefreshDom.call(this),a=this.get("size"),a?this._classNamePool.add(a):void 0},b.prototype._doRemove=function(a){var b;b=this._steps.indexOf(a),b>-1&&(this._steps.splice(b,1),a.remove())},b.prototype._setDom=function(a,c){var d,e,f,g,h,i;if(b.__super__._setDom.call(this,a,c),null!=(f=this._steps)?f.length:void 0)for(g=this._steps,e=0,d=g.length;d>e;e++)h=g[e],i=h.getDom(),i.parentNode!==this._dom&&h.appendTo(this._dom)},b.prototype._parseDom=function(a){var b,c;if(a)for(null==this._steps&&(this._steps=[]),b=a.firstChild;b;)1===b.nodeType&&(c=cola.widget(b),c&&c instanceof cola.steps.Step&&this.addStep(c)),b=b.nextSibling},b.prototype._doChange=function(a){var b,c,d;if(d=this._current,a>-1&&a<this._steps.length&&(c=this._steps[a]),d!==c){if(b={oldCurrent:d,newCurrent:c},this.fire("beforeChange",this,b)===!1)return void(c&&c.set("states",""));this._current=c,d&&d.set("states",""),c&&c.set("states","active"),a>=this._steps.length&&this.fire("complete",this,{}),this.fire("change",this,b),this._doComplete(a)}},b.prototype.getStep=function(a){var b;return null!=(b=this._steps)?b[a]:void 0},b.prototype.setCurrent=function(a){var b,c,d,e,f,g;if(b=a,"string"==typeof a){for(g=this._steps,d=f=0,e=g.length;e>f;d=++f)if(c=g[d],a===c.get("content")){b=d;break}}else a instanceof cola.steps.Step&&(b=this._steps.indexOf(a));return this._doChange(b),this},b.prototype._doComplete=function(a){var b,c,d;if(this._autoComplete){for(b=a-1;b>-1;)this._steps[b].set("states","completed"),b--;for(c=a+1,d=[];c<this._steps.length;)this._steps[c].set("states",""),d.push(c++);return d}},b.prototype.getCurrent=function(){return this._current},b.prototype.add=function(){var a,b,c,d;for(c=0,b=arguments.length;b>c;c++)a=arguments[c],d=a,d instanceof cola.steps.Step?this.addStep(d):d.constructor===Object.prototype.constructor&&this.addStep(new cola.steps.Step(d));return this},b.prototype.addStep=function(a){var b,c;return this._destroyed?this:(null==this._steps&&(this._steps=[]),a.constructor===Object.prototype.constructor&&(a=new cola.steps.Step(a)),a instanceof cola.steps.Step?this._steps.indexOf(a)>-1?this:(this._steps.push(a),this._dom&&(c=a.getDom(),c.parentNode!==this._dom&&a.appendTo(this._dom)),b=a.get("states"),"active"===b&&this._doChange(this._steps.length-1),this):this)},b.prototype.removeStep=function(a){return this._steps?("number"==typeof a&&(a=this._steps[a]),a&&this._doRemove(a),this):this},b.prototype.clear=function(){return this._steps?(this._dom&&this.get$Dom().empty(),this._steps.length&&(this._steps=[]),this):this},b.prototype.next=function(){var a;return a=this.get("currentIndex"),this.setCurrent(++a),this},b.prototype.complete=function(){return this.setCurrent(this._steps.length)},b.prototype.previous=function(){var a;return a=this.get("currentIndex"),this.setCurrent(--a),this},b.prototype.goTo=function(a){return this.setCurrent(a),this},b.prototype.getStepIndex=function(a){var b;return null!=(b=this._steps)?b.indexOf(a):void 0},b}(cola.Widget),cola.registerWidget(cola.Steps),null==cola.steps&&(cola.steps={}),cola.steps.Step=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="div",b.parentWidget=cola.Steps,b.CLASS_NAME="step",b.attributes={icon:{refreshDom:!0},content:{refreshDom:!0},states:{refreshDom:!0,"enum":["completed","active",""],defaultValue:"",setter:function(a){var b;return b=this._states,this._states=a,this._dom&&a!==b&&b&&$fly(this._dom).removeClass(b),this}},disabled:{type:"boolean",defaultValue:!1}},b.prototype._parseDom=function(a){var b,c,d,e,f,g,h,i,j,k;for(null==this._doms&&(this._doms={}),j=function(a){return function(b){var c,d;a._doms.title=b,d=cola.util.getTextChildData(b),c=a._content||{},!c.title&&d&&(null==a._content&&(a._content={}),a._doms.titleDom=b,a._content.title=d)}}(this),i=function(a){return function(b){var c,d;a._doms.description=b,d=cola.util.getTextChildData(b),c=a._content||{},d&&!c.description&&(null==a._content&&(a._content={}),a._doms.descriptionDom=b,a._content.description=d)}}(this),h=function(a){return function(b){var c;c=cola.util.getTextChildData(b),!a._content&&c&&(a._content=c)}}(this),e=a.firstChild;e;){if(1===e.nodeType)if("I"===e.nodeName)this._doms.iconDom=e,this._icon||(this._icon=e.className);else if(c=$(e),c.hasClass("content")){for(this._doms.contentDom=e,k=e.childNodes,g=0,f=k.length;f>g;g++)d=k[g],1===e.nodeType&&(b=$(d),b.hasClass("title")&&j(d),b.hasClass("description")&&i(d));this._content||h(e)}else c.hasClass("title")?j(e):c.hasClass("description")&&i(e);e=e.nextSibling}h(a)},b.prototype._doRefreshDom=function(){var a,c,d,e,f,g,h,i,j;if(this._dom)return b.__super__._doRefreshDom.call(this),null==this._doms&&(this._doms={}),i=this.get("content"),c=this.get$Dom(),c.empty(),j=this.get("icon"),j?(null==(d=this._doms).iconDom&&(d.iconDom=document.createElement("i")),this._doms.iconDom.className=j+" icon",c.append(this._doms.iconDom)):$fly(this._doms.iconDom).remove(),i&&(null==(e=this._doms).contentDom&&(e.contentDom=document.createElement("div")),a=$(this._doms.contentDom),a.addClass("content").empty(),"string"==typeof i?a.text(i):(i.title&&(null==(f=this._doms).titleDom&&(f.titleDom=document.createElement("div")),$fly(this._doms.titleDom).addClass("title").text(i.title),a.append(this._doms.titleDom)),i.description&&(null==(g=this._doms).descriptionDom&&(g.descriptionDom=document.createElement("div")),$fly(this._doms.descriptionDom).addClass("description").text(i.description),a.append(this._doms.descriptionDom))),c.append(a)),h=this._classNamePool,this._states&&h.add(this._states),h.toggle("disabled",this._disabled)},b.prototype.destroy=function(){return this._destroyed?void 0:(b.__super__.destroy.call(this),delete this._doms)},b}(cola.Widget),cola.registerWidget(cola.steps.Step),cola.registerType("steps","_default",cola.steps.Step),cola.registerType("steps","Step",cola.steps.Step),cola.registerTypeResolver("steps",function(a){return cola.resolveType("widget",a)}),cola.Stack=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-stack",b.CLASS_NAME="stack",b.attributes={touchable:{defaultValue:!0,refreshDom:!0,type:"boolean"}},b.events={change:null,beforeChange:null},b.duration=200,b.prototype._initDom=function(a){var b,c;null==this._doms&&(this._doms={}),b=this.getItemsWrap(),this._doms.prevItem||(this._doms.prevItem=$.xCreate({"class":"prev item"}),$fly(b).prepend(this._doms.prevItem)),this._doms.currentItem||(this._doms.currentItem=$.xCreate({"class":"current item"}),$fly(this._doms.prevItem).after(this._doms.currentItem)),this._doms.nextItem||(this._doms.nextItem=$.xCreate({"class":"next item"}),$fly(this._doms.currentItem).after(this._doms.nextItem)),this._prevItem=this._doms.prevItem,this._currentItem=this._doms.currentItem,this._nextItem=this._doms.nextItem,c=this._currentItem.clientWidth,$fly(this._currentItem).css({display:"block"}),this._bindTouch(),$fly(this._currentItem).css("transform","translate(-"+c+"px,0)")},b.prototype._parseDom=function(a){var b,c,d,e;for(d=function(a){return function(b){var c;for(a._items=[],c=b.firstChild;c;)1===c.nodeType&&($fly(c).hasClass("prev")?a._doms.prevItem=c:$fly(c).hasClass("current")?a._doms.currentItem=c:$fly(c).hasClass("next")&&(a._doms.nextItem=c)),c=c.nextSibling}}(this),c=this._doms,b=a.firstChild,e=[];b;)1===b.nodeType&&cola.util.hasClass(b,"items-wrap")&&(c.wrap=b,d(b)),e.push(b=b.nextSibling);return e},b.prototype.getItemContainer=function(a){return this["_"+a+"Item"]},b.prototype.getItemsWrap=function(){var a;return this._doms.itemsWrap||(a=$.xCreate({"class":"items-wrap"}),this._doms.itemsWrap=a,this._dom.appendChild(a)),this._doms.itemsWrap},b.prototype._setDom=function(a,c){return b.__super__._setDom.call(this,a,c)},b.prototype._bindTouch=function(){var a;return a=this,this._touchable?($(this._dom).on("touchstart",function(b){a._onTouchStart(b)}).on("touchmove",function(b){a._onTouchMove(b)}),$(window.document.body).on("touchend",function(b){a._onTouchEnd(b)})):void 0},b.prototype._getTouchPoint=function(a){var b;return b=a.originalEvent.touches,b.length||(b=a.originalEvent.changedTouches),b[0]},b.prototype._onTouchStart=function(a){var b;return this._touchStart=!0,b=a.originalEvent.touches[0],this._touchStartX=b.pageX,this._touchStartY=b.pageY,this._moveTotal=0,this._touchTimestamp=new Date,a.stopImmediatePropagation(),this},b.prototype._onTouchMove=function(a){var b,c,d,e,f,g,h;if(this._touchStart&&(g=this._getTouchPoint(a),this._touchLastX=g.pageX,this._touchLastY=g.pageY,c=this._touchLastX-this._touchStartX,d=this._touchLastY-this._touchStartY,f=new Date,this._touchMoveSpeed=c/(f-this._touchLastTimstamp),this._touchLastTimstamp=f,0>c?(b="left",e=1):(b="right",e=-1),this._touchDirection=b,this._factor=e,h=this._currentItem.clientWidth,this._distanceX=Math.abs(c),this._moveTotal=(this._moveTotal||0)+Math.abs(c),!(this._moveTotal<8)))return $fly(this._currentItem).css("transform","translate("+c+"px,0)"),"left"===b?($fly(this._prevItem).css("display","none"),$fly(this._nextItem).css({transform:"translate("+(h+c)+"px,0)",display:"block"})):($fly(this._nextItem).css("display","none"),$fly(this._prevItem).css({transform:"translate("+(e*h+c)+"px,0)",display:"block"})),a.stopImmediatePropagation(),!1},b.prototype._onTouchEnd=function(a){var b,c,d,e;if(this._touchStart){if(c=this.constructor.duration,e=this._currentItem.clientWidth,this._touchStart=!1,d=function(a){return function(){$(a._currentItem).transit({x:0,duration:c}),"left"===a._touchDirection?$(a._nextItem).transit({x:e,duration:c}):$(a._prevItem).transit({x:-1*e,duration:c})}}(this),this._moveTotal<8)return void d();if(b={current:this._currentItem,prev:this._prevItem,next:this._nextItem,action:"over"},this._distanceX>e/3)if("left"===this._touchDirection){if(this.fire("beforeChange",this,b)===!1)return void d();$(this._currentItem).transit({x:-1*e,duration:c}),$(this._nextItem).transit({x:0,duration:c}),this._doNext()}else{if(b.action="back",this.fire("beforeChange",this,b)===!1)return void d();$(this._currentItem).transit({x:e,duration:c}),$(this._prevItem).transit({x:0,duration:c}),this._doPrev()}else d()}},b.prototype.next=function(){var a,b,c,d;if(!this._animating&&(a={current:this._currentItem,prev:this._prevItem,next:this._nextItem,action:"over"},this.fire("beforeChange",this,a)!==!1))return this._animating=!0,d=this._currentItem.clientWidth,c=this,b=this.constructor.duration,$fly(this._nextItem).css({transform:"translate("+d+"px,0)",display:"block"}),$(this._currentItem).transit({x:-1*d,duration:2*b,complete:function(){return c._animating=!1,$(c._currentItem).css("display","none"),c._doNext()}}),$(this._nextItem).transit({x:0,duration:2*b}),this},b.prototype.prev=function(){var a,b,c,d;if(!this._animating&&(a={current:this._currentItem,prev:this._prevItem,next:this._nextItem,action:"back"},this.fire("beforeChange",this,a)!==!1))return this._animating=!0,d=this._currentItem.clientWidth,c=this,b=this.constructor.duration,$fly(this._prevItem).css({transform:"translate(-"+d+"px,0)",display:"block"}),$(this._currentItem).transit({x:d,duration:2*b,complete:function(){return $(c._currentItem).css("display","none"),c._animating=!1,c._doPrev()}}),$(this._prevItem).transit({x:0,duration:2*b}),this},b.prototype._doNext=function(){var a,b,c;return c=this._prevItem,a=this._currentItem,b=this._nextItem,this._prevItem=a,this._nextItem=c,this._currentItem=b,this.fire("change",this,{current:this._currentItem,prev:this._prevItem,next:this._nextItem,action:"over"}),null},b.prototype._doPrev=function(){var a,b,c;return c=this._prevItem,a=this._currentItem,b=this._nextItem,this._prevItem=b,this._nextItem=a,this._currentItem=c,this.fire("change",this,{current:this._currentItem,prev:this._prevItem,next:this._nextItem,action:"back"}),null},b}(cola.Widget),cola.registerWidget(cola.Stack),cola.AbstractList=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.attributes={currentPageOnly:{type:"boolean"},autoLoadPage:{type:"boolean"},changeCurrentItem:{type:"boolean",defaultValue:!0},pullDown:{readOnlyAfterCreate:!0},pullUp:{readOnlyAfterCreate:!0},filterCriteria:{refreshItems:!0}},b.events={pullStart:null,pullStep:null,pullComplete:null,pullCancel:null,filterItem:{singleListener:!0}},b.prototype.destroy=function(){b.__super__.destroy.call(this),delete this._emptyItemDom},b.prototype._appendTailDom=function(a){$fly(a).xAppend({"class":"tail-padding",content:{"class":"ui loader"}})},b.prototype._onItemsWrapperScroll=function(){var a,b;b=this._realItems,this._currentPageOnly||!this._autoLoadPage||this._loadingNextPage||b!==this._realOriginItems&&this._realOriginItems||b instanceof cola.EntityList&&b.pageSize>0&&(b.pageNo<b.pageCount||!b.pageCountDetermined)&&(a=this._doms.itemsWrapper,Math.abs(a.scrollTop+a.clientHeight-a.scrollHeight)<6&&(this._loadingNextPage=!0,$fly(a).find(">.tail-padding >.ui.loader").addClass("active"),b.loadPage(b.pageNo+1,function(b){return function(){b._loadingNextPage=!1,$fly(a).find(">.tail-padding >.ui.loader").removeClass("active")}}(this))))},b.prototype._convertItems=function(a){var b;return this.getListeners("filterItem")?(b={filterCriteria:this._filterCriteria},a=cola.util.filter(a,function(a){return function(c){return b.item=c,a.fire("filterItem",a,b)}}(this))):this._filterCriteria&&(a=cola.util.filter(a,this._filterCriteria)),a},b.prototype._refreshEmptyItemDom=function(){var a,b,c;a=this._emptyItemDom=this.getTemplate("empty-item"),a&&(b=this._realItems,b instanceof cola.EntityList&&0===b.entityCount||b instanceof Array&&0===b.length?($fly(a).show(),c=this._doms.itemsWrapper,a.parentNode!==c&&($fly(a).addClass("protected"),cola.xRender(a,this._scope),c.appendChild(a))):$fly(a).hide())},b.prototype._doRefreshItems=function(a){var c,d,e;b.__super__._doRefreshItems.call(this,a),void 0===this._pullAction&&(this._pullAction=null,this._pullDown&&(c=!0,d=this.getTemplate("pull-down-pane"),null==d&&(d=$.xCreate({tagName:"div"})),this._doms.pullDownPane=d),this._pullUp&&(c=!0,e=this.getTemplate("pull-up-pane"),null==e&&(e=$.xCreate({tagName:"div"})),this._doms.pullUpPane=e),c&&cola.util.delay(this,"createPullAction",200,this._createPullAction))},b.prototype._createPullAction=function(){this._pullAction=new cola.PullAction(this._doms.itemsWrapper,{pullDownPane:this._doms.pullDownPane,pullUpPane:this._doms.pullUpPane,pullStart:function(a){return function(b,c,d){var e;return a.getListeners("pullStart")?a.fire("pullStart",a,{event:b,pullPane:c,direction:d}):"up"===d&&!a.getListeners("pullComplete")&&(e=a._realItems,e instanceof cola.EntityList)?e.pageNo<e.pageCount:void 0}}(this),pullStep:function(a){return function(b,c,d,e,f){return a.fire("pullStep",a,{event:b,pullPane:c,direction:d,distance:e,theshold:f})}}(this),pullComplete:function(a){return function(b,c,d,e){var f;a.fire("pullComplete",a,{event:b,pullPane:c,direction:d,done:e})!==!1&&("down"===d?(f=a._realOriginItems||a._realItems,f instanceof cola.EntityList?f.flush(e):e()):"up"===d&&(f=a._realItems,f instanceof cola.EntityList?f.nextPage(e):e()))}}(this),pullCancel:function(a){return function(b,c,d){return a.fire("pullCancel",a,{event:b,pullPane:c,direction:d})}}(this)})},b}(cola.ItemsView),i=cola.os.android&&!cola.browser.chrome,cola.PullAction=function(){function a(a,b){var c,d,e,f;this.content=a,this.contentWrapper=this.content.parentNode,this.options={resistance:2.5,startTheshold:10,pullTheshold:.4};for(c in b)f=b[c],this.options[c]=f;d=this.options.pullDownPane,d&&"string"==typeof d&&(d=document.body.querySelector(d)),d&&(this.pullDownPane=d,this.content.previousSibling!==d&&$fly(this.content).before(d),$fly(d).addClass("pull-down-pane"),this.pullDownDistance=d.offsetHeight,this.contentWrapper.scrollTop=this.pullDownDistance),e=this.options.pullUpPane,e&&"string"==typeof e&&(e=document.body.querySelector(e)),e&&(this.pullUpPane=e,this.content.nextSibling!==e&&$fly(this.content).after(e),$fly(e).addClass("pull-up-pane"),this.pullUpDistance=e.offsetHeight),$(this.content).on("touchstart",function(a){return function(b){return a._onTouchStart(b)}}(this)).on("touchmove",function(a){return function(b){return a._onTouchMove(b)}}(this)).on("touchend",function(a){return function(b){return a._onTouchEnd(b)}}(this))}return a.prototype._getTouchPoint=function(a){var b;return b=a.originalEvent.touches,b.length||(b=a.originalEvent.changedTouches),b[0]},a.prototype._onTouchStart=function(a){var b;return this._disabled?(this.pullState=null,this._watchingTouchMove=!1):(this._scrollTop=this.content.scrollTop,this.options.pullDownPane&&this._scrollTop<=0?(this.pullState="pre-down",this._watchingTouchMove=!0):this.options.pullUpPane&&this._scrollTop+this.content.clientHeight>=this.content.scrollHeight?(this.pullState="pre-up",this._watchingTouchMove=!0):(this.pullState=null,this._watchingTouchMove=!1)),this.pullReached=!1,this._panStarted=0,this._watchingTouchMove&&(b=this._getTouchPoint(a),this._touchStartX=b.pageX,this._touchStartY=b.pageY,cola.os.ios&&(this._scrollTop<0||this._scrollTop+this.content.clientHeight>this.content.scrollHeight))?!1:void 0},a.prototype._onTouchMove=function(a){var b,c,d,e,f,g,h;if(this._watchingTouchMove){if(h=this._getTouchPoint(a),c=h.pageX-this._touchStartX,d=h.pageY-this._touchStartY,!this._panStarted&&Math.abs(c)<20&&(d>0&&"pre-down"===this.pullState||0>d&&"pre-up"===this.pullState)){if(g=this.options.startTheshold,d>g&&"pre-down"===this.pullState?this.pullState="down":-g>d&&("pre-up"===this.pullState?this.pullState="up":void 0),("down"===this.pullState||"up"===this.pullState)&&(this._panStarted=new Date,e="down"===this.pullState?this.options.pullDownPane:this.options.pullUpPane,("function"==typeof(b=this.options).pullStart?b.pullStart(a,e,this.pullState):void 0)===!1))return this.pullState=null,void(this._watchingTouchMove=!1);f=!1}return this._panStarted&&this._onPanMove(a,Math.abs(d)),f===!1||this._panStarted?(a.stopImmediatePropagation(),!1):void 0}},a.prototype._onPanMove=function(a,b){var c,d,e,f,g;b/=this.options.resistance,this._distance=b,"down"===this.pullState?(d=this.pullDownDistance,f=d*this.options.pullTheshold,g=b>f,b>d&&(b=d),e=this.options.pullDownPane,this.contentWrapper.scrollTop=d-b):"up"===this.pullState&&(d=this.pullUpDistance,f=d*this.options.pullTheshold,g=b>f,b>d&&(b=d),e=this.options.pullUpPane,this.contentWrapper.scrollTop=this.options.pullUpPane.offsetTop-this.contentWrapper.clientHeight+b),e&&(this.pullReached=g,$fly(e).toggleClass("reached",g),"function"==typeof(c=this.options).pullStep&&c.pullStep(a,e,this.pullState,b,f))},a.prototype._onTouchEnd=function(a){var b,c,d,e,f;this._panStarted&&(e=this.pullState,"down"===e?d=this.options.pullDownPane:"up"===e&&(d=this.options.pullUpPane),d&&(this._disabled=!0,$fly(d).removeClass("reached"),this.pullReached?(f="down"===this.pullState?this.pullDownDistance*(1-this.options.pullTheshold):this.options.pullUpPane.offsetTop-this.contentWrapper.clientHeight+this.pullUpDistance*(1-this.options.pullTheshold),i?this.contentWrapper.scrollTop=f:$fly(this.contentWrapper).animate({scrollTop:f},{duration:200}),$fly(d).addClass("executing"),c=this,this._executePullAction(a,e,function(){c._hidePullPane(e)})):("function"==typeof(b=this.options).pullCancel&&b.pullCancel(a,d,e),this._hidePullPane(e))))},a.prototype._executePullAction=function(a,b,c){var d;this.options.pullComplete?(d="down"===this.pullState?this.options.pullDownPane:this.options.pullUpPane,this.options.pullComplete(a,d,b,c)):c()},a.prototype._hidePullPane=function(a){var b,c,d;"down"===a?d=this.options.pullDownPane:"up"===a&&(d=this.options.pullUpPane),i?(this.contentWrapper.scrollTop=this.pullDownDistance,this._disabled=!1,$fly(d).removeClass("executing")):(c=this,$(this.contentWrapper).animate({scrollTop:this.pullDownDistance},{duration:200,complete:function(){c._disabled=!1,$fly(d).removeClass("executing")}})),cola.os.android&&cola.browser.qqbrowser&&(b=this.contentWrapper.style,b.marginTop?b.marginTop="":b.marginTop="0.001px")},a}(),j=cola.os.android&&!cola.browser.chrome,k=200,h=["small","medium","large","xlarge","xxlarge"],o=function(){var a;return a=[],
a._grouped=!0,a},cola.ListView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-listView",b.CLASS_NAME="items-view list-view",b.prototype._columnsChanged=!0,b.attributes={items:{expressionType:"repeat",refreshItems:!0,setter:function(a){this._items!==a&&(this._set("bind",void 0),this._items=a)},getter:function(){return this._realItems||this._items}},bind:{refreshItems:!0,setter:function(a){return this._bindStr!==a?(this._set("items",void 0),this._bindSetter(a)):void 0}},textProperty:{refreshItems:!0},columns:{refreshItems:!0,defaultValue:"row",setter:function(a){this._columns=a,this._columnsChanged=!0}},itemWidth:null,itemHeight:null,group:{refreshItems:!0},groupCollapsible:{type:"boolean",defaultValue:!0},indexBar:{refreshItems:!0},itemSlide:{"enum":["none","left","right","both"],defaultValue:"none",setter:function(a){var b,c;return this._itemSlide=a,a?("left"===a?b=!0:"right"===a?c=!0:(b=!0,c=!0),this._leftItemSlide=b,this._rightItemSlide=c):void 0}}},b.events={getGroupString:null,itemSlideStart:null,itemSlideStep:null,itemSlideComplete:null,itemSlideCancel:null,itemSlidePaneInit:null,itemSlidePaneShow:null,itemSlidePaneHide:null},b.TEMPLATES={"default":{tagName:"li","c-bind":"$default"},group:{tagName:"ul",content:{tagName:"ul"}},"group-header":{tagName:"li","c-bind":"group.name"}},b.prototype.destroy=function(){b.__super__.destroy.call(this),delete this._topGroupDom,this._indexBarRelocateTimer&&clearInterval(this._indexBarRelocateTimer),delete this._itemSlidePane,delete this._slideItemDom},b.prototype._initDom=function(a){b.__super__._initDom.call(this,a),$fly(this._doms.itemsWrapper).delegate(".group-header","click",function(a){return function(b){return a._onGroupHeaderClick(b)}}(this)),cola.util.delay(this,"initItemSlide",200,this._initItemSlide)},b.prototype._getItems=function(){return this._items?{items:this._items}:b.__super__._getItems.call(this)},b.prototype._groupItems=function(a){var b,c,d,e;return c=o(),b=null,d=this.getListeners("getGroupString"),e=this,cola.each(a,function(a){var f,g,h;d?(f={item:a,result:null},e.fire("getGroupString",e,f),h=f.result):(h=null,g=e.group,g&&"string"==typeof g&&(a instanceof cola.Entity?h=a.get(g):"object"==typeof a?h=null!=a?a[g]:void 0:a&&(h=a+""))),h===(null!=b?b.name:void 0)?b.items.push(a):(b&&c.push(b),b={_itemType:"group",_alias:"group",name:h||"#",items:[a]})}),b&&c.push(b),c},b.prototype._convertItems=function(a){return a=b.__super__._convertItems.call(this,a),this._group&&a&&(a=this._groupItems(a)),a},b.prototype._doRefreshDom=function(a){var c,d,e,f,g,i,j;if(this._dom){if(this._columnsChanged){for(delete this._columnsChanged,c=["items"],e=this._columns||"row",e=e.split(" "),f=0,j=0,i=e.length;i>j&&(d=e[j],!(""!==d&&("row"===d?c.push(h[f]+"-row-list"):c.push(h[f]+"-block-grid-"+d),f++,f>=h.length)));j++);g=this._doms.itemsWrapper,this._group?(this._columnsClassNames=c,g.className="items"):g.className=c.join(" ")}b.__super__._doRefreshDom.call(this,a),this._classNamePool.toggle("has-index-bar",!!this._indexBar)}},b.prototype._refreshItems=function(){var a,c,d;b.__super__._refreshItems.call(this),this._dom&&(this._group||null!=(d=this._doms.floatGroupHeaderWrapper)&&(d.style.display="none"),this._indexBar&&this._group&&this._realItems?this._refreshIndexBar():this._doms.indexBar&&$fly(this._doms.indexBar).hide(),cola.os.mobile||this._indexBarRelocateTimer||(c=this._doms.itemsWrapper,a=this._dom,this._indexBarRelocateTimer=setInterval(function(){$fly(a).toggleClass("v-scroll",c.scrollHeight>c.clientHeight)},500)))},b.prototype._getDefaultBindPath=function(a){return this._textProperty?(a._alias||this._alias)+"."+this._textProperty:void 0},b.prototype._createNewItem=function(a,b){var c,d,e,f;return f=this.getTemplate(a),f?d=this._cloneTemplate(f):(d=document.createElement("li"),d.setAttribute("c-bind","$default")),"group"===a?e="list group":"group-header"===a?(e="list group-header",this._groupCollapsible&&(e+=" collapsible")):e="list item "+a,d._itemType=a,c=$fly(d),c.addClass(e),this._itemWidth&&c.width(this._itemWidth),this._itemHeight&&c.height(this._itemHeight),d},b.prototype._refreshItemDom=function(a,c,d){return"group"===a._itemType?this._refreshGroupDom(a,c,d):b.__super__._refreshItemDom.call(this,a,c,d)},b.prototype._refreshGroupDom=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(null==c&&(c=this._itemsScope),g=cola.Entity._getEntityId(b),h=cola.util.userData(a,"scope"),h?(p=cola.util.userData(a,"item"),p!==h.data.getTargetData()&&(a._itemId&&delete a._itemId,h.data.setTargetData(b),cola.util.userData(a,"item",b))):(a._itemScope=h=new cola.ItemScope(c,b._alias),c.regItemScope(g,h),h.data.setTargetData(b,!0),cola.util.userData(a,"scope",h),cola.util.userData(a,"item",b)),g?(a._itemId=g,this._itemDomMap[g]=a):delete a._itemId,a._headerCreated?l=a.lastChild:(a._headerCreated=!0,l=a.firstChild,f=this._createNewItem("group-header",b),this._templateContext.defaultPath=b._alias,cola.xRender(f,h,this._templateContext),a.insertBefore(f,l),cola.util.userData(f,"item",b)),e=null,d=l.firstChild,q=b.items,n=0,m=q.length;m>n;n++){if(i=q[n],k=this._getItemType(i),j=null,d){for(;d&&d._itemType!==k;)o=d.nextSibling,a.removeChild(d),d=o;d&&(j=d,d=d.nextSibling)}j?this._refreshItemDom(j,i):(j=this._createNewItem(k,i),this._refreshItemDom(j,i),null==e&&(e=document.createDocumentFragment()),e.appendChild(j))}if(d)for(j=d;j;)o=j.nextSibling,l.removeChild(j),j._itemId&&delete this._itemDomMap[j._itemId],j=o;this._columnsClassNames?l.className=this._columnsClassNames.join(" "):l.className="items",e&&l.appendChild(e)},b.prototype._onItemInsert=function(a){this._group?this._refreshItems():b.__super__._onItemInsert.call(this,a)},b.prototype._onItemRemove=function(a){this._group?this._refreshItems():b.__super__._onItemRemove.call(this,a)},b.prototype._onItemsWrapperScroll=function(){var a,c,d,e,f,g,h,i,j,k;if(b.__super__._onItemsWrapperScroll.call(this),this._group){if(j=this._doms.itemsWrapper.scrollTop,0>=j)return void(null!=(g=this._doms.floatGroupHeaderWrapper)&&(g.style.display="none"));if(k=this._findTopGroupDom(j)){if(k.offsetTop===j)return void(null!=(h=this._doms.floatGroupHeaderWrapper)&&(h.style.display="none"));d=cola.util.userData(k,"item"),a=this._getFloatGroupHeader(d),c=1,e=null!=(i=k.nextSibling)?i.offsetTop:void 0,e>0&&e-j-c<this._floatGroupHeaderHeight?(f=this._floatGroupHeaderHeight-(e-j-c),a.style.top=this._floatGroupHeaderDefaultTop-f+"px",this._floatGroupHeaderMoved=!0):this._floatGroupHeaderMoved&&(a.style.top=this._floatGroupHeaderDefaultTop+"px",delete this._floatGroupHeaderMoved)}}},b.prototype._getFloatGroupHeader=function(a){var b,c,d,e;return c=this._doms.floatGroupHeaderWrapper,c?(b=c.firstChild,d=cola.util.userData(b,"scope"),d.data.setTargetData(a),"none"===c.style.display&&(c.style.display="")):(d=new cola.ItemScope(this._itemsScope,a._alias),d.data.setTargetData(a,!0),b=this._createNewItem("group-header",a),cola.util.userData(b,"scope",d),this._templateContext.defaultPath=a._alias,cola.xRender(b,d),c=$.xCreate({tagName:"ul","class":"items float-group-header",content:b}),this._dom.appendChild(c),this._doms.floatGroupHeaderWrapper=c,this._floatGroupHeaderDefaultTop=(null!=(e=this._doms.pullDownPane)?e.offsetHeight:void 0)||0,this._floatGroupHeaderHeight=c.offsetHeight,c.style.top=this._floatGroupHeaderDefaultTop+"px"),c},b.prototype._findTopGroupDom=function(a){var b,c,d,e,f;if(f=this._realItems,null!=f?f.length:void 0){if(b=this._topGroupDom||this._doms.itemsWrapper.firstChild,c=b.offsetTop,a>=c)for(d=b.nextSibling;d;){if(e=d.offsetTop,e>a){d=d.previousSibling,this._topGroupDom!==d&&(this._topGroupDom=d);break}d=d.nextSibling}else for(d=b.previousSibling;d;){if(e=d.offsetTop,a>=e){this._topGroupDom=d;break}d=d.previousSibling}return d}},b.prototype._onGroupHeaderClick=function(a){var b,c,d;return d=a.currentTarget,c=cola.util.userData(d,"item"),b=d.parentNode,c._collapsed?(c._collapsed=!1,$fly(d).removeClass("collapsed"),$fly(b).animate({height:b.scrollHeight},{duration:150,easing:"swing",complete:function(){b.style.height="",b.style.overflow=""}})):(c._collapsed=!0,$fly(d).addClass("collapsed"),$fly(b).css("overflow","hidden").animate({height:d.offsetHeight},{duration:150,easing:"swing"})),!1},b.prototype._createPullAction=function(){var a;b.__super__._createPullAction.call(this),this._doms.indexBar&&(a=this._doms.indexBar,this._pullAction.pullDownDistance&&"absolute"===$fly(a).css("position")&&(a.style.marginTop=this._pullAction.pullDownDistance+"px",a.style.marginBottom=-this._pullAction.pullDownDistance+"px"))},b.prototype._refreshIndexBar=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;for(k=this,h=this._doms.indexBar,h?$fly(h).show():(d=function(a,b){var c,d,e,f,g,i,j;for(g=a;g&&g!==h&&!(g._groupIndex>=0);)g=g.parentNode;(null!=g?g._groupIndex:void 0)>=0&&(j=new Date,(!k._currentIndex||k._currentIndex!==g._groupIndex&&j-k._currentIndexTimestamp>100)&&(k._currentIndex=g._groupIndex,k._currentIndexTimestamp=j,c=h.querySelector(".current"),c&&$fly(c).removeClass("current"),$fly(g).addClass("current"),d=k._realItems[g._groupIndex],f=cola.Entity._getEntityId(d),f&&(e=k._itemDomMap[f],e&&(i=k._doms.itemsWrapper,b?$(i).animate({scrollTop:e.offsetTop},{duration:150,easing:"swing",queue:!0}):i.scrollTop=e.offsetTop))))},a=function(){setTimeout(function(){var a;a=h.querySelector(".current"),a&&$fly(a).removeClass("current")},300)},this._doms.indexBar=h=$.xCreate({tagName:"div","class":"index-bar",mousedown:function(a){return d(a.target,!0)},mouseup:a,touchstart:function(a){return d(a.target,!0)},touchmove:function(a){var b,c;return c=a.originalEvent.touches[0],b=document.elementFromPoint(c.pageX,c.pageY),d(b,!0),!1},touchend:a}),this._dom.appendChild(h)),c=null,b=h.firstChild,f=this._realItems,g=l=0,j=f.length;j>l;g=++l)e=f[g],b?(i=b,b=b.nextSibling):(i=$.xCreate({tagName:"div","class":"index",content:"^span"}),null==c&&(c=document.createDocumentFragment()),c.appendChild(i)),$fly(i.firstChild).text(e.name),i._groupIndex=g;if(c)h.appendChild(c);else for(;b;)m=b.nextSibling,h.removeChild(b),b=m},b.prototype._initItemSlide=function(){var a,b,c,d;c=this.getTemplate("slide-left-pane"),d=this.getTemplate("slide-right-pane"),(c||d)&&(b=this._doms.itemsWrapper,this._itemSlide&&"none"!==this._itemSlide&&$fly(b).on("touchstart",function(a){return function(b){return a._onItemsWrapperTouchStart(b)}}(this)).on("touchmove",function(a){return function(b){return a._onItemsWrapperTouchMove(b)}}(this)).on("touchend",function(a){return function(b){return a._onItemsWrapperTouchEnd(b)}}(this)),a=new cola.ItemScope(this._itemsScope,this._alias),this._templateContext.defaultPath=this._alias,c&&($fly(c).addClass("item-slide-pane protected").css("left","100%").click(function(a){return function(){"waiting"===a._itemSlideState&&a.hideItemSlidePane()}}(this)),cola.xRender(c,a,this._templateContext),cola.util.userData(c,"scope",a),b.appendChild(c)),d&&($fly(d).addClass("item-slide-pane protected").css("right","100%").click(function(a){return function(){"waiting"===a._itemSlideState&&a.hideItemSlidePane()}}(this)),cola.xRender(d,a,this._templateContext),cola.util.userData(d,"scope",a),b.appendChild(d)))},b.prototype._getTouchPoint=function(a){var b;return b=a.originalEvent.touches,b.length||(b=a.originalEvent.changedTouches),b[0]},b.prototype._onItemsWrapperTouchStart=function(a){var b,c,d,e;if(this._start=new Date,this._itemSlide&&(!this._itemSlideState||"closed"===this._itemSlideState||"ignore"===this._itemSlideState)){if(d=this._findItemDom(a.target)){if(d.offsetWidth<.6*this._doms.itemsWrapper.clientWidth)return;c=cola.util.userData(d,"item")}if(c){if(this.getListeners("itemSlideStart")){if(b={event:a,item:c},this.fire("itemSlideStart",this,b)===!1)return}else if("group"===this._getItemType(c))return;this._slideItemDom=d,this._itemSlideState=null,e=a.originalEvent.touches[0],this._touchStartX=e.pageX,this._touchStartY=e.pageY,this._touchTimestamp=new Date}}},b.prototype._initItemSlidePane=function(a,b){var c,d,e,f,g;return d=cola.util.userData(a,"item"),b!==this._itemSlideDirection?(f=this._itemSlidePane,f&&($fly(f).hide(),j||$fly(f).css("transform","")),this._itemSlideDirection=b,this._itemSlidePane=g=this.getTemplate("slide-"+b+"-pane"),g?(e=cola.util.userData(g,"scope"),e.data.setTargetData(d),this.getListeners("itemSlidePaneInit")&&this.fire("itemSlidePaneInit",this,{item:d,direction:b,slidePane:g}),"left"===b&&void 0===this._maxDistanceAdjust&&this._indexBar&&(c=this._doms.indexBar,c?this._maxDistanceAdjust=c.offsetWidth+parseInt($fly(c).css("right")):this._maxDistanceAdjust=0),$fly(g).css({height:a.offsetHeight,top:a.offsetTop,"pointer-events":"none"}).show(),this._maxSlideDistance=g.offsetWidth,"left"===b&&(this._maxSlideDistance+=this._maxDistanceAdjust||0)):this._maxSlideDistance=a.offsetWidth):g=this._itemSlidePane,g},b.prototype._onItemsWrapperTouchMove=function(a){var b,c,d,e,f,g,h,i,k,l,m;if(this._itemSlide){if("prevent"===this._itemSlideState)return a.stopImmediatePropagation(),!1;if(!this._itemSlideState||"slide"===this._itemSlideState){if(l=this._getTouchPoint(a),this._touchLastX=l.pageX,this._touchLastY=l.pageY,c=this._touchLastX-this._touchStartX,d=this._touchLastY-this._touchStartY,k=new Date,g=this._slideItemDom,!this._itemSlideState){if(!(Math.abs(c)>5&&Math.abs(c)>Math.abs(d)))return void(this._itemSlideState="ignore");this._itemSlideState="slide",this._itemSlideDirection=null,cola.browser.chrome&&(g.style.opacity=.999)}return this._touchMoveSpeed=c/(k-this._touchLastTimstamp),this._touchLastTimstamp=k,c>0?(b="right",e=1):(b="left",e=-1),h=g.firstChild&&g.firstChild===g.lastChild?g.firstChild:g,i=this._initItemSlidePane(g,b),i&&(Math.abs(c)<=this._maxSlideDistance?this._currentSlideDistance=c:this._currentSlideDistance=this._maxSlideDistance*e,j||(m="translate("+this._currentSlideDistance+"px,0)",$fly(h).css("transform",m),$fly(i).css("transform",m)),this.getListeners("itemSlideStep")&&(f=cola.util.userData(g,"item"),this.fire("itemSlideStep",this,{event:a,item:f,direction:b,distance:c,speed:this._touchMoveSpeed}))),a.stopImmediatePropagation(),!1}}},b.prototype._onItemsWrapperTouchEnd=function(a){var b,c,d,e,f,g,h,i;"slide"===this._itemSlideState&&(b=this._currentSlideDistance,0!==b&&(d=this._slideItemDom,e=this._maxSlideDistance,g=!1,Math.abs(b)===e?g=!0:Math.abs(b)/e>.5?(g=!0,f=!0):Math.abs(this._touchMoveSpeed)>5&&(g=!0,f=!0),cola.browser.chrome&&(d.style.opacity=""),c=this._itemSlideDirection,g?this.fire("itemSlideComplete",this,{event:a,item:cola.util.userData(d,"item"),direction:c,distance:this._currentSlideDistance,speed:this._touchMoveSpeed}):this.fire("itemSlideCancel",this,{direction:c,event:a,item:cola.util.userData(d,"item")}),h=d.firstChild&&d.firstChild===d.lastChild?d.firstChild:d,"left"===c?j||$(h).transit({x:0,duration:2*k}):$(h).transit({x:e,duration:k}),g?(i=this._itemSlidePane,i?this._showItemSlidePane(d,c,i,f):this._itemSlideState="closed"):this._hideItemSlidePane(!1)))},b.prototype._showItemSlidePane=function(a,b,c,d){var e,f;$fly(this._doms.itemsWrapper).dimmer({opacity:1e-4,duration:0,closable:!1}).dimmer("show").find(">.ui.dimmer").on("touchstart.hide",function(a){return function(){"waiting"===a._itemSlideState&&a.hideItemSlidePane()}}(this)),e=$(c),d||j?(f="left"===b?-1:1,e.show().transit({x:this._maxSlideDistance*f,duration:k,complete:function(d){return function(){e.css("pointer-events",""),d._onItemSlidePaneShow(b,c,a)}}(this)})):(e.css("pointer-events",""),this._onItemSlidePaneShow(b,c,a))},b.prototype._hideItemSlidePane=function(a,b){var c,d,e,f;this._itemSlideState="closing",d=this._slideItemDom,f=this._itemSlidePane,c=this._itemSlideDirection,"right"===c&&(e=d.firstChild&&d.firstChild===d.lastChild?d.firstChild:d,$(e).transit({x:0,duration:k})),$fly(this._doms.itemsWrapper).dimmer("hide"),f?$(f).transit({x:0,duration:b?k:0,complete:function(b){return function(){$fly(f).hide(),delete b._itemSlidePane,b._onItemSlidePaneHide(a,c,f,d)}}(this)}):this._onItemSlidePaneHide(a,c,f,d)},b.prototype._onItemSlidePaneShow=function(a,b,c){this._itemSlideState="waiting",this.fire("itemSlidePaneShow",this,{item:cola.util.userData(c,"item"),direction:a,slidePane:b})},b.prototype._onItemSlidePaneHide=function(a,b,c,d){this._itemSlideDirection=null,this._itemSlideState="closed",this._slideItemDom=null,a&&this.fire("itemSlidePaneHide",this,{item:cola.util.userData(d,"item"),direction:b,slidePane:c})},b.prototype.showItemSlidePane=function(a,b){var c,d,e;c=cola.Entity._getEntityId(a),d=this._itemDomMap[c],e=this._initItemSlidePane(d,b),e&&(this._slideItemDom=d,this._showItemSlidePane(d,b,e,!0))},b.prototype.hideItemSlidePane=function(a){this._hideItemSlidePane(!0,a)},b}(cola.AbstractList),cola.registerWidget(cola.ListView),p=cola.Entity._getEntityId,cola.CascadeBind=function(a){function b(a,c){this._widget=a,b.__super__.constructor.call(this,c)}return J(b,a),b.attributes={expression:{setter:function(a){if(a=cola._compileExpression(a,"repeat")){if(!a.repeat)throw new cola.Exception('"'+bindStr+'" is not a repeat expression.')}else delete this._alias;this._expression=a}},recursive:null,child:{setter:function(a){!a||a instanceof cola.CascadeBind||(a=new this.constructor(this._widget,a)),this._child=a}},hasChildProperty:null},b.prototype._wrapChildItems=function(a,b,c,d,e){var f,g,h,i,j,k,l,m;m=[],l=this.constructor.NODE_TYPE,j=a._nodeMap,k={},b&&cola.each(b,function(b){return function(c){var d,e;j&&(d=p(c),d&&(e=j[d],(null!=e?e._bind:void 0)===b?delete j[d]:e=null)),null==e&&(e=new l(b,c)),e._parent=a,k[e._id]=e,m.push(e)}}(this)),d&&cola.each(d,function(b){return function(c){var d,e;j&&(d=p(c),d&&(e=j[d],(null!=e?e._bind:void 0)===b?delete j[d]:e=null)),null==e&&(e=new l(b._child,c)),e._parent=a,e._scope=a._scope,m.push(e)}}(this));for(g in j)i=j[g],i.destroy();a._nodeMap=k,a._children=m,delete a._hasChild,h=a._itemsScope,h&&(f=[m],b&&f.push(c||b),d&&f.push(e||d),h._setItems.apply(h,f))},b.prototype.retrieveChildNodes=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;i=!a._parent,h=!1,g=[],(this._recursive||i)&&(null==c&&(c={}),j=this._expression.evaluate(a._scope,"async",c),void 0===j&&c.unloaded?(n=null!=(o=c.providerInvokers)?o[0]:void 0,n&&g.push(function(a){return n.invokeAsync(a)})):(m=j,j instanceof Array&&(l=j.$origin),m&&(h=m instanceof cola.EntityList?m.entityCount>0:m.length>0))),this._child&&!i&&(null==c&&(c={}),j=this._child._expression.evaluate(a._scope,"async",c),void 0===j&&c.unloaded?(f=null!=(p=c.providerInvokers)?p[0]:void 0,f&&g.push(function(a){return f.invokeAsync(a)})):(e=j,j instanceof Array&&(k=j.$origin),h=!0)),g.length?cola.util.waitForAll(g,{scope:this,complete:function(c,d){var f;c?(h=!1,(this._recursive||i)&&(m=this._expression.evaluate(a._scope,"never"),m instanceof Array&&(l=m.$origin),m&&(h=m instanceof cola.EntityList?m.entityCount>0:m.length>0)),this._child&&!i&&(h=!0,e=this._child._expression.evaluate(a._scope,"never"),e instanceof Array&&(k=e.$origin)),this._wrapChildItems(a,m,l,e,k),a._hasChild=h,"function"==typeof(f=a._itemsScope).onItemsRefresh&&f.onItemsRefresh(),b&&cola.callback(b,!0)):b&&cola.callback(b,!1,d)}}):(this._wrapChildItems(a,m,l,e,k),a._hasChild=h,"function"==typeof(d=a._itemsScope).onItemsRefresh&&d.onItemsRefresh(),b&&cola.callback(b,!0))},b.prototype.hasChildItems=function(a){var b,c,d;if(this._recursive){if(b={},d=this._expression.evaluate(a,"never",b),b.unloaded)return!0;if(d&&(c=d instanceof cola.EntityList?d.entityCount>0:d.length>0))return!0}if(this._child){if(b={},d=this._child._expression.evaluate(a,"never",b),b.unloaded)return!0;if(d&&(c=d instanceof cola.EntityList?d.entityCount>0:d.length>0))return!0}return!1},b}(cola.Element),cola.Node=function(a){function b(a,c){var d,e;b.__super__.constructor.call(this),this._bind=a,this._alias=null!=(d=a._expression)?d.alias:void 0,this._widget=a._widget,this._data=c,"object"==typeof c?this._id=cola.Entity._getEntityId(c):this._id=cola.uniqueId(),null!=(e=this._widget)&&"function"==typeof e._onNodeAttach&&e._onNodeAttach(this)}return J(b,a),b.prototype.isDataWrapper=!0,b.attributes={bind:{readOnly:!0},alias:null,data:null,hasChild:{getter:function(){var a,b,c,d,e;if((null!=(e=this._children)?e.length:void 0)>0)return!0;if(null!=this._hasChild)return this._hasChild;if(a=this._bind,d=a._hasChildProperty,d&&this._data)return this._data instanceof cola.Entity?this._data.get(d,"never"):this._data[d];if(this._scope){if(a._recursive){if(b={},c=a._expression.evaluate(this._scope,"never",b),b.unloaded)return;if(!c)return!1}if(a._child){if(b={},c=a._child._expression.evaluate(this._scope,"never",b),b.unloaded)return;if(!c)return!1}}}},parent:{readOnly:!0},children:{readOnly:!0}},b.prototype.destroy=function(){var a,b,c,d,e;if(this._children)for(d=this._children,c=0,b=d.length;b>c;c++)a=d[c],a.destroy();null!=(e=this._widget)&&"function"==typeof e._onNodeDetach&&e._onNodeDetach(this)},b.prototype.remove=function(){var a,b;this._parent&&(b=this._parent,a=b._children.indexOf(this),a>-1&&b._children.splice(a,1),delete b._nodeMap[this._id]),this.destroy()},b}(cola.Element),cola.TreeSupportMixin={constructor:function(){return this._nodeMap={}},_onNodeAttach:function(a){this._nodeMap[a._id]=a},_onNodeDetach:function(a){delete this._nodeMap[a._id]}},cola.NestedListNode=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.attributes={title:{readOnly:!0,getter:function(){var a,b;return a=this._bind._titleProperty,a&&(b=this._data instanceof cola.Entity?this._data.get(a):this._data[a]),b||"#Unknown"}}},b}(cola.Node),cola.NestedListBind=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.NODE_TYPE=cola.NestedListNode,b.attributes={titleProperty:null},b}(cola.CascadeBind),cola.NestedList=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-nestedList",b.CLASS_NAME="nested-list",b.attributes={bind:{setter:function(a){!a||a instanceof cola.NestedListBind||(a=new cola.NestedListBind(this,a)),this._bind=a,this._rootNode&&this._rootNode.set("bind",a)}},autoSplit:{type:"boolean",defaultValue:!0},navBarWidth:{defaultValue:"280px"},showTitleBar:{type:"boolean",defaultValue:!0},title:null,layerIndex:{readOnly:!0,getter:function(){return this._layerIndex}},splited:{readOnly:!0,getter:function(){return this._autoSplit&&this._largeScreen}}},b.events={getItemTemplate:null,itemClick:null,renderItem:null,initLayer:null,topLayerChange:null},b.prototype._initDom=function(a){var b,c,d;this._autoSplit&&(cola.device.pad?this._largeScreen=!0:cola.device.desktop&&(this._largeScreen=document.body.clientWidth>480)),null==this._doms&&(this._doms={}),c=this._createLayer(0),this._layers=[c],this._layerIndex=0,this._initLayer(c,null,0),this._autoSplit&&this._largeScreen?$fly(a).xAppend([{tagName:"div","class":"nav",style:{width:this._navBarWidth,height:"100%","float":"left",overflow:"hidden"},content:c.container},{tagName:"div","class":"detail",style:{marginLeft:this._navBarWidth,height:"100%",position:"relative",overflow:"hidden"},contextKey:"detailContainer"}],this._doms):(this._doms.detailContainer=a,c.container.appendTo(a)),b=c.list._itemsScope,this._rootNode=new cola.NestedListNode(this._bind),this._rootNode._scope=this._scope,this._rootNode._itemsScope=b,this._bind&&(this._itemsRetrieved=!0,d=this,this._bind.retrieveChildNodes(d._rootNode,function(){var a,b;d._autoSplit&&d._largeScreen&&(a=d._rootNode._children,b=null!=a?a[0]:void 0,(null!=b?b._scope:void 0)&&d._showLayer(1,null!=a?a[0]:void 0))}),b._retrieveItems=function(a){return d._bind.retrieveChildNodes(d._rootNode,null,a)}),this.fire("topLayerChange",this,{index:0})},b.prototype._parseDom=function(a){var b;if(a)for(b=a.firstChild;b;)"TEMPLATE"===b.nodeName&&this.regTemplate(b),b=b.nextSibling},b.prototype._createLayer=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(d=this._autoSplit&&this._largeScreen&&0===a,n=a>(this._autoSplit&&this._largeScreen?1:0),e={tagName:"div",style:{height:"100%"},contextKey:"container","c-widget":n?"layer":"widget",content:{tagName:"div","class":"v-box",style:{height:"100%"}}},h={$type:"listView","class":this._ui,allowNoCurrent:!d,highlightCurrentItem:d,height:"100%",userData:a,getItemTemplate:function(a){return function(b,c){return a._onGetItemTemplate(b,c)}}(this),renderItem:function(a){return function(b,c){return a._onRenderItem(b,c)}}(this),itemClick:function(a){return function(b,c){return a._onItemClick(b,c)}}(this)},this._showTitleBar?(i=n?[{icon:"chevron left",click:function(a){return function(){return a.back()}}(this)}]:void 0,e.content.content=[{tagName:"div","class":"box title-box",content:{tagName:"div",contextKey:"titleBar","c-widget":{$type:"titleBar","class":this._ui,items:i}}},{tagName:"div","class":"flex-box list-box",content:{tagName:"div",contextKey:"list","c-widget":h}}]):e.content.content={tagName:"div",contextKey:"list","c-widget":h},c={},new cola.xRender(e,this._scope,c),g=cola.widget(c.list),k=g._refreshItemDom,g._refreshItemDom=function(a,b,c){var d;return d=k.apply(this,arguments),b._scope=d,d},b=c.container?cola.widget(c.container):g,this._templates){l=this._templates;for(j in l)m=l[j],g._templates[j]=m}return f={itemsScope:g._itemsScope,titleBar:cola.widget(c.titleBar),list:g,container:b}},b.prototype._initLayer=function(a,b,c){var d;null!=(d=a.titleBar)&&d.set("title",b?b.get("title"):this._title),this.fire("initLayer",this,{parentNode:b,parentItem:null!=b?b._data:void 0,index:c,list:a.list,titleBar:a.titleBar})},b.prototype._getLayerInfo=function(a){var b,c;return{index:a.index,parentNode:a.parentNode,parentItem:null!=(b=a.parentNode)?b._data:void 0,title:null!=(c=a.parentNode)?c.get("title"):void 0,titleBar:a.titleBar,list:a.list,nodes:a.list.get("items")}},b.prototype._showLayer=function(a,b,c){var d,e,f,g;if(a<=this._layerIndex){for(d=a;d<=this._layerIndex;)this._hideLayer(d===this._layerIndex);this._layerIndex=a-1}a>=this._layers.length?(f=this._createLayer(a),this._layers.push(f),f.container.appendTo(this._doms.detailContainer)):f=this._layers[a],g=f.list,e=g._itemsScope,e.setParent(b._scope),b._itemsScope=e,b._bind.retrieveChildNodes(b,function(d){return function(){b._children&&(d._initLayer(f,b,a),f.container instanceof cola.Layer&&f.container.show(),d._layerIndex=a,f.parentNode=b,d.fire("topLayerChange",d,d._getLayerInfo(f))),"function"==typeof c&&c("undefined"!=typeof wrapper&&null!==wrapper)}}(this)),e._retrieveItems=function(a){return b._bind.retrieveChildNodes(b,null,a)}},b.prototype._hideLayer=function(a){var b,c,d,e;b=this._layers[this._layerIndex],delete b.list._itemsScope._retrieveItems,c={},a||(c.animation="none"),b.container instanceof cola.Layer?b.container.hide(c,function(){var a;null!=(a=b.titleBar)&&a.set("rightItems",null)}):null!=(e=b.titleBar)&&e.set("rightItems",null),delete b.parentNode,this._layerIndex--,d=this._layers[this._layerIndex],this.fire("topLayerChange",this,this._getLayerInfo(d))},b.prototype.back=function(){return this._layerIndex>(this._autoSplit&&this._largeScreen?1:0)?(this._hideLayer(!0),!0):!1},b.prototype._onGetItemTemplate=function(a,b){var c;return c=b.item,this.fire("getItemTemplate",this,{item:c._data})},b.prototype._onItemClick=function(a,b){var c,d;c=b.item,d=this.fire("itemClick",this,{node:c,item:c._data,bind:c._bind}),d!==!1&&this._showLayer(a.get("userData")+1,b.item,function(a){return function(b){b||a.fire("leafItemClick",a,{node:c,item:c._data})}}(this))},b.prototype._onRenderItem=function(a,b){var c,d;d=b.item,c=d.get("hasChild"),null==c&&d._scope&&(c=d._bind.hasChildItems(d._scope)),$fly(b.dom).toggleClass("has-child",!!c),this.getListeners("renderItem")&&this.fire("renderItem",this,{node:d,item:d._data,dom:b.dom})},b.prototype.getLayer=function(a){var b;return b=this._layers[a],b?this._getLayerInfo(b):null},b.prototype.getTopLayer=function(){return this.getLayer(this._layerIndex)},b}(cola.Widget),cola.Element.mixin(cola.NestedList,cola.TemplateSupport),cola.registerWidget(cola.NestedList),cola.TreeNode=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.attributes={expanded:{getter:function(){var a;return null!=this._expanded?this._expanded:(a=this._bind._expandedProperty,a&&this._data?this._data instanceof cola.Entity?this._data.get(a,"never"):this._data[a]:void 0)},setter:function(a){this._expanded=a,a?this._widget.expand(this):this._widget.collapse(this)}},hasExpanded:null,checked:{getter:function(){var a;return a=this._bind._checkedProperty,a&&this._data?this._data instanceof cola.Entity?this._data.get(a,"never"):this._data[a]:void 0},setter:function(a){var b;b=this._bind._checkedProperty,b&&this._data&&(this._data instanceof cola.Entity?this._data.set(b,a):this._data[b]=a)}}},b}(cola.Node),cola.TreeNodeBind=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.NODE_TYPE=cola.TreeNode,b.attributes={textProperty:null,expandedProperty:null,checkedProperty:null,autoCheckChildren:{defaultValue:!0}},b}(cola.CascadeBind),cola.Tree=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-tree",b.CLASS_NAME="items-view tree",b.attributes={bind:{refreshItems:!0,setter:function(a){!a||a instanceof cola.TreeNodeBind||(a=new cola.TreeNodeBind(this,a)),this._bind=a,a&&this._itemsScope.setExpression(a._expression)}},currentNode:{readOnly:!0},currentItemAlias:{setter:function(a){var b;this._currentItemAlias&&this._scope.set(this._currentItemAlias,null),this._currentItemAlias=a,a&&this._scope.set(a,null!=(b=this._currentNode)?b._data:void 0)}},autoCollapse:null,autoExpand:null,lazyRenderChildNodes:{defaultValue:!0}},b.events={beforeCurrentNodeChange:null,currentNodeChange:null},b.TEMPLATES={"default":{tagName:"ul",content:{tagName:"div","class":"tree node",content:[{tagName:"div","class":"expand-button"}]}},checkable:{tagName:"ul",content:{tagName:"div","class":"tree node",content:[{tagName:"div","class":"expand-button"},{tagName:"div","c-widget":{$type:"checkbox","class":"node-checkbox",triState:!0}}]}},node:{tagName:"span","c-bind":"$default"}},b.prototype._initDom=function(a){var c;b.__super__._initDom.call(this,a),$fly(a).attr("tabIndex",1),$fly(this._doms.itemsWrapper).delegate(".expand-button","click",function(a){return function(b){return a._expandButtonClick(b)}}(this)).delegate(".tree.item","click",function(a){return function(b){var c,d;return a._autoExpand&&(c=a._findItemDom(b.currentTarget))&&(d=cola.util.userData(c,"item"))?(d.get("expanded")?a.collapse(d):d.get("hasChild")!==!1&&a.expand(d),!1):!1}}(this)),c=this._itemsScope,this._rootNode=new cola.TreeNode(this._bind),this._rootNode._scope=this._scope,this._rootNode._itemsScope=c,this._bind&&(this._itemsRetrieved=!0,this._bind.retrieveChildNodes(this._rootNode),c._retrieveItems=function(a){return function(b){return a._bind.retrieveChildNodes(a._rootNode,null,b)}}(this))},b.prototype._setCurrentItemDom=function(a){var b;if(a)return b=cola.util.userData(a,"item"),b?this._setCurrentNode(b):void 0},b.prototype._setCurrentNode=function(a){var b,c;this._currentNode!==a&&(b={oldCurrent:this._currentNode,newCurrent:a},this.fire("beforeCurrentNodeChange",this,b)!==!1&&(this._currentNode&&(c=this._itemDomMap[this._currentNode._id],c&&$fly(c).removeClass("current")),this._currentNode=a,this._currentItemAlias&&this._scope.set(this._currentItemAlias,null!=a?a._data:void 0),a&&(c=this._itemDomMap[a._id],c&&this._highlightCurrentItem&&$fly(c).addClass("current")),this.fire("currentNodeChange",this,b)))},b.prototype._getItemType=function(a){var b,c;return b=(null!=a?a.isDataWrapper:void 0)?null!=(c=a._data)?c._itemType:void 0:a._itemType,!b&&a._bind._checkedProperty&&(b="checkable"),b||"default"},b.prototype._createNewItem=function(a,b){var c,d,e,f;return f=this.getTemplate(a),d=this._cloneTemplate(f),$fly(d).addClass("tree item "+a),d._itemType=a,e=d.firstChild,e&&cola.util.hasClass(e,"node")&&(f=this.getTemplate("node-"+a,"node"),f&&(c=this._cloneTemplate(f),
$fly(c).addClass("node-content"),e.appendChild(c))),d},b.prototype._getDefaultBindPath=function(a){var b;return b=a._bind._textProperty,b?a._alias+"."+b:void 0},b.prototype._refreshItemDom=function(a,c,d){var e,f,g,h,i,j,k,l;return k=cola.util.userData(a,"scope"),k&&k.data.getTargetData()!==c.get("data")&&(h=!0),k=b.__super__._refreshItemDom.call(this,a,c,d),c._scope=k,a._binded||(a._binded=!0,"checkable"===a._itemType&&(f=a.querySelector(".node-checkbox"),f&&(l=this,e=cola.widget(f),i=k.data.alias+"."+c._bind._checkedProperty,g=k.get(i),"undefined"==typeof g&&k.set(i,!1),e.set({bind:i,click:function(){return l._onCheckboxClick(c)}})))),!h&&c.get("expanded")?c._hasExpanded?this._refreshChildNodes(a,c):this.expand(c):(c._hasExpanded?h&&this.collapse(c,!0):this._lazyRenderChildNodes||this._prepareChildNode(c,!1),j=a.firstChild,$fly(j).toggleClass("leaf",c.get("hasChild")===!1)),this._currentNode?c===this._currentNode&&this._highlightCurrentItem&&$fly(a).addClass("current"):this._setCurrentNode(c),k},b.prototype._refreshChildNodes=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;if(m=a.lastChild,$fly(m).hasClass("child-nodes")||(m=$.xCreate({tagName:"ul","class":"child-nodes",style:{display:c?"hidden":"",padding:0,margin:0,overflow:"hidden"}}),a.appendChild(m)),h=b._itemsScope,h.resetItemScopeMap(),e=null,d=m.firstChild,b._children)for(n=b._children,j=0,i=n.length;i>j;j++){if(l=n[j],g=this._getItemType(l),d){for(;d&&d._itemType!==g;)k=d.nextSibling,m.removeChild(d),d=k;f=d,d&&(d=d.nextSibling)}else f=null;f?this._refreshItemDom(f,l,h):(f=this._createNewItem(g,l),this._refreshItemDom(f,l,h),null==e&&(e=document.createDocumentFragment()),e.appendChild(f))}if(d)for(f=d;f;)k=f.nextSibling,$fly(f).hasClass("item")&&m.removeChild(f),f=k;e&&m.appendChild(e)},b.prototype._onItemClick=function(a){var c,d;return(c=a.currentTarget)?(d=cola.util.userData(c,"item"),this._setCurrentNode(d),b.__super__._onItemClick.call(this,a)):void 0},b.prototype._expandButtonClick=function(a){var b,c,d;return b=a.currentTarget,b&&(c=this._findItemDom(b),c&&(d=cola.util.userData(c,"item")))?(d.set("expanded",!d.get("expanded")),a.stopPropagation(),!1):void 0},b.prototype.findNode=function(a){var b,c;return(c=cola.Entity._getEntityId(a))?(b=this._itemDomMap[c],cola.util.userData(b,"item")):void 0},b.prototype._prepareChildNode=function(a,b,c,d){var e,f,g,h;e=this._itemDomMap[a._id],e&&(h=this,f=a._itemsScope,f||(a._itemsScope=f=new cola.ItemsScope(a._scope),f.alias=a._alias,f._retrieveItems=function(b){return a._bind.retrieveChildNodes(a,null,b)},f.onItemsRefresh=function(){e=h._itemDomMap[a._id],e&&h._refreshChildNodes(e,a)},f.onItemInsert=function(){return this.onItemsRefresh()},f.onItemRemove=function(a){return h._onItemRemove(a)}),g=e.firstChild,b&&$fly(g).addClass("expanding"),a._bind.retrieveChildNodes(a,function(){var f;b&&$fly(g).removeClass("expanding"),a._children?(h._refreshChildNodes(e,a,!0),b&&$fly(g).addClass("expanded"),f=$fly(e.lastChild),b&&f.hasClass("child-nodes")&&(c?f.show():f.slideDown(150))):$fly(g).addClass("leaf"),b&&(a._expanded=!0),a._hasExpanded=!0,null!=d&&d.call(h)}))},b.prototype.expand=function(a,b){null==b&&(b=!0),this._prepareChildNode(a,!0,b,function(b){return function(){var c,d,e,f,g,h;if(b._autoCollapse&&(null!=(f=a._parent)?f._children:void 0)){for(g=a._parent._children,h=[],e=0,d=g.length;d>e;e++)c=g[e],c!==a&&c.get("expanded")?h.push(b.collapse(c)):h.push(void 0);return h}}}(this))},b.prototype.collapse=function(a,b){var c,d,e;if(null==b&&(b=!0),d=this._itemDomMap[a._id]){if(this._currentNode)for(e=this._currentNode._parent;e;){if(e===a){this._setCurrentNode(a);break}e=e._parent}$fly(d.firstChild).removeClass("expanded"),c=$fly(d.lastChild),c.hasClass("child-nodes")&&(b?c.hide():c.slideUp(150)),a._expanded=!1}},b.prototype._refreshItems=function(){var a;return this._currentNode&&(a=this._itemDomMap[this._currentNode._id],delete this._currentNode,a&&$fly(a).removeClass("current")),b.__super__._refreshItems.call(this)},b.prototype._onItemRemove=function(a){var c,d,e,f,g;g=p(a.entity),f=this._nodeMap[g],f&&(this._currentNode.data===f.data&&(c=f._parent._children,d=c.indexOf(f),d<c.length-1?e=c[d+1]:d>0?e=c[d-1]:f._parent!==this._rootNode&&(e=f._parent),e&&this._setCurrentNode(e)),f.remove()),b.__super__._onItemRemove.call(this,a)},b.prototype._onItemInsert=function(){this._refreshItems()},b.prototype._onCurrentItemChange=null,b.prototype._resetNodeAutoCheckedState=function(a){var b,c,d,e,f,g,h,i;if(a._bind._checkedProperty&&a._bind._autoCheckChildren&&(this._autoChecking||(this._autoCheckingParent=!0),this._autoCheckingParent)){for(this._autoCheckingChildren=!1,d=0,c=0,f=!1,i=a._children,h=0,g=i.length;g>h;h++)e=i[h],e._bind._checkedProperty&&(c++,b=e.get("checked"),b===!0?d++:null===b&&(f=!0));c&&(this._autoChecking=!0,b=void 0,f||(0===d?b=!1:d===c&&(b=!0)),a.set("checked",b),this._nodeCheckedChanged(a,!1,!0),this._autoChecking=!1)}},b.prototype._nodeCheckedChanged=function(a,b,c){var d,e,f,g,h,i;if(b&&a._children&&a._bind._autoCheckChildren&&(this._autoChecking||(this._autoCheckingChildren=!0),this._autoCheckingChildren)){for(this._autoCheckingParent=!1,this._autoChecking=!0,d=a.get("checked"),i=a._children,g=0,f=i.length;f>g;g++)e=i[g],e._bind._checkedProperty&&(h=e.get("checked"),h!==d&&(e.set("checked",d),this._nodeCheckedChanged(e,!0,!1)));this._autoChecking=!1}c&&a._parent&&this._resetNodeAutoCheckedState(a._parent)},b.prototype._onCheckboxClick=function(a){this._nodeCheckedChanged(a,!0,!0)},b.prototype.getCheckedNodes=function(){var a,b,c,d,e;if(d=[],this._rootNode)for(e=this._rootNode._children,c=0,b=e.length;b>c;c++)a=e[c],collectCheckNodes(a);return d},b}(cola.AbstractList),cola.Element.mixin(cola.Tree,cola.TreeSupportMixin),cola.registerWidget(cola.Tree),cola.registerTypeResolver("table.column",function(a){var b;if(a&&a.$type)return b=a.$type.toLowerCase(),"select"===b?cola.TableSelectColumn:void 0}),cola.registerTypeResolver("table.column",function(a){var b;return(null!=(b=a.columns)?b.length:void 0)?cola.TableGroupColumn:cola.TableDataColumn}),cola.TableColumn=function(a){function b(a){b.__super__.constructor.call(this,a),this._name||(this._name=cola.uniqueId()),this.on("attributeChange",function(a){return function(b,c){var d;a._table&&(d=a.constructor.attributes[c.attribute],d&&d.refreshStructure&&a._table._collectionColumnsInfo())}}(this))}return J(b,a),b.attributes={name:{reaonlyAfterCreate:!0},caption:null,align:{"enum":["left","center","right"]},visible:{type:"boolean",defaultValue:!0,refreshStructure:!0},headerTemplate:null},b.events={renderHeader:null,headerClick:null},b.prototype._setTable=function(a){this._table&&this._table._unregColumn(this),this._table=a,a&&a._regColumn(this)},b.prototype.getTemplate=function(a){var b,c,d;return c=this["_real_"+a],void 0!==c?c:(d=this.get(a))?("string"==typeof d?d.indexOf("<")>=0?c=$.xCreate(d):d.match(/^\#[\w\-\$]*$/)&&(c=cola.util.getGlobalTemplate(d.substring(1)),c&&(b=document.createElement("div"),b.innerHTML=c,c=b.firstElementChild)):"object"==typeof d&&(c=d.nodeType?d:$.xCreate(d)),c||(c=this._table.getTemplate(d)),this["_real_"+a]=c||null,c):null},b}(cola.Element),cola.TableGroupColumn=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.attributes={columns:{setter:function(a){n.call(this,this._table,a)}}},b.prototype._setTable=function(a){var c,d,e,f;if(b.__super__._setTable.call(this,a),this._columns)for(f=this._columns,e=0,d=f.length;d>e;e++)c=f[e],c._setTable(a)},b}(cola.TableColumn),cola.TableContentColumn=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.attributes={width:{defaultValue:80},valign:{"enum":["top","center","bottom"]},footerTemplate:null},b.events={renderCell:null,renderFooter:null,cellClick:null,footerClick:null},b}(cola.TableColumn),cola.TableDataColumn=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.attributes={dataType:{readOnlyAfterCreate:!0,setter:cola.DataType.dataTypeSetter},property:null,bind:null,template:null,sortable:null,sortDirection:null},b}(cola.TableContentColumn),cola.TableSelectColumn=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.events={change:null},b.attributes={width:{defaultValue:"42px"},align:{defaultValue:"center"}},b.prototype.renderHeader=function(a,b){var c;a.firstChild||(this._headerCheckbox=c=new cola.Checkbox({"class":"in-cell",triState:!0,change:function(a){return function(b,c){return"boolean"!=typeof c.value?a.fire("change",a,{checkbox:b,oldValue:c.oldValue,value:c.value}):void 0}}(this),click:function(a){return function(b){var c;c=b.get("checked"),a.selectAll(c),a.fire("change",a,{checkbox:b,oldValue:!c,value:c})}}(this)}),c.appendTo(a))},b.prototype.renderCell=function(a,b){var c;a.firstChild||(c=new cola.Checkbox({"class":"in-cell",bind:this._table._alias+"."+this._table._selectedProperty,change:function(a){return function(){a._ignoreCheckedChange||a.refreshHeaderCheckbox()}}(this)}),c.appendTo(a))},b.prototype.refreshHeaderCheckbox=function(){this._headerCheckbox&&cola.util.delay(this,"refreshHeaderCheckbox",50,function(){var a,b,c,d;d=this._table,c=d._selectedProperty,d._realItems&&(a=0,b=void 0,cola.each(this._table._realItems,function(e){var f,g;if(f=d._getItemType(e),"default"===f)if(a++,g=e instanceof cola.Entity?e.get(c):e[c],1===a)b=g;else if(b!==g)return b=void 0,!1}),this._headerCheckbox.set("value",b))})},b.prototype.selectAll=function(a){var b,c;c=this._table,b=c._selectedProperty,c._realItems&&(this._ignoreCheckedChange=!0,cola.each(this._table._realItems,function(d){var e;e=c._getItemType(d),"default"===e&&(d instanceof cola.Entity?d.set(b,a):(d[b],c.refreshItem(d)))}),setTimeout(function(a){return function(){a._ignoreCheckedChange=!1}}(this),100))},b}(cola.TableContentColumn),n=function(a,b){var c,d,e,f,g,h,i,j;if(null!=a?a._columns:void 0)for(j=a._columns,h=0,f=j.length;f>h;h++)c=j[h],c._setTable(null);if(e=[],b)for(i=0,g=b.length;g>i;i++)d=b[i],d&&(c=d instanceof cola.TableColumn?d:cola.create("table.column",d,cola.TableColumn),c._setTable(a),e.push(c));this._columns=e},cola.AbstractTable=function(a){function b(a){this._columnMap={},b.__super__.constructor.call(this,a)}return J(b,a),b.attributes={items:{refreshItems:!0,setter:function(a){this._items!==a&&(this._set("bind",void 0),this._items=a)}},bind:{setter:function(a){this._bindStr!==a&&(this._set("items",void 0),this._bindSetter(a))}},columns:{setter:function(a){n.call(this,this,a),this._collectionColumnsInfo()}},dataType:{setter:cola.DataType.dataTypeSetter},showHeader:{type:"boolean",defaultValue:!0},showFooter:{type:"boolean"},columnStrecthable:{type:"boolean",defaultValue:!0},selectedProperty:{defaultValue:"selected"},sortMode:{defaultValue:"remote"}},b.events={renderRow:null,renderCell:null,renderHeaderCell:null,renderFooterCell:null,cellClick:null,headerClick:null,footerClick:null,sortDirectionChange:null},b.TEMPLATES={"default":{tagName:"tr"},"boolean-column":{"c-display":"$default",content:{tagName:"i","class":"green checkmark icon"}},"checkbox-column":{tagName:"c-checkbox","class":"in-cell",bind:"$default"},"input-column":{tagName:"c-input","class":"in-cell",bind:"$default",style:{width:"100%"}},"group-header":{tagName:"tr",content:{tagName:"td",colSpan:100}}},b.prototype._getItems=function(){return this._items?{items:this._items}:b.__super__._getItems.call(this)},b.prototype._regColumn=function(a){a._name&&(this._columnMap[a._name]=a)},b.prototype._unregColumn=function(a){a._name&&delete this._columnMap[a._name]},b.prototype.getColumn=function(a){return this._columnMap[a]},b.prototype._collectionColumnsInfo=function(){var a,b,c,d,e,f,g;if(b=function(a,c,d){var e,f,g,h,i,j,k,l,m;if(h={level:d,column:a},a instanceof cola.TableGroupColumn){if(a._columns){for(h.columns=g=[],k=a._columns,j=0,i=k.length;i>j;j++)f=k[j],f._visible&&(c.rows.length===d&&(c.rows[d]=[]),g.push(b(f,c,d+1)));g.length&&(c.rows.length===d&&(c.rows[d]=[]),c.rows[d].push(h))}}else a._bind&&(e=a._bind,46===e.charCodeAt(0)?a._property||(a._property=e.substring(1)):h.expression=cola._compileExpression(e)),a._width&&(l=a._width,"string"==typeof l&&(l.indexOf("px")>0?m="px":l.indexOf("%")>0&&(m="percent")),h.widthType=m,h.width=parseInt(l,10),!m&&h.width&&(c.totalWidth+=h.width)),h.index=c.dataColumns.length,c.dataColumns.push(h),a instanceof cola.TableSelectColumn&&(null==c.selectColumns&&(c.selectColumns=[]),c.selectColumns.push(h)),c.rows.length===d&&(c.rows[d]=[]),c.rows[d].push(h);return h},this._columnsInfo=c={totalWidth:0,rows:[[]],dataColumns:[],alias:"item"},this._columns)for(d=this._itemsScope.expression,d&&(c.alias=d.alias),g=this._columns,f=0,e=g.length;e>f;f++)a=g[f],a._visible&&b(a,c,0)},b.prototype._getBindDataType=function(){return this._dataType?this._dataType:this._dataType=b.__super__._getBindDataType.call(this)},b.prototype._createDom=function(){var a;return a=document.createElement("div"),null==this._doms&&(this._doms={}),this._createInnerDom(a),a},b.prototype._createInnerDom=function(a){$fly(a).xAppend({tagName:"div","class":"table-wrapper",contextKey:"itemsWrapper",content:{tagName:"table",contextKey:"table",content:[{tagName:"colgroup",contextKey:"colgroup",span:100},{tagName:"tbody","class":"items",contextKey:"tbody"}]}},this._doms),$fly(this._doms.tbody).delegate(">tr >td","click",function(a){return function(b){var c,d,e;d=b.currentTarget._name,c=a.getColumn(d),e={column:c},c.fire("cellClick",a,e)!==!1&&a.fire("cellClick",a,e)}}(this))},b.prototype._parseDom=function(a){var b,c,d,e,f;if(a){for(null==this._doms&&(this._doms={}),d=[],b=a.firstChild;b;)e=b.nextSibling,f=b.nodeName,"TEMPLATE"===f?this.regTemplate(b):("COLUMN"===f?(c=this._parseColumnDom(b),c&&d.push(c)):"SELECT-COLUMN"===f&&(c=this._parseColumnDom(b),c.$type="select",c&&d.push(c)),a.removeChild(b)),b=e;d.length&&this.set("columns",d),this._createInnerDom(a)}},b.prototype._parseColumnDom=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;for(e={},k=a.attributes,h=0,g=k.length;g>h;h++)b=k[h],c=b.name,"c-"===c.substring(0,2)?(f=cola._compileExpression(b.value),e[c.substring(2)]=f):e[c]=b.value;for(d=a.firstChild;d;)i=d.nextSibling,j=d.nodeName,"TEMPLATE"===j?(m=d.getAttribute("name"),m=m&&0===m.indexOf("header")?"headerTemplate":m&&0===m.indexOf("footer")?"footerTemplate":"template",e[m]=this.trimTemplate(d)):1===d.nodeType&&(l=this._parseColumnDom(d),null==e.columns&&(e.columns=[]),e.columns.push(l)),d=i;return e},b.prototype._createNewItem=function(a,b){var c,d;return d=this.getTemplate(a),c=this._cloneTemplate(d),$fly(c).addClass("table item "+a),c._itemType=a,c},b}(cola.AbstractList),cola.Table=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-table",b.CLASS_NAME="items-view widget-table",b.prototype._initDom=function(a){b.__super__._initDom.call(this,a),$fly(window).resize(function(a){return function(){var b,c;a._fixedHeaderVisible&&(c=a._getFixedHeader(),$fly(c).width(a._doms.itemsWrapper.clientWidth)),a._fixedFooterVisible&&(b=a._getFixedFooter(),$fly(b).width(a._doms.itemsWrapper.clientWidth))}}(this)),this._bindKeyDown()},b.prototype._convertItems=function(a){return a=b.__super__._convertItems.call(this,a),this._sortCriteria&&(a=cola.util.sort(a,this._sortCriteria)),a},b.prototype._sysHeaderClick=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(a instanceof cola.TableDataColumn&&a.get("sortable")){if(n=a.get("sortDirection"),n="asc"===n?"desc":"desc"===n?null:"asc",a.set("sortDirection",n),this.fire("sortDirectionChange",this,{column:a,sortDirection:n})===!1)return;if(e=this._realOriginItems||this._realItems,!e)return;if(n){if(f="asc"===n?"+":"-",l=a._bind,l&&!l.match(/\(/)||(l=a._property),!l)return;46===l.charCodeAt(0)?l=l.slice(1):this._alias&&0===l.indexOf("."+this._alias)&&(l=l.slice(this._alias.length+1)),f+=l}else f=null;for(d=this._columnsInfo.dataColumns,i=0,h=d.length;h>i;i++)c=d[i],b=c.column,b!==a&&b.set("sortDirection",null);if("remote"===this._sortMode){if(e instanceof cola.EntityList&&(g=e._providerInvoker)){if(j=g.invokerOptions.data){if("object"!=typeof j||j instanceof Date)throw new cola.Exception("Can not set sort parameter automatically.")}else g.invokerOptions.data=j={};if(j.sort=f,m=g.ajaxService,j=m.get("parameter")){if("object"!=typeof j||j instanceof Date)throw new cola.Exception("Can not set sort parameter automatically.")}else m.set("parameter",j={});j.sort=f,cola.util.flush(e),k=!0}if(!k)throw new cola.Exception("Remote sort not supported.")}else this._sortCriteria=f,this._refreshItems()}},b.prototype._doRefreshItems=function(){var a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(this._columnsInfo){if(g=this._getBindDataType(),!this._columnsInfo.dataColumns.length&&g&&g instanceof cola.EntityDataType){for(f=[],o=g.getProperties().elements,k=0,i=o.length;i>k;k++)n=o[k],f.push({bind:n._property});this.set("columns",f)}for(d=this._doms.colgroup,l=d.firstChild,p=this._columnsInfo.dataColumns,h=m=0,j=p.length;j>m;h=++m)c=p[h],a=l,a?l=a.nextSibling:(a=document.createElement("col"),d.appendChild(a)),"percent"===c.widthType?a.width=c.width+"%":c.widthType?a.width=c.width+c.widthType:c.width?a.width=100*c.width/this._columnsInfo.totalWidth+"%":a.width="",e=c.column,a.valign=e._valign||"";for(a=l;a;)l=a.nextSibling,d.removeChild(a),a=l;q=this._doms.tbody,this._showHeader&&(s=this._doms.thead,s||($fly(q).xInsertBefore({tagName:"thead",contextKey:"thead"},this._doms),s=this._doms.thead,$fly(s).delegate("th","click",function(a){return function(b){var c,d;c=b.currentTarget._name,e=a.getColumn(c),d={column:e},e.fire("headerClick",a,d)!==!1&&a.fire("headerClick",a,d)!==!1&&a._sysHeaderClick(e)}}(this))),this._refreshHeader(s)),b.__super__._doRefreshItems.call(this,q),this._showFooter&&(r=this._doms.tfoot,r||($fly(q).xInsertAfter({tagName:"tfoot",contextKey:"tfoot"},this._doms),r=this._doms.tfoot,$fly(r).delegate("td","click",function(a){return function(b){var c,d;c=b.currentTarget._name,e=a.getColumn(c),d={column:e},e.fire("footerClick",a,d)!==!1&&a.fire("footerClick",a,d)}}(this))),this._refreshFooter(r),this._fixedFooterVisible||(this._showFooterTimer=setInterval(function(a){return function(){var b;b=a._doms.itemsWrapper,b.scrollHeight&&a._refreshFixedFooter(300)}}(this),300)))}},b.prototype._onItemInsert=function(a){b.__super__._onItemInsert.call(this,a),this._columnsInfo.selectColumns&&cola.util.delay(this,"refreshHeaderCheckbox",100,function(a){return function(){var b,c,d,e;for(e=a._columnsInfo.selectColumns,d=0,c=e.length;c>d;d++)b=e[d],b.column.refreshHeaderCheckbox()}}(this))},b.prototype._onItemRemove=function(a){b.__super__._onItemRemove.call(this,a),this._showFooter&&this._refreshFixedFooter(),this._columnsInfo.selectColumns&&cola.util.delay(this,"refreshHeaderCheckbox",100,function(a){return function(){var b,c,d,e;for(e=a._columnsInfo.selectColumns,d=0,c=e.length;c>d;d++)b=e[d],b.column.refreshHeaderCheckbox()}}(this))},b.prototype._refreshHeader=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;for(f=null,o=this._columnsInfo.rows,g=0,j=o.length;j>g;){for(m=a.rows[g],m||(m=$.xCreate({tagName:"tr"}),null==f&&(f=document.createDocumentFragment()),f.appendChild(m)),n=o[g],i=l=0,k=n.length;k>l;i=++l){for(c=n[i],d=c.column,b=m.cells[i];b&&b._name!==d._name;)m.removeChild(b),b=m.cells[i];b||(h=!0,b=$.xCreate({tagName:"th",content:{tagName:"div"}}),b._name=d._name,m.appendChild(b)),b._index=c.index,c.columns?(b.rowSpan=1,b.colSpan=c.columns.length):(b.rowSpan=j-g,b.colSpan=1),e=b.firstChild,this._refreshHeaderCell(e,c,h)}for(;m.lastChild&&m.lastChild!==b;)m.removeChild(m.lastChild);cola.xRender(m,this._scope),g++}for(f&&a.appendChild(f);a.lastChild&&a.lastChild!==m;)a.removeChild(a.lastChild)},b.prototype._refreshHeaderCell=function(a,b,c){var d,e,f,g,h,i;f=b.column,a.style.textAlign=f._align||"left",d=$fly(a.parentNode),d.toggleClass("sortable",!!f._sortable).removeClass("asc desc"),f._sortDirection&&d.addClass(f._sortDirection),f.renderHeader&&f.renderHeader(a)!==!0||f.getListeners("renderHeader")&&f.fire("renderHeader",f,{dom:a})===!1||this.getListeners("renderHeaderCell")&&this.fire("renderHeaderCell",this,{column:f,dom:a})===!1||(c&&(i=f.getTemplate("headerTemplate"),i&&(i=this._cloneTemplate(i),a.appendChild(i))),f._real_headerTemplate||(g=this._getBindDataType(),e=f._caption,e||(g&&f._property&&(h=g.getProperty(f._property),h&&(e=h._caption||h._property)),null==e&&(e=f._name),95===(null!=e?e.charCodeAt(0):void 0)&&(e=f._bind)),a.innerText=e||""))},b.prototype._refreshFooter=function(a){var b,c,d,e,f,g,h,i,j,k;for(d=this._columnsInfo.dataColumns,k=a.rows[0],k||(k=document.createElement("tr")),g=j=0,i=d.length;i>j;g=++j){for(c=d[g],e=c.column,b=k.cells[g];b&&b._name!==e._name;)k.removeChild(b),b=k.cells[g];b||(h=!0,b=$.xCreate({tagName:"td",content:{tagName:"div"}}),b._name=e._name,k.appendChild(b)),f=b.firstChild,this._refreshFooterCell(f,c,h)}for(;k.lastChild!==b;)k.removeChild(k.lastChild);cola.xRender(k,this._scope),a.rows.length<1&&a.appendChild(k)},b.prototype._refreshFooterCell=function(a,b,c){var d,e;d=b.column,a.style.textAlign=d._align||"left",d.renderFooter&&d.renderFooter(a)!==!0||d.getListeners("renderFooter")&&d.fire("renderFooter",d,{dom:a})===!1||this.getListeners("renderFooterCell")&&this.fire("renderFooterCell",this,{column:d,dom:a})===!1||(c&&(e=d.getTemplate("footerTemplate"),e&&(e=this._cloneTemplate(e),a.appendChild(e))),d._real_footerTemplate||(a.innerHTML="&nbsp;"))},b.prototype._doRefreshItemDom=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;if(k=a._itemType,(!this.getListeners("renderRow")||this.fire("renderRow",this,{item:b,dom:a,scope:c})!==!1)&&"default"===k){for(f=this._columnsInfo.dataColumns,i=m=0,l=f.length;l>m;i=++m){for(e=f[i],g=e.column,d=a.cells[i];d&&d._name!==g._name;)a.removeChild(d),d=a.cells[i];d||(j=!0,d=$.xCreate({tagName:"td",content:{tagName:"div"}}),d._name=g._name,a.appendChild(d)),h=d.firstChild,this._refreshCell(h,b,e,c,j)}for(;a.lastChild&&a.lastChild!==d;)a.removeChild(a.lastChild)}},b.prototype._refreshCell=function(a,b,c,d,e){var f,g,h,i,j,k;g=c.column,a.style.textAlign=g._align||"",g.renderCell&&g.renderCell(a,b,d)!==!0||g.getListeners("renderCell")&&g.fire("renderCell",g,{item:b,dom:a,scope:d})===!1||this.getListeners("renderCell")&&this.fire("renderCell",this,{item:b,column:g,dom:a,scope:d})===!1||(e&&(j=g.getTemplate("template"),j&&(j=this._cloneTemplate(j),a.appendChild(j),g._property&&(h=g._format?{defaultPath:"format("+this._alias+"."+g._property+","+g._format+")"}:{defaultPath:this._alias+"."+g._property}),cola.xRender(a,d,h))),g._real_template||(f=$fly(a),c.expression?f.attr("c-bind",c.expression.raw):g._property&&(k=b.get(g._property),g._format?k=cola.defaultAction.format(k,g._format):k instanceof Date&&(i=cola.setting("defaultDateFormat"),i&&(k=cola.defaultAction.formatDate(k,i))),void 0!==k&&null!==k||(k=""),f.text(k))))},b.prototype._refreshFakeRow=function(a){var b,c,d,e,f,g,h;for(g=a.firstChild,h=this._columnsInfo.dataColumns,d=f=0,e=h.length;e>f;d=++f)c=h[d],b=g,b?g=g.nextSibling:(b=$.xCreate({tagName:"td"}),a.appendChild(b));for(;g;)b=g,g=g.nextSibling,a.removeChild(b)},b.prototype._getFixedHeader=function(a){var b,c;return c=this._doms.fixedHeaderWrapper,!c&&a&&(c=$.xCreate({tagName:"div",contextKey:"fixedHeaderWrapper","class":"fixed-header table-wrapper",content:{tagName:"table",contextKey:"fixedHeaderTable"}},this._doms),this._dom.appendChild(c),this._doms.fakeThead=b=$.xCreate({tagName:"thead",content:{tagName:"tr"}}),this._refreshFakeRow(b.firstChild),$fly(this._doms.tbody).before(b)),c},b.prototype._getFixedFooter=function(a){var b,c;return c=this._doms.fixedFooterWrapper,!c&&a&&(c=$.xCreate({tagName:"div",contextKey:"fixedFooterWrapper","class":"fixed-footer table-wrapper",content:{tagName:"table",contextKey:"fixedFooterTable"}},this._doms),this._dom.appendChild(c,this._doms),this._doms.fakeTfoot=b=$.xCreate({tagName:"tfoot",content:{tagName:"tr"}}),this._refreshFakeRow(b.firstChild),$fly(this._doms.tbody).after(b)),c},b.prototype._refreshFixedColgroup=function(a,b){var c,d,e,f;for(e=a.firstChild,f=b.firstChild;e;)c=e,e=e.nextSibling,d=f,d?f=f.nextSibling:d=document.createElement("col"),d.width=c.width,d.valign=c.valign;for(;f;)d=f,f=f.nextSibling,b.removeChild(d)},b.prototype._setFixedHeaderSize=function(){var a,b;a=this._doms.colgroup,b=this._doms.fixedHeaderColgroup,b?this._refreshFixedColgroup(a,b):(this._doms.fixedHeaderColgroup=b=a.cloneNode(!0),this._doms.fixedHeaderTable.appendChild(b)),$fly(this._doms.fakeThead.firstChild).height(this._doms.thead.offsetHeight)},b.prototype._setFixedFooterSize=function(){var a,b;a=this._doms.colgroup,b=this._doms.fixedFooterColgroup,b?this._refreshFixedColgroup(a,b):(this._doms.fixedFooterColgroup=b=a.cloneNode(!0),this._doms.fixedFooterTable.appendChild(b)),$fly(this._doms.fakeTfoot.firstChild).height(this._doms.tfoot.offsetHeight)},b.prototype._refreshFixedHeader=function(){var a,b,c,d;b=this._doms.itemsWrapper,c=b.scrollTop,d=c>0,d!==this._fixedHeaderVisible&&(this._fixedHeaderVisible=d,d?(a=this._getFixedHeader(!0),this._setFixedHeaderSize(),$fly(this._doms.tbody).before(this._doms.fakeThead),this._doms.fixedHeaderTable.appendChild(this._doms.thead),$fly(a).width(b.clientWidth).show()):(a=this._getFixedHeader(),a&&($fly(a).hide(),this._doms.fixedHeaderTable.appendChild(this._doms.fakeThead),$fly(this._doms.tbody).before(this._doms.thead))))},b.prototype._refreshFixedFooter=function(a){var b,c,d,e,f,g;this._showFooterTimer&&(clearInterval(this._showFooterTimer),delete this._showFooterTimer),d=this._doms.itemsWrapper,f=d.scrollTop,e=d.scrollHeight-d.clientHeight,g=e>f,g!==this._fixedFooterVisible&&(this._fixedFooterVisible=g,g?(c=this._getFixedFooter(!0),this._setFixedFooterSize(),$fly(this._doms.tbody).after(this._doms.fakeTfoot),this._doms.fixedFooterTable.appendChild(this._doms.tfoot),b=$fly(c).width(d.clientWidth),a?b.fadeIn(a):b.show()):(c=this._getFixedFooter(),c&&($fly(c).hide(),this._doms.fixedFooterTable.appendChild(this._doms.fakeTfoot),$fly(this._doms.tbody).after(this._doms.tfoot))))},b.prototype._onItemsWrapperScroll=function(){return this._showHeader&&this._refreshFixedHeader(),this._showFooter&&this._refreshFixedFooter(),b.__super__._onItemsWrapperScroll.call(this)},b.prototype._bindKeyDown=function(){var a;a=this,$(this._dom).delegate("input","keydown",function(b){var c,d,e;return e=$(this).closest("td")[0],d=$(e).parent()[0],c=cola.util.userData(d,"item"),"default"===d._itemType&&c?a._changeCurrentItem&&c.parent instanceof cola.EntityList?c.parent.setCurrent(c):a._setCurrentItemDom(d):void 0}),$(this._dom).delegate("input","keydown",function(b){var c,d,e,f,g,h,i,j,k,l,m;return h=b.keyCode,e=b.ctrlKey,k=$(this).closest("td")[0],m=$(k).parent()[0],d=$(k).index(),38===h?j=m.previousElementSibling:40===h?j=m.nextElementSibling:e&&37===h?i=k.previousElementSibling:e&&39===h&&(i=k.nextElementSibling),j&&(l=$(j).find(">td"),l.length>=d&&(i=l[d]),g=cola.util.userData(j,"item"),"default"===j._itemType&&g&&(a._changeCurrentItem&&g.parent instanceof cola.EntityList?g.parent.setCurrent(g):a._setCurrentItemDom(j))),i&&(c=$(i).find(".ui.input"),c.length>0&&(f=cola.widget(c[0]),f&&f.focus())),38===h||40===h||e&&37===h||e&&39===h?b.preventDefault():void 0})},b.prototype.focus=function(){var a,b,c;if(this._$dom)return c=this._$dom.find("table")[0],b=$(c.tBodies).find(".ui.input"),b.length&&(a=cola.widget(b[0]))?a.focus():void 0},b}(cola.AbstractTable),cola.registerWidget(cola.Table),r=["firstPage","prevPage","info","nextPage","lastPage"],q={"|<":"firstPage","<":"prevPage",">":"nextPage",">|":"lastPage"},cola.Pager=function(a){function b(a){var c,d;this._pagerItemMap={},d=this,c=function(){var a;return a=d._getBindItems(),parseInt((a.totalEntityCount+a.pageSize-1)/a.pageSize)},this._pagerItemConfig={firstPage:{icon:"angle double left","class":"page-item",click:function(){var a;return null!=(a=d._getBindItems())?a.firstPage():void 0}},prevPage:{icon:"angle left","class":"page-item",click:function(){var a;return a=d._getBindItems(),null!=a?a.previousPage():void 0}},pageSize:{$type:"input","class":"page-item page-size",inputType:"number",initDom:function(a,b){a.get$Dom().find("input").attr("min",0)},keyDown:function(a,b){var c;return c=b.keyCode,190===c?event.preventDefault():void 0},change:function(a,b){var c,e,f;if(f=b.value,c=d._getBindItems()){if(f&&(f=parseInt(f)),f===c.pageSize)return;if(c instanceof cola.EntityList)return e=c._providerInvoker,e.ajaxService.set("pageSize",f),cola.util.flush(c)}}},"goto":{$type:"input","class":"goto",inputType:"number",initDom:function(a,b){a.get$Dom().find("input").attr("min",0)},keyDown:function(a,b){var c;return c=b.keyCode,190===c?event.preventDefault():void 0},change:function(a,b){var e,f,g,h,i;return i=b.value,i&&(i=parseInt(i)),i!==this._targetPageNo?(f=d._getBindItems(),f?(h=f.pageNo,g=c(),(i>g||1>i)&&(i>g&&(i=g),1>i&&(i=1),setTimeout(function(){return a.get$Dom().find("input").val(i)},10)),e=a.get("actionButton"),setTimeout(function(){return e.set("disabled",i===h)},100),d._targetPageNo=i):void 0):void 0},actionButton:{$type:"Button",caption:"Go",click:function(){var a;return d._targetPageNo?(a=d._getBindItems(),null!=a?a.gotoPage(d._targetPageNo):void 0):void 0}}},nextPage:{icon:"angle right","class":"page-item",click:function(){var a;return a=d._getBindItems(),null!=a?a.nextPage():void 0}},lastPage:{icon:"angle double right","class":"page-item",click:function(){var a;return a=d._getBindItems(),null!=a?a.lastPage():void 0}}},b.__super__.constructor.call(this,a)}return J(b,a),b.tagName="c-pager",b.CLASS_NAME="ui menu pager secondary",b.attributes={bind:{setter:function(a){return this._bindSetter(a)}}},b.prototype._getBindItems=function(){var a;return null!=(a=this._getItems())?a.items:void 0},b.prototype._parseDom=function(a){var c,d,e,f;for(b.__super__._parseDom.call(this,a),c=!1,e=0,d=r.length;d>e;e++)if(f=r[e],this._pagerItemMap[f]){c=!0;break}return c||this.addItem("pages"),null!=this._items?this._items:this._items=[]},b.prototype._parsePageItem=function(a,b){var c,d,e,f,g,h,i,j,k,l;if(i=$fly(a).attr("page-code"))if("pages"===i)for(h=0,f=r.length;f>h;h++)k=r[h],j=this._pagerItemConfig[k],"firstPage"===k?(j.dom=a,g=new cola.menu.MenuItem(j),b?this.addRightItem(g):this.addItem(g),c=a):(g="info"===k?new cola.menu.MenuItem({type:"container"}):new cola.menu.MenuItem(j),e=g.getDom(),$fly(c).after(e),e._eachIgnore=!0,b?this.addRightItem(g):this.addItem(g),c=e),this._pagerItemMap[k]=g;else l=q[i],l?(d=this._pagerItemConfig[l],d.dom=a,$(a).text()&&delete d.icon,g=new cola.menu.MenuItem(d),b?this.addRightItem(g):this.addItem(g)):"goto"===i?(l="goto",d={dom:a,type:"container",content:this._pagerItemConfig[i]},g=new cola.menu.MenuItem(d),b?this.addRightItem(g):this.addItem(g)):"pageSize"===i?(l="pageSize",d={dom:a,type:"container",content:this._pagerItemConfig[i]},g=new cola.menu.MenuItem(d),b?this.addRightItem(g):this.addItem(g)):"info"===i&&(l="info",d={dom:a},g=new cola.menu.MenuItem(d),b?this.addRightItem(g):this.addItem(g)),this._pagerItemMap[l]=g},b.prototype._parseItems=function(a){var b,c,d,e,f;for(e=function(a){return function(b){var c,d,e;for(c=b.firstChild,null==a._rightItems&&(a._rightItems=[]);c;)1===c.nodeType&&(e=$fly(c).attr("page-code"),e?a._parsePageItem(c,!0):(d=cola.widget(c),d?a.addRightItem(d):cola.util.hasClass(c,"item")&&(d=new cola.menu.MenuItem({dom:c}),a.addRightItem(d)))),c=c.nextSibling}}(this),b=a.firstChild,f=[];b;)b._eachIgnore?b=b.nextSibling:(1===b.nodeType&&(d=$fly(b).attr("page-code"),d?this._parsePageItem(b):(c=cola.widget(b),c?this.addItem(c):!this._rightMenuDom&&cola.util.hasClass(b,"right menu")?(this._rightMenuDom=b,e(b)):cola.util.hasClass(b,"item")&&(c=new cola.menu.MenuItem({dom:b}),this.addItem(c)))),f.push(b=b.nextSibling));return f},b.prototype._createItem=function(a,b){var c,d,e,f,g,h,i;{if("string"!=typeof a)return e=null,a.constructor===Object.prototype.constructor?e=a.$type?"dropdown"===a.$type?new cola.menu.DropdownMenuItem(a):new cola.menu.MenuItem({
content:a,type:"container"}):new cola.menu.MenuItem(a):a instanceof cola.menu.AbstractMenuItem&&(e=a),e;if("pages"===a)for(f=0,d=r.length;d>f;f++)h=r[f],g=this._pagerItemConfig[h],e="info"===h?new cola.menu.MenuItem({type:"container"}):new cola.menu.MenuItem(g),b?this.addRightItem(e):this.addItem(e),this._pagerItemMap[h]=e;else i=q[a],i?(c=this._pagerItemConfig[i],e=new cola.menu.MenuItem(c)):"goto"===a?(i=a,c={content:this._pagerItemConfig[a],type:"container"},e=new cola.menu.MenuItem(c)):"pageSize"===a?(i=a,c={content:this._pagerItemConfig[a],type:"container"},e=new cola.menu.MenuItem(c)):"info"===a&&(i=a,e=new cola.menu.MenuItem),b?this.addRightItem(e):this.addItem(e),this._pagerItemMap[i]=e}},b.prototype._initDom=function(a){return b.__super__._initDom.call(this,a),this.pagerItemsRefresh()},b.prototype.pagerItemsRefresh=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;return p=this,a=p._getBindItems(),g=!1,f=!1,k=0,j=0,v=0,l=0,a&&(j=parseInt((a.totalEntityCount+a.pageSize-1)/a.pageSize),v=a.totalEntityCount,g=a.pageNo>1,f=j>a.pageNo,k=a.pageNo,j=a.pageCount,l=a.pageSize),this._pageNo=k,null!=(q=p._pagerItemMap.firstPage)&&q.get$Dom().toggleClass("disabled",!g),null!=(r=p._pagerItemMap.prevPage)&&r.get$Dom().toggleClass("disabled",!g),null!=(s=p._pagerItemMap.nextPage)&&s.get$Dom().toggleClass("disabled",!f),null!=(t=p._pagerItemMap.lastPage)&&t.get$Dom().toggleClass("disabled",!f),h=p._pagerItemMap.info,h&&(i=1===h.nodeType?h:h.getDom(),$(i).addClass("page-item desc").text(cola.resource("cola.pager.info",k,j,v))),e=p._pagerItemMap["goto"],e&&(c=e.get("content")[0],c&&(d=cola.widget(c),null!=d&&d.set("value",k),null!=d&&d.get$Dom().parent().addClass("page-item desc"))),o=p._pagerItemMap.pageSize,o&&(m=1===o.nodeType?o:o.getDom(),b=$(m).find(">.page-size-desc"),$(m).addClass("page-item desc"),b.length||$(m).prepend($.xCreate({tagName:"span","class":"page-size-desc",content:cola.resource("cola.pager.pageSize")})),n=o.get("content")[0])&&null!=(u=cola.widget(n))?u.set("value",l):void 0},b.prototype._onItemsRefresh=function(){return this.pagerItemsRefresh()},b.prototype._onItemRefresh=function(a){},b.prototype._onItemInsert=function(a){},b.prototype._onItemRemove=function(a){},b.prototype._onItemsLoadingStart=function(a){},b.prototype._onItemsLoadingEnd=function(a){},b.prototype._onCurrentItemChange=function(a){return this._pageNo!==a.entityList.pageNo?this.pagerItemsRefresh():void 0},b}(cola.Menu),cola.Element.mixin(cola.Pager,cola.DataItemsWidgetMixin),cola.registerWidget(cola.Pager),cola.TimeLine=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return J(b,a),b.tagName="c-timeLine",b.CLASS_NAME="time-line",b.attributes={bind:{refreshItems:!0,setter:function(a){return this._bindSetter(a)}}},b.TEMPLATES={"default":{tagName:"li"},content:{tagName:"div","c-bind":"$default.content"},icon:{tagName:"i","c-class":"'icon '+$default.icon"},label:{tagName:"div","c-bind":"$default.label"}},b.prototype._createNewItem=function(a,b){var c,d,e,f,g,h,i,j;for(j=this.getTemplate(a),e=this._cloneTemplate(j),$fly(e).addClass("item "+a),e._itemType=a,i=["content","icon","label"],g=0,f=i.length;f>g;g++)h=i[g],j=this.getTemplate(h),d=this._cloneTemplate(j,!0),c=$.xCreate({tagName:"div","class":h}),c.appendChild(d),e.appendChild(c);return this._currentItem||this._setCurrentNode(b),e},b}(cola.AbstractList),cola.registerWidget(cola.TimeLine)}.call(this);